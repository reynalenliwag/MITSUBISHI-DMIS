VERSION 5.00
Object = "{86CF1D34-0C5F-11D2-A9FC-0000F8754DA1}#2.0#0"; "MSCOMCT2.OCX"
Object = "{B8CDB61A-9806-4F7E-814B-BE4071F425B9}#1.0#0"; "wizProgBar.ocx"
Object = "{C8E5842E-102B-4289-9D57-3B3F5B5E15D3}#10.4#0"; "CO774D~1.OCX"
Object = "{976422A2-3979-40ED-B01B-D2C4E24678A7}#1.6#0"; "FlexCell.ocx"
Begin VB.Form frmSALESImport 
   BackColor       =   &H00FFFFFF&
   BorderStyle     =   1  'Fixed Single
   Caption         =   "SALES Import Process"
   ClientHeight    =   7800
   ClientLeft      =   345
   ClientTop       =   1110
   ClientWidth     =   13980
   FillColor       =   &H8000000D&
   ForeColor       =   &H00FFFFFF&
   LinkTopic       =   "Form1"
   MaxButton       =   0   'False
   MDIChild        =   -1  'True
   ScaleHeight     =   7800
   ScaleWidth      =   13980
   Begin VB.CommandButton cmdExit 
      BackColor       =   &H00FFFFFF&
      Caption         =   "E&xit"
      BeginProperty Font 
         Name            =   "Segoe UI"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   795
      Left            =   13185
      MouseIcon       =   "SALESImport.frx":0000
      MousePointer    =   99  'Custom
      Picture         =   "SALESImport.frx":0152
      Style           =   1  'Graphical
      TabIndex        =   3
      ToolTipText     =   "Exit Window"
      Top             =   6930
      Width           =   720
   End
   Begin VB.CommandButton cmdCheck 
      BackColor       =   &H00FFFFFF&
      Caption         =   "&Import"
      Enabled         =   0   'False
      BeginProperty Font 
         Name            =   "Segoe UI"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   795
      Left            =   12480
      MouseIcon       =   "SALESImport.frx":04B8
      MousePointer    =   99  'Custom
      Picture         =   "SALESImport.frx":060A
      Style           =   1  'Graphical
      TabIndex        =   4
      ToolTipText     =   "Process Importing of Sales"
      Top             =   6930
      Width           =   720
   End
   Begin VB.CommandButton cmdClearJournals 
      BackColor       =   &H0080FF80&
      Caption         =   "Clear Unposted Transactions"
      Enabled         =   0   'False
      BeginProperty Font 
         Name            =   "Segoe UI"
         Size            =   9.75
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Left            =   11100
      Style           =   1  'Graphical
      TabIndex        =   28
      Top             =   120
      Width           =   2775
   End
   Begin VB.CommandButton cmdShowTrans 
      BackColor       =   &H00FFFFFF&
      Caption         =   "Show Transactions"
      BeginProperty Font 
         Name            =   "Segoe UI"
         Size            =   9.75
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Left            =   3600
      MousePointer    =   99  'Custom
      Style           =   1  'Graphical
      TabIndex        =   27
      ToolTipText     =   "Process Import of Sales"
      Top             =   120
      Width           =   2040
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H00FFFFFF&
      BorderStyle     =   0  'None
      Height          =   855
      Left            =   -90
      ScaleHeight     =   855
      ScaleWidth      =   3195
      TabIndex        =   21
      Top             =   6690
      Width           =   3195
      Begin VB.ComboBox cboMonth 
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   9
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   345
         Left            =   850
         Style           =   2  'Dropdown List
         TabIndex        =   24
         Top             =   30
         Width           =   1335
      End
      Begin VB.ComboBox cboYear 
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   9
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   345
         Left            =   850
         Style           =   2  'Dropdown List
         TabIndex        =   23
         Top             =   420
         Width           =   1335
      End
      Begin VB.CommandButton cmdShowImp 
         BackColor       =   &H00FFFFFF&
         Caption         =   "Show"
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   705
         Left            =   2250
         Picture         =   "SALESImport.frx":08A5
         Style           =   1  'Graphical
         TabIndex        =   22
         Top             =   30
         Width           =   915
      End
      Begin VB.Label Label7 
         AutoSize        =   -1  'True
         BackColor       =   &H8000000D&
         BackStyle       =   0  'Transparent
         Caption         =   "Month"
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   9
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000D&
         Height          =   225
         Left            =   240
         TabIndex        =   26
         Top             =   120
         Width           =   540
      End
      Begin VB.Label Label8 
         AutoSize        =   -1  'True
         BackColor       =   &H8000000D&
         BackStyle       =   0  'Transparent
         Caption         =   "Year"
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   9
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000D&
         Height          =   225
         Left            =   240
         TabIndex        =   25
         Top             =   480
         Width           =   345
      End
   End
   Begin VB.PictureBox Picture3 
      BackColor       =   &H00FFFFFF&
      BorderStyle     =   0  'None
      Height          =   465
      Left            =   3120
      ScaleHeight     =   465
      ScaleWidth      =   4905
      TabIndex        =   14
      Top             =   7380
      Width           =   4905
      Begin VB.Label Label10 
         AutoSize        =   -1  'True
         BackColor       =   &H00FFFFFF&
         Caption         =   "- Imported"
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   195
         Left            =   4080
         TabIndex        =   17
         Top             =   90
         Width           =   810
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   31
         Left            =   30
         MousePointer    =   99  'Custom
         TabIndex        =   20
         Top             =   90
         Width           =   315
      End
      Begin VB.Label Label9 
         AutoSize        =   -1  'True
         BackColor       =   &H00FFFFFF&
         Caption         =   "- No Transaction"
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Left            =   420
         TabIndex        =   19
         Top             =   90
         Width           =   1260
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00C0FFC0&
         BorderStyle     =   1  'Fixed Single
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   32
         Left            =   3750
         MousePointer    =   99  'Custom
         TabIndex        =   18
         Top             =   90
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H0000FFFF&
         BorderStyle     =   1  'Fixed Single
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   33
         Left            =   1860
         MousePointer    =   99  'Custom
         TabIndex        =   16
         Top             =   90
         Width           =   315
      End
      Begin VB.Label Label11 
         AutoSize        =   -1  'True
         BackColor       =   &H00FFFFFF&
         Caption         =   "- Not Yet Imported"
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   195
         Left            =   2280
         TabIndex        =   15
         Top             =   90
         Width           =   1410
      End
   End
   Begin VB.PictureBox picBatchImport 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      ForeColor       =   &H80000008&
      Height          =   1395
      Left            =   4890
      ScaleHeight     =   1365
      ScaleWidth      =   4125
      TabIndex        =   6
      Top             =   2940
      Visible         =   0   'False
      Width           =   4155
      Begin VB.CommandButton cmdCloseRange 
         Caption         =   "X"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   11.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   285
         Left            =   3840
         TabIndex        =   8
         Top             =   0
         Width           =   255
      End
      Begin VB.CommandButton cmdBatchImporting 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFFFF&
         Caption         =   "BATCH IMPORT"
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   375
         Left            =   560
         Style           =   1  'Graphical
         TabIndex        =   7
         Top             =   900
         Width           =   3485
      End
      Begin MSComCtl2.DTPicker dtFrom 
         Height          =   405
         Left            =   570
         TabIndex        =   9
         Top             =   420
         Width           =   1545
         _ExtentX        =   2725
         _ExtentY        =   714
         _Version        =   393216
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Segoe UI"
            Size            =   9.75
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Format          =   102432769
         CurrentDate     =   40603
      End
      Begin MSComCtl2.DTPicker dtTo 
         Height          =   405
         Left            =   2520
         TabIndex        =   10
         Top             =   390
         Width           =   1545
         _ExtentX        =   2725
         _ExtentY        =   714
         _Version        =   393216
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Segoe UI"
            Size            =   9.75
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Format          =   102432769
         CurrentDate     =   40603
      End
      Begin VB.Label Label12 
         AutoSize        =   -1  'True
         BackColor       =   &H8000000D&
         BackStyle       =   0  'Transparent
         Caption         =   "To"
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   9
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000D&
         Height          =   225
         Left            =   2190
         TabIndex        =   13
         Top             =   480
         Width           =   210
      End
      Begin VB.Label Label13 
         AutoSize        =   -1  'True
         BackColor       =   &H8000000D&
         BackStyle       =   0  'Transparent
         Caption         =   "From"
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   9
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000D&
         Height          =   225
         Left            =   60
         TabIndex        =   12
         Top             =   480
         Width           =   420
      End
      Begin XtremeShortcutBar.ShortcutCaption ShortcutCaption1 
         Height          =   315
         Left            =   0
         TabIndex        =   11
         Top             =   0
         Width           =   4155
         _Version        =   655364
         _ExtentX        =   7329
         _ExtentY        =   556
         _StockProps     =   14
         Caption         =   "Select Date Range for the Month"
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         GradientColorLight=   8388608
         GradientColorDark=   8388608
         ForeColor       =   16777215
      End
   End
   Begin VB.CommandButton cmdBatchImport 
      BackColor       =   &H00FFFFFF&
      Caption         =   "&Batch"
      BeginProperty Font 
         Name            =   "Segoe UI"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   795
      Left            =   11760
      MouseIcon       =   "SALESImport.frx":1927
      MousePointer    =   99  'Custom
      Picture         =   "SALESImport.frx":1A79
      Style           =   1  'Graphical
      TabIndex        =   5
      ToolTipText     =   "Process Importing of Purchases"
      Top             =   6930
      Width           =   735
   End
   Begin VB.CheckBox chkPMIS 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      Caption         =   "PMIS"
      BeginProperty Font 
         Name            =   "Segoe UI"
         Size            =   14.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H8000000D&
      Height          =   465
      Left            =   90
      Style           =   1  'Graphical
      TabIndex        =   2
      Top             =   630
      Value           =   1  'Checked
      Width           =   4575
   End
   Begin VB.CheckBox chkCSMS 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      Caption         =   "CSMS"
      BeginProperty Font 
         Name            =   "Segoe UI"
         Size            =   14.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H8000000D&
      Height          =   465
      Left            =   4710
      Style           =   1  'Graphical
      TabIndex        =   1
      Top             =   630
      Value           =   1  'Checked
      Width           =   4575
   End
   Begin VB.CheckBox chkSMIS 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      Caption         =   "SMIS"
      BeginProperty Font 
         Name            =   "Segoe UI"
         Size            =   14.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H8000000D&
      Height          =   465
      Left            =   9330
      Style           =   1  'Graphical
      TabIndex        =   0
      Top             =   630
      Value           =   1  'Checked
      Width           =   4575
   End
   Begin wizProgBar.Prg progCPB 
      Height          =   315
      Left            =   9360
      TabIndex        =   29
      Top             =   6360
      Width           =   4545
      _ExtentX        =   8017
      _ExtentY        =   556
      Picture         =   "SALESImport.frx":2AFB
      ForeColor       =   255
      Appearance      =   0
      BorderStyle     =   2
      BarPicture      =   "SALESImport.frx":2B17
      ShowText        =   -1  'True
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      XpStyle         =   -1  'True
   End
   Begin MSComCtl2.DTPicker dtpTranDate 
      Height          =   405
      Left            =   1860
      TabIndex        =   30
      Top             =   120
      Width           =   1695
      _ExtentX        =   2990
      _ExtentY        =   714
      _Version        =   393216
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Segoe UI"
         Size            =   9.75
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Format          =   102367233
      CurrentDate     =   38216
   End
   Begin wizProgBar.Prg Prg1 
      Height          =   315
      Left            =   120
      TabIndex        =   31
      Top             =   6360
      Width           =   5865
      _ExtentX        =   10345
      _ExtentY        =   556
      Picture         =   "SALESImport.frx":2B33
      ForeColor       =   255
      Appearance      =   0
      BorderStyle     =   2
      BarColor        =   4194304
      BarPicture      =   "SALESImport.frx":2B4F
      ShowText        =   -1  'True
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      XpStyle         =   -1  'True
   End
   Begin FlexCell.Grid Grid1 
      Height          =   4965
      Left            =   90
      TabIndex        =   64
      Top             =   1110
      Width           =   4575
      _ExtentX        =   8070
      _ExtentY        =   8758
      Appearance      =   0
      BackColor2      =   16777152
      BackColorBkg    =   -2147483645
      Cols            =   6
      DefaultFontName =   "Segoe UI"
      DefaultFontSize =   8.25
      Rows            =   2
   End
   Begin FlexCell.Grid Grid2 
      Height          =   4965
      Left            =   4710
      TabIndex        =   65
      Top             =   1110
      Width           =   4575
      _ExtentX        =   8070
      _ExtentY        =   8758
      Appearance      =   0
      BackColor2      =   16777152
      BackColorBkg    =   -2147483645
      Cols            =   6
      DefaultFontName =   "Segoe UI"
      DefaultFontSize =   8.25
      Rows            =   2
   End
   Begin FlexCell.Grid Grid3 
      Height          =   4965
      Left            =   9330
      TabIndex        =   66
      Top             =   1110
      Width           =   4575
      _ExtentX        =   8070
      _ExtentY        =   8758
      Appearance      =   0
      BackColor2      =   16777152
      BackColorBkg    =   -2147483645
      Cols            =   6
      DefaultFontName =   "Segoe UI"
      DefaultFontSize =   8.25
      Rows            =   2
   End
   Begin VB.PictureBox Picture2 
      BackColor       =   &H00FFFFFF&
      BorderStyle     =   0  'None
      Height          =   765
      Left            =   3090
      ScaleHeight     =   765
      ScaleWidth      =   5805
      TabIndex        =   32
      Top             =   6720
      Width           =   5805
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   30
         Left            =   5460
         MousePointer    =   99  'Custom
         TabIndex        =   63
         Top             =   390
         Visible         =   0   'False
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   29
         Left            =   5100
         MousePointer    =   99  'Custom
         TabIndex        =   62
         Top             =   390
         Visible         =   0   'False
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   28
         Left            =   4740
         MousePointer    =   99  'Custom
         TabIndex        =   61
         Top             =   390
         Visible         =   0   'False
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   27
         Left            =   4380
         MousePointer    =   99  'Custom
         TabIndex        =   60
         Top             =   390
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   26
         Left            =   4020
         MousePointer    =   99  'Custom
         TabIndex        =   59
         Top             =   390
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   25
         Left            =   3660
         MousePointer    =   99  'Custom
         TabIndex        =   58
         Top             =   390
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   24
         Left            =   3300
         MousePointer    =   99  'Custom
         TabIndex        =   57
         Top             =   390
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   23
         Left            =   2940
         MousePointer    =   99  'Custom
         TabIndex        =   56
         Top             =   390
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   22
         Left            =   2580
         MousePointer    =   99  'Custom
         TabIndex        =   55
         Top             =   390
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   21
         Left            =   2220
         MousePointer    =   99  'Custom
         TabIndex        =   54
         Top             =   390
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   20
         Left            =   1860
         MousePointer    =   99  'Custom
         TabIndex        =   53
         Top             =   390
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   19
         Left            =   1500
         MousePointer    =   99  'Custom
         TabIndex        =   52
         Top             =   390
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   18
         Left            =   1140
         MousePointer    =   99  'Custom
         TabIndex        =   51
         Top             =   390
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   17
         Left            =   780
         MousePointer    =   99  'Custom
         TabIndex        =   50
         Top             =   390
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   16
         Left            =   420
         MousePointer    =   99  'Custom
         TabIndex        =   49
         Top             =   390
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   15
         Left            =   60
         MousePointer    =   99  'Custom
         TabIndex        =   48
         Top             =   390
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   14
         Left            =   5100
         MousePointer    =   99  'Custom
         TabIndex        =   47
         Top             =   60
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   13
         Left            =   4740
         MousePointer    =   99  'Custom
         TabIndex        =   46
         Top             =   60
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   12
         Left            =   4380
         MousePointer    =   99  'Custom
         TabIndex        =   45
         Top             =   60
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   11
         Left            =   4020
         MousePointer    =   99  'Custom
         TabIndex        =   44
         Top             =   60
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   10
         Left            =   3660
         MousePointer    =   99  'Custom
         TabIndex        =   43
         Top             =   60
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   9
         Left            =   3300
         MousePointer    =   99  'Custom
         TabIndex        =   42
         Top             =   60
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   8
         Left            =   2940
         MousePointer    =   99  'Custom
         TabIndex        =   41
         Top             =   60
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   7
         Left            =   2580
         MousePointer    =   99  'Custom
         TabIndex        =   40
         Top             =   60
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   6
         Left            =   2220
         MousePointer    =   99  'Custom
         TabIndex        =   39
         Top             =   60
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   5
         Left            =   1860
         MousePointer    =   99  'Custom
         TabIndex        =   38
         Top             =   60
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   4
         Left            =   1500
         MousePointer    =   99  'Custom
         TabIndex        =   37
         Top             =   60
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   3
         Left            =   1140
         MousePointer    =   99  'Custom
         TabIndex        =   36
         Top             =   60
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   2
         Left            =   780
         MousePointer    =   99  'Custom
         TabIndex        =   35
         Top             =   60
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   1
         Left            =   420
         MousePointer    =   99  'Custom
         TabIndex        =   34
         Top             =   60
         Width           =   315
      End
      Begin VB.Label lab 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   1  'Fixed Single
         BeginProperty Font 
            Name            =   "Segoe UI"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   255
         Index           =   0
         Left            =   60
         MousePointer    =   99  'Custom
         TabIndex        =   33
         Top             =   60
         Width           =   315
      End
   End
   Begin VB.Label Label2 
      BackColor       =   &H8000000D&
      BackStyle       =   0  'Transparent
      Caption         =   "Over All Completion"
      BeginProperty Font 
         Name            =   "Segoe UI Semibold"
         Size            =   9
         Charset         =   0
         Weight          =   600
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00000000&
      Height          =   225
      Left            =   150
      TabIndex        =   69
      Top             =   6120
      Width           =   5835
   End
   Begin VB.Label Label1 
      BackColor       =   &H8000000D&
      BackStyle       =   0  'Transparent
      Caption         =   "Transaction Date"
      BeginProperty Font 
         Name            =   "Segoe UI"
         Size            =   9
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H8000000D&
      Height          =   255
      Left            =   120
      TabIndex        =   68
      Top             =   210
      Width           =   1875
   End
   Begin VB.Label labCPB 
      BackColor       =   &H8000000D&
      BackStyle       =   0  'Transparent
      Caption         =   "Transaction Completion"
      BeginProperty Font 
         Name            =   "Segoe UI Semibold"
         Size            =   9
         Charset         =   0
         Weight          =   600
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00000000&
      Height          =   225
      Left            =   9390
      TabIndex        =   67
      Top             =   6120
      Width           =   4515
   End
End
Attribute VB_Name = "frmSALESImport"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit
Dim TransactionID                                           As String
Dim rsPMIOS_ORD_HD                                          As ADODB.Recordset
Dim rsTdayTran                                              As ADODB.Recordset
Dim rsCSMIOS_REPOR                                          As ADODB.Recordset
Dim rsCSMIOS_PARTS_NON                                      As ADODB.Recordset
Dim rsCSMIOS_SUBLET                                         As ADODB.Recordset
Dim rsCSMIOS_PMS                                            As ADODB.Recordset
Dim rsCSMIOS_LABOR                                          As ADODB.Recordset
Dim rsCSMIOS_PARTS                                          As ADODB.Recordset
Dim rsCSMIOS_PARTS_BP                                       As ADODB.Recordset
Dim rsCSMIOS_MATERIALS                                      As ADODB.Recordset
Dim rsCSMIOS_MATERIALS_BP                                   As ADODB.Recordset
Dim rsCSMIOS_GJ                                             As ADODB.Recordset
Dim rsCSMIOS_SR                                             As ADODB.Recordset
Dim rsCSMIOS_BP                                             As ADODB.Recordset
Dim rsCSMIOS_INSPMS                                         As ADODB.Recordset
Dim rsCSMIOS_INSPARTS_BP                                    As ADODB.Recordset
Dim rsCSMIOS_INSMATERIALS_BP                                As ADODB.Recordset
Dim rsCSMIOS_WARRANTYGJ                                     As ADODB.Recordset
Dim rsCSMIOS_WARRANTYSR                                     As ADODB.Recordset
Dim rsCSMIOS_WARRANTYBP                                     As ADODB.Recordset
Dim rsCSMIOS_WARRANTYPARTSBP                                As ADODB.Recordset
Dim rsCSMIOS_WARRANTYMATERIALSBP                            As ADODB.Recordset
Dim rsCSMIOS_ACCESSORIES                                    As ADODB.Recordset
Dim rsCSMIOS_ACCESSORIES_BP                                 As ADODB.Recordset
Dim rsSMIS_PURCHAGREE                                       As ADODB.Recordset
Dim rsTransferOut                                           As ADODB.Recordset
Dim rsVENDOR                                                As New ADODB.Recordset
Dim rsCSMIOS_TINSMITH                                       As New ADODB.Recordset
Dim rsINTERNAL_RO_DET                                       As ADODB.Recordset
Dim rsJournal_HDDup                                         As ADODB.Recordset
Dim DOTAX_SERVICE1                                          As ADODB.Recordset

Dim rsCheckVoucher                                          As ADODB.Recordset

'DISCOUNT
Dim CSMIOS_PMS_DISCOUNT                                     As Double
'WARRANTY
Dim WARRANTY_CSMIOS_PARTS_COST                              As Double
Dim WARRANTY_CSMIOS_PARTS_COST_BP                           As Double
Dim WARRANTY_CSMIOS_MATERIALS_COST                          As Double
Dim WARRANTY_CSMIOS_MATERIALS_COST_BP                       As Double
Dim WARRANTY_CSMIOS_ACCESSORIES_COST                        As Double
Dim WARRANTY_JNO                                            As String
Dim WARRANTY_VOUCHERNO                                      As String
Dim INSURANCE_VOUCHERNO_TAX                                 As String
Dim WARRANTY_ItemCnt                                        As Integer
Dim WARRANTY_J_JITEMNO                                      As String
Dim WARRANTY_DIRECT_EXPENSE_LABOR_COST                      As Double
Dim WARRANTY_DIRECT_EXPENSE_LABOR_COST_BP                   As Double
Dim WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR                   As Double
Dim WARRANTY_J_AMOUNTTOPAY                                  As Double
Dim WARRANTY_J_INVOICEAMT                                   As Double
Dim WARRANTY_J_BALANCE                                      As Double
Dim WARRANTY_J_AMOUNTPAID                                   As Double
'ACCESSOREIS
Dim CSMIOS_ACCESSORIES_DISCOUNT                             As Double
Dim CSMIOS_REP_OR                                           As String
Dim CSMIOS_ACCT_NO                                          As String
Dim CSMIOS_PARTICIPAT                                       As String
Dim CSMIOS_PLATE_NO                                         As String
Dim CSMIOS_NIYM                                             As String
Dim CSMIOS_TERM                                             As String
Dim CSMIOS_DTE_REL                                          As String
Dim CSMIOS_INVOICE                                          As String
Dim CSMIOS_VAT_EXEMPT                                       As Boolean
Dim CSMIOS_VAT_EXEMPT1                                      As Boolean
Dim CSMIOS_RO_AMOUNT                                        As Double
Dim CSMIOS_LABOR                                            As Double
Dim CSMIOS_PARTS, CSMIOS_PARTS_BP                           As Double
Dim CSMIOS_PARTS_NON                                        As Double
Dim CSMIOS_MATERIALS, CSMIOS_MATERIALS_BP                   As Double
Dim CSMIOS_ACCESSORIES, CSMIOS_ACCESSORIES_BP               As Double
Dim CSMIOS_LABOR_COST                                       As Double
Dim CSMIOS_PARTS_COST                                       As Double
Dim CSMIOS_PARTS_COST_BP                                    As Double
Dim CSMIOS_MATERIALS_COST                                   As Double
Dim CSMIOS_MATERIALS_COST_BP                                As Double
Dim CSMIOS_ACCESSORIES_COST                                 As Double
Dim CSMIOS_ACCESSORIES_COST_BP                              As Double
Dim CSMIOS_PMS_COST                                         As Double
Dim CSMIOS_TINSPAINT                                        As Double
Dim CSMIOS_SUBLET                                           As Double
Dim CSMIOS_SUBLET_BP                                        As Double
Dim CSMIOS_AIRCON                                           As Double
Dim CSMIOS_TINSPAINT_DISCOUNT                               As Double
Dim CSMIOS_SUBLET_DISCOUNT                                  As Double
Dim CSMIOS_SUBLET_DISCOUNT_BP                               As Double
Dim CSMIOS_PARTS_NON_DISCOUNT                               As Double
    
Dim CSMIOS_PARTS_DISCOUNT_BP                                As Double
Dim CSMIOS_MATERIALS_DISCOUNT_BP                            As Double
Dim CSMIOS_ACCESSORIES_DISCOUNT_BP                          As Double

Dim CSMIOS_LABOR_DISCOUNT                                   As Double
Dim CSMIOS_PARTS_DISCOUNT                                   As Double
Dim CSMIOS_MATERIALS_DISCOUNT                               As Double
Dim CSMIOS_SUBLET_COST                                      As Double
Dim CSMIOS_SUBLET_COST_BP                                   As Double
Dim CSMIOS_TINSPAINT_COST                                   As Double
Dim WARRANTY_DIRECT_EXPENSE_LABOR                           As Double
Dim WARRANTY_DIRECT_EXPENSE_LABOR_BP                        As Double
Dim WARRANTY_DIRECT_EXPENSE_LABOR_SR                        As Double
Dim WARRANTY_DIRECT_EXPENSE_SPAREPARTS                      As Double
Dim WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP                   As Double
Dim WARRANTY_DIRECT_EXPENSE_GOL                             As Double
Dim WARRANTY_DIRECT_EXPENSE_GOL_BP                          As Double
Dim COMPANY_DIRECT_EXPENSE_LABOR                            As Double
Dim COMPANY_DIRECT_EXPENSE_SPAREPARTS                       As Double
Dim COMPANY_DIRECT_EXPENSE_GOL                              As Double
Dim COMPANY_DIRECT_EXPENSE_ACCESSORIES                      As Double
Dim SALES_DIRECT_EXPENSE_LABOR                              As Double
Dim SALES_DIRECT_EXPENSE_SPAREPARTS                         As Double
Dim SALES_DIRECT_EXPENSE_GOL                                As Double
Dim SALES_DIRECT_EXPENSE_ACCESSORIES                        As Double
Dim INSURANCE_DIRECT_EXPENSE_LABOR                          As Double
Dim INSURANCE_DIRECT_EXPENSE_LABOR_BP                       As Double
Dim INSURANCE_DIRECT_EXPENSE_SR                             As Double
Dim INSURANCE_DIRECT_EXPENSE_SR_BP                          As Double
Dim INSURANCE_DIRECT_EXPENSE_LABOR_PMS                      As Double
Dim INSURANCE_DIRECT_EXPENSE_SPAREPARTS                     As Double
Dim INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP                  As Double
Dim INSURANCE_DIRECT_EXPENSE_SPAREPARTS_SR                  As Double
Dim INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP_SR               As Double
Dim INSURANCE_DIRECT_EXPENSE_ACCESSORIES                    As Double
Dim INSURANCE_DIRECT_EXPENSE_ACCESSORIES_BP                 As Double
Dim INSURANCE_DIRECT_EXPENSE_GOL                            As Double
Dim INSURANCE_DIRECT_EXPENSE_GOL_BP                         As Double
Dim CSMIOS_PMS                                              As Double
Dim TOTAL_INSURANCE_AMOUNT                                  As Double
Dim TOTAL_DISCOUNT_AMOUNT                                   As Double
Dim ALL_DEBIT                                               As Double
Dim ALL_CREDIT                                              As Double

'INTERNAL
Dim INTERNAL_BP_LABOR_RS                                    As New ADODB.Recordset
Dim INTERNAL_BP_LABOR                                       As Double

Dim INTERNAL_PARTS_INV                                      As Double
Dim INTERNAL_SR_AMT                                         As Double
Dim INTERNAL_LABOR_AMT                                      As Double
Dim INTERNAL_PARTS_AMT                                      As Double
Dim INTERNAL_MATERIALS_AMT                                  As Double
Dim INTERNAL_ACCESSORIES_AMT                                As Double

Dim INTERNAL_LABOR_AMT_BP                                   As Double
Dim INTERNAL_SR_AMT_BP                                      As Double
Dim INTERNAL_PARTS_AMT_BP                                   As Double
Dim INTERNAL_MATERIALS_AMT_BP                               As Double
Dim INTERNAL_ACCESSORIES_AMT_BP                             As Double

Dim INTERNAL_LABOR_COST                                     As Double
Dim INTERNAL_SR_COST                                        As Double
Dim INTERNAL_PARTS_COST                                     As Double
Dim INTERNAL_MATERIALS_COST                                 As Double
Dim INTERNAL_ACCESSORIES_COST                               As Double

Dim INTERNAL_LABOR_COST_BP                                  As Double
Dim INTERNAL_SR_COST_BP                                     As Double
Dim INTERNAL_PARTS_COST_BP                                  As Double
Dim INTERNAL_MATERIALS_COST_BP                              As Double
Dim INTERNAL_ACCESSORIES_COST_BP                            As Double

Dim INTERNAL_LABOR_CODE_GJ                                  As String
Dim INTERNAL_SR_CODE_GJ                                     As String
Dim INTERNAL_PARTS_CODE_GJ                                  As String
Dim INTERNAL_MATERIALS_CODE_GJ                              As String
Dim INTERNAL_ACCESSORIES_CODE_GJ                            As String

Dim INTERNAL_LABOR_CODE_BP                                  As String
Dim INTERNAL_SR_CODE_BP                                     As String
Dim INTERNAL_PARTS_CODE_BP                                  As String
Dim INTERNAL_MATERIALS_CODE_BP                              As String
Dim INTERNAL_ACCESSORIES_CODE_BP                            As String

Dim J_ACCT_CODE                                             As String
Dim J_ACCT_NAME                                             As String
Dim J_GROSS                                                 As Double
Dim J_TAX                                                   As Double
Dim J_NET                                                   As Double
Dim J_DEBIT                                                 As Double
Dim J_CREDIT                                                As Double
Dim TOTAL_DEBIT                                             As Double
Dim TOTAL_CREDIT                                            As Double
Dim ItemCnt                                                 As Integer
Dim J_JDATE                                                 As String
Dim J_VOUCHERNO                                             As String
Dim J_JTYPE                                                 As String
Dim J_JNO                                                   As String
Dim J_REMARKS                                               As String
Dim J_VENDORCODE                                            As String
Dim J_CUSTOMERCODE                                          As String
Dim J_OUTBALANCE                                            As Double
Dim J_AMOUNTTOPAY                                           As Double
Dim J_INVOICEAMT                                            As Double
Dim J_BALANCE                                               As Double
Dim J_AMOUNTPAID                                            As Double
Dim J_CHECKNO                                               As String
Dim J_INVOICEDATE                                           As String
Dim J_DUEDATE                                               As String
Dim J_PAYTYPE                                               As String
Dim J_INVOICETYPE                                           As String
Dim J_INVOICENO                                             As String
Dim J_CHECKDATE                                             As String
Dim J_BANKCODE                                              As String
Dim J_REFNO                                                 As String
Dim J_REFDATE                                               As String
Dim J_TERMS                                                 As String
Dim J_DEALER                                                As String
Dim J_PAIDSTATUS                                            As String
Dim J_RECEIVESTATUS                                         As String
Dim J_STATUS                                                As String
Dim J_JITEMNO                                               As String
Dim TRANSACTIONDATE                                         As String
Dim Indx                                                    As Integer
Dim J_ITEMCNT                                               As Integer
Dim xTranDate                                               As String
Dim SubletType                                              As String
Dim DetCodeLen                                              As Integer

'DISCOUNT INSURANCE :NRE
Dim CHECK_INSURANCE_DIS                                     As New ADODB.Recordset
Dim CHECK_INSURANCE                                         As Double
Dim DISCOUNT_INS_LABOR_GJ                                   As Double
Dim DISCOUNT_INS_SUBLET                                     As Double
Dim DISCOUNT_INS_LABOR_BP                                   As Double
Dim DISCOUNT_INS_PARTS_GJ                                   As Double
Dim DISCOUNT_INS_PARTS_BP                                   As Double
Dim DISCOUNT_INS_MATERIALS                                  As Double
Dim DISCOUNT_INS_ACCESSORIES                                As Double
Dim TranType                                                As String
Dim rsUEA                                                   As New ADODB.Recordset
Dim rsDOTCIS                                                As New ADODB.Recordset
Dim xIDDOTAX                                                As String
Dim xCNAME                                                  As String
Dim INTERNAL_LABOR_AMT_SR                                   As Double
Dim INTERNAL_LABOR_COST_SR                                  As Double
Dim rsPARTSHARI                                             As New ADODB.Recordset
Dim rsPARTSNHARI                                            As New ADODB.Recordset
Dim INSURANCE_PARTS_HARI                                    As Double
Dim INSURANCE_PARTS_NONHARI                                 As Double

''ADDITIONAL VARIABLE FOR HCA
Dim CSMIOS_TINSPAINT_PARTS                                  As Double
Dim CSMIOS_TINSPAINT_DISCOUNT_PARTS                         As Double
Dim CSMIOS_TINSPAINT_COST_PARTS                             As Double
Dim INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS                 As Double
Dim WARRANTY_DIRECT_EXPENSE_ACC                             As Double
Dim WARRANTY_CSMIOS_MATERIALS_COST_ACC                      As Double
Dim CUSTOMER_VOUCHERNO_TAX                                  As String
Dim INTERNAL_LABOR_AMT_TAG                                  As Double
Dim INTERNAL_LABOR_AMT_BP_TAG                               As Double
Dim INTERNAL_PARTS_AMT_TAG                                  As Double
Dim INTERNAL_ACCESSORIES_TAG                                As Double
Dim INTERNAL_SR_TAG                                         As Double
Dim INTERNAL_MATERIALS_TAG                                  As Double
''
Dim CSMIOS_PARTS_INV_GEN                                    As Double
Dim CSMIOS_PARTS_INV_NONGEN                                 As Double
Dim CSMIOS_WARRANTY_PARTS_INV_GEN                           As Double
Dim CSMIOS_WARRANTY__PARTS_INV_NONGEN                       As Double
Dim CSMIOS_INTERNAL_PARTS_INV_GEN                           As Double
Dim CSMIOS_INTERNAL_PARTS_INV_NONGEN                        As Double

Dim CSMIOS_MISC                                             As Double
Dim CSMIOS_INSURANCE_MISC                                   As Double
Dim CSMIOS_NIYM_PRINT                                       As String

Dim xKIM                                                    As Integer
Dim xELLAINE                                                As Integer
Dim xInvoiceType                                            As String
Dim xINVOICETYPECODE                                        As String
Dim xIS_EXIST                                               As Byte

Function SetCustomerName(VVV As Variant) As String
    Dim rsCustomer2                                         As ADODB.Recordset
    Set rsCustomer2 = New ADODB.Recordset
    rsCustomer2.Open "Select CustCode,acctname from ALL_CUSTMASTER_AMIS where CustCode = '" & VVV & "'", gconDMIS, adOpenForwardOnly, adLockReadOnly
    If Not rsCustomer2.EOF And Not rsCustomer2.BOF Then
        SetCustomerName = UCase(Null2String(rsCustomer2!AcctName))
    Else
        SetCustomerName = ""
    End If
End Function

Function Setacctname(VVV As String) As String
    Dim rsChartAccount2                                     As ADODB.Recordset
    Set rsChartAccount2 = New ADODB.Recordset
    If Left(VVV, 1) = "'" Then
        rsChartAccount2.Open "Select AcctCode,Description from AMIS_ChartAccount where AcctCode = " & VVV, gconDMIS, adOpenForwardOnly, adLockReadOnly
    Else
        rsChartAccount2.Open "Select AcctCode,Description from AMIS_ChartAccount where AcctCode = '" & VVV & "'", gconDMIS, adOpenForwardOnly, adLockReadOnly
    End If
    If Not rsChartAccount2.EOF And Not rsChartAccount2.BOF Then
        Setacctname = UCase(Null2String(rsChartAccount2!DESCRIPTION))
    Else
        Setacctname = ""
    End If
End Function

Function GetVoucherNo() As String
    Dim rsJournal_HD                                        As ADODB.Recordset
    Set rsJournal_HD = New ADODB.Recordset
    Set rsJournal_HD = gconDMIS.Execute("Select CAST(VoucherNo AS int) AS MAX_VOUCHERNO from AMIS_Journal_HD Where Jtype = 'SJ' Order by MAX_VOUCHERNO desc")
    If Not rsJournal_HD.EOF And Not rsJournal_HD.BOF Then
        GetVoucherNo = Format(NumericVal(rsJournal_HD!MAX_VOUCHERNO) + 1, "000000")
    Else
        GetVoucherNo = "000001"
    End If
End Function

Function GetJNo() As String
    Dim rsJournal_HD                                        As ADODB.Recordset
    Set rsJournal_HD = New ADODB.Recordset
    Set rsJournal_HD = gconDMIS.Execute("Select CAST(JNo AS int) AS MAX_JNO from AMIS_Journal_HD Order by MAX_JNO desc")
    If Not rsJournal_HD.EOF And Not rsJournal_HD.BOF Then
        GetJNo = Format(NumericVal(rsJournal_HD!MAX_JNO) + 1, "000000")
    Else
        GetJNo = "000001"
    End If
End Function

Function SetRONiym(XXX As String)
    Dim rsRO_Niym                                           As ADODB.Recordset
    Set rsRO_Niym = New ADODB.Recordset
    Set rsRO_Niym = gconDMIS.Execute("Select NIYM from CSMS_REPOR WHERE INVOICE = '" & XXX & "'")
    If Not rsRO_Niym.EOF And Not rsRO_Niym.BOF Then
        SetRONiym = Null2String(rsRO_Niym!Niym)
    End If
End Function

'UPDATED: ACL 06042010 DUE TO CASH/ TCHARGERANSACTIONS
Function CheckSJExisting(VarInvoiceType As String, VarInvoiceNo As String, Optional VarTranType As String) As Boolean
    Dim rsCheckSJ_Journal_HD                                As ADODB.Recordset
    Set rsCheckSJ_Journal_HD = New ADODB.Recordset
    If VarTranType = "" Then
        Set rsCheckSJ_Journal_HD = gconDMIS.Execute("Select VoucherNo,Jtype from AMIS_Journal_HD where JTYPE = 'SJ' AND InvoiceType = " & N2Str2Null(VarInvoiceType) & " AND InvoiceNo = " & N2Str2Null(VarInvoiceNo))
    Else
        If VarTranType = "DR" Then
            Set rsCheckSJ_Journal_HD = gconDMIS.Execute("Select VoucherNo,Jtype from AMIS_Journal_HD where JTYPE = 'SJ' AND InvoiceType = " & N2Str2Null(VarInvoiceType) & " AND InvoiceNo = 'DR OUT' AND RefNo = " & N2Str2Null(VarInvoiceNo))
        ElseIf VarInvoiceNo = "PDI RO" Then
            Set rsCheckSJ_Journal_HD = gconDMIS.Execute("Select VoucherNo,Jtype from AMIS_Journal_HD where JTYPE = 'SJ' AND InvoiceType = " & N2Str2Null(VarInvoiceType) & " AND InvoiceNo = 'PDI RO' AND RefNo = " & N2Str2Null(VarTranType))
        Else
            Set rsCheckSJ_Journal_HD = gconDMIS.Execute("Select VoucherNo,Jtype from AMIS_Journal_HD where JTYPE = 'SJ' AND InvoiceType = " & N2Str2Null(VarInvoiceType) & " AND PayType = " & N2Str2Null(VarTranType) & " AND InvoiceNo = " & N2Str2Null(VarInvoiceNo))
        End If
    End If
    If Not rsCheckSJ_Journal_HD.EOF And Not rsCheckSJ_Journal_HD.BOF Then
        CheckSJExisting = True
    Else
        CheckSJExisting = False
    End If
    Set rsCheckSJ_Journal_HD = Nothing
End Function

Function CheckRefNoExisting(VarInvoiceType As String, VarInvoiceNo As String) As Boolean
    Dim rsCheckSJ_Journal_HD                                As ADODB.Recordset
    Set rsCheckSJ_Journal_HD = New ADODB.Recordset
    Set rsCheckSJ_Journal_HD = gconDMIS.Execute("Select VoucherNo,Jtype from AMIS_Journal_HD where JTYPE = 'SJ' AND Status <> 'C' AND InvoiceType = " & N2Str2Null(VarInvoiceType) & " AND RefNo = " & N2Str2Null(VarInvoiceNo))
    If Not rsCheckSJ_Journal_HD.EOF And Not rsCheckSJ_Journal_HD.BOF Then
        CheckRefNoExisting = True
    Else
        CheckRefNoExisting = False
    End If
    Set rsCheckSJ_Journal_HD = Nothing
End Function

Function ReturnClearing_AccountCode(XXX As String) As String
    Dim rsChartAccount                                      As ADODB.Recordset
    Set rsChartAccount = New ADODB.Recordset
    Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE2 = 'CLEARING' AND TRANTYPE1 = '" & Trim(XXX) & "'")
    If Not rsChartAccount.EOF And Not rsChartAccount.BOF Then
        ReturnClearing_AccountCode = Null2String(rsChartAccount!AcctCode)
    End If
    Set rsChartAccount = Nothing
End Function

Function ReturnAR_AccountCode(XXX As String) As String
    Dim rsChartAccount                                      As ADODB.Recordset
    Set rsChartAccount = New ADODB.Recordset
    Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE2 = 'AR' AND TRANTYPE1 = '" & XXX & "'")
    If Not rsChartAccount.EOF And Not rsChartAccount.BOF Then
        ReturnAR_AccountCode = Null2String(rsChartAccount!AcctCode)
    End If
    Set rsChartAccount = Nothing
End Function

Function ReturnSales_AccountCode(InvType As String, Optional OTHERTYPE As String, Optional NEXTTYPE As String) As String
    Dim rsChartAccount                                      As ADODB.Recordset
    Set rsChartAccount = New ADODB.Recordset
    If OTHERTYPE = "" Then
        If NEXTTYPE = "" Then
            Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'SALES' AND TRANTYPE2 = '" & InvType & "'")
        Else
            Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'SALES' AND TRANTYPE2 = '" & InvType & "' AND TRANTYPE4 = '" & NEXTTYPE & "'")
        End If
    Else
        If NEXTTYPE = "" Then
            If InvType = "SALES" Then
                Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'SALES' AND TRANTYPE2 = '" & InvType & "' AND TRANTYPE1 like '%" & Right(OTHERTYPE, 5) & "%'")
            Else
                Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'SALES' AND TRANTYPE2 = '" & InvType & "' AND TRANTYPE1 like '%" & OTHERTYPE & "%'")
            End If
        Else
                Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'SALES' AND TRANTYPE2 = '" & InvType & "' AND TRANTYPE1 like '%" & OTHERTYPE & "%' AND TRANTYPE4 = '" & NEXTTYPE & "'")
        End If
    End If
    If Not rsChartAccount.EOF And Not rsChartAccount.BOF Then
        ReturnSales_AccountCode = Null2String(rsChartAccount!AcctCode)
    End If
    Set rsChartAccount = Nothing
End Function

Function ReturnDiscount_AccountCode(InvType As String, Optional OTHERTYPE As String) As String
    Dim rsChartAccount                                      As ADODB.Recordset
    Set rsChartAccount = New ADODB.Recordset
    If OTHERTYPE = "" Then
        Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'DISCOUNT' AND TRANTYPE2 = '" & InvType & "'")
    Else
            Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'DISCOUNT' AND TRANTYPE2 = '" & InvType & "' AND TRANTYPE1 = '" & OTHERTYPE & "'")
    End If
    If Not rsChartAccount.EOF And Not rsChartAccount.BOF Then
        ReturnDiscount_AccountCode = Null2String(rsChartAccount!AcctCode)
    End If
    Set rsChartAccount = Nothing
End Function
Function ReturnCostOFSALES_PARTS(STR_TRANNO As String, STR_TRANTYPE As String, STR_TYPE As String) As Double
    Dim RSCOST                                              As ADODB.Recordset
    'UPDATED BY: ACL 03092010
    'TO GET TOTAL COST NOT THE ITEM COST ONLY
    'Set RSCOST = gconDMIS.Execute("SELECT ISNULL(SUM(TRANUCOST),0) AS TRANUCOST FROM PMIS_ALLDAYTRAN WHERE TRANNO=" & N2Str2Null(STR_TRANNO) & " AND TRANTYPE=" & N2Str2Null(STR_TRANTYPE))
    Set RSCOST = gconDMIS.Execute("SELECT ISNULL(TRANUCOST,0) * TRANQTY AS TRANUCOST FROM PMIS_ALLDAYTRAN WHERE TRANNO=" & N2Str2Null(STR_TRANNO) & " AND TRANTYPE=" & N2Str2Null(STR_TRANTYPE) & " AND TYPE=" & N2Str2Null(STR_TYPE))
    If Not RSCOST.EOF Or Not RSCOST.BOF Then
        Do While Not RSCOST.EOF
            ReturnCostOFSALES_PARTS = ReturnCostOFSALES_PARTS + Round(NumericVal(RSCOST!TRANUCOST), 2)
            RSCOST.MoveNext
        Loop
    End If
    Set RSCOST = Nothing
End Function

Function ReturnCostofSales(InvType As String, Optional OTHERTYPE As String, Optional NEXTTYPE As String) As String
    Dim rsChartAccount                                      As ADODB.Recordset
    Set rsChartAccount = New ADODB.Recordset
    If OTHERTYPE = "" Then
        If NEXTTYPE = "" Then
            Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'COST OF SALES' AND TRANTYPE2 = '" & InvType & "'")
        Else
            Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'COST OF SALES' AND TRANTYPE2 = '" & InvType & "' AND TRANTYPE4 = '" & NEXTTYPE & "'")
        End If
    Else
        If NEXTTYPE = "" Then
            If InvType = "SALES" Then
                Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'COST OF SALES' AND TRANTYPE2 = '" & InvType & "' AND TRANTYPE1 like '%" & Right(OTHERTYPE, 5) & "%'")
            Else
                Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'COST OF SALES' AND TRANTYPE2 = '" & InvType & "' AND TRANTYPE1 like '%" & OTHERTYPE & "%'")
            End If
        Else
            Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'COST OF SALES' AND TRANTYPE2 = '" & InvType & "' AND TRANTYPE1 like '%" & OTHERTYPE & "%' AND TRANTYPE4 = '" & NEXTTYPE & "'")
        End If
    End If
    If Not rsChartAccount.EOF And Not rsChartAccount.BOF Then
        ReturnCostofSales = Null2String(rsChartAccount!AcctCode)
    End If
    Set rsChartAccount = Nothing
End Function

Function ReturnInventory(InvType As String, Optional OTHERTYPE As String, Optional NEXTTYPE As String) As String
    Dim rsChartAccount                                      As ADODB.Recordset
    Set rsChartAccount = New ADODB.Recordset
    If OTHERTYPE = "" Then
        If NEXTTYPE = "" Then
            Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'INVENTORY' AND TRANTYPE2 = '" & InvType & "'")
        Else
            Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'INVENTORY' AND TRANTYPE2 = '" & InvType & "' AND TRANTYPE4 = '" & NEXTTYPE & "'")
        End If
    Else
        If NEXTTYPE = "" Then
            Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'INVENTORY' AND TRANTYPE2 = '" & InvType & "' AND TRANTYPE1 = '" & OTHERTYPE & "'")
        Else
            Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'INVENTORY' AND TRANTYPE2 = '" & InvType & "' AND TRANTYPE1 = '" & OTHERTYPE & "' AND TRANTYPE4 = '" & NEXTTYPE & "'")
        End If
    End If
    If Not rsChartAccount.EOF And Not rsChartAccount.BOF Then
        ReturnInventory = Null2String(rsChartAccount!AcctCode)
    End If
    Set rsChartAccount = Nothing
End Function
Function ReturnOutputTax2(InvType As String)
    Dim rsChartAccount                                      As ADODB.Recordset
    Set rsChartAccount = New ADODB.Recordset
    Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE1 = 'OUTPUT TAX' and TRANTYPE3 = 'SERVICE' and TRANTYPE2 = '" & InvType & "'")
    If Not rsChartAccount.EOF And Not rsChartAccount.BOF Then
        ReturnOutputTax2 = Null2String(rsChartAccount!AcctCode)
    End If
    Set rsChartAccount = Nothing
End Function
Function ReturnOutputTax()
    Dim rsChartAccount                                      As ADODB.Recordset
    Set rsChartAccount = New ADODB.Recordset
    If COMPANY_CODE = "MGS" Or COMPANY_CODE = "HGS" Then
        Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE1 = 'TAX'")
    Else
        Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE1 = 'OUTPUT TAX'")
    End If
    
    If Not rsChartAccount.EOF And Not rsChartAccount.BOF Then
        ReturnOutputTax = Null2String(rsChartAccount!AcctCode)
    End If
    
    Set rsChartAccount = Nothing
End Function

Function ReturnDeferredOutPutTax()
    Dim rsChartAccount                                      As ADODB.Recordset
    Set rsChartAccount = New ADODB.Recordset
    Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE1 = 'DEFERRED OUTPUT TAX'")
    If Not rsChartAccount.EOF And Not rsChartAccount.BOF Then
        ReturnDeferredOutPutTax = Null2String(rsChartAccount!AcctCode)
    End If
    Set rsChartAccount = Nothing
End Function

Function ReturnInternalAccountCode(XXX As String)
    Dim rsChartAccount                                      As ADODB.Recordset
    Set rsChartAccount = New ADODB.Recordset
    Set rsChartAccount = gconDMIS.Execute("Select ChartCodes from CMIS_SBOOK where BOOK = 'S' and CODE = '" & XXX & "'")
    If Not rsChartAccount.EOF And Not rsChartAccount.BOF Then
        ReturnInternalAccountCode = Null2String(rsChartAccount!CHARTCODES)
    End If
    Set rsChartAccount = Nothing
End Function

Function ReturnAccountCode(XXX As String)
    Dim rsChartAccount                                      As ADODB.Recordset
    Set rsChartAccount = New ADODB.Recordset
    Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE1 = '" & XXX & "'")
    If Not rsChartAccount.EOF And Not rsChartAccount.BOF Then
        ReturnAccountCode = Null2String(rsChartAccount!AcctCode)
    End If
    Set rsChartAccount = Nothing
End Function

Function SetVendorName(VVV As Variant)
    Set rsVENDOR = New ADODB.Recordset
    rsVENDOR.Open "Select code,nameofvendor from ALL_Vendor where code = " & N2Str2Null(VVV), gconDMIS, adOpenForwardOnly, adLockReadOnly
    If Not rsVENDOR.EOF And Not rsVENDOR.BOF Then
        SetVendorName = Null2String(rsVENDOR!nameofvendor)
    Else
        SetVendorName = ""
    End If
End Function

Function CheckIfNonVatSup(SupplierCode As String) As Boolean
    Dim rsSupplierMaster                                    As ADODB.Recordset
    Set rsSupplierMaster = New ADODB.Recordset
    rsSupplierMaster.Open "Select supcode,supname,NONVAT from PMIS_vw_Supplier where supcode = '" & SupplierCode & "'", gconDMIS, adOpenForwardOnly, adLockReadOnly
    If Not rsSupplierMaster.EOF And Not rsSupplierMaster.BOF Then
        If Null2String(rsSupplierMaster!NONVAT) = "Y" Then
            CheckIfNonVatSup = True
        Else
            CheckIfNonVatSup = False
        End If
    Else
        CheckIfNonVatSup = False
    End If
End Function

Function ReturnPlateNo(XXX As String) As String
' Update By BTT - 07092008
    Dim SQL                                                 As String
    Dim RS                                                  As New ADODB.Recordset

    SQL = "SELECT Plate_no from CSMS_REPOR WHERE REP_OR='" & XXX & "' "

    Set RS = New ADODB.Recordset
    Set RS = gconDMIS.Execute(SQL)

    If Not RS.BOF And Not RS.EOF Then
        ReturnPlateNo = Null2String(RS!PLATE_NO)
    Else
        ReturnPlateNo = ""
    End If
    Set RS = Nothing
End Function

Function ReturnCodeSellingDealer(XXX As String) As String
'Update By BTT - 07092008
    Dim SQL                                                 As String
    Dim RS                                                  As New ADODB.Recordset

    SQL = "SELECT Selling_dealer from CSMS_Cusveh WHERE plate_no='" & XXX & "' "

    Set RS = New ADODB.Recordset
    Set RS = gconDMIS.Execute(SQL)

    If Not RS.BOF And Not RS.EOF Then
        ReturnCodeSellingDealer = Null2String(RS!Selling_Dealer)
    Else
        ReturnCodeSellingDealer = ""
    End If
    Set RS = Nothing
End Function

Function SetSellingDealerName(XXX As String) As String
'Update By BTT - 07092008
    Dim SQL                                                 As String
    Dim RS                                                  As New ADODB.Recordset

    SQL = "SELECT DealerName from CSMS_SellingDealer WHERE DealerCOde='" & XXX & "' "

    Set RS = New ADODB.Recordset
    Set RS = gconDMIS.Execute(SQL)

    If Not RS.BOF And Not RS.EOF Then
        SetSellingDealerName = Null2String(RS!DealerName)
    Else
        SetSellingDealerName = ""
    End If
    Set RS = Nothing
End Function

Function ReturnCode(XXX As String) As String
'Update By BTT - 07092008
    Dim SQL                                                 As String
    Dim RS                                                  As New ADODB.Recordset
    Dim MARK                                                As String
    'This will return the code of the Selling Dealer

    MARK = (Replace(XXX, " ", ""))

    SQL = "SELECT Custcode, replace(custname,' ','') from ALL_Custmaster_AMIS where REPLACE(custname,' ','') like '%" & MARK & "%'"

    Set RS = New ADODB.Recordset
    Set RS = gconDMIS.Execute(SQL)

    If Not RS.BOF And Not RS.EOF Then
        ReturnCode = Null2String(RS!CUSTCODE)
    Else
        ReturnCode = ""
    End If
    Set RS = Nothing
End Function

Function CheckIfPMS_Ik_to_5k(XXX As String) As Boolean
    Dim SQL                                                 As String
    Dim RS                                                  As New ADODB.Recordset

    SQL = "select Status1 from CSMS_ro_det where jobtype='PMS' and livil='1' and wcode='W' and Rep_or='" & XXX & "'"

    Set RS = New ADODB.Recordset
    Set RS = gconDMIS.Execute(SQL)

    If Not RS.EOF And Not RS.BOF Then
        If Null2String(RS!status1) = "Y" Then
            CheckIfPMS_Ik_to_5k = True
        Else
            CheckIfPMS_Ik_to_5k = False
        End If
    End If
    Set RS = Nothing
End Function

Function CheckIfPMS(XXX As String) As Boolean
    Dim SQL                                                 As String
    Dim RS                                                  As New ADODB.Recordset

    SQL = "select Status1 from CSMS_ro_det where jobtype='PMS' and livil='1' and wcode='W' and Rep_or='" & XXX & "'"

    Set RS = New ADODB.Recordset
    Set RS = gconDMIS.Execute(SQL)

    If Not RS.EOF And Not RS.BOF Then
        CheckIfPMS = True
    Else
        CheckIfPMS = False
    End If
    Set RS = Nothing
End Function

Function ReturnShopSuplies(XXX As String) As Integer
    Dim SQL                                                 As String
    Dim RS                                                  As New ADODB.Recordset

    SQL = "SELECT DETAMT,detprc FROM CSMS_RO_DET WHERE LIVIL = '3' AND DETCDE = 'SVCMAT0068' and REP_or='" & XXX & "'"

    Set RS = New ADODB.Recordset
    Set RS = gconDMIS.Execute(SQL)

    If Not RS.EOF And Not RS.BOF Then
        ReturnShopSuplies = NumericVal(RS!DETPRC)
    Else
        ReturnShopSuplies = 0
    End If
    Set RS = Nothing
End Function

Function PosibleDoubleInternal(XXX As String) As Boolean
    Dim SQL                                                 As String
    Dim RS                                                  As New ADODB.Recordset
    SQL = "SELECT * FROM AMIS_journal_hd where refno='" & XXX & "' and invoicetype = 'SI'"

    Set RS = New ADODB.Recordset
    Set RS = gconDMIS.Execute(SQL)

    If Not RS.EOF And Not RS.BOF Then
        PosibleDoubleInternal = True
    Else
        PosibleDoubleInternal = False
    End If
    Set RS = Nothing
End Function

Sub InsertToJournalDet(vJ_JDATE As Variant, vJ_VOUCHERNO As Variant, vJ_JTYPE As Variant, vJ_JNO As Variant, vJ_JITEMNO As Variant, vJ_ACCT_CODE As Variant, vJ_ACCT_NAME As Variant, vJ_DEBIT As Variant, vJ_CREDIT As Variant, vJ_TAX As Variant, vJ_GROSS As Variant, vJ_NET As Variant, vJ_STATUS As Variant)
'UPDATE DUE TO NEW AUDIT : BTT 08292008
    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                    " values (" & vJ_JDATE & ", " & vJ_VOUCHERNO & ", " & vJ_JTYPE & ", " & vJ_JNO & ", " & vJ_JITEMNO & ", " & vJ_ACCT_CODE & ", " & vJ_ACCT_NAME & ", " & vJ_DEBIT & ", " & vJ_CREDIT & ", " & vJ_TAX & "," & vJ_GROSS & "," & vJ_NET & ", " & vJ_STATUS & ")"
                    gconDMIS.Execute SQL_STATEMENT
                    TransactionID = (FindTransactionID(N2Str2Null(vJ_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype")): NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(vJ_VOUCHERNO), J_JTYPE, J_JNO
                    vJ_JITEMNO = ""
End Sub

Sub UpdateJournalDetAmt(vJ_VOUCHERNO As Variant, vJ_JTYPE As Variant, vJ_ACCT_CODE As Variant, vJ_ACCT_NAME As Variant, vJ_DEBIT As Variant, vJ_CREDIT As Variant)
'UPDATE AMOUNTS FOR MGS CUSTOMER PAID + INSURANCE
    SQL_STATEMENT = "UPDATE AMIS_JOURNAL_DET " & _
                    "SET DEBIT = DEBIT + " & vJ_DEBIT & ", " & _
                    "CREDIT = CREDIT + " & vJ_CREDIT & " " & _
                    "WHERE VOUCHERNO = " & vJ_VOUCHERNO & " AND JTYPE = " & vJ_JTYPE & " AND ACCT_CODE = " & vJ_ACCT_CODE & " AND ACCT_NAME = " & vJ_ACCT_NAME & ""
                    gconDMIS.Execute SQL_STATEMENT
End Sub

Sub InsertToJournalDet1(vJ_JDATE As Variant, vJ_VOUCHERNO As Variant, vJ_JTYPE As Variant, vJ_JNO As Variant, vJ_JITEMNO As Variant, vJ_ACCT_CODE As Variant, vJ_ACCT_NAME As Variant, vJ_DEBIT As Variant, vJ_CREDIT As Variant, vJ_TAX As Variant, vJ_GROSS As Variant, vJ_NET As Variant, vJ_STATUS As Variant)
'UPDATE DUE TO NEW AUDIT : BTT 08292008
    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                    " values ('" & vJ_JDATE & "', '" & vJ_VOUCHERNO & "', '" & vJ_JTYPE & "', '" & vJ_JNO & "', '" & vJ_JITEMNO & "', '" & vJ_ACCT_CODE & "', '" & vJ_ACCT_NAME & "', '" & vJ_DEBIT & "', '" & vJ_CREDIT & "', 0,0,0, '" & vJ_STATUS & "')"
    gconDMIS.Execute SQL_STATEMENT
    TransactionID = (FindTransactionID(N2Str2Null(vJ_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(vJ_VOUCHERNO), J_JTYPE, J_JNO
End Sub

Function ImportPurelyInternal() As Boolean
    On Error GoTo ErrorCode

    Dim GridImport                                          As Integer
    Dim i                                                   As Integer
    For GridImport = 1 To Grid2.Rows - 1
        If N2Str2Zero(Grid2.Cell(GridImport, 1).Text) = 0 Then
            ALL_DEBIT = 0: ALL_CREDIT = 0
            Set rsCSMIOS_REPOR = New ADODB.Recordset
            'Set rsCSMIOS_REPOR = gconDMIS.Execute("Select * from CSMS_REPOR where RO_AMOUNT > 0 AND invoice = '" & Grid2.Cell(GridImport, 3).Text & "' and dte_comp = '" & CDate(dtpTranDate) & "' order by invoice ASC")
            'Set rsCSMIOS_REPOR = gconDMIS.Execute("Select * from CSMS_REPOR where REP_OR = '" & Grid2.Cell(GridImport, 2).Text & "' and dte_comp = '" & CDate(dtpTranDate) & "' order by invoice ASC")
            Set rsCSMIOS_REPOR = gconDMIS.Execute("Select * from CSMS_REPOR where REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsCSMIOS_REPOR.EOF And Not rsCSMIOS_REPOR.BOF Then
                ItemCnt = 0
                CSMIOS_REP_OR = Null2String(rsCSMIOS_REPOR!REP_OR)
                CSMIOS_ACCT_NO = Null2String(rsCSMIOS_REPOR!ACCT_NO)
                CSMIOS_PARTICIPAT = Null2String(rsCSMIOS_REPOR!PARTICIPAT)
                CSMIOS_PLATE_NO = Null2String(rsCSMIOS_REPOR!PLATE_NO)
                CSMIOS_NIYM = Null2String(rsCSMIOS_REPOR!Niym)
                CSMIOS_TERM = Null2String(rsCSMIOS_REPOR!TERM)
                CSMIOS_DTE_REL = Null2Date(rsCSMIOS_REPOR!DTE_REL)
                CSMIOS_INVOICE = Null2String(rsCSMIOS_REPOR!INVOICE)
                CSMIOS_VAT_EXEMPT = Null2Bool(rsCSMIOS_REPOR!VAT_EXEMPT)
                CSMIOS_RO_AMOUNT = Round(N2Str2Zero(rsCSMIOS_REPOR!RO_AMOUNT), 2)

                'INTERNAL - COMPANY
                '====================================================================================================================================================================================

                COMPANY_DIRECT_EXPENSE_LABOR = 0: COMPANY_DIRECT_EXPENSE_SPAREPARTS = 0: COMPANY_DIRECT_EXPENSE_GOL = 0

                Set rsCSMIOS_LABOR = New ADODB.Recordset
                Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS LABOR,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_LABORCompany Where REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
                If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then COMPANY_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2) Else COMPANY_DIRECT_EXPENSE_LABOR = 0

                Set rsCSMIOS_PARTS = New ADODB.Recordset
                Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS PARTS,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_PARTSCompany Where REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
                If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then COMPANY_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2) Else COMPANY_DIRECT_EXPENSE_SPAREPARTS = 0

                Set rsCSMIOS_MATERIALS = New ADODB.Recordset
                Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS MATERIALS,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_MATERIALSCompany Where REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
                If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then COMPANY_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS), 2) Else COMPANY_DIRECT_EXPENSE_GOL = 0

                Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
                rsCSMIOS_ACCESSORIES.Open ("SELECT SUM(CSMS_Ro_Det.DETVOL * CSMS_Ro_Det.DETPRC) AS ACCESSORIES, " & _
                                           "SUM((CSMS_Ro_Det.DETVOL * CSMS_Ro_Det.DETPRC) * (CSMS_Ro_Det.DISCRATE / 100)) As DISCOUNT " & _
                                           "FROM CSMS_Repor INNER JOIN CSMS_Ro_Det " & _
                                           "ON CSMS_Repor.REP_OR = CSMS_Ro_Det.REP_OR " & _
                                           "WHERE (CSMS_Ro_Det.LIVIL = '4') AND (CSMS_Ro_Det.WCODE = 'C') AND  CSMS_Repor.REP_OR= " & N2Str2Null(CSMIOS_REP_OR)), gconDMIS, adOpenForwardOnly
                If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
                    COMPANY_DIRECT_EXPENSE_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!Accessories))
                Else
                    COMPANY_DIRECT_EXPENSE_ACCESSORIES = 0
                End If

                '====================================================================================================================================================================================

                'INTERNAL - SALES DEPARTMENT
                '====================================================================================================================================================================================

                SALES_DIRECT_EXPENSE_LABOR = 0: SALES_DIRECT_EXPENSE_SPAREPARTS = 0: SALES_DIRECT_EXPENSE_GOL = 0

                Set rsCSMIOS_LABOR = New ADODB.Recordset
                Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS LABOR,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_LABORSales Where REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
                If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
                    SALES_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
                Else
                    SALES_DIRECT_EXPENSE_LABOR = 0
                End If

                Set rsCSMIOS_PARTS = New ADODB.Recordset
                Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS PARTS,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_PARTSSales Where REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
                If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                    SALES_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2)
                Else
                    SALES_DIRECT_EXPENSE_SPAREPARTS = 0
                End If

                Set rsCSMIOS_MATERIALS = New ADODB.Recordset
                Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS MATERIALS,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_MATERIALSSales Where REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
                If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
                    SALES_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS), 2)
                Else
                    SALES_DIRECT_EXPENSE_GOL = 0
                End If

                Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
                rsCSMIOS_ACCESSORIES.Open ("SELECT SUM(CSMS_Ro_Det.DETVOL * CSMS_Ro_Det.DETPRC) AS ACCESSORIES, " & _
                                           "SUM((CSMS_Ro_Det.DETVOL * CSMS_Ro_Det.DETPRC) * (CSMS_Ro_Det.DISCRATE / 100)) As DISCOUNT " & _
                                           "FROM CSMS_Repor INNER JOIN CSMS_Ro_Det " & _
                                           "ON CSMS_Repor.REP_OR = CSMS_Ro_Det.REP_OR " & _
                                           "WHERE (CSMS_Ro_Det.LIVIL = '4') AND (CSMS_Ro_Det.WCODE = 'S') AND  CSMS_Repor.REP_OR= " & N2Str2Null(CSMIOS_REP_OR)), gconDMIS, adOpenForwardOnly
                If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
                    SALES_DIRECT_EXPENSE_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!Accessories))
                Else
                    SALES_DIRECT_EXPENSE_ACCESSORIES = 0
                End If
                '====================================================================================================================================================================================

                '=========================================================================================================================================================
                'ENTRY FOR PURELY INTERNAL
                'UPDATED BY: JUN - UPDATE DUE TO ERROR IN SAVING JNO
                Set rsJournal_HDDup = New ADODB.Recordset
                Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_journal_hd order by jno desc")
                If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then
                    WARRANTY_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 1, "000000") & "'"
                Else
                    WARRANTY_JNO = "000001"
                End If
                'UPDATED BY: JUN

                If COMPANY_DIRECT_EXPENSE_LABOR + COMPANY_DIRECT_EXPENSE_SPAREPARTS + COMPANY_DIRECT_EXPENSE_GOL > 0 And CSMIOS_RO_AMOUNT = 0 Then

                    Set rsJournal_HDDup = New ADODB.Recordset
                    Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_journal_hd order by jno desc")
                    If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then WARRANTY_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 1, "000000") & "'"

                    J_JDATE = N2Date2Null(CSMIOS_DTE_REL)
                    J_VOUCHERNO = N2Str2Null(GetVoucherNo())
                    J_JTYPE = "'SJ'": J_REMARKS = "NULL": J_VENDORCODE = "'999999'"
                    J_CUSTOMERCODE = N2Str2Null(CSMIOS_ACCT_NO)

                    J_DEBIT = 0: J_CREDIT = 0: J_TAX = 0: J_OUTBALANCE = 0: J_AMOUNTTOPAY = 0
                    CSMIOS_RO_AMOUNT = Round((CSMIOS_LABOR + CSMIOS_AIRCON + CSMIOS_TINSPAINT + CSMIOS_SUBLET + CSMIOS_PMS + CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES) - TOTAL_DISCOUNT_AMOUNT, 2)

                    J_INVOICEAMT = Round(NumericVal(CSMIOS_RO_AMOUNT), 2)
                    J_BALANCE = Round(NumericVal(CSMIOS_RO_AMOUNT), 2)
                    J_AMOUNTPAID = 0
                    J_STATUS = "'N'"

                    J_INVOICEDATE = N2Date2Null(CSMIOS_DTE_REL)
                    J_INVOICENO = N2Str2Null(CSMIOS_INVOICE)

                    J_CHECKNO = "NULL": J_DUEDATE = N2Date2Null(CSMIOS_DTE_REL): J_PAYTYPE = "NULL": J_INVOICETYPE = "'SI'"
                    J_CHECKDATE = "NULL": J_BANKCODE = "NULL": J_REFNO = N2Str2Null(CSMIOS_REP_OR): J_REFDATE = N2Date2Null(CSMIOS_DTE_REL)
                    J_TERMS = N2Str2Null(CSMIOS_TERM): J_DEALER = "NULL": J_PAIDSTATUS = "'N'": J_RECEIVESTATUS = "'N'"

                    WARRANTY_VOUCHERNO = N2Str2Null(Format(NumericVal(GetVoucherNo()), "000000"))
                    WARRANTY_ItemCnt = 0
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    TOTAL_DEBIT = 0: TOTAL_CREDIT = 0
                    'LABOR

                    'to check if there is more than 1 purely charge to internal : update By BTT
                    If PosibleDoubleInternal(CSMIOS_REP_OR) = True Then
                        ImportPurelyInternal = True
                        Exit Function
                    End If

                    INTERNAL_LABOR_AMT = 0: INTERNAL_PARTS_AMT = 0: INTERNAL_MATERIALS_AMT = 0:
                    INTERNAL_LABOR_COST = 0: INTERNAL_PARTS_COST = 0: INTERNAL_MATERIALS_COST = 0:

                    Set rsINTERNAL_RO_DET = New ADODB.Recordset
                    Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND REP_OR = '" & CSMIOS_REP_OR & "'")
                    If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                        rsINTERNAL_RO_DET.MoveFirst
                        Do While Not rsINTERNAL_RO_DET.EOF
                            If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                                INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                                INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                                If COMPANY_CODE = "HPI" Then
                                Else
                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                                    J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                    J_TAX = 0
                                    J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                    'J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                    J_DEBIT = Round(NumericVal(J_NET), 2)
                                    J_CREDIT = 0
                                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                    gconDMIS.Execute SQL_STATEMENT
                                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                End If
                            End If
                            rsINTERNAL_RO_DET.MoveNext
                        Loop

                       
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                            J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                            J_DEBIT = 0
                            J_CREDIT = Round(NumericVal(J_NET), 2)

                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                            "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                            " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                            ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                            ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"

                            gconDMIS.Execute SQL_STATEMENT
                            TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                       

                       
                            'COST OF SALES
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            If CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                            End If
                            J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                            J_CREDIT = 0
                            ALL_DEBIT = ALL_DEBIT + J_DEBIT
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        
                            'INVENTORY
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            If CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                            End If
                            J_DEBIT = 0
                            J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                            ALL_CREDIT = ALL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    'PARTS
                    Set rsINTERNAL_RO_DET = New ADODB.Recordset
                    Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '2' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND REP_OR = '" & CSMIOS_REP_OR & "'")
                    If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                        rsINTERNAL_RO_DET.MoveFirst
                        Do While Not rsINTERNAL_RO_DET.EOF
                            If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                                INTERNAL_PARTS_AMT = INTERNAL_PARTS_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                                INTERNAL_PARTS_COST = INTERNAL_PARTS_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                                
                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                                    J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                    J_TAX = 0
                                    J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                    'J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                    J_DEBIT = Round(NumericVal(J_NET), 2)
                                    J_CREDIT = 0
                                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                    gconDMIS.Execute SQL_STATEMENT
                                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                            rsINTERNAL_RO_DET.MoveNext
                        Loop

                        If INTERNAL_PARTS_AMT > 0 Then
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "RETAIL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "RETAIL")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                                End If
                                J_GROSS = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                                If CSMIOS_VAT_EXEMPT = True Then
                                    J_TAX = 0
                                Else
                                    J_TAX = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                                End If
                                J_NET = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                                J_DEBIT = 0
                                J_CREDIT = Round(NumericVal(J_NET), 2)
                                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO

                            If COMPANY_CODE = "HPI" Then
                            Else
                                'COST OF SALES
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "RETAIL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "RETAIL")))
                                Else
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                                    End If
                                End If
                                J_DEBIT = Round(INTERNAL_PARTS_COST, 2)
                                J_CREDIT = 0
                                TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If

                            'INVENTORY
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                                End If
                            J_DEBIT = 0
                            J_CREDIT = Round(INTERNAL_PARTS_COST, 2)
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)

                        End If

                    End If

                    'MATERIALS
                    Set rsINTERNAL_RO_DET = New ADODB.Recordset
                    Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '3' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND REP_OR = '" & CSMIOS_REP_OR & "'")
                    If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                        rsINTERNAL_RO_DET.MoveFirst
                        Do While Not rsINTERNAL_RO_DET.EOF
                            If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                                INTERNAL_MATERIALS_AMT = INTERNAL_MATERIALS_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                                INTERNAL_MATERIALS_COST = INTERNAL_MATERIALS_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                                    
                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                                    J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                    J_TAX = 0
                                    J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                    J_DEBIT = Round(NumericVal(J_NET), 2)
                                    J_CREDIT = 0
                                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"

                                    gconDMIS.Execute SQL_STATEMENT
                                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                            rsINTERNAL_RO_DET.MoveNext
                        Loop

                        If INTERNAL_MATERIALS_AMT > 0 Then
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS")))
                                End If

                                J_GROSS = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                                If CSMIOS_VAT_EXEMPT = True Then
                                    J_TAX = 0
                                Else
                                    J_TAX = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                                End If
                                J_NET = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                                J_DEBIT = 0
                                J_CREDIT = Round(NumericVal(J_NET), 2)
                                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
 
                                'COST OF SALES
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                                Else
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                                    End If
                            
                                J_GROSS = 0
                                J_TAX = 0
                                J_NET = 0
                                J_DEBIT = Round(INTERNAL_MATERIALS_COST, 2)
                                J_CREDIT = 0
                                TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If

                            'INVENTORY
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                                End If
                            J_GROSS = 0: J_TAX = 0: J_NET = 0
                            J_DEBIT = 0
                            J_CREDIT = Round(INTERNAL_MATERIALS_COST, 2)
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If

                    
                        'ACCESSORIES
                        Set rsINTERNAL_RO_DET = New ADODB.Recordset
                        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '4' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND REP_OR = '" & CSMIOS_REP_OR & "'")
                        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                            rsINTERNAL_RO_DET.MoveFirst
                            Do While Not rsINTERNAL_RO_DET.EOF
                                If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                                    INTERNAL_ACCESSORIES_AMT = INTERNAL_ACCESSORIES_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                                    INTERNAL_ACCESSORIES_COST = INTERNAL_ACCESSORIES_AMT + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                                    If COMPANY_CODE = "HPI" Then
                                    Else
                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                        J_TAX = 0
                                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                        J_DEBIT = Round(NumericVal(J_NET), 2)
                                        J_CREDIT = 0
                                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                        ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"

                                        gconDMIS.Execute SQL_STATEMENT
                                        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                    End If
                                End If
                                rsINTERNAL_RO_DET.MoveNext
                            Loop

                            If INTERNAL_MATERIALS_AMT > 0 Then
                            
                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS")))
                                    End If

                                    J_GROSS = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                                    If CSMIOS_VAT_EXEMPT = True Then
                                        J_TAX = 0
                                    Else
                                        J_TAX = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                                    End If
                                    J_NET = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                                    J_DEBIT = 0
                                    J_CREDIT = Round(NumericVal(J_NET), 2)
                                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                    gconDMIS.Execute SQL_STATEMENT
                                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO


                                
                                    'COST OF SALES
                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                        If CSMIOS_TERM = "CSH" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                                        Else
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                                        End If
                                        
                                    J_GROSS = 0
                                    J_TAX = 0
                                    J_NET = 0
                                    J_DEBIT = Round(INTERNAL_MATERIALS_COST, 2)
                                    J_CREDIT = 0
                                    TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)

                                'INVENTORY
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES")))
                                    End If
                                J_GROSS = 0: J_TAX = 0: J_NET = 0
                                J_DEBIT = 0
                                J_CREDIT = Round(INTERNAL_MATERIALS_COST, 2)
                                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)

                            End If
                        End If
                    'OUT PUT TAX
                        If INTERNAL_PARTS_COST + INTERNAL_MATERIALS_COST > 0 Then
                            If CSMIOS_VAT_EXEMPT = False Then
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If COMPANY_CODE = "HBK" Then
                                    If CSMIOS_TERM = "CHG" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnDeferredOutPutTax())
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDeferredOutPutTax()))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnOutputTax())
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnOutputTax()))
                                    End If
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnOutputTax())
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnOutputTax()))
                                End If
                                J_DEBIT = 0
                                J_CREDIT = Round(NumericVal(Round(((INTERNAL_PARTS_COST + INTERNAL_MATERIALS_COST)), 2) * 0.12), 2)
                                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                J_TAX = 0: J_GROSS = 0: J_NET = 0
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        End If


                    CSMIOS_REP_OR = Null2String(rsCSMIOS_REPOR!REP_OR)
                    CSMIOS_ACCT_NO = Null2String(rsCSMIOS_REPOR!ACCT_NO)
                    CSMIOS_PARTICIPAT = Null2String(rsCSMIOS_REPOR!PARTICIPAT)
                    CSMIOS_PLATE_NO = Null2String(rsCSMIOS_REPOR!PLATE_NO)
                    CSMIOS_NIYM = Null2String(rsCSMIOS_REPOR!Niym)

                    CSMIOS_TERM = Null2String(rsCSMIOS_REPOR!TERM)
                    CSMIOS_DTE_REL = Null2Date(rsCSMIOS_REPOR!DTE_REL)
                    CSMIOS_INVOICE = Null2String(rsCSMIOS_REPOR!INVOICE)

                    J_CUSTOMERCODE = N2Str2Null(CSMIOS_ACCT_NO)

                    WARRANTY_J_AMOUNTTOPAY = 0
                    WARRANTY_J_INVOICEAMT = Round(NumericVal(COMPANY_DIRECT_EXPENSE_LABOR + COMPANY_DIRECT_EXPENSE_SPAREPARTS + COMPANY_DIRECT_EXPENSE_GOL), 2)
                    WARRANTY_J_BALANCE = Round(NumericVal(COMPANY_DIRECT_EXPENSE_LABOR + COMPANY_DIRECT_EXPENSE_SPAREPARTS + COMPANY_DIRECT_EXPENSE_GOL), 2)
                    WARRANTY_J_AMOUNTPAID = 0
                    SQL_STATEMENT = "Insert into AMIS_Journal_HD" & _
                                    " (jdate,voucherno,jtype,vendorcode,customercode,invoicedate,invoicetype,invoiceno,invoiceamt,duedate,paytype,refno,refdate,terms,dealer,amounttopay,Balance,AmountPaid,jno,debit,credit,outbalance,status,CheckNo,CheckDate,BankCode,remarks,PaidStatus,ReceiveStatus)" & _
                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & ", " & J_VENDORCODE & "," & J_CUSTOMERCODE & ", " & J_INVOICEDATE & "," & J_INVOICETYPE & "," & J_INVOICENO & "," & WARRANTY_J_INVOICEAMT & ", " & J_DUEDATE & ", " & J_PAYTYPE & "," & J_REFNO & "," & J_REFDATE & "," & J_TERMS & "," & J_DEALER & ", " & WARRANTY_J_AMOUNTTOPAY & "," & WARRANTY_J_BALANCE & "," & WARRANTY_J_AMOUNTPAID & _
                                    ", " & WARRANTY_JNO & ", " & TOTAL_DEBIT & ", " & TOTAL_CREDIT & ", " & J_OUTBALANCE & ", " & J_STATUS & ", " & J_CHECKNO & ", " & J_CHECKDATE & ", " & J_BANKCODE & "," & J_REMARKS & "," & J_PAIDSTATUS & "," & J_RECEIVESTATUS & ")"
                    gconDMIS.Execute SQL_STATEMENT
                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_HD", "X", J_JTYPE, "Jtype"))
                    NEW_LogAudit "M", "JOURNAL ENTRY", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                    ':-)=================================
                    Grid2.Cell(GridImport, 1).Text = 1
                End If
                '=========================================================================================================================================================
            End If
        End If
        i = i + 1
        progCPB.Value = (i / (Grid2.Rows - 1)) * 100
        labCPB.Caption = Int(progCPB.Value) & "% Completed"
        DoEvents
    Next

    ImportPurelyInternal = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    ImportPurelyInternal = False
End Function

Function ImportPurelyInternalNew() As Boolean
    On Error GoTo ErrorCode

    ALL_DEBIT = 0: ALL_CREDIT = 0
    Set rsCSMIOS_REPOR = New ADODB.Recordset
    Set rsCSMIOS_REPOR = gconDMIS.Execute("Select * from CSMS_REPOR where REP_OR = '" & CSMIOS_REP_OR & "'")
    If Not rsCSMIOS_REPOR.EOF And Not rsCSMIOS_REPOR.BOF Then
        ItemCnt = 0
        CSMIOS_REP_OR = Null2String(rsCSMIOS_REPOR!REP_OR)
        CSMIOS_ACCT_NO = Null2String(rsCSMIOS_REPOR!ACCT_NO)
        CSMIOS_PARTICIPAT = Null2String(rsCSMIOS_REPOR!PARTICIPAT)
        CSMIOS_PLATE_NO = Null2String(rsCSMIOS_REPOR!PLATE_NO)
        CSMIOS_NIYM = Null2String(rsCSMIOS_REPOR!Niym)
        CSMIOS_TERM = Null2String(rsCSMIOS_REPOR!TERM)
        
        If COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCE" Then
            CSMIOS_DTE_REL = Null2Date(rsCSMIOS_REPOR!DTE_REL)
        Else
            CSMIOS_DTE_REL = Null2Date(rsCSMIOS_REPOR!dte_comp)
        End If
        
        CSMIOS_INVOICE = Null2String(rsCSMIOS_REPOR!INVOICE)
        CSMIOS_VAT_EXEMPT = Null2Bool(rsCSMIOS_REPOR!VAT_EXEMPT)
        CSMIOS_RO_AMOUNT = Round(N2Str2Zero(rsCSMIOS_REPOR!RO_AMOUNT), 2)

        'INTERNAL - COMPANY====================================================================================================================================================================================
        COMPANY_DIRECT_EXPENSE_LABOR = 0: COMPANY_DIRECT_EXPENSE_SPAREPARTS = 0: COMPANY_DIRECT_EXPENSE_GOL = 0: COMPANY_DIRECT_EXPENSE_ACCESSORIES = 0
        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
            Set rsCSMIOS_LABOR = New ADODB.Recordset
            Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS LABOR,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where WCODE = 'C' and livil = 1 and ISNULL(ROTYPE,0) <> 'SR' and REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
            If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
                COMPANY_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
            End If
            
            Dim rsCSMIOS_SR_C As New ADODB.Recordset
            Dim COMPANY_DIRECT_EXPENSE_SR_C As Double
            Set rsCSMIOS_SR_C = New ADODB.Recordset
            Set rsCSMIOS_SR_C = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS SUBLET,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where WCODE = 'C' and ISNULL(ROTYPE,0) = 'SR' and REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
            If Not rsCSMIOS_SR_C.EOF And Not rsCSMIOS_SR_C.BOF Then
                COMPANY_DIRECT_EXPENSE_SR_C = Round(N2Str2Zero(rsCSMIOS_SR_C!SUBLET), 2)
                COMPANY_DIRECT_EXPENSE_LABOR = COMPANY_DIRECT_EXPENSE_LABOR + COMPANY_DIRECT_EXPENSE_SR_C
            End If
            
            Set rsCSMIOS_PARTS = New ADODB.Recordset
            Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS PARTS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where WCODE = 'C' and livil = 2 and ISNULL(ROTYPE,0) <> 'SR' and REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
            If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                COMPANY_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2)
            End If
            
            Set rsCSMIOS_MATERIALS = New ADODB.Recordset
            Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS MATERIALS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET  Where WCODE = 'C' and livil = 3 and ISNULL(ROTYPE,0) <> 'SR' and REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
            If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
                COMPANY_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS), 2)
            End If
            
            Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
            Set rsCSMIOS_ACCESSORIES = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS MATERIALS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET  Where WCODE = 'C' and livil = 4 and ISNULL(ROTYPE,0) <> 'SR' and REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
            If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
                COMPANY_DIRECT_EXPENSE_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!MATERIALS), 2)
            End If
        Else
            Set rsCSMIOS_LABOR = New ADODB.Recordset
            Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS LABOR,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_LABORCompany Where REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
            If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then COMPANY_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2) Else COMPANY_DIRECT_EXPENSE_LABOR = 0
    
            Set rsCSMIOS_PARTS = New ADODB.Recordset
            Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS PARTS,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_PARTSCompany Where REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
            If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then COMPANY_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2) Else COMPANY_DIRECT_EXPENSE_SPAREPARTS = 0
    
            Set rsCSMIOS_MATERIALS = New ADODB.Recordset
            Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS MATERIALS,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_MATERIALSCompany Where REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
            If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then COMPANY_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS), 2) Else COMPANY_DIRECT_EXPENSE_GOL = 0
    
            Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
            rsCSMIOS_ACCESSORIES.Open ("SELECT SUM(CSMS_Ro_Det.DETVOL * CSMS_Ro_Det.DETPRC) AS ACCESSORIES, " & _
                                       "SUM((CSMS_Ro_Det.DETVOL * CSMS_Ro_Det.DETPRC) * (CSMS_Ro_Det.DISCRATE / 100)) As DISCOUNT " & _
                                       "FROM CSMS_Repor INNER JOIN CSMS_Ro_Det " & _
                                       "ON CSMS_Repor.REP_OR = CSMS_Ro_Det.REP_OR " & _
                                       "WHERE (CSMS_Ro_Det.LIVIL = '4') AND (CSMS_Ro_Det.WCODE = 'C') AND  CSMS_Repor.REP_OR= " & N2Str2Null(CSMIOS_REP_OR)), gconDMIS, adOpenForwardOnly
            If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
                COMPANY_DIRECT_EXPENSE_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!Accessories))
            Else
                COMPANY_DIRECT_EXPENSE_ACCESSORIES = 0
            End If
        End If

        'INTERNAL - SALES DEPARTMENT====================================================================================================================================================================================
        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
            Set rsCSMIOS_LABOR = New ADODB.Recordset
            Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS LABOR,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where WCODE = 'S' and livil = 1 and ISNULL(ROTYPE,0) <> 'SR' and REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
            If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
                SALES_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
            End If
            
            Dim rsCSMIOS_SR_S As New ADODB.Recordset
            Dim COMPANY_DIRECT_EXPENSE_SR_S As Double
            Set rsCSMIOS_SR_S = New ADODB.Recordset
            Set rsCSMIOS_SR_S = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS SUBLET,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where WCODE = 'S'   and ISNULL(ROTYPE,0)='SR' and REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
            If Not rsCSMIOS_SR_S.EOF And Not rsCSMIOS_SR_S.BOF Then
                COMPANY_DIRECT_EXPENSE_SR_S = Round(N2Str2Zero(rsCSMIOS_SR_S!SUBLET), 2)
                SALES_DIRECT_EXPENSE_LABOR = SALES_DIRECT_EXPENSE_LABOR + COMPANY_DIRECT_EXPENSE_SR_S
            End If
            
            Set rsCSMIOS_PARTS = New ADODB.Recordset
            Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS PARTS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where WCODE = 'S' and livil = 2 and ISNULL(ROTYPE,0) <> 'SR' and REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
            If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                SALES_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2)
            End If
            
            Set rsCSMIOS_MATERIALS = New ADODB.Recordset
            Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS MATERIALS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET  Where WCODE = 'S' and livil = 3 and ISNULL(ROTYPE,0) <> 'SR' and REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
            If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
                SALES_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS), 2)
            End If
            
            Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
            Set rsCSMIOS_ACCESSORIES = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS MATERIALS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET  Where WCODE = 'S' and livil = 4 and ISNULL(ROTYPE,0) <> 'SR' and REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
            If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
                SALES_DIRECT_EXPENSE_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!MATERIALS), 2)
            End If
        Else
        
            SALES_DIRECT_EXPENSE_LABOR = 0: SALES_DIRECT_EXPENSE_SPAREPARTS = 0: SALES_DIRECT_EXPENSE_GOL = 0
            Set rsCSMIOS_LABOR = New ADODB.Recordset
            Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS LABOR,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_LABORSales Where REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
            If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
                SALES_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
            Else
                SALES_DIRECT_EXPENSE_LABOR = 0
            End If
    
            Set rsCSMIOS_PARTS = New ADODB.Recordset
            Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS PARTS,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_PARTSSales Where REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
            If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                SALES_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2)
            Else
                SALES_DIRECT_EXPENSE_SPAREPARTS = 0
            End If
    
            Set rsCSMIOS_MATERIALS = New ADODB.Recordset
            Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS MATERIALS,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_MATERIALSSales Where REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
            If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
                SALES_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS), 2)
            Else
                SALES_DIRECT_EXPENSE_GOL = 0
            End If
    
            Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
            rsCSMIOS_ACCESSORIES.Open ("SELECT SUM(CSMS_Ro_Det.DETVOL * CSMS_Ro_Det.DETPRC) AS ACCESSORIES, " & _
                                       "SUM((CSMS_Ro_Det.DETVOL * CSMS_Ro_Det.DETPRC) * (CSMS_Ro_Det.DISCRATE / 100)) As DISCOUNT " & _
                                       "FROM CSMS_Repor INNER JOIN CSMS_Ro_Det " & _
                                       "ON CSMS_Repor.REP_OR = CSMS_Ro_Det.REP_OR " & _
                                       "WHERE (CSMS_Ro_Det.LIVIL = '4') AND (CSMS_Ro_Det.WCODE = 'S') AND  CSMS_Repor.REP_OR= " & N2Str2Null(CSMIOS_REP_OR)), gconDMIS, adOpenForwardOnly
            If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
                SALES_DIRECT_EXPENSE_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!Accessories))
            Else
                SALES_DIRECT_EXPENSE_ACCESSORIES = 0
            End If
        End If

        'ENTRY FOR PURELY INTERNAL=========================================================================================================================================================
        If J_INVOICEAMT > 0 Then GoTo SKIP_EXIT
        
        Set rsJournal_HDDup = New ADODB.Recordset
        Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_journal_hd order by jno desc")
        If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then
            WARRANTY_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 1, "000000") & "'"
        Else
            WARRANTY_JNO = "000001"
        End If
        
        '120916 - added COMPANY_DIRECT_EXPENSE_ACCESSORIES
        If COMPANY_DIRECT_EXPENSE_LABOR + COMPANY_DIRECT_EXPENSE_SPAREPARTS + COMPANY_DIRECT_EXPENSE_GOL + COMPANY_DIRECT_EXPENSE_ACCESSORIES + SALES_DIRECT_EXPENSE_LABOR + SALES_DIRECT_EXPENSE_SPAREPARTS + SALES_DIRECT_EXPENSE_GOL > 0 And CSMIOS_RO_AMOUNT = 0 Then

            Set rsJournal_HDDup = New ADODB.Recordset
            Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_journal_hd order by jno desc")
            If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then WARRANTY_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 1, "000000") & "'"
            J_JDATE = N2Date2Null(CSMIOS_DTE_REL)
            J_VOUCHERNO = N2Str2Null(GetVoucherNo())
            J_JTYPE = "'SJ'": J_REMARKS = "NULL": J_VENDORCODE = "'999999'"
            J_CUSTOMERCODE = N2Str2Null(CSMIOS_ACCT_NO)

            J_DEBIT = 0: J_CREDIT = 0: J_TAX = 0: J_OUTBALANCE = 0: J_AMOUNTTOPAY = 0
            CSMIOS_RO_AMOUNT = Round((CSMIOS_LABOR + CSMIOS_AIRCON + CSMIOS_TINSPAINT + CSMIOS_SUBLET + CSMIOS_PMS + CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES) - TOTAL_DISCOUNT_AMOUNT, 2)

            J_INVOICEAMT = Round(NumericVal(CSMIOS_RO_AMOUNT), 2)
            J_BALANCE = Round(NumericVal(CSMIOS_RO_AMOUNT), 2)
            J_AMOUNTPAID = 0
            J_STATUS = "'N'"

            J_INVOICEDATE = N2Date2Null(CSMIOS_DTE_REL)
            J_INVOICENO = N2Str2Null(CSMIOS_INVOICE)

            J_CHECKNO = "NULL": J_DUEDATE = N2Date2Null(CSMIOS_DTE_REL): J_PAYTYPE = "NULL": J_INVOICETYPE = "'SI'"
            J_CHECKDATE = "NULL": J_BANKCODE = "NULL": J_REFNO = N2Str2Null(CSMIOS_REP_OR): J_REFDATE = N2Date2Null(CSMIOS_DTE_REL)
            J_TERMS = N2Str2Null(CSMIOS_TERM): J_DEALER = "NULL": J_PAIDSTATUS = "'N'": J_RECEIVESTATUS = "'N'"
            
            WARRANTY_VOUCHERNO = N2Str2Null(Format(NumericVal(GetVoucherNo()), "000000"))
            WARRANTY_ItemCnt = 0
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            TOTAL_DEBIT = 0: TOTAL_CREDIT = 0
            'LABOR

            'to check if there is more than 1 purely charge to internal : update By BTT
            If PosibleDoubleInternal(CSMIOS_REP_OR) = True Then Exit Function

            INTERNAL_LABOR_AMT = 0: INTERNAL_PARTS_AMT = 0: INTERNAL_MATERIALS_AMT = 0: INTERNAL_ACCESSORIES_AMT = 0:
            INTERNAL_LABOR_COST = 0: INTERNAL_PARTS_COST = 0: INTERNAL_MATERIALS_COST = 0: INTERNAL_ACCESSORIES_COST = 0:
            
If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HCE" Then
    Call PURELYITERNAL
Else
            Set rsINTERNAL_RO_DET = New ADODB.Recordset
            Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0) Then
                        INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                        
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            
                        If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        Else
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                        End If
                            
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                                Set rsUEA = New ADODB.Recordset
                                Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                    Else
                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                        
                                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                        ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                        
                                        gconDMIS.Execute SQL_STATEMENT
                                        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                    End If
                            Else
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop
                
                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                    Else
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL")))
                    ElseIf COMPANY_CODE = "HMH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "INTERNAL")))
                    ElseIf COMPANY_CODE = "HGS" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                    End If
                    J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                    J_TAX = 0
                    J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                    If COMPANY_CODE = "HPI" Then
                        J_CREDIT = 0
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                    Else
                        J_DEBIT = 0
                        J_CREDIT = Round(NumericVal(J_NET), 2)
                    End If

                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"

                    gconDMIS.Execute SQL_STATEMENT
                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                    End If
                
                If COMPANY_CODE = "HGS" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                Else
                    'COST OF SALES
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HMH" Then
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL")))
                    End If
                ElseIf COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "CUSTOMER")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                    End If
                End If
                    J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                    J_CREDIT = 0
                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
                
                If COMPANY_CODE = "HGS" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "HSM" Then
                Else
                    'INVENTORY
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    End If
                    J_DEBIT = 0
                    J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
            
''SUBLET
If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
INTERNAL_LABOR_AMT = 0: INTERNAL_LABOR_COST = 0
 Set rsINTERNAL_RO_DET = New ADODB.Recordset
            Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S')AND ROTYPE = 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                        INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                            Else
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            End If
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                                Set rsUEA = New ADODB.Recordset
                                Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                                            gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                    Else
                                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                            SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                            "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                            " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                            ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                            ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                            gconDMIS.Execute SQL_STATEMENT
                                            TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                    End If
                            Else
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop
                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                    Else
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER")))
                    ElseIf COMPANY_CODE = "HMH" Or COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                    End If
                    J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                    J_TAX = 0
                    J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                    If COMPANY_CODE = "HPI" Then
                        J_CREDIT = 0
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                    Else
                        J_DEBIT = 0
                        J_CREDIT = Round(NumericVal(J_NET), 2)
                    End If

                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"

                    gconDMIS.Execute SQL_STATEMENT
                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                    End If
                
                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                Else
                    'COST OF SALES
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HMH" Then
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL")))
                    End If
                ElseIf COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "CUSTOMER")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                    End If
                End If
                    J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                    J_CREDIT = 0
                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
                If COMPANY_CODE = "HPI" Or COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "HSM" Then
                Else
                    'INVENTORY
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                    End If
                    J_DEBIT = 0
                    J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
End If
            'PARTS
            Set rsINTERNAL_RO_DET = New ADODB.Recordset
            Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '2' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0) Then
                        INTERNAL_PARTS_AMT = INTERNAL_PARTS_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_PARTS_COST = INTERNAL_PARTS_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                        If COMPANY_CODE = "HPI" Then
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            
                            If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                                J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                                J_TAX = 0
                                J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                            Else
                                J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                J_TAX = 0
                                J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            End If
                            
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                                    Set rsUEA = New ADODB.Recordset
                                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        Else
                                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                gconDMIS.Execute SQL_STATEMENT
                                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                        End If
                            Else
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                        End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop
                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                Else
                If INTERNAL_PARTS_AMT > 0 Then
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                       If COMPANY_CODE = "HMH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "INTERNAL")))
                        ElseIf COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                        End If
                        J_GROSS = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                        If CSMIOS_VAT_EXEMPT = True Then
                            J_TAX = 0
                        Else
                            J_TAX = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                        End If
                        J_NET = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                        J_DEBIT = 0
                        J_CREDIT = Round(NumericVal(J_NET), 2)
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                        ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                        gconDMIS.Execute SQL_STATEMENT
                        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                    End If
                    If COMPANY_CODE = "HNE" Or COMPANY_CODE = "HSM" Then
                    Else
                        'COST OF SALES
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        If COMPANY_CODE = "HMH" Then
                            If CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "INTERNAL")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "INTERNAL")))
                            End If
                        ElseIf COMPANY_CODE = "HMR" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                        Else
                            If CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                            End If
                        End If
                        J_DEBIT = Round(INTERNAL_PARTS_COST, 2)
                        J_CREDIT = 0
                        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If
                 If COMPANY_CODE = "HNE" Or COMPANY_CODE = "HSM" Then
                 Else
                    'INVENTORY
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                    ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARST-IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARST-IN-PROCESS")))
                    Else
                    
                        If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                        End If
                    End If
                    J_DEBIT = 0
                    J_CREDIT = Round(INTERNAL_PARTS_COST, 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                 End If
            End If

            'MATERIALS
            Set rsINTERNAL_RO_DET = New ADODB.Recordset
            Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '3' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0) Then
                        INTERNAL_MATERIALS_AMT = INTERNAL_MATERIALS_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_MATERIALS_COST = INTERNAL_MATERIALS_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                        If COMPANY_CODE = "HPI" Then
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            If COMPANY_CODE = "HMH" Then
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                            Else
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            End If
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                                    Set rsUEA = New ADODB.Recordset
                                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        Else
                                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                gconDMIS.Execute SQL_STATEMENT
                                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                        End If
                            Else
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                        End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop

                If INTERNAL_MATERIALS_AMT > 0 Then
                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Then
                    Else
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL")))
                        ElseIf COMPANY_CODE = "HMH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "INTERNAL")))
                        ElseIf COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS")))
                        End If

                        J_GROSS = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                        If CSMIOS_VAT_EXEMPT = True Then
                            J_TAX = 0
                        Else
                            J_TAX = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                        End If
                        J_NET = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                        J_DEBIT = 0
                        J_CREDIT = Round(NumericVal(J_NET), 2)
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                        ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                        gconDMIS.Execute SQL_STATEMENT
                        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                    

                    If COMPANY_CODE = "HNE" Or COMPANY_CODE = "HSM" Then
                    Else
                        'COST OF SALES
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        If COMPANY_CODE = "HMH" Then
                             If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "INTERNAL")))
                            Else
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "INTERNAL")))
                                End If
                        ElseIf COMPANY_CODE = "HMR" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                        ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                        Else
                            If CSMIOS_TERM = "CSH" Then
                                If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HOT" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                                End If
                            Else
                                If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                                End If
                            End If
                        End If
                        J_GROSS = 0
                        J_TAX = 0
                        J_NET = 0
                        J_DEBIT = Round(INTERNAL_MATERIALS_COST, 2)
                        J_CREDIT = 0
                        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If
                    
                    If COMPANY_CODE = "HNE" Or COMPANY_CODE = "HSM" Then
                    Else
                    'INVENTORY
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HMH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                    ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                    Else
                        If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                        End If
                    End If
                    J_GROSS = 0: J_TAX = 0: J_NET = 0
                    J_DEBIT = 0
                    J_CREDIT = Round(INTERNAL_MATERIALS_COST, 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                 End If
                End If
            End If

            'ACCESSORIES
                INTERNAL_ACCESSORIES_COST = 0
                Set rsINTERNAL_RO_DET = New ADODB.Recordset
                Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '4' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
                If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                    rsINTERNAL_RO_DET.MoveFirst
                    Do While Not rsINTERNAL_RO_DET.EOF
                        If (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0) Then
                            INTERNAL_ACCESSORIES_AMT = INTERNAL_ACCESSORIES_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                            INTERNAL_ACCESSORIES_COST = INTERNAL_ACCESSORIES_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                            If COMPANY_CODE = "HPI" Then
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                                '021916
                                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                                    J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                                    J_TAX = 0
                                    J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                                Else
                                    J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                    J_TAX = 0
                                    J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                End If
                                
                                J_DEBIT = Round(NumericVal(J_NET), 2)
                                J_CREDIT = 0
                                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                                        Set rsUEA = New ADODB.Recordset
                                        Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                    gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                            Else
                                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                    gconDMIS.Execute SQL_STATEMENT
                                                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                            End If
                                Else
                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                    gconDMIS.Execute SQL_STATEMENT
                                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                End If
                            End If
                        End If
                        rsINTERNAL_RO_DET.MoveNext
                    Loop

                    If INTERNAL_ACCESSORIES_AMT > 0 Then
                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                    Else
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            If COMPANY_CODE = "HMH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS")))
                            End If
                            J_GROSS = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                            If CSMIOS_VAT_EXEMPT = True Then
                                J_TAX = 0
                            Else
                                J_TAX = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                            End If
                            J_NET = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                            J_DEBIT = 0
                            J_CREDIT = Round(NumericVal(J_NET), 2)
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                            "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                            " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                            ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                            ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                            gconDMIS.Execute SQL_STATEMENT
                            TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                        

                        If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                        Else
                            'COST OF SALES
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            If COMPANY_CODE = "HMH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER")))
                            Else
                                If CSMIOS_TERM = "CSH" Then
                                    If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                                    End If
                                Else
                                    If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                                    End If
                                End If
                            End If
                            J_GROSS = 0
                            J_TAX = 0
                            J_NET = 0
                            J_DEBIT = Round(INTERNAL_MATERIALS_COST, 2)
                            J_CREDIT = 0
                            TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If
                        
                        'INVENTORY
                        If COMPANY_CODE = "HNE" Then
                        Else
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVA", "MATERIALS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVA", "MATERIALS")))
                        Else
                            If CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES")))
                            End If
                        End If
                        J_GROSS = 0: J_TAX = 0: J_NET = 0
                        J_DEBIT = 0
                        J_CREDIT = Round(INTERNAL_ACCESSORIES_COST, 2)
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                       End If
                    End If
                End If
End If

            CSMIOS_REP_OR = Null2String(rsCSMIOS_REPOR!REP_OR)
            CSMIOS_ACCT_NO = Null2String(rsCSMIOS_REPOR!ACCT_NO)
            CSMIOS_PARTICIPAT = Null2String(rsCSMIOS_REPOR!PARTICIPAT)
            CSMIOS_PLATE_NO = Null2String(rsCSMIOS_REPOR!PLATE_NO)
            CSMIOS_NIYM = Null2String(rsCSMIOS_REPOR!Niym)

            CSMIOS_TERM = Null2String(rsCSMIOS_REPOR!TERM)
            CSMIOS_DTE_REL = Null2Date(rsCSMIOS_REPOR!DTE_REL)
            CSMIOS_INVOICE = Null2String(rsCSMIOS_REPOR!INVOICE)

            J_CUSTOMERCODE = N2Str2Null(CSMIOS_ACCT_NO)
            J_REMARKS = " SERVICE INVOICENO:" + " " + CSMIOS_INVOICE
            WARRANTY_J_AMOUNTTOPAY = 0
            WARRANTY_J_INVOICEAMT = Round(NumericVal(COMPANY_DIRECT_EXPENSE_LABOR + COMPANY_DIRECT_EXPENSE_SPAREPARTS + COMPANY_DIRECT_EXPENSE_GOL), 2)
            WARRANTY_J_BALANCE = Round(NumericVal(COMPANY_DIRECT_EXPENSE_LABOR + COMPANY_DIRECT_EXPENSE_SPAREPARTS + COMPANY_DIRECT_EXPENSE_GOL), 2)
            WARRANTY_J_AMOUNTPAID = 0
            If (Left(CSMIOS_INVOICE, 6) = "INT RO") Or COMPANY_CODE = "HSM" Then
                WARRANTY_J_INVOICEAMT = 0
                WARRANTY_J_BALANCE = 0
            Else
                WARRANTY_J_INVOICEAMT = Round(NumericVal(COMPANY_DIRECT_EXPENSE_LABOR + COMPANY_DIRECT_EXPENSE_SPAREPARTS + COMPANY_DIRECT_EXPENSE_GOL), 2)
                WARRANTY_J_BALANCE = Round(NumericVal(COMPANY_DIRECT_EXPENSE_LABOR + COMPANY_DIRECT_EXPENSE_SPAREPARTS + COMPANY_DIRECT_EXPENSE_GOL), 2)
            End If
            SQL_STATEMENT = "Insert into AMIS_Journal_HD" & _
                            " (jdate,voucherno,jtype,vendorcode,customercode,invoicedate,invoicetype,invoiceno,invoiceamt,duedate,paytype,refno,refdate,terms,dealer,amounttopay,Balance,AmountPaid,jno,debit,credit,outbalance,status,CheckNo,CheckDate,BankCode,remarks,PaidStatus,ReceiveStatus)" & _
                            " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & ", " & J_VENDORCODE & "," & J_CUSTOMERCODE & ", " & J_INVOICEDATE & "," & J_INVOICETYPE & "," & J_INVOICENO & "," & WARRANTY_J_INVOICEAMT & ", " & J_DUEDATE & ", " & J_PAYTYPE & "," & J_REFNO & "," & J_REFDATE & "," & J_TERMS & "," & J_DEALER & ", " & WARRANTY_J_AMOUNTTOPAY & "," & WARRANTY_J_BALANCE & "," & WARRANTY_J_AMOUNTPAID & _
                            ", " & WARRANTY_JNO & ", " & TOTAL_DEBIT & ", " & TOTAL_CREDIT & ", " & J_OUTBALANCE & ", " & J_STATUS & ", " & J_CHECKNO & ", " & J_CHECKDATE & ", " & J_BANKCODE & ",'" & J_REMARKS & "'," & J_PAIDSTATUS & "," & J_RECEIVESTATUS & ")"
            gconDMIS.Execute SQL_STATEMENT
            TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_HD", "X", J_JTYPE, "Jtype"))
            NEW_LogAudit "M", "JOURNAL ENTRY", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
        End If
        '=========================================================================================================================================================
    End If
SKIP_EXIT:
    ImportPurelyInternalNew = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    ImportPurelyInternalNew = False
    ShowVBError
End Function

Sub ProcessPartsCost()
    Dim rsRo_det                                            As ADODB.Recordset
    Dim rsOrd_Hd                                            As ADODB.Recordset
    Dim rsRR_HD                                             As ADODB.Recordset
    Dim rsDAYTRAN                                           As ADODB.Recordset
    Dim rsPartMas                                           As ADODB.Recordset
    Dim i                                                   As Integer

    Dim vTDTranDate, vTDTranType, vTDTranno, vSupCode       As String
    Dim vTDTranQTY, vTotTranCost, vTotTranInvAmt, vMAC, vPMOnhand, vVatAmt As Double

    Set rsTdayTran = New ADODB.Recordset
    rsTdayTran.Open "select id,ItemNo,trantype,tranno,STOCK_ORD,tranqty,status,in_out,tranucost,traninvamt,trandate from PMIS_AllDayTran where tranucost <= 0 AND [TYPE] = 'P' AND trantype <> 'ADB' and (status = 'P' OR status = 'B') AND trandate = " & N2Date2Null(dtpTranDate) & " order by id asc", gconDMIS
    If Not rsTdayTran.EOF And Not rsTdayTran.BOF Then
        rsTdayTran.MoveFirst
        Screen.MousePointer = 11
        i = 0
        Do While Not rsTdayTran.EOF
            gconDMIS.Execute "update PMIS_DayTran set TYPE = 'P', ItemNo = '" & Format(Null2String(rsTdayTran!ItemNo), "0000") & "' where ID = " & rsTdayTran!ID
            gconDMIS.Execute "update PMIS_TDayTran set TYPE = 'P', ItemNo = '" & Format(Null2String(rsTdayTran!ItemNo), "0000") & "' where ID = " & rsTdayTran!ID
            vTDTranDate = N2Date2Null(rsTdayTran!trandate)
            vTDTranType = Null2String(rsTdayTran!TranType)
            vTDTranno = Null2String(rsTdayTran!TRANNO)
            vTDTranQTY = N2Str2Zero(rsTdayTran!tranqty)
            If N2Str2Zero(rsTdayTran!TRANUCOST) > 0 Then
                vTotTranCost = N2Str2Zero(rsTdayTran!TRANUCOST) * vTDTranQTY
            Else
                vTotTranCost = 0
            End If
            If N2Str2Zero(rsTdayTran!TRANINVAMT) > 0 Then
                vTotTranInvAmt = N2Str2Zero(rsTdayTran!TRANINVAMT) * vTDTranQTY
            Else
                vTotTranInvAmt = 0
            End If
            Set rsPartMas = New ADODB.Recordset
            rsPartMas.Open "select id,STOCKNO,mac,tissqty,trecqty,poqty,tprqty,prqty,issuances,receipts,onhand,ONREQUEST,REQSERVED,SERVED,ONORDER,ORDERED,tpoqty,S_REQSERVED,S_ONREQUEST,purchases from PMIS_PARTMAS where STOCKNO = " & N2Str2Null(rsTdayTran!stock_ord), gconDMIS
            If Not rsPartMas.EOF And Not rsPartMas.BOF Then
                vMAC = N2Str2Zero(rsPartMas!Mac)
                vPMOnhand = N2Str2IntZero(rsPartMas!ONHAND)
                If Null2String(rsTdayTran!IN_OUT) = "O" And vTDTranQTY <> 0 Then
                    gconDMIS.Execute "update PMIS_DayTran set tranucost = " & vMAC & " where ID = " & rsTdayTran!ID
                    gconDMIS.Execute "update PMIS_TDayTran set tranucost = " & vMAC & " where ID = " & rsTdayTran!ID
                End If

                If Null2String(rsTdayTran!IN_OUT) = "I" And vTDTranQTY <> 0 Then
                    Set rsRR_HD = New ADODB.Recordset
                    rsRR_HD.Open "Select id,recvd_code,ds1,status,classcode,rrno from PMIS_RR_HD where [TYPE] = 'P' AND rrno = '" & Format(vTDTranno, "000000") & "' and status <> 'C'", gconDMIS
                    If Not rsRR_HD.EOF And Not rsRR_HD.BOF Then
                        vSupCode = Null2String(rsRR_HD!RECVD_CODE)
                        vVatAmt = N2Str2Zero(rsRR_HD!DS1)
                        If Null2String(rsRR_HD!CLASSCODE) = "PCG" Or Null2String(rsRR_HD!CLASSCODE) = "PCS" Then
                            gconDMIS.Execute "update PMIS_RR_HD set ds1 = " & vVatAmt & " where id = " & rsRR_HD!ID
                            If CheckIfNonVatSup(Null2String(rsRR_HD!RECVD_CODE)) = False Then
                                If vSupCode <> VPAMCOR And vVatAmt <= 0 Then
                                    vTotTranCost = vTotTranCost / ConvertToBIRDecimalFormat(vVatAmt)
                                End If
                            Else
                                vTotTranCost = vTotTranInvAmt
                                If N2Str2Zero(rsTdayTran!TRANINVAMT) > 0 Then
                                    gconDMIS.Execute ("update PMIS_DayTran Set tranucost = " & rsTdayTran!TRANINVAMT & " Where id = " & rsTdayTran!ID)
                                    gconDMIS.Execute ("update PMIS_TDayTran Set tranucost = " & rsTdayTran!TRANINVAMT & " Where id = " & rsTdayTran!ID)
                                Else
                                    gconDMIS.Execute ("update PMIS_DayTran Set tranucost = 0 Where id = " & rsTdayTran!ID)
                                    gconDMIS.Execute ("update PMIS_TDayTran Set tranucost = 0 Where id = " & rsTdayTran!ID)
                                End If
                                gconDMIS.Execute ("update PMIS_RR_HD Set DS1 = 0, DS_AMT1 = 0 WHERE ID = " & rsRR_HD!ID)
                                gconDMIS.Execute ("update PMIS_REC_HIST Set DS1 = 0, DS_AMT1 = 0 WHERE ID = " & rsRR_HD!ID)
                            End If
                        End If
                    Else
                        If vTDTranType = "ADJ" Or vTDTranType = "BEG" Then
                            vTotTranCost = vMAC * vTDTranQTY
                        End If
                    End If
                    If vPMOnhand <= 0 Then
                        vMAC = vTotTranCost / vTDTranQTY
                    Else
                        vMAC = ((vMAC * vPMOnhand) + vTotTranCost) / (vTDTranQTY + vPMOnhand)
                    End If
                    gconDMIS.Execute "update PMIS_dayTran set tranucost = " & vMAC & ", mac = " & vMAC & ", status = 'P' where id = " & rsTdayTran!ID
                    gconDMIS.Execute "update PMIS_TdayTran set tranucost = " & vMAC & ", mac = " & vMAC & ", status = 'P' where id = " & rsTdayTran!ID
                End If
            End If
            DoEvents
            i = i + 1
            progCPB.Value = (i / rsTdayTran.RecordCount) * 100
            labCPB.Caption = Int(progCPB.Value) & "% Completed"
            rsTdayTran.MoveNext
        Loop
        DoEvents
        Screen.MousePointer = 0
    End If

    Set rsRo_det = New ADODB.Recordset
    Set rsRo_det = gconDMIS.Execute("Select CSMS_Ro_Det.ID,CSMS_Ro_Det.DetAmt,CSMS_Ro_Det.Rep_Or,detcde,CSMS_repor.Dte_rel from CSMS_Ro_Det inner join CSMS_repor on CSMS_ro_det.rep_or = CSMS_repor.rep_or where CSMS_RO_DET.livil = '2' and CSMS_RO_DET.DETCOST <=0 AND  CSMS_repor.DTE_REL = " & N2Date2Null(dtpTranDate) & " Order by CSMS_ro_det.Rep_Or asc")
    If Not rsRo_det.EOF And Not rsRo_det.BOF Then
        rsRo_det.MoveFirst
        i = 0
        Do While Not rsRo_det.EOF
            Set rsOrd_Hd = New ADODB.Recordset
            Set rsOrd_Hd = gconDMIS.Execute("Select tranno from PMIS_vw_ISS_HISTORY where [TYPE] = 'P' AND trantype = 'RIV' and RONO = '" & Null2String(rsRo_det!REP_OR) & "'")
            If Not rsOrd_Hd.EOF And Not rsOrd_Hd.BOF Then
                rsOrd_Hd.MoveFirst
                Do While Not rsOrd_Hd.EOF
                    Set rsDAYTRAN = New ADODB.Recordset
                    Set rsDAYTRAN = gconDMIS.Execute("Select tranucost from PMIS_vw_IS_DETHIST where [TYPE] = 'P' AND trantype = 'RIV' and tranno = '" & rsOrd_Hd!TRANNO & "' and STOCK_ORD = " & N2Str2Null(rsRo_det!DETCDE) & " order by trandate desc")
                    If Not rsDAYTRAN.EOF And Not rsDAYTRAN.BOF Then
                        If N2Str2Zero(rsDAYTRAN!TRANUCOST) > 0 Then
                            gconDMIS.Execute "Update CSMS_Ro_Det Set " & _
                                             "DetCost = " & N2Str2Zero(rsDAYTRAN!TRANUCOST) & _
                                             " Where id = " & rsRo_det!ID
                        End If
                    End If
                    rsOrd_Hd.MoveNext
                Loop
            End If
            i = i + 1
            progCPB.Value = (i / rsRo_det.RecordCount) * 100
            labCPB.Caption = Int(progCPB.Value) & "% Completed": DoEvents
            rsRo_det.MoveNext
        Loop
    End If
End Sub

Sub ProcessMaterialsCost()
    Dim rsRo_det                                            As ADODB.Recordset
    Dim rsOrd_Hd                                            As ADODB.Recordset
    Dim rsRR_HD                                             As ADODB.Recordset
    Dim rsDAYTRAN                                           As ADODB.Recordset
    Dim rsPartMas                                           As ADODB.Recordset
    Dim i                                                   As Integer

    Dim vTDTranDate, vTDTranType, vTDTranno, vSupCode, vSTOCKDESC As String
    Dim vTDTranQTY, vTotTranCost, vTotTranInvAmt, vMAC, vPMOnhand, vVatAmt As Double

    Set rsTdayTran = New ADODB.Recordset
    rsTdayTran.Open "select id,ItemNo,trantype,tranno,STOCK_ORD,tranqty,status,in_out,tranucost,traninvamt,trandate from PMIS_AllDayTran where tranucost <= 0 AND [TYPE] = 'M' AND trantype <> 'ADB' and (status = 'P' OR status = 'B') and status <> 'N' AND trandate = " & N2Date2Null(dtpTranDate) & " order by id asc", gconDMIS
    If Not rsTdayTran.EOF And Not rsTdayTran.BOF Then
        rsTdayTran.MoveFirst
        Screen.MousePointer = 11
        i = 0
        Do While Not rsTdayTran.EOF
            gconDMIS.Execute "update PMIS_DayTran set TYPE = 'M', ItemNo = '" & Format(Null2String(rsTdayTran!ItemNo), "0000") & "' where ID = " & rsTdayTran!ID
            gconDMIS.Execute "update PMIS_TDayTran set TYPE = 'M', ItemNo = '" & Format(Null2String(rsTdayTran!ItemNo), "0000") & "' where ID = " & rsTdayTran!ID
            vTDTranDate = N2Date2Null(rsTdayTran!trandate)
            vTDTranType = Null2String(rsTdayTran!TranType)
            vTDTranno = Null2String(rsTdayTran!TRANNO)
            vTDTranQTY = N2Str2IntZero(rsTdayTran!tranqty)
            If N2Str2Zero(rsTdayTran!TRANUCOST) > 0 Then
                vTotTranCost = N2Str2Zero(rsTdayTran!TRANUCOST) * vTDTranQTY
            Else
                vTotTranCost = 0
            End If
            If N2Str2Zero(rsTdayTran!TRANINVAMT) > 0 Then
                vTotTranInvAmt = N2Str2Zero(rsTdayTran!TRANINVAMT) * vTDTranQTY
            Else
                vTotTranInvAmt = 0
            End If
            Set rsPartMas = New ADODB.Recordset
            Set rsPartMas = gconDMIS.Execute("select STOCKNO from PMIS_STOCKMAS where TYPE = 'M' AND STOCKNO = " & N2Str2Null(rsTdayTran!stock_ord))
            If rsPartMas.EOF And rsPartMas.BOF Then
                vSTOCKDESC = "'NO DESCRIPTION'"
                'gconDMIS.Execute ("Insert into PMIS_STOCKMAS ([TYPE],STOCKNO,STOCKDESC,date_entered) values ('M'," & N2Str2Null(rsTdayTran!STOCK_ORD) & "," & vSTOCKDESC & "," & N2Str2Null(rsTdayTran!trandate) & ")")
            Else
                gconDMIS.Execute ("Update PMIS_STOCKMAS SET ACTIVE = 'Y', TYPE = 'M' WHERE STOCKNO = " & N2Str2Null(rsTdayTran!stock_ord))
            End If
            Set rsPartMas = New ADODB.Recordset
            rsPartMas.Open "select id,STOCKNO,mac,tissqty,trecqty,poqty,tprqty,prqty,issuances,receipts,onhand,ONREQUEST,REQSERVED,SERVED,ONORDER,ORDERED,tpoqty,S_REQSERVED,S_ONREQUEST,purchases from PMIS_STOCKMAS where TYPE = 'M' AND STOCKNO = " & N2Str2Null(rsTdayTran!stock_ord), gconDMIS
            If Not rsPartMas.EOF And Not rsPartMas.BOF Then
                vMAC = N2Str2Zero(rsPartMas!Mac)
                vPMOnhand = N2Str2IntZero(rsPartMas!ONHAND)
                If Null2String(rsTdayTran!IN_OUT) = "O" And vTDTranQTY <> 0 Then
                    gconDMIS.Execute "update PMIS_DayTran set tranucost = " & vMAC & " where ID = " & rsTdayTran!ID
                    gconDMIS.Execute "update PMIS_TDayTran set tranucost = " & vMAC & " where ID = " & rsTdayTran!ID
                End If

                If Null2String(rsTdayTran!IN_OUT) = "I" And vTDTranQTY <> 0 Then
                    Set rsRR_HD = New ADODB.Recordset
                    rsRR_HD.Open "Select id,recvd_code,ds1,status,classcode,rrno from PMIS_RR_HD where [TYPE] = 'M' AND rrno = '" & Format(vTDTranno, "000000") & "' and status <> 'C'", gconDMIS
                    If Not rsRR_HD.EOF And Not rsRR_HD.BOF Then
                        vSupCode = Null2String(rsRR_HD!RECVD_CODE)
                        vVatAmt = N2Str2Zero(rsRR_HD!DS1)
                        If Null2String(rsRR_HD!CLASSCODE) = "PCG" Or Null2String(rsRR_HD!CLASSCODE) = "PCS" Then
                            gconDMIS.Execute "update PMIS_RR_HD set ds1 = " & vVatAmt & " where id = " & rsRR_HD!ID
                            If CheckIfNonVatSup(Null2String(rsRR_HD!RECVD_CODE)) = False Then
                                If vSupCode <> VPAMCOR And vVatAmt <= 0 Then
                                    vTotTranCost = vTotTranCost / ConvertToBIRDecimalFormat(vVatAmt)
                                End If
                            Else
                                vTotTranCost = vTotTranInvAmt
                                If N2Str2Zero(rsTdayTran!TRANINVAMT) > 0 Then
                                    gconDMIS.Execute ("update PMIS_DayTran Set tranucost = " & rsTdayTran!TRANINVAMT & " Where id = " & rsTdayTran!ID)
                                    gconDMIS.Execute ("update PMIS_TDayTran Set tranucost = " & rsTdayTran!TRANINVAMT & " Where id = " & rsTdayTran!ID)
                                Else
                                    gconDMIS.Execute ("update PMIS_DayTran Set tranucost = 0 Where id = " & rsTdayTran!ID)
                                    gconDMIS.Execute ("update PMIS_TDayTran Set tranucost = 0 Where id = " & rsTdayTran!ID)
                                End If
                                gconDMIS.Execute ("update PMIS_RR_HD Set DS1 = 0, DS_AMT1 = 0 WHERE ID = " & rsRR_HD!ID)
                                gconDMIS.Execute ("update PMIS_REC_HIST Set DS1 = 0, DS_AMT1 = 0 WHERE ID = " & rsRR_HD!ID)
                            End If
                        End If
                    Else
                        If vTDTranType = "ADJ" Or vTDTranType = "BEG" Then
                            vTotTranCost = vMAC * vTDTranQTY
                        End If
                    End If
                    If vPMOnhand <= 0 Then
                        vMAC = vTotTranCost / vTDTranQTY
                    Else
                        vMAC = ((vMAC * vPMOnhand) + vTotTranCost) / (vTDTranQTY + vPMOnhand)
                    End If
                    gconDMIS.Execute "update PMIS_dayTran set tranucost = " & vMAC & ", mac = " & vMAC & ", status = 'P' where id = " & rsTdayTran!ID
                    gconDMIS.Execute "update PMIS_TdayTran set tranucost = " & vMAC & ", mac = " & vMAC & ", status = 'P' where id = " & rsTdayTran!ID
                End If
            End If
            DoEvents
            i = i + 1
            progCPB.Value = (i / rsTdayTran.RecordCount) * 100
            labCPB.Caption = Int(progCPB.Value) & "% Completed"
            DoEvents
            rsTdayTran.MoveNext
        Loop
        DoEvents
        Screen.MousePointer = 0
    End If


    Set rsRo_det = New ADODB.Recordset
    Set rsRo_det = gconDMIS.Execute("Select CSMS_Ro_Det.ID,CSMS_Ro_Det.DetAmt,CSMS_Ro_Det.Rep_Or,detcde,CSMS_repor.Dte_rel from CSMS_Ro_Det inner join CSMS_repor on CSMS_ro_det.rep_or = CSMS_repor.rep_or where CSMS_RO_DET.livil = '3' AND CSMS_RO_DET.DETCOST <=0 and CSMS_repor.DTE_REL = " & N2Date2Null(dtpTranDate) & " Order by CSMS_ro_det.Rep_Or asc")
    If Not rsRo_det.EOF And Not rsRo_det.BOF Then
        rsRo_det.MoveFirst
        i = 0
        Do While Not rsRo_det.EOF
            Set rsOrd_Hd = New ADODB.Recordset
            Set rsOrd_Hd = gconDMIS.Execute("Select tranno from PMIS_vw_ISS_HISTORY where [TYPE] = 'M' AND trantype = 'RIV' and RONO = '" & Null2String(rsRo_det!REP_OR) & "'")
            If Not rsOrd_Hd.EOF And Not rsOrd_Hd.BOF Then
                rsOrd_Hd.MoveFirst
                Do While Not rsOrd_Hd.EOF
                    Set rsDAYTRAN = New ADODB.Recordset
                    Set rsDAYTRAN = gconDMIS.Execute("Select tranucost from PMIS_vw_IS_DETHIST where [TYPE] = 'M' AND trantype = 'RIV' and tranno = '" & rsOrd_Hd!TRANNO & "' and STOCK_ORD = " & N2Str2Null(rsRo_det!DETCDE) & " order by trandate desc")
                    If Not rsDAYTRAN.EOF And Not rsDAYTRAN.BOF Then
                        If N2Str2Zero(rsDAYTRAN!TRANUCOST) > 0 Then
                            gconDMIS.Execute "Update CSMS_Ro_Det Set " & _
                                             "DetCost = " & N2Str2Zero(rsDAYTRAN!TRANUCOST) & _
                                             " Where id = " & rsRo_det!ID
                        End If
                    End If
                    rsOrd_Hd.MoveNext
                Loop
            End If
            i = i + 1
            progCPB.Value = (i / rsRo_det.RecordCount) * 100
            labCPB.Caption = Int(progCPB.Value) & "% Completed": DoEvents
            rsRo_det.MoveNext
        Loop
    End If
End Sub

Sub ProcessINITIALIZE_ACCESSORIESCOST()
    Dim rsRo_det                                            As ADODB.Recordset
    Dim rsOrd_Hd                                            As ADODB.Recordset
    Dim rsRR_HD                                             As ADODB.Recordset
    Dim rsDAYTRAN                                           As ADODB.Recordset
    Dim rsPartMas                                           As ADODB.Recordset
    Dim i                                                   As Integer

    Dim vTDTranDate, vTDTranType, vTDTranno, vSupCode, vSTOCKDESC As String
    Dim vTDTranQTY, vTotTranCost, vTotTranInvAmt, vMAC, vPMOnhand, vVatAmt As Double

    Set rsTdayTran = New ADODB.Recordset
    rsTdayTran.Open "select id,ItemNo,trantype,tranno,STOCK_ORD,tranqty,status,in_out,tranucost,traninvamt,trandate from PMIS_AllDayTran where tranucost <= 0 AND [TYPE] = 'A' AND trantype <> 'ADB' and (status = 'P' OR status = 'B') and status <> 'N' AND trandate = " & N2Date2Null(dtpTranDate) & " order by id asc", gconDMIS
    If Not rsTdayTran.EOF And Not rsTdayTran.BOF Then
        rsTdayTran.MoveFirst
        Screen.MousePointer = 11
        i = 0
        Do While Not rsTdayTran.EOF
            gconDMIS.Execute "update PMIS_DayTran set TYPE = 'A', ItemNo = '" & Format(Null2String(rsTdayTran!ItemNo), "0000") & "' where ID = " & rsTdayTran!ID
            gconDMIS.Execute "update PMIS_TDayTran set TYPE = 'A', ItemNo = '" & Format(Null2String(rsTdayTran!ItemNo), "0000") & "' where ID = " & rsTdayTran!ID
            vTDTranDate = N2Date2Null(rsTdayTran!trandate)
            vTDTranType = Null2String(rsTdayTran!TranType)
            vTDTranno = Null2String(rsTdayTran!TRANNO)
            vTDTranQTY = N2Str2IntZero(rsTdayTran!tranqty)
            If N2Str2Zero(rsTdayTran!TRANUCOST) > 0 Then
                vTotTranCost = N2Str2Zero(rsTdayTran!TRANUCOST) * vTDTranQTY
            Else
                vTotTranCost = 0
            End If
            If N2Str2Zero(rsTdayTran!TRANINVAMT) > 0 Then
                vTotTranInvAmt = N2Str2Zero(rsTdayTran!TRANINVAMT) * vTDTranQTY
            Else
                vTotTranInvAmt = 0
            End If
            Set rsPartMas = New ADODB.Recordset
            Set rsPartMas = gconDMIS.Execute("select STOCKNO from PMIS_STOCKMAS where TYPE = 'A' AND STOCKNO = " & N2Str2Null(rsTdayTran!stock_ord))
            If rsPartMas.EOF And rsPartMas.BOF Then
                vSTOCKDESC = "'NO DESCRIPTION'"
                'gconDMIS.Execute ("Insert into PMIS_STOCKMAS ([TYPE],STOCKNO,STOCKDESC,date_entered) values ('A'," & N2Str2Null(rsTdayTran!STOCK_ORD) & "," & vSTOCKDESC & "," & N2Str2Null(rsTdayTran!trandate) & ")")
            Else
                gconDMIS.Execute ("Update PMIS_STOCKMAS SET ACTIVE = 'Y', TYPE = 'A' WHERE STOCKNO = " & N2Str2Null(rsTdayTran!stock_ord))
            End If
            Set rsPartMas = New ADODB.Recordset
            rsPartMas.Open "select id,STOCKNO,mac,tissqty,trecqty,poqty,tprqty,prqty,issuances,receipts,onhand,ONREQUEST,REQSERVED,SERVED,ONORDER,ORDERED,tpoqty,S_REQSERVED,S_ONREQUEST,purchases from PMIS_STOCKMAS where TYPE = 'A' AND STOCKNO = " & N2Str2Null(rsTdayTran!stock_ord), gconDMIS
            If Not rsPartMas.EOF And Not rsPartMas.BOF Then
                vMAC = N2Str2Zero(rsPartMas!Mac)
                vPMOnhand = N2Str2IntZero(rsPartMas!ONHAND)
                If Null2String(rsTdayTran!IN_OUT) = "O" And vTDTranQTY <> 0 Then
                    gconDMIS.Execute "update PMIS_DayTran set tranucost = " & vMAC & " where ID = " & rsTdayTran!ID
                    gconDMIS.Execute "update PMIS_TDayTran set tranucost = " & vMAC & " where ID = " & rsTdayTran!ID
                End If

                If Null2String(rsTdayTran!IN_OUT) = "I" And vTDTranQTY <> 0 Then
                    Set rsRR_HD = New ADODB.Recordset
                    rsRR_HD.Open "Select id,recvd_code,ds1,status,classcode,rrno from PMIS_RR_HD where [TYPE] = 'A' AND rrno = '" & Format(vTDTranno, "000000") & "' and status <> 'C'", gconDMIS
                    If Not rsRR_HD.EOF And Not rsRR_HD.BOF Then
                        vSupCode = Null2String(rsRR_HD!RECVD_CODE)
                        vVatAmt = N2Str2Zero(rsRR_HD!DS1)
                        If Null2String(rsRR_HD!CLASSCODE) = "PCG" Or Null2String(rsRR_HD!CLASSCODE) = "PCS" Then
                            gconDMIS.Execute "update PMIS_RR_HD set ds1 = " & vVatAmt & " where id = " & rsRR_HD!ID
                            If CheckIfNonVatSup(Null2String(rsRR_HD!RECVD_CODE)) = False Then
                                If vSupCode <> VPAMCOR And vVatAmt <= 0 Then
                                    vTotTranCost = vTotTranCost / ConvertToBIRDecimalFormat(vVatAmt)
                                End If
                            Else
                                vTotTranCost = vTotTranInvAmt
                                If N2Str2Zero(rsTdayTran!TRANINVAMT) > 0 Then
                                    gconDMIS.Execute ("update PMIS_DayTran Set tranucost = " & rsTdayTran!TRANINVAMT & " Where id = " & rsTdayTran!ID)
                                    gconDMIS.Execute ("update PMIS_TDayTran Set tranucost = " & rsTdayTran!TRANINVAMT & " Where id = " & rsTdayTran!ID)
                                Else
                                    gconDMIS.Execute ("update PMIS_DayTran Set tranucost = 0 Where id = " & rsTdayTran!ID)
                                    gconDMIS.Execute ("update PMIS_TDayTran Set tranucost = 0 Where id = " & rsTdayTran!ID)
                                End If
                                gconDMIS.Execute ("update PMIS_RR_HD Set DS1 = 0, DS_AMT1 = 0 WHERE ID = " & rsRR_HD!ID)
                                gconDMIS.Execute ("update PMIS_REC_HIST Set DS1 = 0, DS_AMT1 = 0 WHERE ID = " & rsRR_HD!ID)
                            End If
                        End If
                    Else
                        If vTDTranType = "ADJ" Or vTDTranType = "BEG" Then
                            vTotTranCost = vMAC * vTDTranQTY
                        End If
                    End If
                    If vPMOnhand <= 0 Then
                        vMAC = vTotTranCost / vTDTranQTY
                    Else
                        vMAC = ((vMAC * vPMOnhand) + vTotTranCost) / (vTDTranQTY + vPMOnhand)
                    End If
                    gconDMIS.Execute "update PMIS_dayTran set tranucost = " & vMAC & ", mac = " & vMAC & ", status = 'P' where id = " & rsTdayTran!ID
                    gconDMIS.Execute "update PMIS_TdayTran set tranucost = " & vMAC & ", mac = " & vMAC & ", status = 'P' where id = " & rsTdayTran!ID
                End If
            End If
            DoEvents
            i = i + 1
            progCPB.Value = (i / rsTdayTran.RecordCount) * 100
            labCPB.Caption = Int(progCPB.Value) & "% Completed"
            DoEvents
            rsTdayTran.MoveNext
        Loop
        DoEvents
        Screen.MousePointer = 0
    End If


    Set rsRo_det = New ADODB.Recordset
    Set rsRo_det = gconDMIS.Execute("Select CSMS_Ro_Det.ID,CSMS_Ro_Det.DetAmt,CSMS_Ro_Det.Rep_Or,detcde,CSMS_repor.Dte_rel from CSMS_Ro_Det inner join CSMS_repor on CSMS_ro_det.rep_or = CSMS_repor.rep_or where CSMS_RO_DET.livil = '4'  AND CSMS_RO_DET.DETCOST <=0 and CSMS_repor.DTE_REL = " & N2Date2Null(dtpTranDate) & " Order by CSMS_ro_det.Rep_Or asc")
    If Not rsRo_det.EOF And Not rsRo_det.BOF Then
        rsRo_det.MoveFirst
        i = 0
        Do While Not rsRo_det.EOF
            Set rsOrd_Hd = New ADODB.Recordset
            Set rsOrd_Hd = gconDMIS.Execute("Select tranno from PMIS_vw_ISS_HISTORY where [TYPE] = 'A' AND trantype = 'RIV' and RONO = '" & Null2String(rsRo_det!REP_OR) & "'")
            If Not rsOrd_Hd.EOF And Not rsOrd_Hd.BOF Then
                rsOrd_Hd.MoveFirst
                Do While Not rsOrd_Hd.EOF
                    Set rsDAYTRAN = New ADODB.Recordset
                    Set rsDAYTRAN = gconDMIS.Execute("Select tranucost from PMIS_vw_IS_DETHIST where [TYPE] = 'A' AND trantype = 'RIV' and tranno = '" & rsOrd_Hd!TRANNO & "' and STOCK_ORD = " & N2Str2Null(rsRo_det!DETCDE) & " order by trandate desc")
                    If Not rsDAYTRAN.EOF And Not rsDAYTRAN.BOF Then
                        If N2Str2Zero(rsDAYTRAN!TRANUCOST) > 0 Then
                            gconDMIS.Execute "Update CSMS_Ro_Det Set " & _
                                             "DetCost = " & N2Str2Zero(rsDAYTRAN!TRANUCOST) & _
                                             " Where id = " & rsRo_det!ID
                        End If
                    End If
                    rsOrd_Hd.MoveNext
                Loop
            End If
            i = i + 1
            progCPB.Value = (i / rsRo_det.RecordCount) * 100
            labCPB.Caption = Int(progCPB.Value) & "% Completed": DoEvents
            rsRo_det.MoveNext
        Loop
    End If
End Sub

Sub InitGrids()
    With Grid1
        .Rows = 1
        .Cell(0, 1).Text = "Imported"
        .Cell(0, 2).Text = "Inv. Type"
        .Cell(0, 3).Text = "Inv. No."
        .Cell(0, 4).Text = "Inv. Amt."
        .Cell(0, 5).Text = "Customer"

        .Column(0).Width = 10
        .Column(1).Width = 50
        .Column(2).Width = 80
        .Column(3).Width = 80
        .Column(4).Width = 80
        .Column(5).Width = 200

        .Column(1).CellType = cellCheckBox
        .Column(4).Alignment = cellRightGeneral

        .Column(1).Locked = True
        .Column(2).Locked = True
        .Column(3).Locked = True
        .Column(4).Locked = True
        .Column(5).Locked = True

    End With

    With Grid2
        .Rows = 1
        .Cell(0, 1).Text = "Imported"
        .Cell(0, 2).Text = "RO No."
        .Cell(0, 3).Text = "Inv. No."
        .Cell(0, 4).Text = "Inv. Amt."
        .Cell(0, 5).Text = "Customer"

        .Column(0).Width = 10
        .Column(1).Width = 50
        .Column(2).Width = 80
        .Column(3).Width = 60
        .Column(4).Width = 80
        .Column(5).Width = 200

        .Column(1).CellType = cellCheckBox
        .Column(4).Alignment = cellRightGeneral

        .Column(1).Locked = True
        .Column(2).Locked = True
        .Column(3).Locked = True
        .Column(4).Locked = True
        .Column(5).Locked = True
    End With

    With Grid3
        .Rows = 1
        .Cell(0, 1).Text = "Imported"
        .Cell(0, 2).Text = "CS No."
        .Cell(0, 3).Text = "Inv. No."
        .Cell(0, 4).Text = "Inv. Amt."
        .Cell(0, 5).Text = "Customer"

        .Column(0).Width = 10
        .Column(1).Width = 50
        .Column(2).Width = 80
        .Column(3).Width = 80
        .Column(4).Width = 80
        .Column(5).Width = 200

        .Column(1).CellType = cellCheckBox
        .Column(4).Alignment = cellRightGeneral

        .Column(1).Locked = True
        .Column(2).Locked = True
        .Column(3).Locked = True
        .Column(4).Locked = True
        .Column(5).Locked = True
    End With
    DoEvents
End Sub
Function ImportPMISSales() As Boolean
    On Error GoTo ErrorCode
    Dim PMIOS_TRANTYPE                                      As String
    Dim PMIOS_TRANNO                                        As String
    Dim PMIOS_TRANDATE                                      As String
    Dim PMIOS_cuscde                                        As String
    Dim PMIOS_AcctName                                      As String
    Dim PMIOS_TTLINVAMT                                     As Double
    Dim PMIOS_DS_AMT1                                       As Double
    Dim PMIOS_NETINVAMT                                     As Double
    Dim PMIOS_NETCOST                                       As Double
    Dim PMIOS_PAY_CLASS                                     As String
    Dim PMIOS_TYPE                                          As String
    Dim PMIS_TYPE                                           As String
    Dim TOTAL_DEBIT, TOTAL_CREDIT                           As Double
    Dim i                                                   As Long
    Dim J_ITEMCOUNT                                         As Integer

    i = 0

    Dim GridImport                                          As Integer
    For GridImport = 1 To Grid1.Rows - 1
        If N2Str2Zero(Grid1.Cell(GridImport, 1).Text) = 0 Then
            Set rsPMIOS_ORD_HD = New ADODB.Recordset
            If Grid1.Cell(GridImport, 2).Text = "Accessories" Then
                If Len(Grid1.Cell(GridImport, 3).Text) = 10 Then
                    Set rsPMIOS_ORD_HD = gconDMIS.Execute("Select * from PMIS_vw_ISS_HISTORY Where Type = 'A' AND TranType = '" & Left(Grid1.Cell(GridImport, 3).Text, 3) & "' and Tranno = '" & Right(Grid1.Cell(GridImport, 3).Text, 6) & "' AND STATUS = 'P' AND trandate = '" & CDate(dtpTranDate) & "' order by Tranno ASC")
                Else
                    Set rsPMIOS_ORD_HD = gconDMIS.Execute("Select * from PMIS_vw_ISS_HISTORY Where Type = 'A' AND TranType = '" & Left(Grid1.Cell(GridImport, 3).Text, 2) & "' and Tranno = '" & Right(Grid1.Cell(GridImport, 3).Text, 6) & "' AND STATUS = 'P' AND trandate = '" & CDate(dtpTranDate) & "' order by Tranno ASC")
                End If
                PMIS_TYPE = "AI"
            ElseIf Grid1.Cell(GridImport, 2).Text = "Materials" Then
                If Len(Grid1.Cell(GridImport, 3).Text) = 10 Then
                    Set rsPMIOS_ORD_HD = gconDMIS.Execute("Select * from PMIS_vw_ISS_HISTORY Where Type = 'M' AND TranType = '" & Left(Grid1.Cell(GridImport, 3).Text, 3) & "' and Tranno = '" & Right(Grid1.Cell(GridImport, 3).Text, 6) & "' AND STATUS = 'P' AND trandate = '" & CDate(dtpTranDate) & "' order by Tranno ASC")
                Else
                    Set rsPMIOS_ORD_HD = gconDMIS.Execute("Select * from PMIS_vw_ISS_HISTORY Where Type = 'M' AND TranType = '" & Left(Grid1.Cell(GridImport, 3).Text, 2) & "' and Tranno = '" & Right(Grid1.Cell(GridImport, 3).Text, 6) & "' AND STATUS = 'P' AND trandate = '" & CDate(dtpTranDate) & "' order by Tranno ASC")
                End If
                PMIS_TYPE = "MI"
            ElseIf Grid1.Cell(GridImport, 2).Text = "Parts" Then
                If Len(Grid1.Cell(GridImport, 3).Text) = 10 Then
                    Set rsPMIOS_ORD_HD = gconDMIS.Execute("Select * from PMIS_vw_ISS_HISTORY Where Type = 'P' AND TranType = '" & Left(Grid1.Cell(GridImport, 3).Text, 3) & "' and Tranno = '" & Right(Grid1.Cell(GridImport, 3).Text, 6) & "' AND STATUS = 'P' AND trandate = '" & CDate(dtpTranDate) & "' order by Tranno ASC")
                Else
                    Set rsPMIOS_ORD_HD = gconDMIS.Execute("Select * from PMIS_vw_ISS_HISTORY Where Type = 'P' AND TranType = '" & Left(Grid1.Cell(GridImport, 3).Text, 2) & "' and Tranno = '" & Right(Grid1.Cell(GridImport, 3).Text, 6) & "' AND STATUS = 'P' AND trandate = '" & CDate(dtpTranDate) & "' order by Tranno ASC")
                End If
                PMIS_TYPE = "PI"
            Else
                GoTo NextGrid
            End If

            If Not rsPMIOS_ORD_HD.EOF And Not rsPMIOS_ORD_HD.BOF Then
                If CheckSJExisting(PMIS_TYPE, Null2String(rsPMIOS_ORD_HD!TRANNO), Null2String(rsPMIOS_ORD_HD!TranType)) = True Then
                    GoTo DuplicateInvoiceNo
                Else
                    PMIOS_TRANTYPE = Null2String(rsPMIOS_ORD_HD!TranType)
                    PMIOS_TRANNO = Null2String(rsPMIOS_ORD_HD!TRANNO)
                    PMIOS_TRANDATE = Null2String(rsPMIOS_ORD_HD!trandate)
                    PMIOS_cuscde = Null2String(rsPMIOS_ORD_HD!CUSTCODE)
                    'PMIOS_AcctName = Null2String(rsPMIOS_ORD_HD!AcctName)
                    PMIOS_AcctName = SetCustomerName(rsPMIOS_ORD_HD!CUSTCODE)
                    PMIOS_TTLINVAMT = Round(N2Str2Zero(rsPMIOS_ORD_HD!TTLINVAMT), 2)
                    PMIOS_NETINVAMT = Round(N2Str2Zero(rsPMIOS_ORD_HD!NETINVAMT), 2)
                    PMIOS_DS_AMT1 = Round(N2Str2Zero(rsPMIOS_ORD_HD!DS_AMT1), 2)



                    If COMPANY_CODE = "HAS" Then
                        ' Upate By BTT - 07082008: NET OF DISCOUNT
                        PMIOS_NETINVAMT = Round(N2Str2Zero(PMIOS_TTLINVAMT), 2) - PMIOS_DS_AMT1
                    End If

                    'PMIOS_NETCOST = Round(N2Str2Zero(rsPMIOS_ORD_HD!NETCOST), 2)
                    PMIOS_TYPE = Null2String(rsPMIOS_ORD_HD!Type)
                    PMIOS_NETCOST = ReturnCostOFSALES_PARTS(PMIOS_TRANNO, PMIOS_TRANTYPE, PMIOS_TYPE)



                    PMIOS_PAY_CLASS = Mid(Null2String(rsPMIOS_ORD_HD!REFPISNO), 5, 1)

                    TOTAL_DEBIT = 0: TOTAL_CREDIT = 0
                    'HEADER
                    Set rsJournal_HDDup = New ADODB.Recordset
                    Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_Journal_HD order by jno desc")
                    If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then
                        J_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 1, "000000") & "'"
                    Else
                        J_JNO = "'000001'"
                    End If

                    J_JDATE = N2Date2Null(PMIOS_TRANDATE)
                    J_VOUCHERNO = N2Str2Null(GetVoucherNo())
                    J_JTYPE = "'SJ'"
                    J_REMARKS = "NULL"
                    J_VENDORCODE = "'999999'"
                    J_CUSTOMERCODE = N2Str2Null(PMIOS_cuscde)

                    J_DEBIT = 0
                    J_CREDIT = 0
                    J_TAX = 0
                    J_OUTBALANCE = 0

                    J_AMOUNTTOPAY = 0
                    If COMPANY_CODE = "HCI" And PMIOS_PAY_CLASS = "I" Then
                        J_INVOICEAMT = Round(PMIOS_NETCOST, 2)
                    ElseIf PMIOS_TRANTYPE = "DR" And COMPANY_CODE = "HGC" Then
                        J_INVOICEAMT = Round(PMIOS_NETCOST, 2)
                    Else
                        J_INVOICEAMT = Round(PMIOS_NETINVAMT, 2)
                    End If
                    J_BALANCE = Round(PMIOS_NETINVAMT, 2)
                    J_AMOUNTPAID = 0

                    J_STATUS = "'N'"

                    J_INVOICEDATE = N2Date2Null(PMIOS_TRANDATE)
                    J_INVOICENO = N2Str2Null(PMIOS_TRANNO)
                    J_CHECKNO = "NULL"
                    J_DUEDATE = N2Date2Null(PMIOS_TRANDATE)
                    J_PAYTYPE = N2Str2Null(PMIOS_TRANTYPE)
                    If PMIOS_TYPE = "P" Then J_INVOICETYPE = "'PI'"
                    If PMIOS_TYPE = "A" Then J_INVOICETYPE = "'AI'"
                    If PMIOS_TYPE = "M" Then J_INVOICETYPE = "'MI'"
                    J_CHECKDATE = "NULL"
                    J_BANKCODE = "NULL"
                    J_REFNO = "NULL"
                    J_REFDATE = N2Date2Null(PMIOS_TRANDATE)
                    J_TERMS = "NULL"
                    J_DEALER = "NULL"
                    J_PAIDSTATUS = "'N'"
                    J_RECEIVESTATUS = "'N'"


                    J_ITEMCOUNT = 0
                    'J_JITEMNO = "'0001'"
                    If COMPANY_CODE = "HCI" And PMIOS_PAY_CLASS = "I" Then
                    Else
                        J_ITEMCOUNT = J_ITEMCOUNT + 1
                        J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                    End If
                    If PMIOS_TYPE = "P" Then
                        If PMIOS_TRANTYPE = "DR" And COMPANY_CODE = "HGC" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("AP", "BRANCH"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("AP", "BRANCH")))
                        ElseIf COMPANY_CODE = "HOT" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("PARTS", "PARTS", "RETAIL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("PARTS", "PARTS", "RETAIL")))
                        Else
                            If PMIOS_PAY_CLASS = "C" Then
                                'CUSTOMER PAID
                                If COMPANY_CODE = "HPI" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("PARTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("PARTS")))
                                ElseIf PMIOS_TRANTYPE = "DR" And COMPANY_CODE = "HGC" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("AP", "BRANCH"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("AP", "BRANCH")))
                                ElseIf COMPANY_CODE = "HOT" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("PARTS", "PARTS", "RETAIL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("PARTS", "PARTS", "RETAIL")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("PARTS", "COUNTER"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("PARTS", "COUNTER")))
                                End If

                            ElseIf PMIOS_PAY_CLASS = "W" Then
                                'WARRANTY
                                If COMPANY_CODE = "HPI" Then

                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("PARTS", "WARRANTY"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("PARTS", "WARRANTY")))
                                End If
                            Else
                                'INTERNAL
                                If COMPANY_CODE = "HGC" Or COMPANY_CODE = "HGH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                                ElseIf COMPANY_CODE = "HPI" Or COMPANY_CODE = "HCI" Then

                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("PARTS", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("PARTS", "INTERNAL")))
                                End If
                            End If
                        End If
                    End If
                    If PMIOS_TYPE = "A" Then
                        If PMIOS_PAY_CLASS = "C" Then
                            'CUSTOMER PAID
                            If COMPANY_CODE = "HPI" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("PARTS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("PARTS")))
                            ElseIf PMIOS_TRANTYPE = "DR" And COMPANY_CODE = "HGC" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("AP", "BRANCH"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("AP", "BRANCH")))
                            ElseIf COMPANY_CODE = "HOT" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("ACCESSORIES", "PARTS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("ACCESSORIES", "PARTS")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("ACCESSORIES"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("ACCESSORIES")))
                            End If
                        ElseIf PMIOS_PAY_CLASS = "W" Then
                            'WARRANTY
                            If COMPANY_CODE = "HPI" Then

                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("ACCESSORIES"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("ACCESSORIES")))
                            End If
                        Else
                            'INTERNAL
                            If COMPANY_CODE <> "HPI" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("ACCESSORIES"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("ACCESSORIES")))
                            End If
                        End If
                    End If
                    If PMIOS_TYPE = "M" Then
                        If PMIOS_PAY_CLASS = "C" Then
                            'CUSTOMER PAID
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("MATERIALS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("MATERIALS")))
                        ElseIf PMIOS_PAY_CLASS = "W" Then
                            'WARRANTY
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("MATERIALS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("MATERIALS")))
                        Else
                            'INTERNAL
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("MATERIALS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("MATERIALS")))
                        End If
                    End If
                    J_GROSS = Round(NumericVal(PMIOS_TTLINVAMT), 2)
                    J_TAX = Round(NumericVal(Round((PMIOS_TTLINVAMT / 1.12), 2) * 0.12), 2)
                    J_NET = Round(NumericVal(PMIOS_TTLINVAMT) - Round(NumericVal(J_TAX), 2), 2)
                    If PMIOS_TRANTYPE = "DR" And COMPANY_CODE = "HGC" Or COMPANY_CODE = "HGH" Then
                        'J_TAX = Round(NumericVal(Round((PMIOS_TTLINVAMT / 1.12), 2) * 0.12), 2)
                        J_DEBIT = J_INVOICEAMT
                    Else
                        J_DEBIT = 0
                        J_CREDIT = NumericVal(J_NET)
                        J_STATUS = "'N'"
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    End If
                    If COMPANY_CODE = "HPI" Then
                        If PMIOS_PAY_CLASS = "C" Then
                            SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                            "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                            " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                            ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                            ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                            gconDMIS.Execute SQL_STATEMENT
                            TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                        End If
                    ElseIf COMPANY_CODE = "HCI" And PMIOS_PAY_CLASS = "I" Then
                    Else
                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                        " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                        ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                        gconDMIS.Execute SQL_STATEMENT
                        TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                    End If

                    'COST OF SALES
                    'J_JITEMNO = "'0002'"
                    J_ITEMCOUNT = J_ITEMCOUNT + 1
                    J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                    'IF INTERBRANCH TRANSFER---AL
                    If COMPANY_CODE = "HGC" And PMIOS_TRANTYPE = "DR" Then
                    Else
                        If PMIOS_TYPE = "P" Then
                            If COMPANY_CODE = "HBK" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("PARTS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("PARTS")))
                            ElseIf COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("PARTS", "COUNTER"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("PARTS", "COUNTER")))
                            Else
                                If PMIOS_PAY_CLASS = "C" Then
                                    'CUSTOMER PAID
                                    If COMPANY_CODE = "HOT" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("PARTS", "PARTS", "RETAIL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("PARTS", "PARTS", "RETAIL")))
                                    ElseIf COMPANY_CODE = "HPI" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("PARTS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("PARTS")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("PARTS", "COUNTER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("PARTS", "COUNTER")))
                                    End If
                                ElseIf PMIOS_PAY_CLASS = "W" Then
                                    'WARRANTY
                                    If COMPANY_CODE = "HPI" Then
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("PARTS", "WARRANTY"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("PARTS", "WARRANTY")))
                                    End If
                                Else
                                    'INTERNAL
                                    If COMPANY_CODE = "HGC" Or COMPANY_CODE = "HGH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                                    ElseIf COMPANY_CODE = "HCI" Then
                                        If UCase(PMIOS_cuscde) = "H00068" Then
                                            '                                    J_ACCT_CODE = N2Str2Null(ReturnExpense("PARTS", "INTERNAL", "TAGBILARAN"))
                                            '                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnExpense("PARTS", "INTERNAL", "TAGBILARAN")))
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP", "TAGBILARAN"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP", "TAGBILARAN")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnExpense("PARTS", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnExpense("PARTS", "INTERNAL")))
                                        End If
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("PARTS", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("PARTS", "INTERNAL")))
                                    End If
                                End If
                            End If
                        End If
                        If PMIOS_TYPE = "A" Then
                            If PMIOS_PAY_CLASS = "C" Then
                                'CUSTOMER PAID
                                If COMPANY_CODE = "HPI" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("PARTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("PARTS")))
                                ElseIf COMPANY_CODE = "HOT" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("ACCESSORIES", "PARTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("ACCESSORIES", "PARTS")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("ACCESSORIES"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("ACCESSORIES")))
                                End If
                            ElseIf PMIOS_PAY_CLASS = "W" Then
                                'WARRANTY
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("ACCESSORIES"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("ACCESSORIES")))
                            Else
                                'INTERNAL
                                If COMPANY_CODE = "HPI" Then
                                ElseIf COMPANY_CODE = "HCI" Then
                                    If UCase(PMIOS_cuscde) = "H00068" Then
                                        'J_ACCT_CODE = N2Str2Null(ReturnExpense("PARTS", "INTERNAL", "TAGBILARAN"))
                                        'J_ACCT_NAME = N2Str2Null(Setacctname(ReturnExpense("PARTS", "INTERNAL", "TAGBILARAN")))
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES", "INVA", "TAGBILARAN"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES", "INVA", "TAGBILARAN")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnExpense("PARTS", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnExpense("PARTS", "INTERNAL")))
                                    End If
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("ACCESSORIES"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("ACCESSORIES")))
                                End If
                            End If
                        End If
                        If PMIOS_TYPE = "M" Then
                            If PMIOS_PAY_CLASS = "C" Then
                                'CUSTOMER PAID
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("MATERIALS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("MATERIALS")))
                            ElseIf PMIOS_PAY_CLASS = "W" Then
                                'WARRANTY
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("MATERIALS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("MATERIALS")))
                            Else
                                'INTERNAL
                                If COMPANY_CODE = "HPI" Then
                                ElseIf COMPANY_CODE = "HCI" Then
                                    If UCase(PMIOS_cuscde) = "H00068" Then
                                        '                                J_ACCT_CODE = N2Str2Null(ReturnExpense("PARTS", "INTERNAL", "TAGBILARAN"))
                                        '                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnExpense("PARTS", "INTERNAL", "TAGBILARAN")))
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "TAGBILARAN"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "TAGBILARAN")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnExpense("PARTS", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnExpense("PARTS", "INTERNAL")))
                                    End If
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("MATERIALS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("MATERIALS")))
                                End If
                            End If
                        End If
                        J_GROSS = 0
                        J_TAX = 0
                        J_NET = 0
                        J_DEBIT = Round(NumericVal(PMIOS_NETCOST), 2)
                        J_CREDIT = 0
                        J_STATUS = "'N'"
                        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT

                        If COMPANY_CODE = "HPI" Then
                            If PMIOS_PAY_CLASS = "C" Then
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                            End If
                        Else
                            SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                            "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                            " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                            ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                            ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                            gconDMIS.Execute SQL_STATEMENT
                            TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                        End If
                    End If

                    'INVENTORY
                    'J_JITEMNO = "'0003'"
                    J_ITEMCOUNT = J_ITEMCOUNT + 1
                    J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                    If PMIOS_TYPE = "P" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                    End If
                    If PMIOS_TYPE = "A" Then
                        If COMPANY_CODE = "HOT" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES", "INVP"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES", "INVP")))
                        ElseIf COMPANY_CODE = "HPI" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES", "INVA"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES", "INVA")))
                        End If
                    End If
                    If PMIOS_TYPE = "M" Then
                        If COMPANY_CODE = "HOT" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM")))
                        End If
                    End If
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(PMIOS_NETCOST), 2)
                    J_TAX = 0
                    J_GROSS = 0
                    J_NET = 0
                    J_STATUS = "'N'"
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                    " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                    ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                    gconDMIS.Execute SQL_STATEMENT
                    TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO

                    'OUTPUT TAX

                    If COMPANY_CODE = "HGC" Or COMPANY_CODE = "HCI" Or COMPANY_CODE = "HGH" Then

                        If PMIOS_TRANTYPE = "DR" Or PMIOS_PAY_CLASS = "I" Then
                            'DO NOTHING
                        Else
                            'J_JITEMNO = "'0004'"
                            J_ITEMCOUNT = J_ITEMCOUNT + 1
                            J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                            J_ACCT_CODE = N2Str2Null(ReturnOutputTax())
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnOutputTax()))
                            J_DEBIT = 0
                            J_CREDIT = Round(NumericVal(Round((PMIOS_NETINVAMT / 1.12), 2) * 0.12), 2)
                            J_TAX = 0
                            J_GROSS = 0
                            J_NET = 0
                            J_STATUS = "'N'"
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                            "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                            " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                            ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                            ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                            gconDMIS.Execute SQL_STATEMENT
                            NEW_LogAudit "MM", "JOURNAL IMPORT", SQL_STATEMENT, J_VOUCHERNO, "", CSMIOS_REP_OR, J_JTYPE, J_JNO
                        End If
                    Else
                        'J_JITEMNO = "'0004'"
                        J_ITEMCOUNT = J_ITEMCOUNT + 1
                        J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                        J_ACCT_CODE = N2Str2Null(ReturnOutputTax())
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnOutputTax()))
                        J_DEBIT = 0
                        J_CREDIT = Round(NumericVal(Round((PMIOS_NETINVAMT / 1.12), 2) * 0.12), 2)
                        J_TAX = 0
                        J_GROSS = 0
                        J_NET = 0
                        J_STATUS = "'N'"
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                        " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                        ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                        gconDMIS.Execute SQL_STATEMENT
                        TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                    End If
                    'A/R PARTS
                    'J_JITEMNO = "'0005'"
                    '=====IF DR
                    If COMPANY_CODE = "HGC" And PMIOS_TRANTYPE = "DR" Then
                    Else
                        J_ITEMCOUNT = J_ITEMCOUNT + 1
                        J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                        'CLEARING ACCOUNT - HGC - FML - 12/19/2007
                        If PMIOS_PAY_CLASS = "C" Then
                            J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("PARTS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("PARTS")))
                        Else
                            If COMPANY_CODE <> "HPI" Then
                                If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("PARTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("PARTS")))
                                ElseIf COMPANY_CODE = "HGC" And PMIOS_TRANTYPE = "DR" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INSTALLED"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INSTALLED")))
                                End If
                            End If
                        End If
                        
                            If PMIOS_PAY_CLASS = "I" Then
                                'Update bY: BTT - 07092008
                                'J_GROSS = Round(NumericVal(PMIOS_TTLINVAMT), 2)

                                If COMPANY_CODE = "HPI" Then
                                    '                            If PMIOS_TYPE = "P" Or PMIOS_TYPE = "M" Then
                                    '                                J_ACCT_CODE = "'71-37100-20'"
                                    '                                J_ACCT_NAME = N2Str2Null(Setacctname("'71-37100-20'"))
                                    '                                J_DEBIT = Round(NumericVal(PMIOS_TTLINVAMT), 2)
                                    '                            End If
                                Else
                                    J_TAX = Round(NumericVal(Round((PMIOS_TTLINVAMT / 1.12), 2) * 0.12), 2)
                                    J_NET = Round(NumericVal(PMIOS_TTLINVAMT) - Round(NumericVal(J_TAX), 2), 2)
                                    J_DEBIT = NumericVal(J_NET)
                                    J_CREDIT = 0
                                End If
                            Else
                                J_DEBIT = Round(NumericVal(PMIOS_NETINVAMT), 2)
                            End If
                      
                        J_CREDIT = 0
                        J_TAX = 0
                        J_GROSS = 0
                        J_NET = 0
                        J_STATUS = "'N'"
                        If PMIOS_TRANTYPE = "DR" And COMPANY_CODE = "HGC" Then
                            J_TAX = Round(NumericVal(Round((PMIOS_TTLINVAMT / 1.12), 2) * 0.12), 2)
                            J_NET = Round(NumericVal(PMIOS_TTLINVAMT) - Round(NumericVal(J_TAX), 2), 2)
                            J_CREDIT = NumericVal(J_NET)
                            J_DEBIT = 0
                        End If
                        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                        If COMPANY_CODE = "HPI" Then
                            If PMIOS_TYPE = "P" Or PMIOS_TYPE = "M" Then
                                J_ACCT_CODE = "'71-37100-20'"
                                J_ACCT_NAME = N2Str2Null(Setacctname("'71-37100-20'"))
                                J_DEBIT = Round(NumericVal(PMIOS_TTLINVAMT), 2)
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                            Else
                                If J_ACCT_CODE = "'11-02009-00'" Then
                                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                    " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                                    ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                    gconDMIS.Execute SQL_STATEMENT
                                    TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                                End If
                            End If
                        ElseIf COMPANY_CODE = "HCI" And PMIOS_PAY_CLASS = "I" Then
                        Else
                            SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                            "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                            " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                            ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                            ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                            gconDMIS.Execute SQL_STATEMENT
                            TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO

                        End If

                        If PMIOS_DS_AMT1 > 0 Then
                            'DISCOUNT
                            'J_JITEMNO = "'0006'"
                            J_ITEMCOUNT = J_ITEMCOUNT + 1
                            J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                            If PMIOS_TYPE = "P" Then
                                J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS")))
                            End If
                            If PMIOS_TYPE = "A" Then
                                If COMPANY_CODE = "HPI" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("ACCESSORIES"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("ACCESSORIES")))
                                End If
                            End If
                            If PMIOS_TYPE = "M" Then
                                If COMPANY_CODE = "HPI" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("MATERIALS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("MATERIALS")))
                                End If
                            End If
                            J_GROSS = Round(NumericVal(PMIOS_DS_AMT1), 2)
                            J_TAX = Round(NumericVal(Round((PMIOS_DS_AMT1 / 1.12), 2) * 0.12), 2)
                            J_NET = Round(NumericVal(PMIOS_DS_AMT1) - Round(NumericVal(J_TAX), 2), 2)
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                            J_STATUS = "'N'"
                            TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                            SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                            "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                            " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                            ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                            ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                            gconDMIS.Execute SQL_STATEMENT
                            TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                            NEW_LogAudit "AA", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                        Else
                            If PMIOS_PAY_CLASS = "I" Then
                                If PMIOS_TYPE = "A" Then
                                    If COMPANY_CODE = "HPI" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SALES"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SALES")))
                                        J_DEBIT = Round(NumericVal(PMIOS_TTLINVAMT), 2)
                                        J_CREDIT = 0
                                        J_STATUS = "'N'"
                                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                        " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                                        ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                        gconDMIS.Execute SQL_STATEMENT
                                        TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                        NEW_LogAudit "AA", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                                    End If
                                End If
                            End If
                        End If
                        '=====IF dr
                    End If
                    SQL_STATEMENT = "Insert into AMIS_Journal_HD" & _
                                    " (jdate,voucherno,jtype,vendorcode,customercode,invoicedate,invoicetype,invoiceno,invoiceamt,duedate,paytype,refno,refdate,terms,dealer,amounttopay,Balance,AmountPaid,jno,debit,credit,outbalance,status,CheckNo,CheckDate,BankCode,remarks,PaidStatus,ReceiveStatus)" & _
                                    " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & ", " & J_VENDORCODE & "," & J_CUSTOMERCODE & ", " & J_INVOICEDATE & "," & J_INVOICETYPE & "," & J_INVOICENO & "," & J_INVOICEAMT & ", " & J_DUEDATE & ", " & J_PAYTYPE & "," & J_REFNO & "," & J_REFDATE & "," & J_TERMS & "," & J_DEALER & ", " & J_AMOUNTTOPAY & "," & J_BALANCE & "," & J_AMOUNTPAID & _
                                    ", " & J_JNO & ", " & TOTAL_DEBIT & ", " & TOTAL_CREDIT & ", " & J_OUTBALANCE & ", " & J_STATUS & ", " & J_CHECKNO & ", " & J_CHECKDATE & ", " & J_BANKCODE & "," & J_REMARKS & "," & J_PAIDSTATUS & "," & J_RECEIVESTATUS & ")"
                    gconDMIS.Execute SQL_STATEMENT
                    Grid1.Cell(GridImport, 1).Text = 1
                    TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_HD", "X", J_JTYPE, "Jtype"))
                    NEW_LogAudit "M", "JOURNAL ENTRY", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                End If

            End If
        End If
        i = i + 1
        progCPB.Value = (i / (Grid1.Rows - 1)) * 100
        labCPB.Caption = Int(progCPB.Value) & "% Completed"
        DoEvents
NextGrid:
DuplicateInvoiceNo:
    Next

    ImportPMISSales = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    ImportPMISSales = False
End Function

Function ImportSMISSales() As Boolean
    On Error GoTo ErrorCode

    Dim i                                                   As Integer
    Dim GridImport                                          As Integer
    Dim rsSMIS_PURCHAGREE                                   As ADODB.Recordset
    Dim rsrecords                                           As ADODB.Recordset
    Dim SMIS_VI_NO                                          As String
    Dim SMIS_DATERELEASED                                   As String
    Dim SMIS_CODE                                           As String
    Dim SMIS_NETSALESPRICE                                  As Double
    Dim SMIS_OTHERS                                         As Double
    Dim SMIS_FOB                                            As Double
    Dim SMIS_TOTALCOST                                      As Double
    Dim SMIS_DOWNPAYMENT                                    As Double
    Dim SMIS_BALTOFINANCED                                  As Double
    Dim SMIS_INSURANCE                                      As Double
    Dim SMIS_LTOREGFEE                                      As Double
    Dim SMIS_CHMOFEE                                        As Double
    Dim SMIS_TERMS                                          As String
    Dim J_ITEMCOUNT                                         As Integer

    'VEHICLE SALES TRANSACTION
    '=========================================================================================================
    i = 0
    For GridImport = 1 To Grid3.Rows - 1
        If N2Str2Zero(Grid3.Cell(GridImport, 2).Text) = 0 Then

            Set rsSMIS_PURCHAGREE = New ADODB.Recordset
            Set rsSMIS_PURCHAGREE = gconDMIS.Execute("Select * from SMIS_StockTransfer Where SDNO = '" & Grid3.Cell(GridImport, 3).Text & "' AND deyt  = '" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' order by deyt ASC")
            If Not rsSMIS_PURCHAGREE.EOF And Not rsSMIS_PURCHAGREE.BOF Then
                SMIS_VI_NO = Null2String(rsSMIS_PURCHAGREE!SDNO)
                SMIS_DATERELEASED = Null2String(rsSMIS_PURCHAGREE!DEYT)
                SMIS_TOTALCOST = N2Str2Zero(ReturnAmount(rsSMIS_PURCHAGREE!DESCRIPTIONS))
                SMIS_NETSALESPRICE = N2Str2Zero(ReturnAmount(rsSMIS_PURCHAGREE!DESCRIPTIONS))
                SMIS_CODE = Null2String(rsSMIS_PURCHAGREE!Entity_to)
                TOTAL_DEBIT = 0: TOTAL_CREDIT = 0
                'HEADER
                Set rsJournal_HDDup = New ADODB.Recordset
                Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_Journal_HD order by jno desc")
                If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then
                    J_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 1, "000000") & "'"
                Else
                    J_JNO = "'000001'"
                End If

                J_JDATE = N2Date2Null(SMIS_DATERELEASED)
                J_VOUCHERNO = N2Str2Null(GetVoucherNo())
                J_JTYPE = "'SJ'"
                J_REMARKS = "'NULL'"                  '"v" + rsSMIS_PURCHAGREE!Notes
                J_VENDORCODE = "'999999'"
                J_CUSTOMERCODE = N2Str2Null(SMIS_CODE)

                J_DEBIT = 0
                J_CREDIT = 0
                J_TAX = 0
                J_OUTBALANCE = 0

                J_AMOUNTTOPAY = 0
                J_INVOICEAMT = SMIS_NETSALESPRICE
                J_BALANCE = SMIS_NETSALESPRICE
                J_AMOUNTPAID = 0

                J_STATUS = "'N'"

                J_INVOICEDATE = N2Date2Null(SMIS_DATERELEASED)
                J_INVOICENO = N2Str2Null(SMIS_VI_NO)
                J_CHECKNO = "NULL"
                J_DUEDATE = N2Date2Null(SMIS_DATERELEASED)
                J_PAYTYPE = "NULL"
                J_INVOICETYPE = "'VI'"
                J_CHECKDATE = "NULL"
                J_BANKCODE = "NULL"
                J_REFNO = "NULL"
                J_REFDATE = N2Date2Null(SMIS_DATERELEASED)
                J_TERMS = "NULL"
                J_DEALER = "NULL"
                J_PAIDSTATUS = "'N'"
                J_RECEIVESTATUS = "'N'"

                'BRANCH Transfer
                J_ITEMCOUNT = 0
                'J_JITEMNO = "'0001'"
                J_ITEMCOUNT = J_ITEMCOUNT + 1
                J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("AP", "BRANCH"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("AP", "BRANCH")))
                J_GROSS = Round(NumericVal(SMIS_NETSALESPRICE), 2)
                J_TAX = 0
                J_NET = Round(J_GROSS, 2)

                J_CREDIT = 0
                J_DEBIT = Round(NumericVal(J_NET), 2)
                J_STATUS = "'N'"
                TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                gconDMIS.Execute SQL_STATEMENT
                TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "BERNARD", J_JTYPE, "Jtype"))
                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                'INVENTORY
                J_ITEMCOUNT = J_ITEMCOUNT + 1
                J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnInventory("SALES", "VEHICLES"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SALES", "VEHICLES")))
                J_GROSS = 0
                J_TAX = 0
                J_NET = 0
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(SMIS_TOTALCOST))
                J_STATUS = "'N'"
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                gconDMIS.Execute SQL_STATEMENT
                TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "BERNARD", J_JTYPE, "Jtype"))
                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO


                SQL_STATEMENT = "Insert into AMIS_Journal_HD" & _
                                " (jdate,voucherno,jtype,vendorcode,customercode,invoicedate,invoicetype,invoiceno,invoiceamt,duedate,paytype,refno,refdate,terms,dealer,amounttopay,Balance,AmountPaid,jno,debit,credit,outbalance,status,CheckNo,CheckDate,BankCode,remarks,PaidStatus,ReceiveStatus)" & _
                                " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & ", " & J_VENDORCODE & "," & J_CUSTOMERCODE & ", " & J_INVOICEDATE & "," & J_INVOICETYPE & "," & J_INVOICENO & "," & J_INVOICEAMT & ", " & J_DUEDATE & ", " & J_PAYTYPE & "," & J_REFNO & "," & J_REFDATE & "," & J_TERMS & "," & J_DEALER & ", " & J_AMOUNTTOPAY & "," & J_BALANCE & "," & J_AMOUNTPAID & _
                                ", " & J_JNO & ", " & TOTAL_DEBIT & ", " & TOTAL_CREDIT & ", " & J_OUTBALANCE & ", " & J_STATUS & ", " & J_CHECKNO & ", " & J_CHECKDATE & ", " & J_BANKCODE & "," & J_REMARKS & "," & J_PAIDSTATUS & "," & J_RECEIVESTATUS & ")"
                gconDMIS.Execute SQL_STATEMENT
                TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_HD", "X", J_JTYPE, "Jtype"))
                NEW_LogAudit "M", "JOURNAL ENTRY", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                Grid3.Cell(GridImport, 1).Text = 1

            End If
        End If
        'god
        ' Else
        Set rsSMIS_PURCHAGREE = New ADODB.Recordset
        Set rsSMIS_PURCHAGREE = gconDMIS.Execute("Select * from SMIS_PurchAgree Where VI_NO = '" & Grid3.Cell(GridImport, 3).Text & "' AND STATUS = 'P' AND CONVERT(VarChar, DateReleased, 101)  = '" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' order by VI_NO ASC")
        If Not rsSMIS_PURCHAGREE.EOF And Not rsSMIS_PURCHAGREE.BOF Then
            If CheckSJExisting("VI", Null2String(rsSMIS_PURCHAGREE!VI_NO)) = True Then
                GoTo DuplicateInvoiceNo
            Else
                SMIS_VI_NO = Null2String(rsSMIS_PURCHAGREE!VI_NO)
                SMIS_DATERELEASED = Null2String(rsSMIS_PURCHAGREE!DATERELEASED)
                SMIS_CODE = Null2String(rsSMIS_PURCHAGREE!Code)
                SMIS_OTHERS = N2Str2Zero(rsSMIS_PURCHAGREE!OTHERS)
                SMIS_TOTALCOST = N2Str2Zero(rsSMIS_PURCHAGREE!TOTAL_COST)
                SMIS_DOWNPAYMENT = N2Str2Zero(rsSMIS_PURCHAGREE!DOWNPAYMENT)
                SMIS_BALTOFINANCED = N2Str2Zero(rsSMIS_PURCHAGREE!BALTOFINANCED)
                SMIS_TERMS = Null2String(rsSMIS_PURCHAGREE!TERM)

                SMIS_INSURANCE = N2Str2Zero(rsSMIS_PURCHAGREE!INSURANCE)
                SMIS_LTOREGFEE = N2Str2Zero(rsSMIS_PURCHAGREE!LTOREGFEE)
                SMIS_CHMOFEE = N2Str2Zero(rsSMIS_PURCHAGREE!CHMOFEE)
                SMIS_FOB = N2Str2Zero(rsSMIS_PURCHAGREE!FREIGHT)

                If Null2String(rsSMIS_PURCHAGREE!TERM) = "F" Then
                    SMIS_NETSALESPRICE = (N2Str2Zero(rsSMIS_PURCHAGREE!NETSALESPRICE) + SMIS_FOB)    '- SMIS_OTHERS
                Else
                    SMIS_NETSALESPRICE = N2Str2Zero(rsSMIS_PURCHAGREE!NETSALESPRICE)
                End If

                TOTAL_DEBIT = 0: TOTAL_CREDIT = 0
                'HEADER
                Set rsJournal_HDDup = New ADODB.Recordset
                Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_Journal_HD order by jno desc")
                If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then
                    J_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 1, "000000") & "'"
                Else
                    J_JNO = "'000001'"
                End If

                J_JDATE = N2Date2Null(SMIS_DATERELEASED)
                J_VOUCHERNO = N2Str2Null(GetVoucherNo())
                J_JTYPE = "'SJ'"
                J_REMARKS = "NULL"
                J_VENDORCODE = "'999999'"
                J_CUSTOMERCODE = N2Str2Null(SMIS_CODE)

                J_DEBIT = 0
                J_CREDIT = 0
                J_TAX = 0
                J_OUTBALANCE = 0

                J_AMOUNTTOPAY = 0
                J_INVOICEAMT = SMIS_NETSALESPRICE
                J_BALANCE = SMIS_NETSALESPRICE
                J_AMOUNTPAID = 0

                J_STATUS = "'N'"

                J_INVOICEDATE = N2Date2Null(SMIS_DATERELEASED)
                J_INVOICENO = N2Str2Null(SMIS_VI_NO)
                J_CHECKNO = "NULL"
                J_DUEDATE = N2Date2Null(SMIS_DATERELEASED)
                J_PAYTYPE = "NULL"
                J_INVOICETYPE = "'VI'"
                J_CHECKDATE = "NULL"
                J_BANKCODE = "NULL"
                J_REFNO = "NULL"
                J_REFDATE = N2Date2Null(SMIS_DATERELEASED)
                J_TERMS = "NULL"
                J_DEALER = "NULL"
                J_PAIDSTATUS = "'N'"
                J_RECEIVESTATUS = "'N'"


                'SALES
                J_ITEMCOUNT = 0
                'J_JITEMNO = "'0001'"
                J_ITEMCOUNT = J_ITEMCOUNT + 1
                J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                If COMPANY_CODE = "HBK" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SALES", "VEHICLES"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SALES", "VEHICLES")))
                ElseIf COMPANY_CODE = "HAS" Then
                    If rsSMIS_PURCHAGREE!Model = "I10" Then
                        J_ACCT_CODE = N2Str2Null("41-01016-10")
                        J_ACCT_NAME = N2Str2Null(Setacctname("41-01016-10"))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SALES", Null2String(rsSMIS_PURCHAGREE!Model)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SALES", Null2String(rsSMIS_PURCHAGREE!Model))))
                    End If
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SALES", Null2String(rsSMIS_PURCHAGREE!Model)))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SALES", Null2String(rsSMIS_PURCHAGREE!Model))))
                End If

                If J_ACCT_CODE = "NULL" Then
                    MessagePop InfoFriend, "INFORMATION", "Vehicle Model " & Null2String(rsSMIS_PURCHAGREE!Model) & " not yet set-up in Vehicle Sales - Account Code Set-Up"
                End If

                If Null2Bool(rsSMIS_PURCHAGREE!ZERORATED) = False Then
                    'J_GROSS = Round(NumericVal(SMIS_NETSALESPRICE) + NumericVal(SMIS_OTHERS), 2)
                    J_GROSS = Round(NumericVal(SMIS_NETSALESPRICE), 2)
                    J_TAX = Round(NumericVal(Round((J_GROSS / 1.12), 2) * 0.12), 2)
                    'J_TAX = Round(NumericVal(J_GROSS) / 1.12  * 0.12, 2)
                    J_NET = Round(NumericVal(J_GROSS) - Round(NumericVal(J_TAX), 2), 2)
                Else
                    'J_GROSS = Round(NumericVal(SMIS_NETSALESPRICE) + NumericVal(SMIS_OTHERS), 2)
                    J_GROSS = Round(NumericVal(SMIS_NETSALESPRICE), 2)
                    J_TAX = 0
                    J_NET = Round(J_GROSS, 2)
                End If
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)
                J_STATUS = "'N'"
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                gconDMIS.Execute SQL_STATEMENT
                TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "BERNARD", J_JTYPE, "Jtype"))
                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                'COST OF SALES
                'J_JITEMNO = "'0002'"
                J_ITEMCOUNT = J_ITEMCOUNT + 1
                J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                If COMPANY_CODE = "HBK" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SALES", "VEHICLES"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SALES", "VEHICLES")))
                ElseIf COMPANY_CODE = "HAS" Then
                    If rsSMIS_PURCHAGREE!Model = "I10" Then
                        J_ACCT_CODE = N2Str2Null("61-01016-10")
                        J_ACCT_NAME = N2Str2Null(Setacctname("61-01016-10"))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SALES", Null2String(rsSMIS_PURCHAGREE!Model)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SALES", Null2String(rsSMIS_PURCHAGREE!Model))))
                    End If
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SALES", Null2String(rsSMIS_PURCHAGREE!Model)))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SALES", Null2String(rsSMIS_PURCHAGREE!Model))))
                End If
                J_GROSS = 0
                J_TAX = 0
                J_NET = 0

                'J_DEBIT = Round(SMIS_TOTALCOST - (NumericVal(SMIS_TOTALCOST) / 1.12  * 0.12), 2)
                J_DEBIT = Round(SMIS_TOTALCOST - (NumericVal(SMIS_TOTALCOST) / 1.12) * 0.12, 2)
                J_CREDIT = 0
                J_STATUS = "'N'"
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                gconDMIS.Execute SQL_STATEMENT

                TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO

                'INVENTORY
                J_ITEMCOUNT = J_ITEMCOUNT + 1
                J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Or COMPANY_CODE = "HOT" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("SALES", Null2String(rsSMIS_PURCHAGREE!Model)))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SALES", Null2String(rsSMIS_PURCHAGREE!Model))))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("SALES", ""))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SALES", "")))
                End If
                J_GROSS = 0
                J_TAX = 0
                J_NET = 0
                J_DEBIT = 0
                J_CREDIT = Round(SMIS_TOTALCOST - (NumericVal(SMIS_TOTALCOST) / 1.12) * 0.12, 2)
                'J_CREDIT = Round(SMIS_TOTALCOST - (NumericVal(SMIS_TOTALCOST) / 9.3333), 2)
                J_STATUS = "'N'"
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                gconDMIS.Execute SQL_STATEMENT
                TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "BERNARD", J_JTYPE, "Jtype"))
                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO

                'J_JITEMNO = "'0004'"
                If Null2Bool(rsSMIS_PURCHAGREE!ZERORATED) = False Then
                    'OUTPUT TAX
                    J_ITEMCOUNT = J_ITEMCOUNT + 1
                    J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                    J_ACCT_CODE = N2Str2Null(ReturnOutputTax())
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnOutputTax()))
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(Round((SMIS_NETSALESPRICE / 1.12), 2) * 0.12), 2)
                    'J_CREDIT = Round(NumericVal(SMIS_NETSALESPRICE / 9.3333), 2)
                    J_TAX = 0
                    J_GROSS = 0
                    J_NET = 0
                    J_STATUS = "'N'"
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                    " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                    ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                    gconDMIS.Execute SQL_STATEMENT
                    TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "BERNARD", J_JTYPE, "Jtype"))
                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                End If


                '            'A/R VEHICLES
                '            J_JITEMNO = "'0001'"
                J_ITEMCOUNT = J_ITEMCOUNT + 1
                J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                If SMIS_TERMS = "COD" Then
                    J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("SALES"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("SALES")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("FINANCING"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("FINANCING")))
                End If

               
                    If Null2Bool(rsSMIS_PURCHAGREE!ZERORATED) = False Then
                        If COMPANY_CODE = "HCI" Then
                            J_DEBIT = Round(NumericVal(SMIS_NETSALESPRICE) + NumericVal(SMIS_INSURANCE) + NumericVal(SMIS_LTOREGFEE) + NumericVal(SMIS_CHMOFEE) + NumericVal(SMIS_FOB), 2)
                        Else
                            J_DEBIT = Round(NumericVal(SMIS_NETSALESPRICE), 2)
                        End If
                    Else
                        If COMPANY_CODE = "HCI" Then
                            J_DEBIT = Round(NumericVal(SMIS_NETSALESPRICE) + NumericVal(SMIS_INSURANCE) + NumericVal(SMIS_LTOREGFEE) + NumericVal(SMIS_CHMOFEE) + NumericVal(SMIS_FOB), 2)
                        Else
                            J_DEBIT = Round(NumericVal(SMIS_NETSALESPRICE), 2)
                        End If
                    End If
                

                J_CREDIT = 0
                J_TAX = 0
                J_GROSS = 0
                J_NET = 0
                J_STATUS = "'N'"

                TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                gconDMIS.Execute SQL_STATEMENT
                TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO

               
                    If SMIS_TERMS = "F" Or SMIS_TERMS = "BPO" Then
                        J_ITEMCOUNT = J_ITEMCOUNT + 1
                        J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                        J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("VEHICLES"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("VEHICLES")))
                        J_DEBIT = Round(NumericVal(SMIS_DOWNPAYMENT), 2)

                        J_CREDIT = 0
                        J_TAX = 0
                        J_GROSS = 0
                        J_NET = 0
                        J_STATUS = "'N'"
                        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                        " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                        ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                        gconDMIS.Execute SQL_STATEMENT
                        TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                    End If
               

                If COMPANY_CODE = "HCI" Then
                    If SMIS_INSURANCE <> 0 Then

                        J_ITEMCOUNT = J_ITEMCOUNT + 1
                        J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                        J_ACCT_CODE = N2Str2Null(ReturnAccommodation("INSURANCE"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccommodation("INSURANCE")))
                        J_GROSS = 0
                        J_TAX = 0
                        J_NET = 0
                        J_DEBIT = 0
                        J_CREDIT = Round(SMIS_INSURANCE, 2)
                        'J_CREDIT = Round(SMIS_TOTALCOST - (NumericVal(SMIS_TOTALCOST) / 9.3333), 2)
                        J_STATUS = "'N'"
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                        " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                        ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                        gconDMIS.Execute SQL_STATEMENT
                        TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "ELLAINE", J_JTYPE, "Jtype"))
                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                    End If

                    If SMIS_LTOREGFEE <> 0 Then
                        J_ITEMCOUNT = J_ITEMCOUNT + 1
                        J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                        J_ACCT_CODE = N2Str2Null(ReturnAccommodation("LTO"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccommodation("LTO")))
                        J_GROSS = 0
                        J_TAX = 0
                        J_NET = 0
                        J_DEBIT = 0
                        J_CREDIT = Round(SMIS_LTOREGFEE, 2)
                        'J_CREDIT = Round(SMIS_TOTALCOST - (NumericVal(SMIS_TOTALCOST) / 9.3333), 2)
                        J_STATUS = "'N'"
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                        " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                        ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                        gconDMIS.Execute SQL_STATEMENT
                        TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "ELLAINE", J_JTYPE, "Jtype"))
                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                    End If

                    If SMIS_CHMOFEE <> 0 Then
                        J_ITEMCOUNT = J_ITEMCOUNT + 1
                        J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                        J_ACCT_CODE = N2Str2Null(ReturnAccommodation("CHATTEL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccommodation("CHATTEL")))
                        J_GROSS = 0
                        J_TAX = 0
                        J_NET = 0
                        J_DEBIT = 0
                        J_CREDIT = Round(SMIS_CHMOFEE, 2)
                        'J_CREDIT = Round(SMIS_TOTALCOST - (NumericVal(SMIS_TOTALCOST) / 9.3333), 2)
                        J_STATUS = "'N'"
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                        " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                        ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                        gconDMIS.Execute SQL_STATEMENT
                        TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "ELLAINE", J_JTYPE, "Jtype"))
                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                    End If

                    If SMIS_FOB <> 0 Then
                        J_ITEMCOUNT = J_ITEMCOUNT + 1
                        J_JITEMNO = "'" & Format(J_ITEMCOUNT, "0000") & "'"
                        J_ACCT_CODE = N2Str2Null(ReturnAccommodation("FOB"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccommodation("FOB")))
                        J_GROSS = 0
                        J_TAX = 0
                        J_NET = 0
                        J_DEBIT = 0
                        J_CREDIT = Round(SMIS_FOB, 2)
                        'J_CREDIT = Round(SMIS_TOTALCOST - (NumericVal(SMIS_TOTALCOST) / 9.3333), 2)
                        J_STATUS = "'N'"
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                        " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                        ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                        gconDMIS.Execute SQL_STATEMENT
                        TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_det", "ELLAINE", J_JTYPE, "Jtype"))
                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                    End If


                End If
                '            'SALES PARTS
                '
                '            'If SMIS_FOB > 0 Then
                '            '   'FREIGHT AND HANDLING
                '            '   J_JITEMNO = "'0003'"
                '            '   J_ACCT_CODE = COA_COSTOFSALES_DISCOUNT_VEHICLES
                '            '   J_ACCT_NAME = N2Str2Null(SetAcctName(COA_COSTOFSALES_DISCOUNT_VEHICLES))
                '            '   J_GROSS = NumericVal(SMIS_FOB)
                '            '   J_TAX = Round(NumericVal(J_GROSS) / 9.3333, 2)
                '            '   J_NET = NumericVal(J_GROSS) - Round(NumericVal(J_TAX),2)
                '            '   J_DEBIT = NumericVal(J_NET)
                '            '   J_CREDIT = 0
                '            '   J_STATUS = "'N'"
                '            '   TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                '
                '            '   gconDMIS.Execute "insert into AMIS_Journal_Det " & _
                             '                '                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                             '                '                    " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                             '                '                    ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                             '                '                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                '            '
                '            '   J_JITEMNO = "'0004'"
                '            'Else
                '            '   J_JITEMNO = "'0003'"
                '            'End If
                '            J_JITEMNO = "'0003'"
                '            If SMIS_OTHERS > 0 Then
                '                'DISCOUNT
                '                J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SALES", Null2String(rsSMIS_PURCHAGREE!MODEL)))
                '                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SALES", Null2String(rsSMIS_PURCHAGREE!MODEL))))
                '                J_GROSS = NumericVal(SMIS_OTHERS)
                '                J_TAX = Round(NumericVal(J_GROSS) / 9.3333, 2)
                '                J_NET = NumericVal(J_GROSS) - Round(NumericVal(J_TAX),2)
                '                J_DEBIT = NumericVal(J_NET)
                '                J_CREDIT = 0
                '                J_STATUS = "'N'"
                '                TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                '
                '                gconDMIS.Execute "insert into AMIS_Journal_Det " & _
                                 '                                 "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                 '                               " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & _
                                 '                                 ", " & J_JNO & ", " & J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                 '                                 ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                '                J_JITEMNO = "'0004'"
                '            End If
                '
                '
                '            If J_JITEMNO = "'0005'" Then
                '                J_JITEMNO = "'0006'"
                '            Else
                '                J_JITEMNO = "'0005'"
                '            End If

                SQL_STATEMENT = "Insert into AMIS_Journal_HD" & _
                                " (jdate,voucherno,jtype,vendorcode,customercode,invoicedate,invoicetype,invoiceno,invoiceamt,duedate,paytype,refno,refdate,terms,dealer,amounttopay,Balance,AmountPaid,jno,debit,credit,outbalance,status,CheckNo,CheckDate,BankCode,remarks,PaidStatus,ReceiveStatus)" & _
                                " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & ", " & J_VENDORCODE & "," & J_CUSTOMERCODE & ", " & J_INVOICEDATE & "," & J_INVOICETYPE & "," & J_INVOICENO & "," & J_INVOICEAMT & ", " & J_DUEDATE & ", " & J_PAYTYPE & "," & J_REFNO & "," & J_REFDATE & "," & J_TERMS & "," & J_DEALER & ", " & J_AMOUNTTOPAY & "," & J_BALANCE & "," & J_AMOUNTPAID & _
                                ", " & J_JNO & ", " & TOTAL_DEBIT & ", " & TOTAL_CREDIT & ", " & J_OUTBALANCE & ", " & J_STATUS & ", " & J_CHECKNO & ", " & J_CHECKDATE & ", " & J_BANKCODE & "," & J_REMARKS & "," & J_PAIDSTATUS & "," & J_RECEIVESTATUS & ")"
                gconDMIS.Execute SQL_STATEMENT
                TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_HD", "X", J_JTYPE, "Jtype"))
                NEW_LogAudit "M", "JOURNAL ENTRY", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, J_JNO
                Grid3.Cell(GridImport, 1).Text = 1

                'End If
            End If
        End If

        i = i + 1
        progCPB.Value = (i / (Grid3.Rows - 1)) * 100
        labCPB.Caption = Int(progCPB.Value) & "% Completed"
        DoEvents
DuplicateInvoiceNo:
    Next

    ImportSMISSales = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    ImportSMISSales = False
End Function

Sub INITIALIZE_ACCESSORIESCOST(XXX As String)
        Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HGS" Then
        CSMIOS_ACCESSORIES = 0: CSMIOS_ACCESSORIES_DISCOUNT = 0
        Set rsCSMIOS_ACCESSORIES = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS ACCESSORIES,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where LIVIL = 4 and WCODE IS NULL and ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
                CSMIOS_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!Accessories), 2)
                CSMIOS_ACCESSORIES_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!DISCOUNT), 2)
        End If
    Else
        Set rsCSMIOS_ACCESSORIES = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS ACCESSORIES,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMIOS_vw_ACCCOST Where REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
            CSMIOS_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!Accessories), 2)
            CSMIOS_ACCESSORIES_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!DISCOUNT), 2)
        Else
            CSMIOS_ACCESSORIES = 0: CSMIOS_ACCESSORIES_DISCOUNT = 0
        End If
    End If
If COMPANY_CODE <> "DJM" And COMPANY_CODE <> "DAI" And COMPANY_CODE <> "DPI" And COMPANY_CODE <> "DMI" And COMPANY_CODE <> "HCA" And COMPANY_CODE <> "HCE" And COMPANY_CODE <> "HNE" And COMPANY_CODE <> "FMC" And COMPANY_CODE <> "DGI" And COMPANY_CODE <> "HMH" And COMPANY_CODE <> "HSM" And COMPANY_CODE <> "HMR" And COMPANY_CODE <> "HGS" Then
        Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
        Set rsCSMIOS_ACCESSORIES = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS ACCESSORIES,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMIOS_vw_WARRANTY_ACCCOST Where REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
            WARRANTY_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!Accessories), 2)
        End If

        Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
        Set rsCSMIOS_ACCESSORIES = gconDMIS.Execute("Select ROUND(sum(DETCOST * DETVOL),2) AS ACC_COST from CSMIOS_vw_WARRANTY_ACCCOST Where REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
            WARRANTY_CSMIOS_ACCESSORIES_COST = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!ACC_COST), 2)
        Else
            WARRANTY_CSMIOS_ACCESSORIES_COST = 0:
        End If
End If
End Sub

Sub INITIALIZE_SALES_AND_DISCOUNT(XXX As String)
    CSMIOS_LABOR = 0
    CSMIOS_LABOR_DISCOUNT = 0
    CSMIOS_LABOR_COST = 0
    CSMIOS_PARTS = 0
    CSMIOS_PARTS_DISCOUNT = 0
    CSMIOS_MATERIALS = 0
    CSMIOS_MATERIALS_DISCOUNT = 0
    CSMIOS_SUBLET = 0
    CSMIOS_SUBLET_DISCOUNT = 0
    CSMIOS_SUBLET_COST = 0
    CSMIOS_TINSPAINT = 0
    CSMIOS_TINSPAINT_DISCOUNT = 0
    CSMIOS_TINSPAINT_COST = 0
    CSMIOS_PMS = 0
    CSMIOS_PMS_DISCOUNT = 0
    CSMIOS_PMS_COST = 0
    CSMIOS_PARTS_COST = 0
    CSMIOS_MATERIALS_COST = 0
    CSMIOS_ACCESSORIES_COST = 0:
    WARRANTY_DIRECT_EXPENSE_LABOR = 0
    WARRANTY_DIRECT_EXPENSE_SPAREPARTS = 0
    WARRANTY_DIRECT_EXPENSE_GOL = 0
    WARRANTY_CSMIOS_PARTS_COST = 0
    WARRANTY_CSMIOS_MATERIALS_COST = 0
    WARRANTY_CSMIOS_ACCESSORIES_COST = 0
    COMPANY_DIRECT_EXPENSE_LABOR = 0
    COMPANY_DIRECT_EXPENSE_SPAREPARTS = 0
    COMPANY_DIRECT_EXPENSE_GOL = 0
    SALES_DIRECT_EXPENSE_LABOR = 0
    SALES_DIRECT_EXPENSE_SPAREPARTS = 0
    SALES_DIRECT_EXPENSE_GOL = 0
    COMPANY_DIRECT_EXPENSE_LABOR = 0
    COMPANY_DIRECT_EXPENSE_SPAREPARTS = 0
    COMPANY_DIRECT_EXPENSE_GOL = 0
    CSMIOS_PARTS_BP = 0
    CSMIOS_MATERIALS_BP = 0
    
    'SALES AND DISCOUNTS
    '====================================================================================================================================================================================
 ''LABOR
    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HGS" Then
        Set rsCSMIOS_LABOR = New ADODB.Recordset
        Set rsCSMIOS_LABOR = gconDMIS.Execute("Select DET_AMT AS LABOR,DETCOST AS COST,DISCOUNT_2 AS DISCOUNT FROM CSMS_RO_DET Where ISNULL(ROTYPE,0) <> 'SR' AND WCODE IS NULL AND LIVIL = 1 AND ISNULL(JOBTYPE,0) IN ('GJ','PMS','BP') AND REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
            Do While Not rsCSMIOS_LABOR.EOF
                CSMIOS_LABOR = CSMIOS_LABOR + N2Str2Zero(rsCSMIOS_LABOR!LABOR)
                CSMIOS_LABOR_DISCOUNT = CSMIOS_LABOR_DISCOUNT + Round(N2Str2Zero(rsCSMIOS_LABOR!DISCOUNT), 2)
                CSMIOS_LABOR_COST = CSMIOS_LABOR_COST + N2Str2Zero(rsCSMIOS_LABOR!Cost)
            rsCSMIOS_LABOR.MoveNext
            Loop
                CSMIOS_LABOR = Round(CSMIOS_LABOR, 2)
                CSMIOS_LABOR_COST = Round(CSMIOS_LABOR_COST, 2)
        End If
    Else
        Set rsCSMIOS_LABOR = New ADODB.Recordset
        Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS LABOR,ROUND(sum(DETCOST),2) AS COST,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_LABOR Where REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
            CSMIOS_LABOR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
            CSMIOS_LABOR_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_LABOR!DISCOUNT), 2)
            CSMIOS_LABOR_COST = Round(N2Str2Zero(rsCSMIOS_LABOR!Cost), 2)
        End If
    End If

''PARTS
    If COMPANY_CODE = "HNE" Then
        Set rsCSMIOS_PARTS = New ADODB.Recordset
        Set rsCSMIOS_PARTS = gconDMIS.Execute("SELECT ROUND(SUM(DET_AMT),2) AS PARTS,ROUND(SUM(DISCOUNT_2),2) AS DISCOUNT FROM CSMS_RO_DET  WHERE  LIVIL = 2 AND (SELECT NON_HARI FROM PMIS_STOCKMAS WHERE STOCKNO = DETCDE) ='N' AND REP_OR = " & N2Str2Null(XXX) & "")
        If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
            CSMIOS_PARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2)
            CSMIOS_PARTS_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_PARTS!DISCOUNT), 2)
        End If

        Set rsCSMIOS_PARTS_NON = New ADODB.Recordset
        Set rsCSMIOS_PARTS = gconDMIS.Execute("SELECT ROUND(SUM(DET_AMT),2) AS PARTS,ROUND(SUM(DISCOUNT_2),2) AS DISCOUNT FROM CSMS_RO_DET  WHERE  LIVIL = 2 AND (SELECT NON_HARI FROM PMIS_STOCKMAS WHERE STOCKNO = DETCDE) IN ('Y','O') AND REP_OR = " & N2Str2Null(XXX) & "")
        If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
            CSMIOS_PARTS_NON = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2)
            CSMIOS_PARTS_NON_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_PARTS!DISCOUNT), 2)
        End If
    Else
            Set rsCSMIOS_PARTS = New ADODB.Recordset
            Set rsCSMIOS_PARTS = gconDMIS.Execute("Select DET_AMT AS PARTS,DISCOUNT_2 AS DISCOUNT from CSMS_RO_DET Where livil = 2 AND ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL) AND  REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                Do While Not rsCSMIOS_PARTS.EOF
                    CSMIOS_PARTS = CSMIOS_PARTS + N2Str2Zero(rsCSMIOS_PARTS!PARTS)
                    CSMIOS_PARTS_DISCOUNT = CSMIOS_PARTS_DISCOUNT + Round(N2Str2Zero(rsCSMIOS_PARTS!DISCOUNT), 2)
                rsCSMIOS_PARTS.MoveNext
                Loop
                    CSMIOS_PARTS = Round(CSMIOS_PARTS, 2)
            End If
    End If

    
''PARTS BP------------
If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
        Set rsCSMIOS_PARTS_BP = New ADODB.Recordset
        Set rsCSMIOS_PARTS_BP = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS PARTS from CSMS_RO_DET Where livil = 2 AND jobtype = 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL) AND  REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_PARTS_BP.EOF And Not rsCSMIOS_PARTS_BP.BOF Then
            CSMIOS_PARTS_BP = Round(N2Str2Zero(rsCSMIOS_PARTS_BP!PARTS), 2)
            CSMIOS_PARTS = CSMIOS_PARTS - CSMIOS_PARTS_BP
        End If
End If
''END PARTS BP------------

''MATERIALS
        Set rsCSMIOS_MATERIALS = New ADODB.Recordset
        Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select DET_AMT AS MATERIALS,DISCOUNT_2 AS DISCOUNT from CSMS_RO_DET Where livil = 3 AND ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL) AND  REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
            Do While Not rsCSMIOS_MATERIALS.EOF
                CSMIOS_MATERIALS = CSMIOS_MATERIALS + N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS)
                CSMIOS_MATERIALS_DISCOUNT = CSMIOS_MATERIALS_DISCOUNT + Round(N2Str2Zero(rsCSMIOS_MATERIALS!DISCOUNT), 2)
            rsCSMIOS_MATERIALS.MoveNext
            Loop
                CSMIOS_MATERIALS = Round(CSMIOS_MATERIALS, 2)
        End If
''MATERIALS BP------------
 If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
   Set rsCSMIOS_MATERIALS_BP = New ADODB.Recordset
    Set rsCSMIOS_MATERIALS_BP = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS MATERIALS from CSMS_RO_DET Where  livil = 3 and jobtype = 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL) AND  REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_MATERIALS_BP.EOF And Not rsCSMIOS_MATERIALS_BP.BOF Then
        CSMIOS_MATERIALS_BP = Round(N2Str2Zero(rsCSMIOS_MATERIALS_BP!MATERIALS), 2)
        CSMIOS_MATERIALS = CSMIOS_MATERIALS - CSMIOS_MATERIALS_BP
    End If
 End If
 ''END MATERIALS BP------------
 
''SUBLET
        Set rsCSMIOS_SUBLET = New ADODB.Recordset
        Set rsCSMIOS_SUBLET = gconDMIS.Execute("Select DET_AMT AS SUBLET,DETCOST AS COST,DISCOUNT_2 AS DISCOUNT from CSMS_RO_DET Where ISNULL(ROTYPE,0) = 'SR' AND  WCODE IS NULL AND REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_SUBLET.EOF And Not rsCSMIOS_SUBLET.BOF Then
            Do While Not rsCSMIOS_SUBLET.EOF
                CSMIOS_SUBLET = CSMIOS_SUBLET + N2Str2Zero(rsCSMIOS_SUBLET!SUBLET)
                CSMIOS_SUBLET_DISCOUNT = CSMIOS_SUBLET_DISCOUNT + Round(N2Str2Zero(rsCSMIOS_SUBLET!DISCOUNT), 2)
                CSMIOS_SUBLET_COST = CSMIOS_SUBLET_COST + N2Str2Zero(rsCSMIOS_SUBLET!Cost)
            rsCSMIOS_SUBLET.MoveNext
            Loop
                CSMIOS_SUBLET = Round(CSMIOS_SUBLET, 2)
                CSMIOS_SUBLET_COST = Round(CSMIOS_SUBLET_COST, 2)
        End If

''LABOR BP
If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
    Set rsCSMIOS_TINSMITH = New ADODB.Recordset
    Set rsCSMIOS_TINSMITH = gconDMIS.Execute("Select DET_AMT AS TINSPAINT,DETCOST AS COST,DISCOUNT_2 AS DISCOUNT FROM CSMS_RO_DET Where ISNULL(ROTYPE,0) <> 'SR' AND WCODE IS NULL AND LIVIL = 1 AND ISNULL(JOBTYPE,0) IN ('BP') AND REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_TINSMITH.EOF And Not rsCSMIOS_TINSMITH.BOF Then
        Do While Not rsCSMIOS_TINSMITH.EOF
        CSMIOS_TINSPAINT = CSMIOS_TINSPAINT + N2Str2Zero(rsCSMIOS_TINSMITH!TINSPAINT)
        CSMIOS_TINSPAINT_DISCOUNT = CSMIOS_TINSPAINT_DISCOUNT + Round(N2Str2Zero(rsCSMIOS_TINSMITH!DISCOUNT), 2)
        CSMIOS_TINSPAINT_COST = CSMIOS_TINSPAINT_COST + N2Str2Zero(rsCSMIOS_TINSMITH!Cost)
        rsCSMIOS_TINSMITH.MoveNext
        Loop
        CSMIOS_LABOR = CSMIOS_LABOR - CSMIOS_TINSPAINT
        CSMIOS_LABOR_DISCOUNT = CSMIOS_LABOR_DISCOUNT - CSMIOS_TINSPAINT_DISCOUNT
        CSMIOS_LABOR_COST = CSMIOS_LABOR_COST - CSMIOS_TINSPAINT_COST
    End If
End If
    TOTAL_DISCOUNT_AMOUNT = Round(CSMIOS_LABOR_DISCOUNT + CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT + CSMIOS_PARTS_NON_DISCOUNT, 2)
    '====================================================================================================================================================================================
End Sub

Sub INITIALIZE_COST_VARIABLES(XXX As String)
'COST
'====================================================================================================================================================================================
    Set rsCSMIOS_PARTS = New ADODB.Recordset
    If COMPANY_CODE = "HBK" Then
        Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETCOST ),2) AS PARTS_COST from CSMIOS_vw_PARTSCOST Where REP_OR = " & N2Str2Null(XXX))
    Else
        Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETCOST * DETVOL),2) AS PARTS_COST from CSMS_RO_DET Where LIVIL = 2 AND  ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL)AND REP_OR = " & N2Str2Null(XXX))
    End If
    If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then CSMIOS_PARTS_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS_COST), 2)
''BP PARTS----------------------------------------------------------
    If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
        Set rsCSMIOS_PARTS_BP = gconDMIS.Execute("Select ROUND(sum(DETCOST * DETVOL),2) AS PARTS_COST from CSMS_RO_DET Where LIVIL = 2 AND JOBTYPE = 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL)AND REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_PARTS_BP.EOF And Not rsCSMIOS_PARTS_BP.BOF Then
            CSMIOS_PARTS_COST_BP = Round(N2Str2Zero(rsCSMIOS_PARTS_BP!PARTS_COST), 2)
        End If
        CSMIOS_PARTS_COST = CSMIOS_PARTS_COST - CSMIOS_PARTS_COST_BP
    End If
''END BP PARTS----------------------------------------------------------
    
    Set rsCSMIOS_PARTS = New ADODB.Recordset
    If COMPANY_CODE = "HBK" Then
        Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETCOST ),2) AS MAT_COST from CSMIOS_vw_MATCOST Where REP_OR = " & N2Str2Null(XXX))
    Else
        Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETCOST * DETVOL),2) AS MAT_COST from CSMS_RO_DET Where LIVIL = 3  AND ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL)AND REP_OR = " & N2Str2Null(XXX))
    End If
    If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then CSMIOS_MATERIALS_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!MAT_COST), 2)

''BP MATERIALS----------------------------------------------------------
    If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
        Set rsCSMIOS_PARTS_BP = gconDMIS.Execute("Select ROUND(sum(DETCOST * DETVOL),2) AS MATBP_COST from CSMS_RO_DET Where LIVIL = 3 AND JOBTYPE = 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL)AND REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_PARTS_BP.EOF And Not rsCSMIOS_PARTS_BP.BOF Then
            CSMIOS_MATERIALS_COST_BP = Round(N2Str2Zero(rsCSMIOS_PARTS_BP!MATBP_COST), 2)
        End If
        CSMIOS_MATERIALS_COST = CSMIOS_MATERIALS_COST - CSMIOS_MATERIALS_COST_BP
    End If
''END BP MATERIALS----------------------------------------------------------

    Set rsCSMIOS_PARTS = New ADODB.Recordset
    If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HGS" Then
    Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETCOST * DETVOL),2) AS ACC_COST FROM CSMS_RO_DET Where ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 4 AND REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
            CSMIOS_ACCESSORIES_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!ACC_COST), 2)
        End If
    Else
        If COMPANY_CODE = "COMPANYCODE" Then
            Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETCOST),2) AS ACC_COST from CSMIOS_vw_ACCCOST Where REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                CSMIOS_ACCESSORIES_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!ACC_COST), 2)
            End If
        Else
            Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETCOST * DETVOL),2) AS ACC_COST from CSMIOS_vw_ACCCOST Where REP_OR = " & N2Str2Null(XXX))
        End If
        If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then CSMIOS_ACCESSORIES_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!ACC_COST), 2)
    End If
    '====================================================================================================================================================================================
End Sub

Sub INITIALIZE_WARRANTY(XXX As String)
'WARRANTY
'====================================================================================================================================================================================

    WARRANTY_DIRECT_EXPENSE_LABOR = 0: WARRANTY_DIRECT_EXPENSE_SPAREPARTS = 0: WARRANTY_DIRECT_EXPENSE_GOL = 0: WARRANTY_DIRECT_EXPENSE_LABOR_COST = 0: WARRANTY_DIRECT_EXPENSE_LABOR_BP = 0: WARRANTY_DIRECT_EXPENSE_LABOR_COST = 0: WARRANTY_DIRECT_EXPENSE_LABOR_SR = 0: WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR = 0
    WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP = 0: WARRANTY_CSMIOS_PARTS_COST_BP = 0
 If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
        Set rsCSMIOS_WARRANTYGJ = New ADODB.Recordset
        Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2)AS LABOR,ROUND(sum(DETCOST),2) AS LABOR_COST  from CSMS_RO_DET Where  WCODE = 'W' AND LIVIL = 1 AND JOBTYPE IN ('GJ','PMS','BP') AND ISNULL(ROTYPE,0) <> 'SR'  AND REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
            WARRANTY_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
            WARRANTY_DIRECT_EXPENSE_LABOR_COST = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR_COST), 2)
        End If
        If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
            Set rsCSMIOS_WARRANTYBP = New ADODB.Recordset
            Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2)AS LABOR,ROUND(sum(DETCOST),2) AS LABOR_COST  from CSMS_RO_DET Where  WCODE = 'W' AND LIVIL = 1 AND JOBTYPE = 'BP' AND ISNULL(ROTYPE,0) <> 'SR'  AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
                WARRANTY_DIRECT_EXPENSE_LABOR_BP = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
                WARRANTY_DIRECT_EXPENSE_LABOR_COST_BP = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR_COST), 2)
                
                WARRANTY_DIRECT_EXPENSE_LABOR = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR - WARRANTY_DIRECT_EXPENSE_LABOR_BP), 2)
                WARRANTY_DIRECT_EXPENSE_LABOR_COST = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR_COST - WARRANTY_DIRECT_EXPENSE_LABOR_COST_BP), 2)
            End If
        End If
        
        Set rsCSMIOS_WARRANTYSR = New ADODB.Recordset
        Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DETPRC),2)AS LABOR,ROUND(sum(DETCOST),2) AS LABOR_COST  from CSMS_RO_DET Where  WCODE = 'W'  AND ISNULL(ROTYPE,0) = 'SR'  AND REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
            WARRANTY_DIRECT_EXPENSE_LABOR_SR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
            WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR_COST), 2)
        End If
        
    Else
   
        Set rsCSMIOS_LABOR = New ADODB.Recordset
        Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS LABOR,ROUND(sum(DETCOST),2) AS LABOR_COST,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_LABORWarranty Where REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
            WARRANTY_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
            WARRANTY_DIRECT_EXPENSE_LABOR_COST = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR_COST), 2)
        End If
    End If
    
If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HGS" Then
    Set rsCSMIOS_PARTS = New ADODB.Recordset
    Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS PARTS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET Where  WCODE = 'W'  AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 2  AND REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
    WARRANTY_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2)
    WARRANTY_CSMIOS_PARTS_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!DETCOST), 2)
    End If
    
    Set rsCSMIOS_MATERIALS = New ADODB.Recordset
    Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS MATERIALS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET Where  WCODE = 'W'  AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 3  AND REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
    WARRANTY_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS), 2)
    WARRANTY_CSMIOS_MATERIALS_COST = Round(N2Str2Zero(rsCSMIOS_MATERIALS!DETCOST), 2)
    End If
    
    Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
    Set rsCSMIOS_ACCESSORIES = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS ACCESSORIES,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET Where  WCODE = 'W'  AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 4  AND REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
    WARRANTY_DIRECT_EXPENSE_ACC = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!Accessories), 2)
    WARRANTY_CSMIOS_ACCESSORIES_COST = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!DETCOST), 2)
    End If
Else
    Set rsCSMIOS_PARTS = New ADODB.Recordset
    Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS PARTS,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_PARTSWarranty Where REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then WARRANTY_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2)

    Set rsCSMIOS_MATERIALS = New ADODB.Recordset
    Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS MATERIALS,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_MATERIALSWarranty Where REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then WARRANTY_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS), 2)

    Set rsCSMIOS_PARTS = New ADODB.Recordset
    If COMPANY_CODE = "HBK" Then
        Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETCOST),2) AS PARTS_COST from CSMIOS_vw_WARRANTY_PARTSCOST Where REP_OR = " & N2Str2Null(CSMIOS_REP_OR))
    Else
        Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETCOST * DETVOL),2) AS PARTS_COST from CSMIOS_vw_WARRANTY_PARTSCOST Where REP_OR = " & N2Str2Null(XXX))
    End If
    If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then WARRANTY_CSMIOS_PARTS_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS_COST), 2)

    Set rsCSMIOS_PARTS = New ADODB.Recordset
    If COMPANY_CODE = "HBK" Then
        Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETCOST ),2) AS MAT_COST from CSMIOS_vw_WARRANTY_MATCOST Where REP_OR = " & N2Str2Null(XXX))
    Else
        Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETCOST * DETVOL),2) AS MAT_COST from CSMIOS_vw_WARRANTY_MATCOST Where REP_OR = " & N2Str2Null(XXX))
    End If
    If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then WARRANTY_CSMIOS_MATERIALS_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!MAT_COST), 2)

    Set rsCSMIOS_PARTS = New ADODB.Recordset
    If COMPANY_CODE = "HBK" Then
        Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETCOST),2) AS ACC_COST from CSMIOS_vw_WARRANTY_ACCCOST Where REP_OR = " & N2Str2Null(XXX))
    Else
        Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETCOST * DETVOL),2) AS ACC_COST from CSMIOS_vw_WARRANTY_ACCCOST Where REP_OR = " & N2Str2Null(XXX))
    End If
    If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then WARRANTY_CSMIOS_ACCESSORIES_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!ACC_COST), 2)
    '====================================================================================================================================================================================

''PARTS BP WARRANTY ------------------------------------------
If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Then
    Set rsCSMIOS_WARRANTYPARTSBP = New ADODB.Recordset
        Set rsCSMIOS_WARRANTYPARTSBP = gconDMIS.Execute("Select ROUND(sum(DETPRC * DETVOL),2)AS PARTS,ROUND(sum(DETCOST * DETVOL),2) AS PARTS_COST  from CSMS_RO_DET Where  WCODE = 'W' AND LIVIL = 2 AND JOBTYPE = 'BP' AND REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_WARRANTYPARTSBP.EOF And Not rsCSMIOS_WARRANTYPARTSBP.BOF Then
            WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP = Round(N2Str2Zero(rsCSMIOS_WARRANTYPARTSBP!PARTS), 2)
            WARRANTY_CSMIOS_PARTS_COST_BP = Round(N2Str2Zero(rsCSMIOS_WARRANTYPARTSBP!PARTS_COST), 2)
        End If
    WARRANTY_DIRECT_EXPENSE_SPAREPARTS = WARRANTY_DIRECT_EXPENSE_SPAREPARTS - WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP
    WARRANTY_CSMIOS_PARTS_COST = WARRANTY_CSMIOS_PARTS_COST - WARRANTY_CSMIOS_PARTS_COST_BP
End If
''END PARTS BP WARRANTY -------------------------------------------

''MATERIALS BP WARRANTY ------------------------------------------
If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Then
    Set rsCSMIOS_WARRANTYPARTSBP = New ADODB.Recordset
        Set rsCSMIOS_WARRANTYPARTSBP = gconDMIS.Execute("Select ROUND(sum(DETPRC * DETVOL),2)AS MATERIALS,ROUND(sum(DETCOST * DETVOL),2) AS MATERIALS_COST  from CSMS_RO_DET Where  WCODE = 'W' AND LIVIL = 3 AND JOBTYPE = 'BP' AND REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_WARRANTYPARTSBP.EOF And Not rsCSMIOS_WARRANTYPARTSBP.BOF Then
            WARRANTY_DIRECT_EXPENSE_GOL_BP = Round(N2Str2Zero(rsCSMIOS_WARRANTYPARTSBP!MATERIALS), 2)
            WARRANTY_CSMIOS_MATERIALS_COST_BP = Round(N2Str2Zero(rsCSMIOS_WARRANTYPARTSBP!MATERIALS_COST), 2)
        End If
    WARRANTY_DIRECT_EXPENSE_GOL = WARRANTY_DIRECT_EXPENSE_GOL - WARRANTY_DIRECT_EXPENSE_GOL_BP
    WARRANTY_CSMIOS_MATERIALS_COST = WARRANTY_CSMIOS_MATERIALS_COST - WARRANTY_CSMIOS_MATERIALS_COST_BP
End If
''END MATERIALS BP WARRANTY -------------------------------------------
End If
End Sub
Sub INITIALIZE_INTERNAL_COMPANY(XXX As String)
'INTERNAL - COMPANY
'====================================================================================================================================================================================
If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HGS" Then
    Set rsCSMIOS_LABOR = New ADODB.Recordset
    Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS LABOR,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where WCODE = 'C' and livil = 1 and ISNULL(ROTYPE,0) <> 'SR' and REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
    COMPANY_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
    End If
    
    Dim rsCSMIOS_SR_C As New ADODB.Recordset
    Dim COMPANY_DIRECT_EXPENSE_SR_C As Double
    Set rsCSMIOS_SR_C = New ADODB.Recordset
    Set rsCSMIOS_SR_C = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS SUBLET,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where WCODE = 'C' and ISNULL(ROTYPE,0) = 'SR' and REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_SR_C.EOF And Not rsCSMIOS_SR_C.BOF Then
    COMPANY_DIRECT_EXPENSE_SR_C = Round(N2Str2Zero(rsCSMIOS_SR_C!SUBLET), 2)
    COMPANY_DIRECT_EXPENSE_LABOR = COMPANY_DIRECT_EXPENSE_LABOR + COMPANY_DIRECT_EXPENSE_SR_C
    End If
    
    Set rsCSMIOS_PARTS = New ADODB.Recordset
    Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS PARTS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where WCODE = 'C' and livil = 2 and ISNULL(ROTYPE,0) <> 'SR' and REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
    COMPANY_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2)
    End If
    
    Set rsCSMIOS_MATERIALS = New ADODB.Recordset
    Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS MATERIALS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET  Where WCODE = 'C' and livil = 3 and ISNULL(ROTYPE,0) <> 'SR' and REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
    COMPANY_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS), 2)
    End If
    
    Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
    Set rsCSMIOS_ACCESSORIES = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS MATERIALS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET  Where WCODE = 'C' and livil = 4 and ISNULL(ROTYPE,0) <> 'SR' and REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
    COMPANY_DIRECT_EXPENSE_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!MATERIALS), 2)
    End If

Else
    Set rsCSMIOS_LABOR = New ADODB.Recordset
    Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS LABOR,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_LABORCompany Where REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then COMPANY_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)

    Set rsCSMIOS_PARTS = New ADODB.Recordset
    Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS PARTS,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_PARTSCompany Where REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then COMPANY_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2)

    Set rsCSMIOS_MATERIALS = New ADODB.Recordset
    Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS MATERIALS,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_MATERIALSCompany Where REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then COMPANY_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS), 2)

    Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
    rsCSMIOS_ACCESSORIES.Open ("SELECT SUM(CSMS_Ro_Det.DETVOL * CSMS_Ro_Det.DETPRC) AS ACCESSORIES, " & _
                               "SUM((CSMS_Ro_Det.DETVOL * CSMS_Ro_Det.DETPRC) * (CSMS_Ro_Det.DISCRATE / 100)) As DISCOUNT " & _
                               "FROM CSMS_Repor INNER JOIN CSMS_Ro_Det " & _
                               "ON CSMS_Repor.REP_OR = CSMS_Ro_Det.REP_OR " & _
                               "WHERE (CSMS_Ro_Det.LIVIL = '4') AND (CSMS_Ro_Det.WCODE = 'C') AND  CSMS_Repor.REP_OR= " & N2Str2Null(XXX)), gconDMIS, adOpenForwardOnly
    If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
        COMPANY_DIRECT_EXPENSE_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!Accessories))
    Else
        COMPANY_DIRECT_EXPENSE_ACCESSORIES = 0
    End If
End If
    '====================================================================================================================================================================================
End Sub

Sub INITIALIZE_INTERNAL_SALES_DEPARTMENT(XXX As String)
'INTERNAL - SALES DEPARTMENT
'====================================================================================================================================================================================
If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HGS" Then
    Set rsCSMIOS_LABOR = New ADODB.Recordset
    Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS LABOR,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where WCODE = 'S' and livil = 1 and ISNULL(ROTYPE,0) <> 'SR' and REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
    SALES_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
    End If
    
    Dim rsCSMIOS_SR_S As New ADODB.Recordset
    Dim COMPANY_DIRECT_EXPENSE_SR_S As Double
    Set rsCSMIOS_SR_S = New ADODB.Recordset
    Set rsCSMIOS_SR_S = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS SUBLET,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where WCODE = 'S'   and ISNULL(ROTYPE,0)='SR' and REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_SR_S.EOF And Not rsCSMIOS_SR_S.BOF Then
    COMPANY_DIRECT_EXPENSE_SR_S = Round(N2Str2Zero(rsCSMIOS_SR_S!SUBLET), 2)
    SALES_DIRECT_EXPENSE_LABOR = SALES_DIRECT_EXPENSE_LABOR + COMPANY_DIRECT_EXPENSE_SR_S
    End If
    
     Set rsCSMIOS_PARTS = New ADODB.Recordset
    Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS PARTS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where WCODE = 'S' and livil = 2 and ISNULL(ROTYPE,0) <> 'SR' and REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
    SALES_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2)
    End If
    
    Set rsCSMIOS_MATERIALS = New ADODB.Recordset
    Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS MATERIALS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET  Where WCODE = 'S' and livil = 3 and ISNULL(ROTYPE,0) <> 'SR' and REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
    SALES_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS), 2)
    End If
    
    Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
    Set rsCSMIOS_ACCESSORIES = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS MATERIALS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET  Where WCODE = 'S' and livil = 4 and ISNULL(ROTYPE,0) <> 'SR' and REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
    SALES_DIRECT_EXPENSE_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!MATERIALS), 2)
    End If
Else
    Set rsCSMIOS_LABOR = New ADODB.Recordset
    Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS LABOR,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_LABORSales Where REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then SALES_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)

    Set rsCSMIOS_PARTS = New ADODB.Recordset
    Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS PARTS,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_PARTSSales Where REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then SALES_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2)

    Set rsCSMIOS_MATERIALS = New ADODB.Recordset
    Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DETPRC),2) AS MATERIALS,ROUND(sum(DISCOUNT),2) AS DISCOUNT from CSMS_vw_MATERIALSSales Where REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then SALES_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS), 2)

    Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
    rsCSMIOS_ACCESSORIES.Open ("SELECT SUM(CSMS_Ro_Det.DETVOL * CSMS_Ro_Det.DETPRC) AS ACCESSORIES, " & _
                               "SUM((CSMS_Ro_Det.DETVOL * CSMS_Ro_Det.DETPRC) * (CSMS_Ro_Det.DISCRATE / 100)) As DISCOUNT " & _
                               "FROM CSMS_Repor INNER JOIN CSMS_Ro_Det " & _
                               "ON CSMS_Repor.REP_OR = CSMS_Ro_Det.REP_OR " & _
                               "WHERE (CSMS_Ro_Det.LIVIL = '4') AND (CSMS_Ro_Det.WCODE = 'S') AND  CSMS_Repor.REP_OR= " & N2Str2Null(XXX)), gconDMIS, adOpenForwardOnly
    If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
        SALES_DIRECT_EXPENSE_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!Accessories))
    Else
        SALES_DIRECT_EXPENSE_ACCESSORIES = 0
    End If
End If

End Sub

Sub INITIALIZE_INSURANCE(XXX As String)

    INSURANCE_DIRECT_EXPENSE_LABOR = 0: INSURANCE_DIRECT_EXPENSE_SPAREPARTS = 0: INSURANCE_DIRECT_EXPENSE_GOL = 0: INSURANCE_DIRECT_EXPENSE_ACCESSORIES = 0:
    INSURANCE_DIRECT_EXPENSE_SR = 0: INSURANCE_DIRECT_EXPENSE_LABOR_BP = 0: INSURANCE_DIRECT_EXPENSE_LABOR_PMS = 0: INSURANCE_DIRECT_EXPENSE_GOL_BP = 0: INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP = 0: INSURANCE_DIRECT_EXPENSE_SPAREPARTS_SR = 0: INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP_SR = 0:
    TOTAL_INSURANCE_AMOUNT = 0: CHECK_INSURANCE = 0: DISCOUNT_INS_LABOR_GJ = 0: DISCOUNT_INS_SUBLET = 0: DISCOUNT_INS_LABOR_BP = 0: DISCOUNT_INS_PARTS_GJ = 0: DISCOUNT_INS_PARTS_BP = 0: DISCOUNT_INS_MATERIALS = 0: DISCOUNT_INS_ACCESSORIES = 0: INSURANCE_PARTS_HARI = 0: INSURANCE_PARTS_NONHARI = 0
                    
    Dim DIS_LABOR_GJ As New ADODB.Recordset
                
    Set rsCSMIOS_MATERIALS = New ADODB.Recordset
    Set rsCSMIOS_GJ = New ADODB.Recordset
    Set rsCSMIOS_SR = New ADODB.Recordset
    Set rsCSMIOS_INSPMS = New ADODB.Recordset
    Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select * from CSMIOS_INSURANCE Where REP_OR = " & N2Str2Null(XXX))
    
    If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
 
 
        If COMPANY_CODE <> "DJM" And COMPANY_CODE <> "HMH" And COMPANY_CODE <> "DSSC" And COMPANY_CODE <> "HCE" And COMPANY_CODE <> "FMC" And COMPANY_CODE <> "HCA" And COMPANY_CODE <> "DGI" And COMPANY_CODE <> "HNE" And COMPANY_CODE <> "HSM" Then
            INSURANCE_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_MATERIALS!INSLABOR), 2)
        End If
        
        If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
        Else
            INSURANCE_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_MATERIALS!INSPARTS), 2)
            INSURANCE_DIRECT_EXPENSE_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_MATERIALS!INSACCESSORIES), 2)
            INSURANCE_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_MATERIALS!INSMATERIALS), 2)
        End If
        
    ''FOR INSURANCE DISCOUNT
    If COMPANY_CODE = "HCE" Or COMPANY_CODE = "HSM" Then
        Set CHECK_INSURANCE_DIS = New ADODB.Recordset
        Set CHECK_INSURANCE_DIS = gconDMIS.Execute("SELECT SUM(ISNULL(GJ_CUSTOMER,0)) +  SUM(ISNULL(BP_CUSTOMER,0)) AS CUSTOMER FROM CSMS_RO_DET WHERE REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not CHECK_INSURANCE_DIS.EOF And Not CHECK_INSURANCE_DIS.BOF Then
        CHECK_INSURANCE = Round(N2Str2Zero(CHECK_INSURANCE_DIS!Customer), 2)
        End If
        
        If CHECK_INSURANCE = 0 Then

            Set DIS_LABOR_GJ = New ADODB.Recordset
            Set DIS_LABOR_GJ = gconDMIS.Execute("SELECT SUM(DISCOUNT_2) AS DISCOUNT FROM CSMS_RO_DET WHERE LIVIL= 1 AND ISNULL(ROTYPE,0) <> 'SR' AND JOBTYPE IN ('GJ', 'PMS')AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not DIS_LABOR_GJ.EOF And Not DIS_LABOR_GJ.BOF Then
            DISCOUNT_INS_LABOR_GJ = Round(N2Str2Zero(DIS_LABOR_GJ!DISCOUNT), 2)
            End If
            
            Set DIS_LABOR_GJ = New ADODB.Recordset
            Set DIS_LABOR_GJ = gconDMIS.Execute("SELECT SUM(DISCOUNT_2) AS DISCOUNT FROM CSMS_RO_DET WHERE LIVIL= 1 AND ISNULL(ROTYPE,0) <> 'SR' AND JOBTYPE IN ('BP')AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not DIS_LABOR_GJ.EOF And Not DIS_LABOR_GJ.BOF Then
            DISCOUNT_INS_LABOR_BP = Round(N2Str2Zero(DIS_LABOR_GJ!DISCOUNT), 2)
            End If
            
            Set DIS_LABOR_GJ = New ADODB.Recordset
            Set DIS_LABOR_GJ = gconDMIS.Execute("SELECT SUM(DISCOUNT_2) AS DISCOUNT FROM CSMS_RO_DET WHERE LIVIL= 2 AND ISNULL(ROTYPE,0) <> 'SR' AND JOBTYPE IN ('GJ', 'PMS')AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not DIS_LABOR_GJ.EOF And Not DIS_LABOR_GJ.BOF Then
            DISCOUNT_INS_PARTS_GJ = Round(N2Str2Zero(DIS_LABOR_GJ!DISCOUNT), 2)
            End If
            
            Set DIS_LABOR_GJ = New ADODB.Recordset
            Set DIS_LABOR_GJ = gconDMIS.Execute("SELECT SUM(DISCOUNT_2) AS DISCOUNT FROM CSMS_RO_DET WHERE LIVIL= 2 AND ISNULL(ROTYPE,0) <> 'SR' AND JOBTYPE IN ('BP')AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not DIS_LABOR_GJ.EOF And Not DIS_LABOR_GJ.BOF Then
            DISCOUNT_INS_PARTS_BP = Round(N2Str2Zero(DIS_LABOR_GJ!DISCOUNT), 2)
            End If
            
            Set DIS_LABOR_GJ = New ADODB.Recordset
            Set DIS_LABOR_GJ = gconDMIS.Execute("SELECT SUM(DISCOUNT_2) AS DISCOUNT FROM CSMS_RO_DET WHERE LIVIL= 3 AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not DIS_LABOR_GJ.EOF And Not DIS_LABOR_GJ.BOF Then
            DISCOUNT_INS_MATERIALS = Round(N2Str2Zero(DIS_LABOR_GJ!DISCOUNT), 2)
            End If
            
            Set DIS_LABOR_GJ = New ADODB.Recordset
            Set DIS_LABOR_GJ = gconDMIS.Execute("SELECT SUM(DISCOUNT_2) AS DISCOUNT FROM CSMS_RO_DET WHERE LIVIL= 4 AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not DIS_LABOR_GJ.EOF And Not DIS_LABOR_GJ.BOF Then
            DISCOUNT_INS_ACCESSORIES = Round(N2Str2Zero(DIS_LABOR_GJ!DISCOUNT), 2)
            End If
            
            Set DIS_LABOR_GJ = New ADODB.Recordset
            Set DIS_LABOR_GJ = gconDMIS.Execute("SELECT SUM(DISCOUNT_2) AS DISCOUNT FROM CSMS_RO_DET WHERE ISNULL(ROTYPE,0) = 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not DIS_LABOR_GJ.EOF And Not DIS_LABOR_GJ.BOF Then
            DISCOUNT_INS_SUBLET = Round(N2Str2Zero(DIS_LABOR_GJ!DISCOUNT), 2)
            End If
        End If
    End If
    ''END FOR INSURANCE DISCOUNT
    
    
    If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
        If COMPANY_CODE = "HNE" Then
            Set rsPARTSHARI = New ADODB.Recordset
            Set rsPARTSHARI = gconDMIS.Execute("SELECT SUM(GJ_INSURANCE)+ SUM(BP_INSURANCE) AS PARTS FROM CSMS_RO_DET  WHERE  LIVIL = 2 AND (SELECT NON_HARI FROM PMIS_STOCKMAS WHERE STOCKNO = DETCDE) ='N' AND REP_OR = " & N2Str2Null(XXX) & "")
            If Not rsPARTSHARI.EOF And Not rsPARTSHARI.BOF Then
                INSURANCE_PARTS_HARI = Round(N2Str2Zero(rsPARTSHARI!PARTS), 2)
            End If

            Set rsPARTSNHARI = New ADODB.Recordset
            Set rsPARTSNHARI = gconDMIS.Execute("SELECT SUM(GJ_INSURANCE)+ SUM(BP_INSURANCE) AS PARTS FROM CSMS_RO_DET  WHERE  LIVIL = 2 AND (SELECT NON_HARI FROM PMIS_STOCKMAS WHERE STOCKNO = DETCDE) IN ('Y','O') AND REP_OR = " & N2Str2Null(XXX) & "")
            If Not rsPARTSNHARI.EOF And Not rsPARTSNHARI.BOF Then
                INSURANCE_PARTS_NONHARI = Round(N2Str2Zero(rsPARTSNHARI!PARTS), 2)
            End If
        Else
            ''PARTS INSURANCE GJ----------------------------------
                Dim rsCSMIOS_INSPARTS_GJ As New Recordset
                Set rsCSMIOS_INSPARTS_GJ = New ADODB.Recordset
                Set rsCSMIOS_INSPARTS_GJ = gconDMIS.Execute("SELECT (SUM(ISNULL(GJ_INSURANCE,0)) + SUM(ISNULL(BP_INSURANCE,0))) AS GJ_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=2  AND JOBTYPE IN ('GJ','PMS','BP') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_INSPARTS_GJ.EOF And Not rsCSMIOS_INSPARTS_GJ.BOF Then
                    INSURANCE_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_INSPARTS_GJ!GJ_INSURANCE), 2)
                End If
            If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
             ''PARTS INSURANCE BP----------------------------------
                Set rsCSMIOS_INSPARTS_BP = New ADODB.Recordset
                Set rsCSMIOS_INSPARTS_BP = gconDMIS.Execute("SELECT SUM(ISNULL(BP_INSURANCE,0))  AS BP_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=2  AND JOBTYPE IN ('BP')AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_INSPARTS_BP.EOF And Not rsCSMIOS_INSPARTS_BP.BOF Then
                    INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP = Round(N2Str2Zero(rsCSMIOS_INSPARTS_BP!BP_INSURANCE), 2)
                    INSURANCE_DIRECT_EXPENSE_SPAREPARTS = INSURANCE_DIRECT_EXPENSE_SPAREPARTS - INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP
                End If
            End If
        End If
            
         ''MATERIALS INSURANCE GJ----------------------------------
            Dim rsCSMIOS_INSMATERIALS_GJ As New Recordset
            Set rsCSMIOS_INSMATERIALS_GJ = New ADODB.Recordset
            Set rsCSMIOS_INSMATERIALS_GJ = gconDMIS.Execute("SELECT (SUM(ISNULL(GJ_INSURANCE,0)) + SUM(ISNULL(BP_INSURANCE,0)))  AS GJ_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=3  AND JOBTYPE IN ('GJ','PMS','BP') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_INSMATERIALS_GJ.EOF And Not rsCSMIOS_INSMATERIALS_GJ.BOF Then
            INSURANCE_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_INSMATERIALS_GJ!GJ_INSURANCE), 2)
            End If
         If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
            ''MATERIALS INSURANCE BP----------------------------------
            Set rsCSMIOS_INSMATERIALS_BP = New ADODB.Recordset
            Set rsCSMIOS_INSMATERIALS_BP = gconDMIS.Execute("SELECT SUM(ISNULL(BP_INSURANCE,0))  AS BP_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=3  AND JOBTYPE IN ('BP') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_INSMATERIALS_BP.EOF And Not rsCSMIOS_INSMATERIALS_BP.BOF Then
                INSURANCE_DIRECT_EXPENSE_GOL_BP = Round(N2Str2Zero(rsCSMIOS_INSMATERIALS_BP!BP_INSURANCE), 2)
                INSURANCE_DIRECT_EXPENSE_GOL = INSURANCE_DIRECT_EXPENSE_GOL - INSURANCE_DIRECT_EXPENSE_GOL_BP
            End If
        End If
         
'         ''PMS INSURANCE
'        Set rsCSMIOS_INSPMS = gconDMIS.Execute("SELECT SUM(ISNULL(GJ_INSURANCE,0))  AS GJ_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=1  AND JOBTYPE IN ('PMS')AND ISNULL(ROTYPE,0) <>'SR' AND REP_OR = " & N2Str2Null(XXX))
'        If Not rsCSMIOS_INSPMS.EOF And Not rsCSMIOS_INSPMS.BOF Then
'            INSURANCE_DIRECT_EXPENSE_LABOR_PMS = Round(N2Str2Zero(rsCSMIOS_INSPMS!GJ_INSURANCE), 2)
'        End If

         ''GJ INSURANCE
        Set rsCSMIOS_GJ = gconDMIS.Execute("SELECT (SUM(ISNULL(GJ_INSURANCE,0)) + SUM(ISNULL(BP_INSURANCE,0)))  AS GJ_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=1  AND JOBTYPE IN ('GJ','PMS','BP')AND ISNULL(ROTYPE,0) <>'SR' AND REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_GJ.EOF And Not rsCSMIOS_GJ.BOF Then
            INSURANCE_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_GJ!GJ_INSURANCE), 2)
        End If
        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HCA" Then
            ''BP INSURANCE
            Set rsCSMIOS_BP = gconDMIS.Execute("SELECT SUM(ISNULL(BP_INSURANCE,0)) AS BP_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=1 AND JOBTYPE IN ('BP')AND ISNULL(ROTYPE,0) <>'SR' AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_BP.EOF And Not rsCSMIOS_BP.BOF Then
                INSURANCE_DIRECT_EXPENSE_LABOR_BP = Round(N2Str2Zero(rsCSMIOS_BP!BP_INSURANCE), 2)
                INSURANCE_DIRECT_EXPENSE_LABOR = INSURANCE_DIRECT_EXPENSE_LABOR - INSURANCE_DIRECT_EXPENSE_LABOR_BP
            End If
        End If
         ''SUBLET INSURANCE
        Set rsCSMIOS_SR = gconDMIS.Execute("SELECT SUM(ISNULL(GJ_INSURANCE,0)) + SUM(ISNULL(BP_INSURANCE,0)) AS GJ_INSURANCE  FROM CSMS_RO_DET WHERE ROTYPE='SR' AND REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_SR.EOF And Not rsCSMIOS_SR.BOF Then
            INSURANCE_DIRECT_EXPENSE_SR = Round(N2Str2Zero(rsCSMIOS_SR!GJ_INSURANCE), 2)
        End If
        
        ''ACCESSORRIES
        Dim rsINS_ACCESSORIES As ADODB.Recordset
        Set rsINS_ACCESSORIES = New ADODB.Recordset
        Set rsINS_ACCESSORIES = gconDMIS.Execute("Select SUM(GJ_INSURANCE) + SUM(BP_INSURANCE) AS INSURANCE from CSMS_RO_DET Where ISNULL(ROTYPE,0) <> 'SR' AND WCODE IS NULL AND LIVIL = 4 AND REP_OR = " & N2Str2Null(XXX))
        If Not rsINS_ACCESSORIES.EOF And Not rsINS_ACCESSORIES.BOF Then
        INSURANCE_DIRECT_EXPENSE_ACCESSORIES = Round(N2Str2Zero(rsINS_ACCESSORIES!INSURANCE), 2)
        End If
        
'        Set rsCSMIOS_SR = New ADODB.Recordset
'        Set rsCSMIOS_SR = gconDMIS.Execute("Select SUM(GJ_INSURANCE) AS INSURANCE_GJ,SUM(BP_INSURANCE) AS INSURANCE_BP from CSMS_RO_DET Where ISNULL(ROTYPE,0) = 'SR' AND WCODE IS NULL AND LIVIL = '2' AND REP_OR = " & N2Str2Null(XXX))
'        If Not rsCSMIOS_SR.EOF And Not rsCSMIOS_SR.BOF Then
'        INSURANCE_DIRECT_EXPENSE_SPAREPARTS_SR = Round(N2Str2Zero(rsCSMIOS_SR!INSURANCE_GJ), 2)
'        INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP_SR = Round(N2Str2Zero(rsCSMIOS_SR!INSURANCE_BP), 2)
'        End If
    End If

    
        'UPDATED: ACL 04162010 COST FOR INSURANCE
If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
    ''LABOR
        CSMIOS_LABOR = Round(NumericVal(CSMIOS_LABOR - INSURANCE_DIRECT_EXPENSE_LABOR), 2)
        CSMIOS_TINSPAINT = Round(NumericVal(CSMIOS_TINSPAINT - INSURANCE_DIRECT_EXPENSE_LABOR_BP), 2)
    ''PARTS
        If COMPANY_CODE = "HNE" Then
            CSMIOS_PARTS = Round(NumericVal(CSMIOS_PARTS - INSURANCE_PARTS_HARI), 2)
            CSMIOS_PARTS_NON = Round(NumericVal(CSMIOS_PARTS_NON - INSURANCE_PARTS_NONHARI), 2)
        Else
            CSMIOS_PARTS = CSMIOS_PARTS - INSURANCE_DIRECT_EXPENSE_SPAREPARTS
            CSMIOS_PARTS_BP = CSMIOS_PARTS_BP - INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP
        End If
    ''MATERIALS
        CSMIOS_MATERIALS = CSMIOS_MATERIALS - INSURANCE_DIRECT_EXPENSE_GOL
        CSMIOS_MATERIALS_BP = CSMIOS_MATERIALS_BP - INSURANCE_DIRECT_EXPENSE_GOL_BP
    ''SUBLET
        CSMIOS_SUBLET = CSMIOS_SUBLET - INSURANCE_DIRECT_EXPENSE_SR
    ''ACCESSORIES
        CSMIOS_ACCESSORIES = CSMIOS_ACCESSORIES - INSURANCE_DIRECT_EXPENSE_ACCESSORIES
        If COMPANY_CODE = "HNE" Then
            CSMIOS_LABOR = Round(NumericVal(CSMIOS_LABOR + CSMIOS_SUBLET + CSMIOS_TINSPAINT), 2)
            CSMIOS_LABOR_DISCOUNT = Round(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT), 2)
            CSMIOS_LABOR_COST = Round(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_COST), 2)
            INSURANCE_DIRECT_EXPENSE_LABOR = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SR), 2)
            
            INSURANCE_DIRECT_EXPENSE_SR = 0
            INSURANCE_DIRECT_EXPENSE_LABOR_BP = 0
            CSMIOS_SUBLET = 0
            CSMIOS_SUBLET_DISCOUNT = 0
            CSMIOS_SUBLET_COST = 0
        End If
    
Else
    If (CSMIOS_LABOR + CSMIOS_SUBLET + CSMIOS_TINSPAINT + CSMIOS_PMS) - INSURANCE_DIRECT_EXPENSE_LABOR > 0 Then
            If CSMIOS_LABOR - INSURANCE_DIRECT_EXPENSE_LABOR >= 0 Then
                CSMIOS_LABOR = CSMIOS_LABOR - INSURANCE_DIRECT_EXPENSE_LABOR
                GoTo PAKSIW
            Else
                If CSMIOS_LABOR - INSURANCE_DIRECT_EXPENSE_LABOR > 0 Then
                    CSMIOS_LABOR = CSMIOS_LABOR - INSURANCE_DIRECT_EXPENSE_LABOR
                    GoTo PAKSIW
                Else
                    INSURANCE_DIRECT_EXPENSE_LABOR = INSURANCE_DIRECT_EXPENSE_LABOR - CSMIOS_LABOR
                    CSMIOS_LABOR = 0
                End If
            End If
            If CSMIOS_SUBLET > 0 And CSMIOS_LABOR - INSURANCE_DIRECT_EXPENSE_LABOR >= 0 Then
                CSMIOS_SUBLET = CSMIOS_SUBLET - (INSURANCE_DIRECT_EXPENSE_LABOR - CSMIOS_LABOR)
                GoTo PAKSIW
            Else
                If CSMIOS_SUBLET - INSURANCE_DIRECT_EXPENSE_LABOR > 0 Then
                    CSMIOS_SUBLET = CSMIOS_SUBLET - INSURANCE_DIRECT_EXPENSE_LABOR
                    GoTo PAKSIW
                Else
                    INSURANCE_DIRECT_EXPENSE_LABOR = INSURANCE_DIRECT_EXPENSE_LABOR - CSMIOS_SUBLET
                    CSMIOS_SUBLET = 0
                End If
            End If
            If CSMIOS_TINSPAINT > 0 And CSMIOS_LABOR - CSMIOS_SUBLET - INSURANCE_DIRECT_EXPENSE_LABOR >= 0 Then
                CSMIOS_TINSPAINT = CSMIOS_TINSPAINT - (INSURANCE_DIRECT_EXPENSE_LABOR - CSMIOS_LABOR - CSMIOS_SUBLET)
                GoTo PAKSIW
            Else
                If CSMIOS_TINSPAINT - INSURANCE_DIRECT_EXPENSE_LABOR > 0 Then
                    CSMIOS_TINSPAINT = CSMIOS_TINSPAINT - INSURANCE_DIRECT_EXPENSE_LABOR
                    GoTo PAKSIW
                Else
                    INSURANCE_DIRECT_EXPENSE_LABOR = INSURANCE_DIRECT_EXPENSE_LABOR - CSMIOS_TINSPAINT
                    CSMIOS_TINSPAINT = 0
                End If
            End If
            If CSMIOS_PMS > 0 And CSMIOS_LABOR - CSMIOS_SUBLET - CSMIOS_TINSPAINT - INSURANCE_DIRECT_EXPENSE_LABOR >= 0 Then
                CSMIOS_PMS = CSMIOS_PMS - (INSURANCE_DIRECT_EXPENSE_LABOR - CSMIOS_LABOR - CSMIOS_SUBLET - CSMIOS_TINSPAINT)
                GoTo PAKSIW
            Else
                If CSMIOS_PMS - INSURANCE_DIRECT_EXPENSE_LABOR > 0 Then
                    CSMIOS_PMS = CSMIOS_PMS - INSURANCE_DIRECT_EXPENSE_LABOR
                Else
                    INSURANCE_DIRECT_EXPENSE_LABOR = INSURANCE_DIRECT_EXPENSE_LABOR - CSMIOS_PMS
                    CSMIOS_PMS = 0
                End If
            End If

PAKSIW: INSURANCE_DIRECT_EXPENSE_LABOR = N2Str2Zero(rsCSMIOS_MATERIALS!INSLABOR)


        Else
            CSMIOS_LABOR = 0
            CSMIOS_SUBLET = 0
            CSMIOS_TINSPAINT = 0
            CSMIOS_PMS = 0
        End If


        If COMPANY_CODE = "HNE" Then
             If CSMIOS_PARTS_NON > 0 Then
                CSMIOS_PARTS_NON = CSMIOS_PARTS_NON - INSURANCE_DIRECT_EXPENSE_SPAREPARTS
             End If
             If CSMIOS_PARTS > 0 Then
                CSMIOS_PARTS = CSMIOS_PARTS - INSURANCE_DIRECT_EXPENSE_SPAREPARTS
             End If
        Else
            If CSMIOS_PARTS > 0 Then
                CSMIOS_PARTS = CSMIOS_PARTS - INSURANCE_DIRECT_EXPENSE_SPAREPARTS
            End If
        End If
        If CSMIOS_MATERIALS > 0 Then
            CSMIOS_MATERIALS = CSMIOS_MATERIALS - INSURANCE_DIRECT_EXPENSE_GOL
        End If

        If CSMIOS_ACCESSORIES > 0 Then
            CSMIOS_ACCESSORIES = CSMIOS_ACCESSORIES - INSURANCE_DIRECT_EXPENSE_ACCESSORIES
        End If

        If COMPANY_CODE = "HMH" Then
            TOTAL_INSURANCE_AMOUNT = Round(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP, 2)
        Else
            TOTAL_INSURANCE_AMOUNT = Round(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_ACCESSORIES, 2)
        End If
    End If
End If
    
End Sub

Private Sub cboMonth_Click()
    Dim iCount, xCount                                      As Integer
    Dim Indx                                                As Integer
    iCount = 0
    Select Case cboMonth.Text
    Case "January": Indx = 31
    Case "February"
        If NumericVal(cboYear.Text) Mod 4 = 0 Then
            Indx = 29
        Else
            Indx = 28
        End If
    Case "March": Indx = 31
    Case "April": Indx = 30
    Case "May": Indx = 31
    Case "June": Indx = 30
    Case "July": Indx = 31
    Case "August": Indx = 31
    Case "September": Indx = 30
    Case "October": Indx = 31
    Case "November": Indx = 30
    Case "December": Indx = 31
    Case Else: Indx = -1
    End Select
    For xCount = 1 To 30
        lab.Item(xCount).Visible = False
    Next
    
    Do While iCount <= Indx - 1
        lab.Item(iCount).BackColor = &HE0E0E0
        lab.Item(iCount).Visible = True
        iCount = iCount + 1
    Loop
End Sub

Private Sub cboYear_Click()
    Dim iCount, xCount                                      As Integer
    Dim Indx                                                As Integer
    iCount = 0
    Select Case cboMonth.Text
    Case "January": Indx = 31
    Case "February"
        If NumericVal(cboYear.Text) Mod 4 = 0 Then
            Indx = 29
        Else
            Indx = 28
        End If
    Case "March": Indx = 31
    Case "April": Indx = 30
    Case "May": Indx = 31
    Case "June": Indx = 30
    Case "July": Indx = 31
    Case "August": Indx = 31
    Case "September": Indx = 30
    Case "October": Indx = 31
    Case "November": Indx = 30
    Case "December": Indx = 31
    Case Else: Indx = -1
    End Select
    For xCount = 1 To 30
        lab.Item(xCount).Visible = False
    Next
    Do While iCount <= Indx - 1
        lab.Item(iCount).BackColor = &HE0E0E0
        lab.Item(iCount).Visible = True
        iCount = iCount + 1
    Loop
End Sub

Private Sub ChkPMIS_Click()
    If chkPMIS.Value = False Then
        'If MsgBox("Are you sure that Parts, Accessories and Materials will not be included during importing?", vbQuestion + vbYesNo, "Import Parts, Accessories & Materials") = vbYes Then
            chkPMIS.Value = 0
            Grid1.Rows = 1
        'Else
        '    chkPMIS.Value = 1
        'End If
    Else
        chkPMIS.Value = 1
        Call ShowPMISTransactions
    End If
End Sub

Private Sub ChkCSMS_Click()
    If chkCSMS.Value = False Then
        'If MsgBox("Are you sure that Service transactions will not be included during importing?", vbQuestion + vbYesNo, "Import Service") = vbYes Then
            chkCSMS.Value = 0
            Grid2.Rows = 1
        'Else
        '    chkCSMS.Value = 1
        'End If
    Else
        chkCSMS.Value = 1
        Call ShowCSMSTransactions
    End If
End Sub

Private Sub ChkSMIS_Click()
    If chkSMIS.Value = False Then
        'If MsgBox("Are you sure that Vehicles will not be included during importing?", vbQuestion + vbYesNo, "Import Vehicles") = vbYes Then
            chkSMIS.Value = 0
            Grid3.Rows = 1
        'Else
        '    chkSMIS.Value = 1
        'End If
    Else
        chkSMIS.Value = 1
        Call ShowSMISTransactions
    End If
End Sub

Private Sub cmdBatchImport_Click()
    BATCHIMPORT = True
    picBatchImport.Visible = True
    picBatchImport.ZOrder 0
    dtFrom.Value = firstDay(Now())
    dtTo.Value = Format(SJLASTTRANS, "mm/dd/yyyy")
    cmdBatchImport.Enabled = False
    cmdBatchImporting.Enabled = True
    cmdExit.Enabled = False
    cmdBatchImporting.SetFocus
    ShortcutCaption1.VisualTheme = xtpShortcutThemeOffice2007
    cmdClearJournals.Enabled = False
    cmdCheck.Enabled = False
End Sub

Private Sub cmdBatchImporting_Click()
InitGrids:     DoEvents:
    Grid1.Rows = 1
    Grid2.Rows = 1
    Grid3.Rows = 1
    cmdBatchImporting.Enabled = False
    Dim i                                                   As Integer
    For i = 0 To (dtTo.Value - dtFrom.Value)
        dtpTranDate.Value = dtFrom.Value + i
        Call cmdShowTrans_Click
        Call cmdCheck_Click
    Next i

    If BATCHIMPORT = True Then
        Call frmListofUnposted.LOADJOURNAL("SJ")
        If UNPOSTEDSJ = True Then
            frmListofUnposted.Show 1
        End If
        MsgBox "Import Successfully Completed!", vbInformation, "Finish"
    End If
    cmdCheck.Enabled = False
    cmdClearJournals.Enabled = False
    cmdExit.Enabled = False
End Sub

Private Sub cmdCheck_Click()
    If Function_Access(LOGID, "Acess_Process", "IMPORT SALES ENTRIES") = False Then Exit Sub
    
    Screen.MousePointer = 11
    
    Dim str_MSG                                             As String
    
    str_MSG = "Error in Importing @ACL09182716350" & vbCrLf
    str_MSG = str_MSG & "Imported Data Will Now Roll back." & vbCrLf
    str_MSG = str_MSG & "Please Contact Netspeed Software Inc." & vbCrLf
    str_MSG = str_MSG & "Telphone: 6389273(Monday-Friday)-(9:00am-5:00pm)" & vbCrLf
    str_MSG = str_MSG & "Email: nsi_dmis@yahoo.com  (Monday-Friday)-(9:00am-5:00pm)" & vbCrLf
    str_MSG = str_MSG & "Technical log File Has been created on " & App.path & "\" & COMPANY_CODE & "_" & LOGDATE & "log.txt" & vbCrLf
    str_MSG = str_MSG & "Please Send The Log File To nsi_dmis@yahoo.com" & vbCrLf
    
    Prg1.Max = 6:
    Prg1.Value = 1: cmdCheck.Enabled = False: cmdExit.Enabled = False
    
    If COMPANY_CODE = "CMC" Or COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "HGS" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
        If dtpTranDate.Value <= CDate(GetCUTOFF_DATE) Then
            MessagePop InfoFriend, "SYSTEM MESSAGE", "Date selected is less than Cut-Off Date."
            cmdExit.Enabled = True
            Screen.MousePointer = 0
            Call cmdShowImp_Click
        Else
            ImportSalesNew
            cmdCheck.Enabled = True
            cmdExit.Enabled = True
            Screen.MousePointer = 0
            Call cmdShowImp_Click
            If BATCHIMPORT = False Then
                MsgBox "Import Successfully Completed!", vbInformation, "Finish"
            End If
        End If
    Else
        gconDMIS.BeginTrans
        If ImportPMISSales = False Then
            str_MSG = Replace(str_MSG, "@ACL09182716350", "PMIS Sales")
            MsgBox str_MSG, vbCritical, "Import Error "
            cmdExit.Enabled = True
            gconDMIS.RollbackTrans
            Screen.MousePointer = 0
            Exit Sub
        End If
        Prg1.Value = 4
        
        If ImportSales = False Then
            str_MSG = Replace(str_MSG, "@ACL09182716350", "CSMS Sales")
            MsgBox str_MSG, vbCritical, "Import Error "
            cmdExit.Enabled = True
            gconDMIS.RollbackTrans
            Screen.MousePointer = 0
            Exit Sub
        End If
        Prg1.Value = 5
        
        If ImportSMISSales = False Then
            str_MSG = Replace(str_MSG, "@ACL09182716350", "SMIS Sales")
            MsgBox str_MSG, vbCritical, "Import Error "
            cmdExit.Enabled = True
            gconDMIS.RollbackTrans
            Screen.MousePointer = 0
            Exit Sub
        End If
        Prg1.Value = 6
        
        gconDMIS.CommitTrans
        cmdCheck.Enabled = True
        cmdExit.Enabled = True
        Screen.MousePointer = 0
        Call cmdShowImp_Click
        MsgBox "Import Successfully Completed!", vbInformation, "Finish"
    End If
    
    Exit Sub
ErrorCode:
    ShowVBError
End Sub

Sub ImportSalesNew()
    Dim i                                                   As Long
    Prg1.Max = 9
    Prg1.Value = 1
    
    'PARTS / ACCESSORIES / MATERIALS IMPORTING =============================================================
    i = 0
    Dim GridImport                                          As Integer
    For GridImport = 1 To Grid1.Rows - 1
        If N2Str2Zero(Grid1.Cell(GridImport, 1).Text) = 0 Then
            If CHKDUPLICATEINV(Grid1.Cell(GridImport, 2).Text, Grid1.Cell(GridImport, 3).Text, Grid1.Cell(GridImport, 3).Text) = "" Then
                Call ImportSales2("SALES", Grid1.Cell(GridImport, 2).Text, Grid1.Cell(GridImport, 3).Text, CDate(dtpTranDate))
            End If
                Grid1.Cell(GridImport, 1).Text = 1
        End If

        i = i + 1
        progCPB.Value = (i / (Grid1.Rows - 1)) * 100
        labCPB.Caption = Int(progCPB.Value) & "% Completed"
        DoEvents
    Next
    Prg1.Value = 3

    'SERVICE TRANSACTION
    '=========================================================================================================
    i = 0
    For GridImport = 1 To Grid2.Rows - 1
        If N2Str2Zero(Grid2.Cell(GridImport, 1).Text) = 0 Then
            gconDMIS.BeginTrans
            If COMPANY_CODE = "CMC" Or COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HCE" Then
                If IMPORT_SALES_COMPOUND = False Then
                    gconDMIS.RollbackTrans
                Else
                    gconDMIS.CommitTrans
                End If
            Else
                If ImportSales = False Then
                    gconDMIS.RollbackTrans
                Else
                    gconDMIS.CommitTrans
                End If
            End If
            Grid2.Cell(GridImport, 1).Text = 1
        End If
        i = i + 1
        progCPB.Value = (i / (Grid2.Rows - 1)) * 100
        labCPB.Caption = Int(progCPB.Value) & "% Completed"
        DoEvents
    Next
    Prg1.Value = 6

    'VEHICLE SALES TRANSACTION
    '=========================================================================================================
    i = 0
    For GridImport = 1 To Grid3.Rows - 1
        If N2Str2Zero(Grid3.Cell(GridImport, 1).Text) = 0 Then
            If CHKDUPLICATEINV("VEHICLE", Right(Grid3.Cell(GridImport, 3).Text, 6), "") = "" Then
                Call ImportSales2("SALES", "VEHICLES", Right(Grid3.Cell(GridImport, 3).Text, 6), CDate(dtpTranDate))
            End If
                Grid3.Cell(GridImport, 1).Text = 1
        End If
        i = i + 1
        progCPB.Value = (i / (Grid3.Rows - 1)) * 100
        labCPB.Caption = Int(progCPB.Value) & "% Completed"
        DoEvents
    Next
    Prg1.Value = 9
End Sub

Sub ImportSales2(xTRANTYPE As String, XTYPE As String, XTRANNO As String, xTranDate As Date)
    Dim CMD                                                 As New ADODB.Command
    CMD.ActiveConnection = gconDMIS
    CMD.CommandType = adCmdStoredProc
    CMD.CommandText = "USP_IMPORTING_TEMPLATE"
    CMD.CommandTimeout = 500
    
    With CMD.Parameters
            .Append CMD.CreateParameter("@TRANTYPE", adVarChar, adParamInput, 15, xTRANTYPE)
            .Append CMD.CreateParameter("@TYPE", adVarChar, adParamInput, 15, XTYPE)
            
            If COMPANY_CODE = "CMC" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                .Append CMD.CreateParameter("@TRANNO", adVarChar, adParamInput, 12, XTRANNO)
            ElseIf COMPANY_CODE = "HBC" Then
                If Left(XTRANNO, 6) = "CSH-BP" Or Left(XTRANNO, 6) = "CHG-BP" Or Left(XTRANNO, 6) = "CSH-BA" Or Left(XTRANNO, 6) = "CHG-BA" Or Left(XTRANNO, 6) = "CSH-BM" Or Left(XTRANNO, 6) = "CHG-BM" Then
                    .Append CMD.CreateParameter("@TRANNO", adVarChar, adParamInput, 12, XTRANNO)
                Else
                    .Append CMD.CreateParameter("@TRANNO", adVarChar, adParamInput, 11, XTRANNO)
                End If
            Else
                .Append CMD.CreateParameter("@TRANNO", adVarChar, adParamInput, 11, XTRANNO)
            End If

            .Append CMD.CreateParameter("@VOUCHERNO", adVarChar, adParamOutput, 6)
            .Append CMD.CreateParameter("@JTYPE", adVarChar, adParamOutput, 3)
            .Append CMD.CreateParameter("@JNO", adVarChar, adParamOutput, 6)
    End With
    
    CMD.Execute
    
    If Null2String(CMD("@VOUCHERNO")) = "" Then Exit Sub
    J_VOUCHERNO = CMD("@VOUCHERNO")
    J_JTYPE = CMD("@JTYPE")
    J_JNO = CMD("@JNO")

    TransactionID = FindNewID(N2Str2Null(J_VOUCHERNO), "VOUCHERNO", "AMIS_JOURNAL_HD", N2Str2Null(J_JTYPE), "JTYPE")
    SQL_STATEMENT = "INSERT INTO AMIS_JOURNAL_HD " & J_JTYPE & "-" & J_VOUCHERNO
    NEW_LogAudit "R", "SALES JOURNAL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(J_VOUCHERNO), J_JTYPE, N2Str2Null(J_JNO)
End Sub

Function ImportSales() As Boolean
    On Error GoTo ErrorCode
    Dim i                                                   As Integer
    Dim GridImport                                          As Integer
    i = 0
    Dim rsSublet                                            As ADODB.Recordset
    
    For GridImport = 1 To Grid2.Rows - 1
        If N2Str2Zero(Grid2.Cell(GridImport, 1).Text) = 0 Then
            ALL_DEBIT = 0: ALL_CREDIT = 0
            Set rsCSMIOS_REPOR = New ADODB.Recordset
            
            If COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCE" Then
                SQL_STATEMENT = "Select * from CSMS_REPOR where REP_OR = '" & Grid2.Cell(GridImport, 2).Text & "' and DTE_REL = '" & CDate(dtpTranDate) & "' order by invoice ASC"
            Else
                SQL_STATEMENT = "Select * from CSMS_REPOR where REP_OR = '" & Grid2.Cell(GridImport, 2).Text & "' and DTE_COMP = '" & CDate(dtpTranDate) & "' order by invoice ASC"
            End If
            
            Set rsCSMIOS_REPOR = gconDMIS.Execute(SQL_STATEMENT)
            If Not rsCSMIOS_REPOR.EOF And Not rsCSMIOS_REPOR.BOF Then
                If CheckSJExisting("SI", Null2String(rsCSMIOS_REPOR!INVOICE)) = True Then
                    If Null2String(rsCSMIOS_REPOR!INVOICE) = "INT RO" Or Null2String(rsCSMIOS_REPOR!INVOICE) = "PDI RO" Then
                        GoTo ImportINTRO
                    Else
                        GoTo DuplicateInvoiceNo
                    End If
                Else
ImportINTRO:
                    ItemCnt = 0
                    J_JNO = "'" & Format(GetJNo(), "000000") & "'"
                                        
                    CSMIOS_REP_OR = Null2String(rsCSMIOS_REPOR!REP_OR)
                    CSMIOS_ACCT_NO = Null2String(rsCSMIOS_REPOR!ACCT_NO)
                    CSMIOS_PARTICIPAT = Null2String(rsCSMIOS_REPOR!PARTICIPAT)
                    CSMIOS_PLATE_NO = Null2String(rsCSMIOS_REPOR!PLATE_NO)
                    CSMIOS_NIYM = Null2String(rsCSMIOS_REPOR!Niym)
                    CSMIOS_TERM = Null2String(rsCSMIOS_REPOR!TERM)
                    CSMIOS_INVOICE = Null2String(rsCSMIOS_REPOR!INVOICE)
                    CSMIOS_VAT_EXEMPT = Null2Bool(rsCSMIOS_REPOR!VAT_EXEMPT)
                    CSMIOS_VAT_EXEMPT1 = Null2Bool(rsCSMIOS_REPOR!VAT_EXEMPT1)
                    CSMIOS_RO_AMOUNT = Round(N2Str2Zero(rsCSMIOS_REPOR!RO_AMOUNT), 2)
                    
                    If COMPANY_CODE = "HGS" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Then
                        CSMIOS_DTE_REL = Null2Date(rsCSMIOS_REPOR!DTE_REL)
                    Else
                        CSMIOS_DTE_REL = Null2Date(rsCSMIOS_REPOR!dte_comp)
                    End If
                    
                    TOTAL_DISCOUNT_AMOUNT = 0
                    
                    If COMPANY_CODE = "HCA" Then
                        INITIALIZE_VARIABLE_NEW CSMIOS_REP_OR
                    Else
                        INITIALIZE_ACCESSORIESCOST CSMIOS_REP_OR
                        INITIALIZE_SALES_AND_DISCOUNT CSMIOS_REP_OR
                        INITIALIZE_COST_VARIABLES CSMIOS_REP_OR
                        INITIALIZE_INTERNAL_COMPANY CSMIOS_REP_OR
                        INITIALIZE_INTERNAL_SALES_DEPARTMENT CSMIOS_REP_OR
                        
                        If COMPANY_CODE = "HGS" Then
                            INITIALIZE_WARRANTY CSMIOS_REP_OR
                        Else
                            INITIALIZE_WARRANTY CSMIOS_REP_OR
                            INITIALIZE_INSURANCE CSMIOS_REP_OR
                        End If
                        
                    End If
                    
                    TOTAL_DEBIT = 0: TOTAL_CREDIT = 0

                    Set rsJournal_HDDup = New ADODB.Recordset
                    Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_Journal_HD order by jno desc")
                    If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then J_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 1, "000000") & "'"
                    
                    If COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Then
                        J_JDATE = N2Date2Null(CSMIOS_DTE_REL)
                    Else
                        J_JDATE = N2Date2Null(CSMIOS_DTE_REL)
                    End If
                    
                    J_VOUCHERNO = N2Str2Null(GetVoucherNo())
                    J_JTYPE = "'SJ'"
                    J_REMARKS = "NULL"
                    J_VENDORCODE = "'999999'"
                    J_CUSTOMERCODE = N2Str2Null(CSMIOS_ACCT_NO)
                    J_DEBIT = 0
                    J_CREDIT = 0
                    J_TAX = 0
                    J_OUTBALANCE = 0
                    J_AMOUNTTOPAY = 0
                    
                    If COMPANY_CODE = "HNE" Then
                        CSMIOS_RO_AMOUNT = Round((CSMIOS_LABOR + CSMIOS_AIRCON + CSMIOS_TINSPAINT + CSMIOS_SUBLET + CSMIOS_PMS + CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES + CSMIOS_PARTS_NON) - TOTAL_DISCOUNT_AMOUNT, 2)
                    Else
                        If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                            CSMIOS_RO_AMOUNT = Round((CSMIOS_LABOR + CSMIOS_AIRCON + CSMIOS_TINSPAINT + CSMIOS_SUBLET + CSMIOS_PMS + CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES + CSMIOS_PARTS_BP + CSMIOS_MATERIALS_BP) - TOTAL_DISCOUNT_AMOUNT, 2)
                        Else
                            If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HGS" Then
                                CSMIOS_RO_AMOUNT = Round((CSMIOS_LABOR + CSMIOS_AIRCON + CSMIOS_TINSPAINT + CSMIOS_SUBLET + CSMIOS_PMS + CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES + CSMIOS_PARTS_BP + CSMIOS_MATERIALS_BP) - TOTAL_DISCOUNT_AMOUNT, 2)
                            Else
                                CSMIOS_RO_AMOUNT = Round((Round(NumericVal(CSMIOS_LABOR / 1.12), 2) + CSMIOS_AIRCON + Round(NumericVal(CSMIOS_TINSPAINT / 1.12), 2) + CSMIOS_SUBLET + Round(CSMIOS_PMS / 1.12, 2) + Round(NumericVal(CSMIOS_PARTS / 1.12), 2) + Round(NumericVal(CSMIOS_MATERIALS / 1.12), 2) + CSMIOS_ACCESSORIES + CSMIOS_PARTS_BP + CSMIOS_MATERIALS_BP) - TOTAL_DISCOUNT_AMOUNT, 2)
                            End If
                        End If
                    End If
                    
                    J_INVOICEAMT = Round(NumericVal(CSMIOS_RO_AMOUNT), 2)
                    J_BALANCE = Round(NumericVal(CSMIOS_RO_AMOUNT), 2)
                    J_AMOUNTPAID = 0
                    J_STATUS = "'N'"
                    J_INVOICEDATE = N2Date2Null(CSMIOS_DTE_REL)
                    J_INVOICENO = N2Str2Null(CSMIOS_INVOICE)
                    J_CHECKNO = "NULL": J_DUEDATE = N2Date2Null(CSMIOS_DTE_REL): J_PAYTYPE = "NULL": J_INVOICETYPE = "'SI'"
                    J_CHECKDATE = "NULL": J_BANKCODE = "NULL": J_REFNO = N2Str2Null(CSMIOS_REP_OR): J_REFDATE = N2Date2Null(CSMIOS_DTE_REL)
                    J_TERMS = N2Str2Null(CSMIOS_TERM): J_DEALER = "NULL": J_PAIDSTATUS = "'N'": J_RECEIVESTATUS = "'N'"
                    
''ENTRY FOR CUSTOMER START HERE========================================================================================================================================================================================
                    If J_INVOICEAMT > 0 Then
                        If (COMPANY_CODE = "HNE") And (CSMIOS_PMS <> 0 Or CSMIOS_SUBLET <> 0 Or CSMIOS_LABOR <> 0) Then
                            'SALES LABOR GJ
                            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL")))
                            J_GROSS = NumericVal(CSMIOS_LABOR + CSMIOS_SUBLET + CSMIOS_PMS)
                            If CSMIOS_INVOICE = "PDI RO" Then
                                J_TAX = 0
                                J_NET = Round(NumericVal(CSMIOS_LABOR + CSMIOS_SUBLET + CSMIOS_PMS), 2)
                            Else
                                If CSMIOS_VAT_EXEMPT = True Then
                                    J_TAX = 0
                                    J_NET = Round(NumericVal(CSMIOS_LABOR + CSMIOS_SUBLET + CSMIOS_PMS), 2)
                                Else
                                    J_TAX = Round(NumericVal(Round(((CSMIOS_LABOR + CSMIOS_SUBLET + CSMIOS_PMS) / 1.12), 2) * 0.12), 2)
                                    J_NET = Round(NumericVal(CSMIOS_LABOR + CSMIOS_SUBLET + CSMIOS_PMS) - Round(NumericVal(J_TAX), 2), 2)
                                End If
                            End If
                            J_DEBIT = 0
                            J_CREDIT = Round(NumericVal(J_NET), 2)
                            ALL_CREDIT = ALL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            
                            If COMPANY_CODE = "HNE" Then
                            Else
                                'COST OF SALES LABOR + SUBLET + PMS GJ
                                If Round(CSMIOS_LABOR_COST + CSMIOS_SUBLET_COST + CSMIOS_PMS_COST, 2) > 0 Then
                                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "RETAIL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "RETAIL")))
                                    J_DEBIT = Round(CSMIOS_LABOR_COST + CSMIOS_SUBLET_COST + CSMIOS_PMS_COST, 2)
                                    J_CREDIT = 0
                                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    
                                'INVENTORY LABOR GJ
                                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                                    J_DEBIT = 0
                                    J_CREDIT = Round(CSMIOS_LABOR_COST + CSMIOS_SUBLET_COST + CSMIOS_PMS_COST, 2)
                                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                End If
                            End If
                        Else
                            'SALES LABOR GJ
                            If CSMIOS_LABOR + CSMIOS_PMS > 0 Then
                                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HGS" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
                                ElseIf COMPANY_CODE = "HCE" Then
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJCHG", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJCHG", "CUSTOMER")))
                                    End If
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL")))
                                End If
                                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                                    J_GROSS = NumericVal(CSMIOS_LABOR + CSMIOS_PMS)
                                Else
                                    J_GROSS = NumericVal(CSMIOS_LABOR)
                                End If
                                If COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HGS" Then
                                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                        J_NET = (Round(NumericVal((CSMIOS_LABOR + CSMIOS_PMS) - (CSMIOS_LABOR_DISCOUNT + CSMIOS_PMS_DISCOUNT)), 2))
                                    Else
                                        J_NET = (Round(NumericVal((CSMIOS_LABOR + CSMIOS_PMS) - (CSMIOS_LABOR_DISCOUNT + CSMIOS_PMS_DISCOUNT)) / 1.12, 2))    '+ Round(CSMIOS_LABOR_DISCOUNT / 1.12, 2)
                                    End If
                                Else
                                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                        J_NET = Round(NumericVal(CSMIOS_LABOR + CSMIOS_PMS), 2)
                                    Else
                                        J_NET = Round(NumericVal(NumericVal(CSMIOS_LABOR + CSMIOS_PMS) / 1.12), 2)
                                    End If
                                End If
                                J_DEBIT = 0
                                J_CREDIT = Round(NumericVal(J_NET), 2)
                                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HGS" Then
                            Else
                                
                                If (COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HSM") And CSMIOS_PARTICIPAT <> "" And INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS > 0 Then
                                Else
                                    If CSMIOS_LABOR_COST + CSMIOS_PMS_COST = 0 Then
                                    Else
                                        'COST OF SALES LABOR GJ
                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER")))
                                        ElseIf COMPANY_CODE = "HCE" Then
                                            If CSMIOS_TERM = "CSH" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER")))
                                            Else
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJCHG", "CUSTOMER"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJCHG", "CUSTOMER")))
                                            End If
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "RETAIL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "RETAIL")))
                                        End If
                                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Then
                                            J_DEBIT = Round(CSMIOS_LABOR_COST + CSMIOS_PMS_COST, 2)
                                        Else
                                            J_DEBIT = Round(CSMIOS_LABOR_COST, 2)
                                        End If
                                        J_CREDIT = 0
                                        ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        
                                        'INVENTORY LABOR GJ
                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        
                                        If COMPANY_CODE = "HCA" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("PAYROLL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PAYROLL")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                                        End If
                                        
                                        J_DEBIT = 0
                                        
                                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                                            J_CREDIT = Round(CSMIOS_LABOR_COST + CSMIOS_PMS_COST, 2)
                                        Else
                                            J_CREDIT = Round(CSMIOS_LABOR_COST, 2)
                                        End If
                                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    End If
                                End If
                            End If
                        End If
                        
''ENTRY FOR SUBLET'=========================================================================================================================================================
                        If COMPANY_CODE = "HCC" Or COMPANY_CODE = "HNE" Then
                        Else
                            If COMPANY_CODE = "HCI" And CSMIOS_PARTICIPAT <> "" Then
                            Else
                                If CSMIOS_SUBLET > 0 Then
                                    ItemCnt = ItemCnt + 1
                                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER")))
                                    ElseIf COMPANY_CODE = "HGS" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
                                    ElseIf COMPANY_CODE = "HCE" Then
                                        If CSMIOS_TERM = "CSH" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLETCSH", "CUSTOMER"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLETCSH", "CUSTOMER")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "CUSTOMER"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "CUSTOMER")))
                                        End If
                                    Else
                                        If CSMIOS_TERM = "CSH" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "RETAIL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "RETAIL")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "RETAIL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "RETAIL")))
                                        End If
                                    End If
                                    J_GROSS = NumericVal(CSMIOS_SUBLET)
                                    
                                    If COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Then
                                        If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                            J_NET = Round(NumericVal(CSMIOS_SUBLET - CSMIOS_SUBLET_DISCOUNT), 2)
                                        Else
                                            J_NET = Round(NumericVal(CSMIOS_SUBLET - CSMIOS_SUBLET_DISCOUNT) / 1.12, 2)
                                        End If
                                    Else
                                        If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                            J_NET = Round(NumericVal(NumericVal(CSMIOS_SUBLET)), 2)
                                        Else
                                            J_NET = Round(NumericVal(NumericVal(CSMIOS_SUBLET) / 1.12), 2)
                                        End If
                                    End If
                                    
                                    J_DEBIT = 0
                                    J_CREDIT = Round(NumericVal(J_NET), 2)
                                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                End If
                                
                                'COST OF SALES SUBLET
                                If ((COMPANY_CODE = "DGI" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR") And CSMIOS_PARTICIPAT <> "" And INSURANCE_DIRECT_EXPENSE_SR > 0) Then
                                ElseIf COMPANY_CODE = "HSM" Then
                                Else
                                    If CSMIOS_SUBLET_COST > 0 Then
                                        ItemCnt = ItemCnt + 1
                                        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HGS" Then
                                            If CSMIOS_TERM = "CSH" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER")))
                                            Else
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER")))
                                            End If
                                        ElseIf COMPANY_CODE = "HCE" Then
                                            If CSMIOS_TERM = "CSH" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLETCSH", "CUSTOMER"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLETCSH", "CUSTOMER")))
                                            Else
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLETCHG", "CUSTOMER"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLETCHG", "CUSTOMER")))
                                            End If
                                        Else
                                            If CSMIOS_TERM = "CSH" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "RETAIL"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "RETAIL")))
                                            Else
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "RETAIL"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "RETAIL")))
                                            End If
                                        End If
                                        J_DEBIT = Round(CSMIOS_SUBLET_COST, 2)
                                        J_CREDIT = 0
                                        ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        
                                        'INVENTORY SUBLET
                                        ItemCnt = ItemCnt + 1
                                        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        
                                        If CSMIOS_TERM = "CSH" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                                        End If
                                        
                                        J_DEBIT = 0
                                        J_CREDIT = Round(CSMIOS_SUBLET_COST, 2)
                                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    End If
                                End If
                            End If
                        End If
                        
''ENTRY FOR BODY AND PAINT'=========================================================================================================================================================
                        'TINSPAINT + PARTS
                        If CSMIOS_TINSPAINT + CSMIOS_TINSPAINT_PARTS > 0 Then
                            'SALES LABOR BP
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                                If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER")))
                                Else
                                    If COMPANY_CODE = "HCE" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-BPCHG", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-BPCHG", "CUSTOMER")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER")))
                                    End If
                                End If
                            Else
                                If CSMIOS_TERM = "CSH" Then
                                    If COMPANY_CODE = "HNE" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "BODY", "RETAIL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "BODY", "RETAIL")))
                                    End If
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "BODY", "RETAIL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "BODY", "RETAIL")))
                                End If
                            End If
                            
                            J_GROSS = Round(NumericVal(CSMIOS_TINSPAINT + CSMIOS_TINSPAINT_PARTS), 2)
                            
                            If CSMIOS_INVOICE = "PDI RO" Then
                                J_TAX = 0
                                J_NET = Round(NumericVal(CSMIOS_TINSPAINT + CSMIOS_TINSPAINT_PARTS), 2)
                            Else
                                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                    J_TAX = 0
                                    J_NET = Round(NumericVal(CSMIOS_TINSPAINT + CSMIOS_TINSPAINT_PARTS), 2)
                                Else
                                    J_TAX = Round(NumericVal(Round((CSMIOS_TINSPAINT + CSMIOS_TINSPAINT_PARTS / 1.12), 2) * 0.12), 2)
                                    If COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Then
                                        J_NET = Round(NumericVal(CSMIOS_TINSPAINT - CSMIOS_TINSPAINT_DISCOUNT) / 1.12, 2)
                                    Else
                                        J_NET = Round(NumericVal(NumericVal(CSMIOS_TINSPAINT + CSMIOS_TINSPAINT_PARTS) / 1.12), 2)
                                    End If
                                End If
                            End If
                            J_DEBIT = 0
                            J_CREDIT = Round(NumericVal(J_NET), 2)
                            ALL_CREDIT = ALL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            
                            If COMPANY_CODE = "HNE" Then
                            Else
                                If (COMPANY_CODE = "DGI" Or COMPANY_CODE = "HSM") And CSMIOS_PARTICIPAT <> "" And INSURANCE_DIRECT_EXPENSE_LABOR > 0 Then
                                ElseIf (COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HCA") And CSMIOS_PARTICIPAT <> "" And INSURANCE_DIRECT_EXPENSE_LABOR_BP > 0 Then
                                Else
                                    'COST OF SALES LABOR BP
                                    ItemCnt = ItemCnt + 1
                                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                                        If CSMIOS_TERM = "CSH" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER")))
                                        Else
                                            If COMPANY_CODE = "HCE" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-BPCHG", "CUSTOMER"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-BPCHG", "CUSTOMER")))
                                            Else
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER")))
                                            End If
                                        End If
                                    Else
                                        If CSMIOS_TERM = "CSH" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "BODY", "RETAIL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "BODY", "RETAIL")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "BODY", "RETAIL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "BODY", "RETAIL")))
                                        End If
                                    End If
                                    J_DEBIT = Round(CSMIOS_TINSPAINT_COST + CSMIOS_TINSPAINT_COST_PARTS, 2)
                                    J_CREDIT = 0
                                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    
                                    'INVENTORY LABOR BP
                                    ItemCnt = ItemCnt + 1
                                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                                    End If
                                    J_DEBIT = 0
                                    J_CREDIT = Round(CSMIOS_TINSPAINT_COST + CSMIOS_TINSPAINT_COST_PARTS, 2)
                                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    
                                End If
                            End If
                        End If
                        
'PMS
'                        If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Then
'                        Else
'                            If CSMIOS_PMS > 0 Then
'                                ItemCnt = ItemCnt + 1
'                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
'                                If CSMIOS_TERM = "CSH" Then
'                                    'SALES
'                                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Then
'                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL"))
'                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL")))
'                                    Else
'                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "DIAGNOSTIC"))
'                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "DIAGNOSTIC")))
'                                    End If
'                                Else
'                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "DIAGNOSTIC"))
'                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "DIAGNOSTIC")))
'                                End If
'                                J_GROSS = Round(NumericVal(CSMIOS_PMS), 2)
'                                If CSMIOS_INVOICE = "PDI RO" Then
'                                    J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_PMS), 2)
'                                Else
'                                    If CSMIOS_VAT_EXEMPT = True Then
'                                        J_TAX = 0
'                                        J_NET = Round(NumericVal(CSMIOS_PMS), 2)
'                                    Else
'                                        J_TAX = Round(NumericVal(CSMIOS_PMS) / 1.12 * 0.12, 2)
'                                        If COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Then
'                                            J_NET = Round(NumericVal(CSMIOS_PMS - CSMIOS_PMS_DISCOUNT) / 1.12, 2)
'                                        Else
'                                            J_NET = Round(NumericVal(CSMIOS_PMS) - Round(NumericVal(J_TAX), 2), 2)
'                                        End If
'                                    End If
'                                End If
'                                J_DEBIT = 0
'                                J_CREDIT = Round(NumericVal(J_NET), 2)
'                                ALL_CREDIT = ALL_CREDIT + J_CREDIT
'                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
'
'                                If COMPANY_CODE = "HBK" Or COMPANY_CODE = "HPI" Or COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
'                                Else
'                                    If (COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC") And CSMIOS_PARTICIPAT <> "" And INSURANCE_DIRECT_EXPENSE_LABOR > 0 Then
'                                    Else
'                                        'COST OF SALES
'                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
'                                        If CSMIOS_TERM = "CSH" Then
'                                            If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Then
'                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "RETAIL"))
'                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "RETAIL")))
'                                            Else
'                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "DIAGNOSTIC"))
'                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "DIAGNOSTIC")))
'                                            End If
'                                        Else
'                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "DIAGNOSTIC"))
'                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "DIAGNOSTIC")))
'                                        End If
'                                        J_DEBIT = Round(CSMIOS_PMS_COST, 2)
'                                        J_CREDIT = 0
'                                        ALL_DEBIT = ALL_DEBIT + J_DEBIT
'                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
'
'                                        'INVENTORY
'                                        ItemCnt = ItemCnt + 1
'                                        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
'                                        If CSMIOS_TERM = "CSH" Then
'                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
'                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
'                                        Else
'                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
'                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
'                                        End If
'                                        J_DEBIT = 0
'                                        J_CREDIT = Round(CSMIOS_PMS_COST, 2)
'                                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
'                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
'                                    End If
'                                End If
'                            End If
'                        End If
                        
'ENTRY FOR PARTS'=========================================================================================================================================================
'ENTRY FOR GENERAL JOB'=========================================================================================================================================================
                        If COMPANY_CODE = "HCC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HGS" Then
                            'PARTS + MATERIALS + ACCESSORIES
                            If CSMIOS_PARTS > 0 Or CSMIOS_MATERIALS > 0 Or CSMIOS_ACCESSORIES > 0 Then
                                'SALES PARTS GJ
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
                                J_GROSS = Round(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES), 2)
                                If CSMIOS_INVOICE = "PDI RO" Then
                                    J_TAX = 0
                                    J_NET = Round(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES), 2)
                                Else
                                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                        J_TAX = 0
                                        J_NET = Round(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES), 2)
                                    Else
                                        J_TAX = Round(NumericVal(Round(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES) / 1.12 * 0.12), 2)
                                        If COMPANY_CODE = "HGS" Then
                                            J_NET = Round(NumericVal(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES - NumericVal(CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT)) / 1.12), 2)
                                        Else
                                            J_NET = Round(NumericVal(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES) / 1.12), 2)
                                        End If
                                    End If
                                End If
                                J_DEBIT = 0
                                J_CREDIT = Round(NumericVal(J_NET), 2)
                                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                
                                If (COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSM") And INSURANCE_DIRECT_EXPENSE_SPAREPARTS > 0 And CSMIOS_PARTICIPAT <> "" Then
                                Else
                                    'COST OF SALES PARTS GJ
                                    If Round(CSMIOS_PARTS_COST + CSMIOS_MATERIALS_COST + CSMIOS_ACCESSORIES_COST, 2) > 0 Then
                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                                        J_DEBIT = Round(CSMIOS_PARTS_COST + CSMIOS_MATERIALS_COST + CSMIOS_ACCESSORIES_COST, 2)
                                        J_CREDIT = 0
                                        ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        
                                        'INVENTORY PARTS GJ
                                        ItemCnt = ItemCnt + 1
                                        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        
                                        If COMPANY_CODE = "DAI" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS-IN-PROCESS"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS-IN-PROCESS")))
                                        End If
                                        
                                        J_DEBIT = 0
                                        J_CREDIT = Round(CSMIOS_PARTS_COST + CSMIOS_MATERIALS_COST + CSMIOS_ACCESSORIES_COST, 2)
                                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    End If
                                End If
                            End If
                        Else
                            'SALES PARTS GJ
                            If CSMIOS_PARTS > 0 Then
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                
                                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
                                    Else
                                        If COMPANY_CODE = "HCE" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJCHG", "CUSTOMER"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJCHG", "CUSTOMER")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
                                        End If
                                    End If
                                Else
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "RETAIL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "RETAIL")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "RETAIL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "RETAIL")))
                                    End If
                                End If
                                
                                J_GROSS = Round(NumericVal(CSMIOS_PARTS), 2)
                                
                                If COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Then
                                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                        J_NET = (Round(NumericVal(CSMIOS_PARTS - CSMIOS_PARTS_DISCOUNT), 2))
                                    Else
                                        J_NET = (Round(NumericVal(CSMIOS_PARTS - CSMIOS_PARTS_DISCOUNT) / 1.12, 2))
                                    End If
                                Else
                                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                        J_NET = Round(NumericVal(CSMIOS_PARTS), 2)
                                    Else
                                        J_NET = Round(NumericVal(NumericVal(CSMIOS_PARTS) / 1.12), 2)
                                    End If
                                End If
                                
                                J_DEBIT = 0
                                J_CREDIT = Round(NumericVal(J_NET), 2)
                                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                
                                If COMPANY_CODE <> "HNE" Then '
                                    If (COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HSM") And INSURANCE_DIRECT_EXPENSE_SPAREPARTS > 0 And CSMIOS_PARTICIPAT <> "" Then
                                    Else
                                        'COST OF SALES PARTS GJ
                                        If CSMIOS_PARTS_COST = 0 Then
                                        Else
                                            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                            If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                                                If CSMIOS_TERM = "CSH" Then
                                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                                                Else
                                                    If COMPANY_CODE = "HCE" Then
                                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJCHG", "CUSTOMER"))
                                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJCHG", "CUSTOMER")))
                                                    Else
                                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                                                    End If
                                                End If
                                            Else
                                                If CSMIOS_TERM = "CSH" Then
                                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "RETAIL"))
                                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "RETAIL")))
                                                Else
                                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "RETAIL"))
                                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "RETAIL")))
                                                End If
                                            End If
                                            J_DEBIT = Round(CSMIOS_PARTS_COST, 2)
                                            J_CREDIT = 0
                                            ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        
                                            'INVENTORY PARTS GJ
                                            ItemCnt = ItemCnt + 1
                                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                            If CSMIOS_TERM = "CSH" Then
                                                If COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HMR" Then
                                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                                                Else
                                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                                                End If
                                            Else
                                                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                                            End If
                                            J_DEBIT = 0
                                            J_CREDIT = Round(CSMIOS_PARTS_COST, 2)
                                            ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        End If
                                    End If
                                End If
                            End If
                        End If
                        
                        'BP PARTS
                        If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                            Call BP_PARTS
                        End If

                        If COMPANY_CODE = "HNE" Then
                            If CSMIOS_PARTS_NON > 0 Then
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("PARTS", "TRADE", "RETAIL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("PARTS", "TRADE", "RETAIL")))
                                J_GROSS = Round(NumericVal(CSMIOS_PARTS_NON), 2)
                                If CSMIOS_INVOICE = "PDI RO" Then
                                    J_TAX = 0
                                    J_NET = Round(NumericVal(CSMIOS_PARTS_NON), 2)
                                Else
                                    If CSMIOS_VAT_EXEMPT = True Then
                                        J_TAX = 0
                                        J_NET = Round(NumericVal(CSMIOS_PARTS_NON), 2)
                                    Else
                                        J_TAX = Round(NumericVal(Round((CSMIOS_PARTS_NON / 1.12), 2) * 0.12), 2)
                                        J_NET = Round(NumericVal(CSMIOS_PARTS_NON) - Round(NumericVal(J_TAX), 2), 2)
                                    End If
                                    J_DEBIT = 0
                                    J_CREDIT = Round(NumericVal(J_NET), 2)
                                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                End If
                            End If
                        End If
                        
'ENTRY FOR MATERIALS'=========================================================================================================================================================
'ENTRY FOR GENERAL JOB'=========================================================================================================================================================
                        
                        If COMPANY_CODE = "HCC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HGS" Then
                        Else
                            If CSMIOS_MATERIALS > 0 Then
                                Dim SHOPSUP                 As Double
                                Dim SHOPSUP_TAX             As Double
                                Dim SHOPSUP_NET             As Double

                                'SALES MATERIALS
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                                    Else
                                        If COMPANY_CODE = "HCE" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJCHG", "CUSTOMER"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJCHG", "CUSTOMER")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                                        End If
                                    End If
                                Else
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "RETAIL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "RETAIL")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "RETAIL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "RETAIL")))
                                    End If
                                End If
                                J_GROSS = Round(NumericVal(CSMIOS_MATERIALS), 2)
                                If COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Then
                                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                        J_NET = Round(NumericVal(CSMIOS_MATERIALS - CSMIOS_MATERIALS_DISCOUNT), 2)
                                    Else
                                        J_NET = Round(NumericVal(NumericVal(CSMIOS_MATERIALS - CSMIOS_MATERIALS_DISCOUNT) / 1.12), 2)
                                    End If
                                Else
                                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                        J_NET = Round(NumericVal(CSMIOS_MATERIALS), 2)
                                    Else
                                        J_NET = Round(NumericVal(NumericVal(CSMIOS_MATERIALS) / 1.12), 2)
                                    End If
                                End If
                                
                                J_DEBIT = 0
                                J_CREDIT = NumericVal(J_NET)
                                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                
                                'COST OF SALES MATERIALS
                                If CSMIOS_MATERIALS_COST > 0 Then
                                    If COMPANY_CODE <> "HNE" Then
                                        If (COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HSM") And INSURANCE_DIRECT_EXPENSE_GOL > 0 And CSMIOS_PARTICIPAT <> "" Then
                                        Else
                                            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                            If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                                                If CSMIOS_TERM = "CSH" Then
                                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                                                Else
                                                    If COMPANY_CODE = "HCE" Then
                                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJCHG", "CUSTOMER"))
                                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJCHG", "CUSTOMER")))
                                                    Else
                                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                                                    End If
                                                End If
                                            ElseIf COMPANY_CODE = "DAI" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("MATERIALS", "SERVICE", "CUSTOMER"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("MATERIALS", "SERVICE", "CUSTOMER")))
                                            Else
                                                If CSMIOS_TERM = "CSH" Then
                                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                                                Else
                                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                                                End If
                                            End If
                                            J_GROSS = 0: J_TAX = 0: J_NET = 0
                                            J_DEBIT = Round(CSMIOS_MATERIALS_COST, 2)
                                            J_CREDIT = 0
                                            ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                            
                                            'INVENTORY MATERIALS
                                            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                            If CSMIOS_TERM = "CSH" Then
                                                If COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                                                Else
                                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                                                End If
                                            Else
                                                If COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Then
                                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                                                Else
                                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                                                End If
                                            End If
                                            J_GROSS = 0: J_TAX = 0: J_NET = 0
                                            J_DEBIT = 0
                                            J_CREDIT = Round(CSMIOS_MATERIALS_COST, 2)
                                            ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        End If
                                    End If
                                End If
                            End If
                        End If
                        
                        'BP MATERIALS
                        If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                            Call BP_MATERIALS
                        End If
                        
'ENTRY FOR ACCESORIES'=========================================================================================================================================================
                        If COMPANY_CODE = "HCC" Or COMPANY_CODE = "HCA" Then
                        Else
                            Call IMPORT_ACCESSORIES
                        End If
                        
'ENTRY FOR DISCOUNT LABOR'=========================================================================================================================================================
                        If COMPANY_CODE <> "DGI" And COMPANY_CODE <> "HMH" And COMPANY_CODE <> "DSSC" And COMPANY_CODE <> "FMC" And COMPANY_CODE <> "HMR" And COMPANY_CODE <> "HGS" Then
                            If COMPANY_CODE = "HCA" Then
                                'UPDATED BY NRE
                                'DISCOUNT LABOR + SUBLET + PMS
                                If CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_PMS_DISCOUNT > 0 Then
                                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABOR"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABOR")))
                                    If CSMIOS_VAT_EXEMPT = True And CSMIOS_VAT_EXEMPT1 = True Then
                                        J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT), 2)
                                    Else
                                        J_TAX = Round(Round(((CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_PMS_DISCOUNT) / 1.12), 2) * 0.12, 2)
                                        J_NET = Round(NumericVal(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_PMS_DISCOUNT) / 1.12), 2)
                                    End If
                                    J_DEBIT = Round(NumericVal(J_NET), 2)
                                    J_CREDIT = 0
                                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                End If
                                
                                'DISCOUNT TINSPAINT + PARTS
                                If CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT_PARTS > 0 Then
                                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "BRP"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "BRP")))
                                    If CSMIOS_VAT_EXEMPT = True And CSMIOS_VAT_EXEMPT1 = True Then
                                        J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT_PARTS), 2)
                                    Else
                                        J_TAX = Round(Round(((CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT_PARTS) / 1.12), 2) * 0.12, 2)
                                        J_NET = Round(NumericVal(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT) / 1.12), 2)
                                    End If
                                    J_DEBIT = Round(NumericVal(J_NET), 2)
                                    J_CREDIT = 0
                                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                End If
                            Else
                                'DISCOUNT LABOR + SUBLET + TINSPAINT + PMS
                                If CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT > 0 Then
                                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABOR"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABOR")))
                                    Else
                                        If COMPANY_CODE = "HCE" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABORCHG"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABORCHG")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABOR"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABOR")))
                                        End If
                                    End If
                                    If CSMIOS_VAT_EXEMPT = True And CSMIOS_VAT_EXEMPT1 = True Then
                                        J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT), 2)
                                    Else
                                        J_TAX = Round(Round(((CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT) / 1.12), 2) * 0.12, 2)
                                        J_NET = Round(NumericVal(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT) / 1.12), 2)
                                    End If
                                    J_DEBIT = Round(NumericVal(J_NET), 2)
                                    J_CREDIT = 0
                                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                End If
                            End If
                        End If

                        If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                            Call LABOR_DISCOUNT
                        End If

'ENTRY FOR DISCOUNT PARTS'=========================================================================================================================================================
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCC" Or COMPANY_CODE = "HCA" Then
                            If CSMIOS_PARTS_DISCOUNT > 0 Or CSMIOS_MATERIALS_DISCOUNT > 0 Or CSMIOS_ACCESSORIES_DISCOUNT > 0 Or CSMIOS_TINSPAINT_DISCOUNT_PARTS > 0 Then
                                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "PARTS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "PARTS")))
                                J_GROSS = NumericVal(CSMIOS_PARTS_DISCOUNT)
                                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                    J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT_PARTS), 2)
                                Else
                                    J_TAX = Round(NumericVal(Round(((CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT_PARTS) / 1.12), 2) * 0.12), 2)
                                    J_NET = Round(NumericVal(NumericVal(CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT_PARTS) / 1.12), 2)
                                End If
                                J_DEBIT = NumericVal(J_NET)
                                J_CREDIT = 0
                                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        Else
                            If COMPANY_CODE <> "DGI" And COMPANY_CODE <> "DSSC" And COMPANY_CODE <> "HGS" Then
                                If CSMIOS_PARTS_DISCOUNT > 0 Then
                                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "PARTS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "PARTS")))
                                    Else
                                        If CSMIOS_TERM = "CSH" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "PARTS"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "PARTS")))
                                        Else
                                            If COMPANY_CODE = "HCE" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTSCHG", "PARTS"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTSCHG", "PARTS")))
                                            Else
                                                J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "PARTS"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "PARTS")))
                                            End If
                                        End If
                                    End If
                                    J_GROSS = NumericVal(CSMIOS_PARTS_DISCOUNT)
                                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                        J_NET = Round(NumericVal(CSMIOS_PARTS_DISCOUNT), 2)
                                    Else
                                        J_NET = Round(NumericVal(NumericVal(CSMIOS_PARTS_DISCOUNT) / 1.12), 2)
                                    End If
                                    J_DEBIT = NumericVal(J_NET)
                                    J_CREDIT = 0
                                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                End If

                                If COMPANY_CODE = "HNE" Then
                                    If CSMIOS_PARTS_NON_DISCOUNT > 0 Then
                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        If CSMIOS_TERM = "CSH" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "SERVICE"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "SERVICE")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "SERVICE"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "SERVICE")))
                                        End If
                                        
                                        J_GROSS = NumericVal(CSMIOS_PARTS_DISCOUNT)
                                        
                                        If CSMIOS_INVOICE = "PDI RO" Then
                                            J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_PARTS_NON_DISCOUNT), 2)
                                        Else
                                            If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                                J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_PARTS_NON_DISCOUNT), 2)
                                            Else
                                                J_TAX = Round(NumericVal(Round((CSMIOS_PARTS_NON_DISCOUNT / 1.12), 2) * 0.12), 2)
                                                J_NET = Round(NumericVal(CSMIOS_PARTS_NON_DISCOUNT) - Round(NumericVal(J_TAX), 2), 2)
                                            End If
                                        End If
                                        
                                        J_DEBIT = NumericVal(J_NET)
                                        J_CREDIT = 0
                                        ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    End If
                                End If
                                
'ENTRY FOR DISCOUNT MATERIALS'=========================================================================================================================================================
                                If CSMIOS_MATERIALS_DISCOUNT > 0 Then
                                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                    If COMPANY_CODE = "HNE" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "MATERIALS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "MATERIALS")))
                                    ElseIf COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "MATERIALS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "MATERIALS")))
                                    Else
                                        If CSMIOS_TERM = "CSH" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "PARTS"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "PARTS")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "PARTS"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "PARTS")))
                                        End If
                                    End If
                                    J_GROSS = Round(NumericVal(CSMIOS_MATERIALS_DISCOUNT), 2)
                                    If CSMIOS_INVOICE = "PDI RO" Then
                                        J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_MATERIALS_DISCOUNT), 2)
                                    Else
                                        If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                            J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_MATERIALS_DISCOUNT), 2)
                                        Else
                                            J_TAX = Round(NumericVal(Round((CSMIOS_MATERIALS_DISCOUNT / 1.12), 2) * 0.12), 2)
                                            J_NET = Round(NumericVal(CSMIOS_MATERIALS_DISCOUNT) - Round(NumericVal(J_TAX), 2), 2)
                                        End If
                                    End If
                                    J_DEBIT = Round(NumericVal(J_NET), 2)
                                    J_CREDIT = 0
                                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                    
                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                End If

'ENTRY FOR DISCOUNT ACCESSORIES'=========================================================================================================================================================
                                If CSMIOS_ACCESSORIES_DISCOUNT > 0 Then
                                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                    
                                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "ACCESSORIES"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "ACCESSORIES")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "PARTS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "PARTS")))
                                    End If
                                    
                                    J_GROSS = Round(NumericVal(CSMIOS_ACCESSORIES_DISCOUNT), 2)
                                    
                                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                        J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_ACCESSORIES_DISCOUNT), 2)
                                    Else
                                        J_TAX = Round(NumericVal(Round((CSMIOS_ACCESSORIES_DISCOUNT / 1.12), 2) * 0.12), 2)
                                        J_NET = Round(NumericVal(CSMIOS_ACCESSORIES_DISCOUNT) - Round(NumericVal(J_TAX), 2), 2)
                                    End If
                                    
                                    J_DEBIT = Round(NumericVal(J_NET), 2)
                                    J_CREDIT = 0
                                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                    
                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    
                                End If
                            End If
                        End If

'ENTRY FOR OUTPUT TAX'=========================================================================================================================================================
                        If J_INVOICEAMT > 0 Then
                            If CSMIOS_VAT_EXEMPT = False And CSMIOS_VAT_EXEMPT1 = False Then
                                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                                    Call DOTSERVICEPARTS
                                Else
                                
                                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                    
                                    If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnDeferredOutPutTax())
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDeferredOutPutTax()))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnOutputTax())
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnOutputTax()))
                                    End If
                                    
                                    J_DEBIT = 0
                                    
                                    If COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Then
                                        J_CREDIT = Round(NumericVal(J_INVOICEAMT - (AmountLessVAT(J_VOUCHERNO, J_JTYPE))), 2)
                                    Else
                                        J_CREDIT = Round(NumericVal(J_INVOICEAMT - (AmountLessVAT(J_VOUCHERNO, J_JTYPE) - DiscountLessVAT(J_VOUCHERNO, J_JTYPE))), 2)
                                    End If
                                    
                                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                    J_TAX = 0: J_GROSS = 0: J_NET = 0

                                    If COMPANY_CODE = "HCI" And CSMIOS_PARTICIPAT <> "" Then
                                    Else
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        Call DOTAX_SERVICE
                                    End If
                                    
                                End If
                            End If
                            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            If CSMIOS_INVOICE = "PDI RO" Then
                                J_ACCT_CODE = N2Str2Null(ReturnAccountCode(CSMIOS_INVOICE))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode(CSMIOS_INVOICE)))
                            Else
                                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                                    If CSMIOS_TERM = "CHG" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("SERVICE"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("SERVICE")))
                                    Else
                                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Then
                                            If COMPANY_CODE = "HCA" And CSMIOS_RO_AMOUNT = ".01" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnAccountCode("WES"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("WES")))
                                            Else
                                                J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("SERVICE"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("SERVICE")))
                                            End If
                                        Else
                                            If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("SERVICE"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("SERVICE")))
                                            Else
                                                J_ACCT_CODE = N2Str2Null(ReturnClearing_AccountCode("CASH"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnClearing_AccountCode("CASH")))
                                            End If
                                        End If
                                    End If
                                Else
                                    If COMPANY_CODE = "HGS" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("TRADE"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("TRADE")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("SERVICE"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("SERVICE")))
                                    End If
                                End If
                            End If
                            J_DEBIT = Round(J_INVOICEAMT, 2)
                            J_CREDIT = 0: J_TAX = 0: J_GROSS = 0: J_NET = 0
                            ALL_DEBIT = ALL_DEBIT + J_DEBIT
                            ALL_CREDIT = ALL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                        
                        'ROUND OFF DIFFERENCE
                        If COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                            Call rod
                        End If
                        
                        J_REMARKS = " SERVICE INVOICENO:" + " " + CSMIOS_INVOICE
                        
                        SQL_STATEMENT = "Insert into AMIS_Journal_HD" & _
                        " (jdate,voucherno,jtype,vendorcode,customercode,invoicedate,invoicetype,invoiceno,invoiceamt,duedate,paytype,refno,refdate,terms,dealer,amounttopay,Balance,AmountPaid,jno,debit,credit,outbalance,status,CheckNo,CheckDate,BankCode,remarks,PaidStatus,ReceiveStatus)" & _
                        " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & ", " & J_VENDORCODE & "," & J_CUSTOMERCODE & ", " & J_INVOICEDATE & "," & J_INVOICETYPE & "," & J_INVOICENO & "," & J_INVOICEAMT & ", " & J_DUEDATE & ", " & J_PAYTYPE & "," & J_REFNO & "," & J_REFDATE & "," & J_TERMS & "," & J_DEALER & ", " & J_AMOUNTTOPAY & "," & J_BALANCE & "," & J_AMOUNTPAID & _
                        ", " & J_JNO & ", " & ALL_DEBIT & ", " & ALL_CREDIT & ", " & J_OUTBALANCE & ", " & J_STATUS & ", " & J_CHECKNO & ", " & J_CHECKDATE & ", " & J_BANKCODE & ",'" & J_REMARKS & "'," & J_PAIDSTATUS & "," & J_RECEIVESTATUS & ")"
                        gconDMIS.Execute SQL_STATEMENT
                        TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_hd", "X", J_JTYPE, "Jtype"))
                        NEW_LogAudit "M", "JOURNAL ENTRY", SQL_STATEMENT, TransactionID, "", J_VOUCHERNO, J_JTYPE, J_JNO
                    End If
'END OF CUSTOMER PAID ENTRIES
                    
'ENTRY FOR INTERNAL'=========================================================================================================================================================

                    If IMPORT_INTERNAL = False Then
                        ImportSales = False
                        Exit Function
                    End If
                    
                    If ImportPurelyInternalNew = False Then
                        ImportSales = False
                        Exit Function
                    End If
                    
'ENTRY FOR WARRANTY'=========================================================================================================================================================

                    If COMPANY_CODE = "HCA" Then
                        If IMPORT_WARRANTY_NEW = False Then
                            ImportSales = False
                            Exit Function
                        End If
                    Else
                        If Import_Warranty = False Then
                            ImportSales = False
                            Exit Function
                        End If
                    End If
                    
'ENTRY FOR INSURANCE'=========================================================================================================================================================

                    If ENTRY_FOR_INUSURANCE = False Then
                        ImportSales = False
                        Exit Function
                    End If
                    
                    Grid2.Cell(GridImport, 1).Text = 1
                End If
            End If
        End If
xx:
        i = i + 1
        progCPB.Value = (i / (Grid2.Rows - 1)) * 100
        labCPB.Caption = Int(progCPB.Value) & "% Completed"
        DoEvents
DuplicateInvoiceNo:
    Next
    
    ImportSales = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    ImportSales = False
End Function


'~*~WARNING: Missing 1 END | NEXT | LOOP statements (If not missing then not on their own line.)
Function IMPORT_INTERNAL() As Boolean
On Error GoTo ErrorCode
    '120916 - added COMPANY_DIRECT_EXPENSE_ACCESSORIES
    If COMPANY_DIRECT_EXPENSE_LABOR + COMPANY_DIRECT_EXPENSE_SPAREPARTS + COMPANY_DIRECT_EXPENSE_GOL + COMPANY_DIRECT_EXPENSE_ACCESSORIES + SALES_DIRECT_EXPENSE_LABOR + SALES_DIRECT_EXPENSE_SPAREPARTS + SALES_DIRECT_EXPENSE_GOL > 0 And CSMIOS_RO_AMOUNT > 0 Then
        'LABOR
        INTERNAL_LABOR_AMT = 0: INTERNAL_PARTS_AMT = 0: INTERNAL_MATERIALS_AMT = 0
        INTERNAL_LABOR_COST = 0: INTERNAL_PARTS_COST = 0: INTERNAL_MATERIALS_COST = 0
        INTERNAL_ACCESSORIES_AMT = 0: INTERNAL_ACCESSORIES_COST = 0:
If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HCE" Then
    Call NPIENTRY
Else
        Set rsINTERNAL_RO_DET = New ADODB.Recordset
        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '1' AND DETPRC > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
            rsINTERNAL_RO_DET.MoveFirst
            Do While Not rsINTERNAL_RO_DET.EOF
                If ((N2Str2Zero(rsINTERNAL_RO_DET!DETPRC) > 0) And COMPANY_CODE <> "HMH" And COMPANY_CODE <> "FMC") Or ((N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) > 0) And COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC") Then
                    INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)
                    INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                    If COMPANY_CODE = "HPI" Then
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                        If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HGS" Then
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        Else
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        End If
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0

                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HGS" Then
                            Set rsUEA = New ADODB.Recordset
                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        Else
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If
                End If
                rsINTERNAL_RO_DET.MoveNext
            Loop
            
            If COMPANY_CODE = "HCE" Then
                 ''CHECKING FOR BP
                Set INTERNAL_BP_LABOR_RS = New ADODB.Recordset
                Set INTERNAL_BP_LABOR_RS = gconDMIS.Execute("Select SUM(DETPRC) AS DETPRC from CSMS_RO_DET WHERE LIVIL = '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE = 'BP' AND REP_OR = '" & CSMIOS_REP_OR & "'")
                If Not INTERNAL_BP_LABOR_RS.EOF And Not INTERNAL_BP_LABOR_RS.BOF Then
                    INTERNAL_BP_LABOR = Round(N2Str2Zero(INTERNAL_BP_LABOR_RS!DETPRC), 2)
                End If
                ''END CHECKING FOR BP
                
                If INTERNAL_BP_LABOR > 0 Then
                            INTERNAL_LABOR_COST = INTERNAL_LABOR_AMT - INTERNAL_BP_LABOR
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                 If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABORBP", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABORBP", "INTERNAL")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICECHG", "LABORBP", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICECHG", "LABORBP", "INTERNAL")))
                                End If
                            J_DEBIT = 0
                            J_CREDIT = Round(INTERNAL_BP_LABOR, 2)
                            ALL_CREDIT = ALL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
                'COMPANY_CODE = "DAI" Or
                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HGS" Then
                Else
                
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DJM" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                ElseIf COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                End If
                J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_TAX = 0
                J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)

                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            

            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HSM" Then
            Else
                'COST OF SALES
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                End If
                J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            End If
            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HSM" Then
            ElseIf INTERNAL_LABOR_COST = 0 And (COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR") Then
            Else
                'INVENTORY
            
            If INTERNAL_LABOR_COST > 0 Then

                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                
                ''SJR
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PAYROLL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PAYROLL")))
                    J_DEBIT = 0
                    Else
                    
                    If COMPANY_CODE = "HCE" Then
                         If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICECHG", "LABOR", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICECHG", "LABOR", "INTERNAL")))
                        End If
                    Else
                        If COMPANY_CODE = "HGS" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
                        Else
                            If CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                            End If
                        End If

                    End If
                End If
                ''SJR
                
                J_DEBIT = 0
                J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    End If

''SUBLET
If COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMR" Then
INTERNAL_LABOR_AMT = 0: INTERNAL_LABOR_COST = 0
  Set rsINTERNAL_RO_DET = New ADODB.Recordset
        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE  DETPRC > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ROTYPE = 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
            rsINTERNAL_RO_DET.MoveFirst
            Do While Not rsINTERNAL_RO_DET.EOF
                If N2Str2Zero(rsINTERNAL_RO_DET!DETPRC) > 0 Then
                    INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)
                    INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                    If COMPANY_CODE = "HPI" Then
                    Else
                        ItemCnt = ItemCnt + 1
                        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                        If COMPANY_CODE = "HMH" Then
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        Else
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        End If
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0

                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If
                rsINTERNAL_RO_DET.MoveNext
            Loop

                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Then
                Else
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DJM" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                ElseIf COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                End If
                J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_TAX = 0
                J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)

                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            

            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
            Else
                'COST OF SALES
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                End If
                J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            End If
            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
            Else
                'INVENTORY
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                End If
                J_DEBIT = 0
                J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
''SUBLET NOT PURELY INTERNAL
Call SNPI
End If
''END SUBLET

        'PARTS
        Set rsINTERNAL_RO_DET = New ADODB.Recordset
        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '2' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR'AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
            rsINTERNAL_RO_DET.MoveFirst
            Do While Not rsINTERNAL_RO_DET.EOF
                If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                    INTERNAL_PARTS_AMT = INTERNAL_PARTS_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                    INTERNAL_PARTS_COST = INTERNAL_PARTS_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))

    
                    If COMPANY_CODE = "HCC" Then
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                        If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HSM" Then
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                        Else
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                        End If
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0

                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            Set rsUEA = New ADODB.Recordset
                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        Else
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If

                End If
                rsINTERNAL_RO_DET.MoveNext
            Loop

            If INTERNAL_PARTS_AMT > 0 Then
                If COMPANY_CODE = "HCC" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HSM" Then
                Else
                    ItemCnt = ItemCnt + 1
                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                    End If
                    J_GROSS = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                    If CSMIOS_VAT_EXEMPT = True Then
                        J_TAX = 0
                    Else
                        J_TAX = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                    End If
                    J_NET = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(J_NET), 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If

                If COMPANY_CODE = "HCC" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HSM" Then
                Else
                    'COST OF SALES
                    ItemCnt = ItemCnt + 1
                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                    End If
                    J_DEBIT = Round(INTERNAL_PARTS_COST, 2)
                    J_CREDIT = 0
                    TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If


                'INVENTORY
                If COMPANY_CODE = "HCC" Then
                Else
                    ItemCnt = ItemCnt + 1
                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                        ''INVENTORY HCA
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARST-IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARST-IN-PROCESS")))
                    Else
                        If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                        End If
                    End If
                    J_DEBIT = 0
                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HMR" Then
                        J_CREDIT = Round(INTERNAL_PARTS_COST, 2)
                    Else
                        J_CREDIT = Round(INTERNAL_PARTS_COST, 2)
                    End If
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If

        End If

        Set rsINTERNAL_RO_DET = New ADODB.Recordset
        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '3' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
            rsINTERNAL_RO_DET.MoveFirst
            Do While Not rsINTERNAL_RO_DET.EOF
                If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                    INTERNAL_MATERIALS_AMT = INTERNAL_MATERIALS_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                    INTERNAL_MATERIALS_COST = INTERNAL_MATERIALS_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                    If COMPANY_CODE = "HCC" Then
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                        If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Then
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                        Else
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                        End If
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0
                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            Set rsUEA = New ADODB.Recordset
                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        Else
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If
                End If
                rsINTERNAL_RO_DET.MoveNext
            Loop

            If INTERNAL_MATERIALS_AMT > 0 Then
                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCC" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Then
                Else
                    ItemCnt = ItemCnt + 1
                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HMH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "INTERNAL")))
                    ElseIf COMPANY_CODE = "HMR" Or COMPANY_CODE = "HSM" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                    ElseIf COMPANY_CODE = "DAI" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "RETAIL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "RETAIL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL")))
                    End If
                    J_GROSS = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                    If CSMIOS_VAT_EXEMPT = True Then
                        J_TAX = 0
                    Else
                        J_TAX = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                    End If
                    J_NET = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(J_NET), 2)
                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If

                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCC" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                Else
                    'COST OF SALES
                    ItemCnt = ItemCnt + 1
                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HMH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "INTERNAL")))
                    ElseIf COMPANY_CODE = "DAI" Or COMPANY_CODE = "HSM" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                    End If
                    J_GROSS = 0
                    J_TAX = 0
                    J_NET = 0
                    J_DEBIT = Round(INTERNAL_MATERIALS_COST, 2)
                    J_CREDIT = 0
                    TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If


                'INVENTORY
                If COMPANY_CODE = "HCC" Then
                Else
                    ItemCnt = ItemCnt + 1
                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HMH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                    End If
                    J_GROSS = 0: J_TAX = 0: J_NET = 0
                    J_DEBIT = 0
                    J_CREDIT = Round(INTERNAL_MATERIALS_COST, 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If

            End If
        End If

            'ACCESSORIES

            Set rsINTERNAL_RO_DET = New ADODB.Recordset
            Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '4' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                        INTERNAL_ACCESSORIES_AMT = INTERNAL_ACCESSORIES_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_ACCESSORIES_COST = INTERNAL_ACCESSORIES_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                        If COMPANY_CODE = "HPI" Then
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Then
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                            Else
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            End If
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                        End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    Else
                        ItemCnt = ItemCnt + 1
                        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                Else
                    ItemCnt = ItemCnt + 1
                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Then
GoTo SKIP_ENTRY
End If
                If INTERNAL_ACCESSORIES_AMT > 0 Then
                
                        ItemCnt = ItemCnt + 1
                        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                        If COMPANY_CODE = "HMR" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL")))
                        End If
                        J_GROSS = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                        If CSMIOS_VAT_EXEMPT = True Then
                            J_TAX = 0
                        Else
                            J_TAX = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                        End If
                        J_NET = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                        J_DEBIT = 0
                        J_CREDIT = Round(NumericVal(J_NET), 2)
                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                   

                    
                        'COST OF SALES
                        ItemCnt = ItemCnt + 1
                        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                        If COMPANY_CODE = "HMR" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                        End If
                        J_GROSS = 0
                        J_TAX = 0
                        J_NET = 0
                        J_DEBIT = Round(INTERNAL_ACCESSORIES_COST, 2)
                        J_CREDIT = 0
                        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
SKIP_ENTRY:

                    'INVENTORY
                    ItemCnt = ItemCnt + 1
                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES")))
                    J_GROSS = 0: J_TAX = 0: J_NET = 0
                    J_DEBIT = 0
                    J_CREDIT = Round(INTERNAL_ACCESSORIES_COST, 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)

                End If
            End If
        '---al for HCC combined entry
        If COMPANY_CODE = "HCC" Then
            Set rsINTERNAL_RO_DET = New ADODB.Recordset
            Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL IN ('2','3','4') AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                        INTERNAL_ACCESSORIES_AMT = INTERNAL_ACCESSORIES_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_ACCESSORIES_COST = INTERNAL_ACCESSORIES_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                        If COMPANY_CODE = "HPI" Then
                        Else
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            J_GROSS = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(INTERNAL_ACCESSORIES_AMT)), 2)
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                        End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                J_GROSS = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                If CSMIOS_VAT_EXEMPT = True Then
                    J_TAX = 0
                Else
                    J_TAX = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                End If
                J_NET = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                'COST OF SALES
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                J_GROSS = 0
                J_TAX = 0
                J_NET = 0
                J_DEBIT = Round(INTERNAL_ACCESSORIES_COST, 2)
                J_CREDIT = 0
                TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                'INVENTORY
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                J_GROSS = 0: J_TAX = 0: J_NET = 0
                J_DEBIT = 0
                J_CREDIT = Round(INTERNAL_ACCESSORIES_COST, 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)

            End If
        End If

        'OUTPUT TAX
        If COMPANY_CODE = "HPI" Then
            If INTERNAL_PARTS_COST + INTERNAL_MATERIALS_COST > 0 Then
                If CSMIOS_VAT_EXEMPT = False Then
                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HBK" Then
                        If CSMIOS_TERM = "CHG" Then
                            J_ACCT_CODE = N2Str2Null(ReturnDeferredOutPutTax())
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDeferredOutPutTax()))
                        End If
                    ElseIf COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Then
                        J_ACCT_CODE = N2Str2Null(ReturnDeferredOutPutTax())
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDeferredOutPutTax()))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnOutputTax())
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnOutputTax()))
                    End If
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(Round(((INTERNAL_PARTS_COST + INTERNAL_MATERIALS_COST) / 1.12), 2) * 0.12), 2)
                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                    J_TAX = 0: J_GROSS = 0: J_NET = 0
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
        End If

        If COMPANY_CODE = "HCC" Then
            Dim rsCheckHD                                   As ADODB.Recordset
            Set rsCheckHD = New ADODB.Recordset
            rsCheckHD.Open "Select VoucherNo, JType from AMIS_JOURNAL_HD WHERE JTYPE=" & J_JTYPE & " AND VOUCHERNO =" & J_VOUCHERNO & " AND STATUS <> 'P'", gconDMIS, adOpenKeyset
            If Not rsCheckHD.EOF And Not rsCheckHD.BOF Then
            Else
                J_REMARKS = " SERVICE INVOICENO:" + " " + CSMIOS_INVOICE
                SQL_STATEMENT = "Insert into AMIS_Journal_HD" & _
                                " (jdate,voucherno,jtype,vendorcode,customercode,invoicedate,invoicetype,invoiceno,invoiceamt,duedate,paytype,refno,refdate,terms,dealer,amounttopay,Balance,AmountPaid,jno,debit,credit,outbalance,status,CheckNo,CheckDate,BankCode,remarks,PaidStatus,ReceiveStatus)" & _
                                " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & ", " & J_VENDORCODE & "," & J_CUSTOMERCODE & ", " & J_INVOICEDATE & "," & J_INVOICETYPE & "," & J_INVOICENO & "," & J_INVOICEAMT & ", " & J_DUEDATE & ", " & J_PAYTYPE & "," & J_REFNO & "," & J_REFDATE & "," & J_TERMS & "," & J_DEALER & ", " & J_AMOUNTTOPAY & "," & J_BALANCE & "," & J_AMOUNTPAID & _
                                ", " & J_JNO & ", " & TOTAL_DEBIT & ", " & TOTAL_CREDIT & ", " & J_OUTBALANCE & ", " & J_STATUS & ", " & J_CHECKNO & ", " & J_CHECKDATE & ", " & J_BANKCODE & ",'" & J_REMARKS & "'," & J_PAIDSTATUS & "," & J_RECEIVESTATUS & ")"
                gconDMIS.Execute SQL_STATEMENT
                'AUDIT
                TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_hd", "X", J_JTYPE, "Jtype"))
                NEW_LogAudit "M", "JOURNAL ENTRY", SQL_STATEMENT, TransactionID, "", J_VOUCHERNO, J_JTYPE, J_JNO
            End If
        End If
        'END OF NOT PURELY INTERNAL RO
        ':-)=================================
    End If
End If
  IMPORT_INTERNAL = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    IMPORT_INTERNAL = False
    ShowVBError
End Function

Function Import_Warranty() As Boolean
On Error GoTo ErrorCode
    If WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_ACC > 0 Then
        Set rsJournal_HDDup = New ADODB.Recordset
        Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_journal_hd order by jno desc")
        If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then WARRANTY_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 1, "000000") & "'"

        WARRANTY_VOUCHERNO = N2Str2Null(Format(NumericVal(GetVoucherNo()), "000000"))
        WARRANTY_ItemCnt = 0
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        TOTAL_DEBIT = 0: TOTAL_CREDIT = 0
        
        CSMIOS_REP_OR = Null2String(rsCSMIOS_REPOR!REP_OR)
        'To return the Selling Dealer
        If CheckIfPMS(CSMIOS_REP_OR) = True And COMPANY_CODE <> "DGI" And COMPANY_CODE = "DSSC" Then
            If CheckIfPMS_Ik_to_5k(CSMIOS_REP_OR) = True Then
                CSMIOS_ACCT_NO = Null2String("H00001")
                CSMIOS_NIYM = Null2String(SetCustomerName("H00001"))
                J_CUSTOMERCODE = N2Str2Null("H00001")
            ElseIf COMPANY_CODE = "DJM" Then
                CSMIOS_ACCT_NO = Null2String("J00002")
                CSMIOS_NIYM = Null2String(SetCustomerName("J00002"))
                J_CUSTOMERCODE = N2Str2Null("J00002")
            ElseIf COMPANY_CODE = "DSSC" Then
                CSMIOS_ACCT_NO = Null2String("M00246")
                CSMIOS_NIYM = Null2String(SetCustomerName("M00246"))
                J_CUSTOMERCODE = N2Str2Null("M00246")
             ElseIf COMPANY_CODE = "HCE" Then
                CSMIOS_ACCT_NO = Null2String("H00011")
                CSMIOS_NIYM = Null2String(SetCustomerName("H00011"))
                J_CUSTOMERCODE = N2Str2Null("H00011")
            ElseIf COMPANY_CODE = "FMC" Then
                CSMIOS_ACCT_NO = Null2String("F00001")
                CSMIOS_NIYM = Null2String(SetCustomerName("F00001"))
                J_CUSTOMERCODE = N2Str2Null("F00001")
            ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                CSMIOS_ACCT_NO = Null2String("H00001")
                CSMIOS_NIYM = Null2String(SetCustomerName("H00001"))
                J_CUSTOMERCODE = N2Str2Null("H00001")
            ElseIf COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                CSMIOS_ACCT_NO = Null2String(CSMIOS_ACCT_NO)
                CSMIOS_NIYM = Null2String(SetCustomerName(CSMIOS_ACCT_NO))
                J_CUSTOMERCODE = N2Str2Null(CSMIOS_ACCT_NO)
            Else
                CSMIOS_NIYM = Null2String(SetSellingDealerName(ReturnCodeSellingDealer(ReturnPlateNo(CSMIOS_REP_OR))))
                CSMIOS_ACCT_NO = N2Str2Null(ReturnCode(CSMIOS_NIYM))
                J_CUSTOMERCODE = N2Str2Null(ReturnCode(CSMIOS_NIYM))
            End If
        Else
            If COMPANY_CODE = "DGI" Then
                CSMIOS_ACCT_NO = Null2String("M00045")
                CSMIOS_NIYM = Null2String(SetCustomerName("M00045"))
                J_CUSTOMERCODE = N2Str2Null("M00045")
            ElseIf COMPANY_CODE = "DSSC" Then
                CSMIOS_ACCT_NO = Null2String("M00246")
                CSMIOS_NIYM = Null2String(SetCustomerName("M00246"))
                J_CUSTOMERCODE = N2Str2Null("M00246")
            ElseIf COMPANY_CODE = "HMH" Or COMPANY_CODE = "HMR" Then
                CSMIOS_ACCT_NO = Null2String("H00001")
                CSMIOS_NIYM = Null2String(SetCustomerName("H00001"))
                J_CUSTOMERCODE = N2Str2Null("H00001")
            ElseIf COMPANY_CODE = "HCE" Then
                CSMIOS_ACCT_NO = Null2String("H00011")
                CSMIOS_NIYM = Null2String(SetCustomerName("H00011"))
                J_CUSTOMERCODE = N2Str2Null("H00011")
            ElseIf COMPANY_CODE = "FMC" Then
                CSMIOS_ACCT_NO = Null2String("F00001")
                CSMIOS_NIYM = Null2String(SetCustomerName("F00001"))
                J_CUSTOMERCODE = N2Str2Null("F00001")
            ElseIf COMPANY_CODE = "HCA" Then
                CSMIOS_ACCT_NO = Null2String("H00001")
                CSMIOS_NIYM = Null2String(SetCustomerName("H00001"))
                J_CUSTOMERCODE = N2Str2Null("H00001")
            ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DAI" Then
                CSMIOS_ACCT_NO = Null2String(CSMIOS_ACCT_NO)
                CSMIOS_NIYM = Null2String(SetCustomerName(CSMIOS_ACCT_NO))
                J_CUSTOMERCODE = N2Str2Null(CSMIOS_ACCT_NO)
            ElseIf COMPANY_CODE = "HSM" Then
                CSMIOS_ACCT_NO = Null2String("H00054")
                CSMIOS_NIYM = Null2String(SetCustomerName("H00054"))
                J_CUSTOMERCODE = N2Str2Null("H00054")
            ElseIf COMPANY_CODE = "DMI" Then
                CSMIOS_ACCT_NO = Null2String("D00073")
                CSMIOS_NIYM = Null2String(SetCustomerName("D00073"))
                J_CUSTOMERCODE = N2Str2Null("D00073")
            Else
                CSMIOS_NIYM = Null2String(SetSellingDealerName(ReturnCodeSellingDealer(ReturnPlateNo(CSMIOS_REP_OR))))
                CSMIOS_ACCT_NO = N2Str2Null(ReturnCode(CSMIOS_NIYM))
                J_CUSTOMERCODE = N2Str2Null(ReturnCode(CSMIOS_NIYM))
            End If
        End If
        'LABOR
        If COMPANY_CODE <> "DJM" And COMPANY_CODE <> "HCA" Then
            If WARRANTY_DIRECT_EXPENSE_LABOR > 0 Then
                If COMPANY_CODE = "DJM" Then
                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                Else
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                End If
                    If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "WARRANTY")))
                    ElseIf COMPANY_CODE = "HCE" Then
                        If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "WARRANTY"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "WARRANTY")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABORCHG", "WARRANTY"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABORCHG", "WARRANTY")))
                        End If
                    ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                    ElseIf COMPANY_CODE = "HSM" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
                    'SJR 082014
                    ElseIf COMPANY_CODE = "HGS" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "WARRANTY")))
                    End If
                J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR), 2)
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_TAX = 0
                Else
                    J_TAX = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR) / 1.12 * 0.12, 2)
                End If
                If COMPANY_CODE = "DJM" Then
                  J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR), 2)
                ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                        J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR), 2)
                    Else
                        J_NET = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR) / 1.12), 2)
                    End If
                Else
                  J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR) - Round(NumericVal(J_TAX), 2), 2)
                End If
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                If COMPANY_CODE = "DJM" Then
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                Else
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "HSM" Then
                Else
                    'COST OF SALES
                If WARRANTY_DIRECT_EXPENSE_LABOR_COST = 0 Then
                Else
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER")))
                    Else
                        If CSMIOS_TERM = "CSH" Then
                            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "WARRANTY"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "WARRANTY")))
                            ElseIf COMPANY_CODE = "HCE" Then
                                If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "WARRANTY"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "WARRANTY")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABORCHG", "WARRANTY"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABORCHG", "WARRANTY")))
                                End If
                            'SJR 082014
                            ElseIf COMPANY_CODE = "HGS" Then
                            GoTo SKIPTOINVENTORY
                            Else
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "WARRANTY"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "WARRANTY")))
                            End If
                        Else
                        
                            If COMPANY_CODE = "HCC" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "RETAIL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "RETAIL")))
                            ElseIf COMPANY_CODE = "HGS" Then
                                GoTo SKIPTOINVENTORY
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "WARRANTY"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "WARRANTY")))
                            End If
                        End If
                    End If
                    J_DEBIT = Round(WARRANTY_DIRECT_EXPENSE_LABOR_COST, 2)
                    J_CREDIT = 0
                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
SKIPTOINVENTORY:
                    'INVENTORY
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    'SJR 082014
                    If COMPANY_CODE = "HGS" Then
                    GoTo SKIPTOPARTS
                    Else
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    End If
                    J_DEBIT = 0
                    J_CREDIT = Round(WARRANTY_DIRECT_EXPENSE_LABOR_COST, 2)
                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
        End If
    Else
            If WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_SR > 0 Then
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If (COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA") And Left(CSMIOS_INVOICE, 6) = "INT RO" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
                    ElseIf (COMPANY_CODE <> "DJM" And COMPANY_CODE <> "HCA") And Left(CSMIOS_INVOICE, 6) = "INT RO" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "CUSTOMER")))
                    End If
                    J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_SR), 2)
                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Or Left(CSMIOS_INVOICE, 6) = "INT RO" Then
                        J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_SR), 2)
                    Else
                        J_NET = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_SR) / 1.12), 2)
                    End If
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(J_NET), 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        
                    'COST OF SALES
                    If WARRANTY_DIRECT_EXPENSE_LABOR_COST + WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR = 0 Then
                    Else
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER")))
                    J_DEBIT = Round(WARRANTY_DIRECT_EXPENSE_LABOR_COST + WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR, 2)
                    J_CREDIT = 0
                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    
                    'INVENTORY
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    
                    ''SJR
                    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PAYROLL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PAYROLL")))
                        Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    End If
                    ''SJR
                    
                    J_DEBIT = 0
                    J_CREDIT = Round(WARRANTY_DIRECT_EXPENSE_LABOR_COST + WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR, 2)
                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
    End If
        
''LABOR WARRANTY BP------------------------------------------------------------------------------------
If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
 If WARRANTY_DIRECT_EXPENSE_LABOR_BP > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"

                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "WARRANTY"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "WARRANTY")))

                J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR_BP), 2)
                If CSMIOS_VAT_EXEMPT = True Then
                    J_TAX = 0
                Else
                    J_TAX = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR_BP) / 1.12 * 0.12, 2)
                End If
                J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR_BP) - Round(NumericVal(J_TAX), 2), 2)
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                
                'COST OF SALES
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-BP", "WARRANTY"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-BP", "WARRANTY")))
                J_DEBIT = Round(WARRANTY_DIRECT_EXPENSE_LABOR_COST_BP, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    
                'INVENTORY
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    J_DEBIT = 0
                    J_CREDIT = Round(WARRANTY_DIRECT_EXPENSE_LABOR_COST_BP, 2)
                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
End If
''END OF WARRANTY LABOR BP-----------------------------------------------------------------------------

''LABOR WARRANTY SUBLET------------------------------------------------------------------------------------
If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "DSSC" Then
 If WARRANTY_DIRECT_EXPENSE_LABOR_SR > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HCE" Then
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "WARRANTY")))
                    Else
                         J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLECHG", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "WARRANTY")))
                    End If
                ElseIf COMPANY_CODE = "HCE" Or COMPANY_CODE = "HSM" Then 'SJR080614'
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER")))
                ElseIf COMPANY_CODE = "DSSC" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "WARRANTY")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "WARRANTY")))
                End If
                    
                    J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR_SR), 2)
                If CSMIOS_VAT_EXEMPT = True Then
                    J_TAX = 0
                Else
                    J_TAX = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR_SR) / 1.12 * 0.12, 2)
                End If
                J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR_SR) - Round(NumericVal(J_TAX), 2), 2)
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                
                If COMPANY_CODE = "HSM" Then
                Else
                        'COST OF SALES
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        If COMPANY_CODE = "HCE" Then
                            If CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "WARRANTY"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "WARRANTY")))
                           Else
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLETCHG", "WARRANTY"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLETCHG", "WARRANTY")))
                           End If
                        ElseIf COMPANY_CODE = "DSSC" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "WARRANTY"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "WARRANTY")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "WARRANTY"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "WARRANTY")))
                        End If
                        J_DEBIT = Round(WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR, 2)
                        J_CREDIT = 0
                        ALL_DEBIT = ALL_DEBIT + J_DEBIT
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            
                        'INVENTORY
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            If COMPANY_CODE = "DSSC" Then
                                J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                            End If
                            J_DEBIT = 0
                            J_CREDIT = Round(WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR, 2)
                            ALL_CREDIT = ALL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
End If
''LABOR WARRANTY SUBLET------------------------------------------------------------------------------------
SKIPTOPARTS:
If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HGS" Then
Call PARTSWARRANTY
Else
            'PARTS
            If WARRANTY_DIRECT_EXPENSE_SPAREPARTS > 0 Then
                If COMPANY_CODE = "HPI" Then
                Else
                    If COMPANY_CODE = "DJM" Then
                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    Else
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    End If
                   If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "DJM" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                    ElseIf COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "WARRANTY")))
                    ElseIf COMPANY_CODE = "HSM" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
                    ElseIf COMPANY_CODE = "HCE" Then
                        If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "WARRANTY"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "WARRANTY")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJCHG", "WARRANTY"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJCHG", "WARRANTY")))
                        End If
                    ElseIf COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "WARRANTY")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("PARTS", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("PARTS", "WARRANTY")))
                    End If
                    J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS), 2)
                    If CSMIOS_VAT_EXEMPT = True Then
                        J_TAX = 0
                    Else
                        J_TAX = Round(Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS) / 1.12 * 0.12, 2), 2)
                    End If
                    If COMPANY_CODE = "DJM" Then
                        J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS), 2)
                    Else
                        J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS) - Round(NumericVal(J_TAX), 2), 2)

                    End If
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(J_NET), 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    If COMPANY_CODE = "DJM" Then
                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    Else
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If
    
                If COMPANY_CODE = "HPI" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
                Else
                    'COST OF SALES
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "RETAIL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "RETAIL")))
                    ElseIf COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "WARRANTY")))
                    ElseIf COMPANY_CODE = "HSM" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                    ElseIf COMPANY_CODE = "HCE" Then
                        If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "WARRANTY"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "WARRANTY")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJCHG", "WARRANTY"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJCHG", "WARRANTY")))
                        End If
                    ElseIf COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "WARRANTY")))
                    ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCA" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                    Else
                        If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("PARTS", "WARRANTY"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("PARTS", "WARRANTY")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("PARTS", "WARRANTY"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("PARTS", "WARRANTY")))
                        End If
                    End If
                    J_DEBIT = Round(WARRANTY_CSMIOS_PARTS_COST, 2)
                    J_CREDIT = 0
                    TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                    If COMPANY_CODE = "DJM" Then
                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    Else
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If
                'INVENTORY
                If COMPANY_CODE = "DJM" Then
                Else
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                    ElseIf COMPANY_CODE = "HGS" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS-IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS-IN-PROCESS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                    End If
                J_DEBIT = 0
                J_CREDIT = Round(WARRANTY_CSMIOS_PARTS_COST, 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
''BP_PARTS_WARRANTY---------------------------------------------------
If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
  If WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP > 0 Then
                If COMPANY_CODE = "HPI" Then
                Else
                    If COMPANY_CODE = "DJM" Then
                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    Else
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    End If
                    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "DJM" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                    ElseIf COMPANY_CODE = "HMH" Or COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-BP", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-BP", "WARRANTY")))
                    ElseIf COMPANY_CODE = "DGI" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "WARRANTY")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("PARTS", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("PARTS", "WARRANTY")))
                    End If
                    J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP), 2)
                    If CSMIOS_VAT_EXEMPT = True Then
                        J_TAX = 0
                    Else
                        J_TAX = Round(Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP) / 1.12 * 0.12, 2), 2)
                    End If
                    If COMPANY_CODE = "DJM" Then
                        J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP), 2)
                    Else
                        J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP) - Round(NumericVal(J_TAX), 2), 2)

                    End If
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(J_NET), 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    If COMPANY_CODE = "DJM" Then
                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    Else
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If
    
                If COMPANY_CODE = "HPI" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
                Else
                    'COST OF SALES
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                         J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-BP", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-BP", "WARRANTY")))
                    ElseIf COMPANY_CODE = "DGI" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "WARRANTY")))
                    ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                    Else
                        If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("PARTS", "WARRANTY"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("PARTS", "WARRANTY")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("PARTS", "WARRANTY"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("PARTS", "WARRANTY")))
                        End If
                    End If
                    J_DEBIT = Round(WARRANTY_CSMIOS_PARTS_COST_BP, 2)
                    J_CREDIT = 0
                    TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                    If COMPANY_CODE = "DJM" Then
                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    Else
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If
                'INVENTORY
                If COMPANY_CODE = "DJM" Then
                Else
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If CSMIOS_TERM = "CSH" Then
                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                    End If
                Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                End If
                J_DEBIT = 0
                J_CREDIT = Round(WARRANTY_CSMIOS_PARTS_COST_BP, 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
End If
''END BP_PARTS_WARRANTY------------------------------------------------

            'Materials
            If WARRANTY_DIRECT_EXPENSE_GOL > 0 Then
                If COMPANY_CODE = "DJM" Then
                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                Else
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                End If
                
                If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Or COMPANY_CODE = "DJM" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL")))
                ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS")))
                ElseIf COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "WARRANTY")))
                ElseIf COMPANY_CODE = "HSM" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                ElseIf COMPANY_CODE = "HCE" Then
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJCHG", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJCHG", "CUSTOMER")))
                    End If
                'SJR 082014
                ElseIf COMPANY_CODE = "HGS" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS", "WARRANTY")))
                End If
    
                J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_GOL), 2)
                If CSMIOS_VAT_EXEMPT = True Then
                    J_TAX = 0
                Else
                    J_TAX = Round(Round(NumericVal(WARRANTY_DIRECT_EXPENSE_GOL) / 1.12 * 0.12, 2), 2)
                End If
                If COMPANY_CODE = "DJM" Then
                    J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_GOL), 2)
                Else
                    J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_GOL) - Round(NumericVal(J_TAX), 2), 2)
                End If
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                If COMPANY_CODE = "DJM" Then
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                Else
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
                If WARRANTY_CSMIOS_MATERIALS_COST > 0 Then
                If COMPANY_CODE = "HPI" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
                Else
                    'COST OF SALES
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "WARRANTY")))
                    ElseIf COMPANY_CODE = "HSM" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                    'SJR 082014
                    ElseIf COMPANY_CODE = "HGS" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                    ElseIf COMPANY_CODE = "HCE" Then
                        If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                        Else
                             J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJCHG", "CUSTOMER"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJCHG", "CUSTOMER")))
                        End If
                    ElseIf COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Or COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Or COMPANY_CODE = "HOT" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                    ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("MATERIALS", "SERVICE", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("MATERIALS", "SERVICE", "WARRANTY")))
                    End If
                    J_GROSS = 0
                    J_TAX = 0
                    J_NET = 0
                    J_DEBIT = Round(WARRANTY_CSMIOS_MATERIALS_COST, 2)
                    J_CREDIT = 0
                    TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            
                'INVENTORY
                If COMPANY_CODE = "DJM" Then
                Else
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVA", "MATERIALS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVA", "MATERIALS")))
                ElseIf COMPANY_CODE = "DAI" Or COMPANY_CODE = "HSM" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                'SJR 082014
                ElseIf COMPANY_CODE = "HGS" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS-IN-PROCESS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS-IN-PROCESS")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                    End If
                End If
                J_GROSS = 0: J_TAX = 0: J_NET = 0
                J_DEBIT = 0
                J_CREDIT = Round(WARRANTY_CSMIOS_MATERIALS_COST, 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
        End If
''MATERIALS BP WARRANTY
If COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HMR" Then
                If WARRANTY_DIRECT_EXPENSE_GOL_BP > 0 Then
                If COMPANY_CODE = "DJM" Then
                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                Else
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                End If
                
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCA" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS")))
                ElseIf COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-BP", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-BP", "WARRANTY")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS", "WARRANTY")))
                End If
    
                J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_GOL_BP), 2)
                If CSMIOS_VAT_EXEMPT = True Then
                    J_TAX = 0
                Else
                    J_TAX = Round(Round(NumericVal(WARRANTY_DIRECT_EXPENSE_GOL_BP) / 1.12 * 0.12, 2), 2)
                End If
                If COMPANY_CODE = "DJM" Then
                    J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_GOL_BP), 2)
                Else
                    J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_GOL_BP) - Round(NumericVal(J_TAX), 2), 2)
                End If
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                If COMPANY_CODE = "DJM" Then
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                Else
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
                If COMPANY_CODE = "HPI" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
                Else
                    'COST OF SALES
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-BP", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-BP", "WARRANTY")))
                    ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("MATERIALS", "SERVICE", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("MATERIALS", "SERVICE", "WARRANTY")))
                    End If
                    J_GROSS = 0
                    J_TAX = 0
                    J_NET = 0
                    J_DEBIT = Round(WARRANTY_CSMIOS_MATERIALS_COST_BP, 2)
                    J_CREDIT = 0
                    TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            
                'INVENTORY
                If COMPANY_CODE = "DJM" Then
                Else
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                    End If
                J_GROSS = 0: J_TAX = 0: J_NET = 0
                J_DEBIT = 0
                J_CREDIT = Round(WARRANTY_CSMIOS_MATERIALS_COST_BP, 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
        End If
End If
''END MATERIALS BP WARRANTY


'--accesoriesSJR
'If COMPANY_CODE = "DMI" Then
'    If WARRANTY_DIRECT_EXPENSE_ACC > 0 Then
'                If COMPANY_CODE = "DJM" Then
'                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
'                Else
'                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
'                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
'                End If
'
'                If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "DJM" Then
'                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL"))
'                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL")))
'                ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
'                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS"))
'                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS")))
'                ElseIf COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
'                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "WARRANTY"))
'                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "WARRANTY")))
'                ElseIf COMPANY_CODE = "HSM" Then
'                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
'                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
'                ElseIf COMPANY_CODE = "HCE" Then
'                    If CSMIOS_TERM = "CSH" Then
'                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
'                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
'                    Else
'                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJCHG", "CUSTOMER"))
'                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJCHG", "CUSTOMER")))
'                    End If
'                'SJR 082014
'                ElseIf COMPANY_CODE = "HGS" Then
'                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
'                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
'                Else
'                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS", "WARRANTY"))
'                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS", "WARRANTY")))
'                End If
'
'                J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_GOL), 2)
'                If CSMIOS_VAT_EXEMPT = True Then
'                    J_TAX = 0
'                Else
'                    J_TAX = Round(Round(NumericVal(WARRANTY_DIRECT_EXPENSE_GOL) / 1.12 * 0.12, 2), 2)
'                End If
'                If COMPANY_CODE = "DJM" Then
'                    J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_GOL), 2)
'                Else
'                    J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_GOL) - Round(NumericVal(J_TAX), 2), 2)
'                End If
'                J_DEBIT = 0
'                J_CREDIT = Round(NumericVal(J_NET), 2)
'                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
'                If COMPANY_CODE = "DJM" Then
'                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
'                Else
'                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
'                End If
'                If WARRANTY_CSMIOS_MATERIALS_COST > 0 Then
'                If COMPANY_CODE = "HPI" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
'                Else
'                    'COST OF SALES
'                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
'                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
'                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
'                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "WARRANTY"))
'                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "WARRANTY")))
'                    ElseIf COMPANY_CODE = "HSM" Then
'                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
'                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
'                    'SJR 082014
'                    ElseIf COMPANY_CODE = "HGS" Then
'                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
'                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
'                    ElseIf COMPANY_CODE = "HCE" Then
'                        If CSMIOS_TERM = "CSH" Then
'                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
'                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
'                        Else
'                             J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJCHG", "CUSTOMER"))
'                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJCHG", "CUSTOMER")))
'                        End If
'                    ElseIf COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Or COMPANY_CODE = "HOT" Then
'                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
'                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
'                    ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
'                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS"))
'                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS")))
'                    Else
'                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("MATERIALS", "SERVICE", "WARRANTY"))
'                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("MATERIALS", "SERVICE", "WARRANTY")))
'                    End If
'                    J_GROSS = 0
'                    J_TAX = 0
'                    J_NET = 0
'                    J_DEBIT = Round(WARRANTY_CSMIOS_MATERIALS_COST, 2)
'                    J_CREDIT = 0
'                    TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
'                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
'                End If
'
'                'INVENTORY
'                If COMPANY_CODE = "DJM" Then
'                Else
'                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
'                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
'                If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
'                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVA", "MATERIALS"))
'                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVA", "MATERIALS")))
'                ElseIf COMPANY_CODE = "DAI" Or COMPANY_CODE = "HSM" Then
'                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
'                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
'                'SJR 082014
'                ElseIf COMPANY_CODE = "HGS" Then
'                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS-IN-PROCESS"))
'                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS-IN-PROCESS")))
'                Else
'                    If CSMIOS_TERM = "CSH" Then
'                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
'                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
'                    Else
'                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
'                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
'                    End If
'                End If
'                J_GROSS = 0: J_TAX = 0: J_NET = 0
'                J_DEBIT = 0
'                J_CREDIT = Round(WARRANTY_CSMIOS_MATERIALS_COST, 2)
'                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
'                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
'                End If
'            End If
'    End If
'End If

        'OUTPUT TAX
       
            If CSMIOS_VAT_EXEMPT = False Or CSMIOS_VAT_EXEMPT1 = False Then
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                Call DOTSERVICEPARTSWARRANTY
            Else
                    If NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_GOL_BP) > 0 Then
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HMR" Then
                            J_ACCT_CODE = N2Str2Null(ReturnDeferredOutPutTax())
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDeferredOutPutTax()))
                        ElseIf COMPANY_CODE = "HNE" Then
                            J_ACCT_CODE = N2Str2Null(ReturnOutputTax2("WARRANTY"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnOutputTax2("WARRANTY")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnOutputTax())
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnOutputTax()))
                        End If
                        J_DEBIT = 0
                        J_CREDIT = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_GOL_BP) / 1.12 * 0.12), 2)
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                        If COMPANY_CODE = "HMR" Then
                        Else
                        If Round(Round(TOTAL_CREDIT, 2) - Round(TOTAL_DEBIT + WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_GOL_BP, 2), 2) = 0.01 Then J_CREDIT = Round(J_CREDIT, 2) - 0.01
                        If Round(Round(TOTAL_DEBIT + WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_GOL_BP, 2) - Round(TOTAL_CREDIT, 2), 2) = 0.01 Then J_CREDIT = Round(J_CREDIT, 2) + 0.01
                        End If
                        J_TAX = 0: J_GROSS = 0: J_NET = 0
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
        End If
        If COMPANY_CODE = "DJM" Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
        Else
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        End If
        
        'SJR 082014
        If COMPANY_CODE = "HGS" Then
            J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("TRADE"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("TRADE")))
        Else
            J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("WARRANTY"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("WARRANTY")))
        End If
        
        J_DEBIT = NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_GOL_BP)
        J_CREDIT = 0: J_TAX = 0: J_GROSS = 0: J_NET = 0
        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
        If COMPANY_CODE = "DJM" Then
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        Else
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
            Call rodwarranty
        End If

        WARRANTY_J_AMOUNTTOPAY = 0
        WARRANTY_J_INVOICEAMT = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_GOL_BP), 2)
        WARRANTY_J_BALANCE = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_GOL_BP), 2)
        WARRANTY_J_AMOUNTPAID = 0
        
        If (COMPANY_CODE = "DJM") And WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL > 0 And CSMIOS_RO_AMOUNT = 0 Then
        SQL_STATEMENT = "Insert into AMIS_Journal_HD" & _
                        " (jdate,voucherno,jtype,vendorcode,customercode,invoicedate,invoicetype,invoiceno,invoiceamt,duedate,paytype,refno,refdate,terms,dealer,amounttopay,Balance,AmountPaid,jno,debit,credit,outbalance,status,CheckNo,CheckDate,BankCode,remarks,PaidStatus,ReceiveStatus)" & _
                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & ", " & J_VENDORCODE & "," & J_CUSTOMERCODE & ", " & J_INVOICEDATE & "," & J_INVOICETYPE & "," & J_INVOICENO & "," & WARRANTY_J_INVOICEAMT & ", " & J_DUEDATE & ", " & J_PAYTYPE & "," & J_REFNO & "," & J_REFDATE & "," & J_TERMS & "," & J_DEALER & ", " & WARRANTY_J_AMOUNTTOPAY & "," & WARRANTY_J_BALANCE & "," & WARRANTY_J_AMOUNTPAID & _
                        ", " & WARRANTY_JNO & ", " & TOTAL_DEBIT & ", " & TOTAL_CREDIT & ", " & J_OUTBALANCE & ", " & J_STATUS & ", " & J_CHECKNO & ", " & J_CHECKDATE & ", " & J_BANKCODE & "," & J_REMARKS & "," & J_PAIDSTATUS & "," & J_RECEIVESTATUS & ")"
        gconDMIS.Execute SQL_STATEMENT
        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_hd", "X", J_JTYPE, "Jtype"))
        NEW_LogAudit "M", "JOURNAL ENTRY", SQL_STATEMENT, TransactionID, "", WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO
        
        ElseIf (COMPANY_CODE <> "DJM") Then
        J_REMARKS = " SERVICE INVOICENO:" + " " + CSMIOS_INVOICE
        SQL_STATEMENT = "Insert into AMIS_Journal_HD" & _
                        " (jdate,voucherno,jtype,vendorcode,customercode,invoicedate,invoicetype,invoiceno,invoiceamt,duedate,paytype,refno,refdate,terms,dealer,amounttopay,Balance,AmountPaid,jno,debit,credit,outbalance,status,CheckNo,CheckDate,BankCode,remarks,PaidStatus,ReceiveStatus)" & _
                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & ", " & J_VENDORCODE & "," & J_CUSTOMERCODE & ", " & J_INVOICEDATE & "," & J_INVOICETYPE & "," & J_INVOICENO & "," & WARRANTY_J_INVOICEAMT & ", " & J_DUEDATE & ", " & J_PAYTYPE & "," & J_REFNO & "," & J_REFDATE & "," & J_TERMS & "," & J_DEALER & ", " & WARRANTY_J_AMOUNTTOPAY & "," & WARRANTY_J_BALANCE & "," & WARRANTY_J_AMOUNTPAID & _
                        ", " & WARRANTY_JNO & ", " & TOTAL_DEBIT & ", " & TOTAL_CREDIT & ", " & J_OUTBALANCE & ", " & J_STATUS & ", " & J_CHECKNO & ", " & J_CHECKDATE & ", " & J_BANKCODE & ",'" & J_REMARKS & "'," & J_PAIDSTATUS & "," & J_RECEIVESTATUS & ")"
        gconDMIS.Execute SQL_STATEMENT
        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_hd", "X", J_JTYPE, "Jtype"))
        NEW_LogAudit "M", "JOURNAL ENTRY", SQL_STATEMENT, TransactionID, "", WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO
        
       End If
    End If
  Import_Warranty = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    Import_Warranty = False
    ShowVBError
End Function

Private Sub cmdClearJournals_Click()
    Screen.MousePointer = 0
    If MsgBox("Clear Unposted Data?", vbQuestion + vbYesNo, "Confirm...") = vbNo Then
        Exit Sub
    Else
        Dim i                                               As Integer
        Dim xInvoiceType                                    As String
        Dim xInvoiceNo                                      As String
        Dim xTRANTYPE                                       As String
        Dim rsJournalHD                                     As ADODB.Recordset

        i = 0
        For i = 1 To Grid1.Rows - 1
            If UCase(Grid1.Cell(i, 2).Text) = "PARTS" Then
                xInvoiceType = "PI"
            ElseIf UCase(Grid1.Cell(i, 2).Text) = "ACCESSORIES" Then
                xInvoiceType = "AI"
            ElseIf UCase(Grid1.Cell(i, 2).Text) = "MATERIALS" Then
                xInvoiceType = "MI"
            End If
            If COMPANY_CODE = "DSSC" Then
                xInvoiceNo = Right(Grid1.Cell(i, 3).Text, 7)
            ElseIf Len(Grid1.Cell(i, 3).Text) = 11 Then
                xInvoiceNo = Right(Grid1.Cell(i, 3).Text, 7)
            ElseIf COMPANY_CODE = "HCA" Then
                xTRANTYPE = Left(Grid1.Cell(i, 3).Text, 2)
                If xTRANTYPE = "DR" Or xTRANTYPE = "RI" Then
                    xInvoiceNo = Right(Grid1.Cell(i, 3).Text, 6)
               Else
                    xInvoiceNo = Right(Grid1.Cell(i, 3).Text, 8)
               End If
            ElseIf COMPANY_CODE = "HBC" Then
                If dtpTranDate.Value >= "11/1/2015" Then
                    xInvoiceNo = Right(Grid1.Cell(i, 3).Text, 8)
                    xTRANTYPE = Left(Grid1.Cell(i, 3).Text, 2)
                Else
                    xInvoiceNo = Right(Grid1.Cell(i, 3).Text, 6)
                    xTRANTYPE = Left(Grid1.Cell(i, 3).Text, 2)
                End If
            Else
                xInvoiceNo = Right(Grid1.Cell(i, 3).Text, 6)
                xTRANTYPE = Left(Grid1.Cell(i, 3).Text, 2)
            End If
            Set rsJournalHD = New ADODB.Recordset
            If xTRANTYPE = "DR" Then
                rsJournalHD.Open ("SELECT VOUCHERNO,JTYPE FROM AMIS_JOURNAL_HD WHERE STATUS='N' AND INVOICETYPE ='" & xInvoiceType & "' AND INVOICENO='DR OUT' AND JTYPE='SJ' AND REFNO ='" & xInvoiceNo & "'"), gconDMIS, adOpenForwardOnly
            Else
                rsJournalHD.Open ("SELECT VOUCHERNO,JTYPE FROM AMIS_JOURNAL_HD WHERE STATUS='N' AND INVOICETYPE ='" & xInvoiceType & "' AND INVOICENO='" & xInvoiceNo & "' AND JTYPE='SJ'"), gconDMIS, adOpenForwardOnly
            End If
            If Not rsJournalHD.EOF And Not rsJournalHD.BOF Then
                Screen.MousePointer = 11
                gconDMIS.Execute ("Delete from AMIS_AP Where STATUS = 'N' AND VOUCHERNO='" & rsJournalHD!JTYPE + "-" + rsJournalHD!VOUCHERNO & "'")
                gconDMIS.Execute ("Delete from AMIS_AR Where STATUS = 'N' AND SJVOUCHERNO='" & rsJournalHD!JTYPE + "-" + rsJournalHD!VOUCHERNO & "'")
                gconDMIS.Execute ("Delete from AMIS_Journal_Det Where STATUS = 'N' AND Jtype = 'SJ' AND VOUCHERNO='" & rsJournalHD!VOUCHERNO & "'")
                gconDMIS.Execute ("Delete from AMIS_Journal_HD Where STATUS = 'N' AND Jtype = 'SJ' and VOUCHERNO='" & rsJournalHD!VOUCHERNO & "'")
                gconDMIS.Execute ("Delete from amis_detail Where STATUS = 'N' AND Jtype = 'SJ' AND VOUCHERNO='" & rsJournalHD!VOUCHERNO & "'")
                gconDMIS.Execute ("Delete from amis_details Where STATUS = 'N' AND Jtype = 'SJ' and VOUCHERNO='" & rsJournalHD!VOUCHERNO & "'")
            End If
        Next i

        i = 0
        For i = 1 To Grid2.Rows - 1
            xInvoiceType = "SI"
            xInvoiceNo = Grid2.Cell(i, 2).Text
            Set rsJournalHD = New ADODB.Recordset
            rsJournalHD.Open ("SELECT VOUCHERNO,JTYPE FROM AMIS_JOURNAL_HD WHERE STATUS='N' AND INVOICETYPE ='" & xInvoiceType & "' AND REFNO='" & xInvoiceNo & "' AND JTYPE='SJ'"), gconDMIS, adOpenForwardOnly
            If Not rsJournalHD.EOF And Not rsJournalHD.BOF Then
                Do While Not rsJournalHD.EOF
                    gconDMIS.Execute ("Delete from AMIS_AP Where STATUS = 'N' AND VOUCHERNO='" & rsJournalHD!JTYPE + "-" + rsJournalHD!VOUCHERNO & "'")
                    gconDMIS.Execute ("Delete from AMIS_AR Where STATUS = 'N' AND SJVOUCHERNO='" & rsJournalHD!JTYPE + "-" + rsJournalHD!VOUCHERNO & "'")
                    gconDMIS.Execute ("Delete from AMIS_Journal_Det Where STATUS = 'N' AND Jtype = 'SJ' AND VOUCHERNO='" & rsJournalHD!VOUCHERNO & "'")
                    gconDMIS.Execute ("Delete from AMIS_Journal_HD Where STATUS = 'N' AND Jtype = 'SJ' and VOUCHERNO='" & rsJournalHD!VOUCHERNO & "'")
                    gconDMIS.Execute ("Delete from amis_detail Where STATUS = 'N' AND Jtype = 'SJ' AND VOUCHERNO='" & rsJournalHD!VOUCHERNO & "'")
                    gconDMIS.Execute ("Delete from amis_details Where STATUS = 'N' AND Jtype = 'SJ' and VOUCHERNO='" & rsJournalHD!VOUCHERNO & "'")
                    rsJournalHD.MoveNext
                Loop
            End If
        Next i

        i = 0
        For i = 1 To Grid3.Rows - 1
            xInvoiceType = "VI"
            xInvoiceNo = Grid3.Cell(i, 3).Text
            Set rsJournalHD = New ADODB.Recordset
            rsJournalHD.Open ("SELECT VOUCHERNO,JTYPE FROM AMIS_JOURNAL_HD WHERE STATUS='N' AND INVOICETYPE ='" & xInvoiceType & "' AND INVOICENO='" & xInvoiceNo & "' AND JTYPE='SJ'"), gconDMIS, adOpenForwardOnly
            If Not rsJournalHD.EOF And Not rsJournalHD.BOF Then
                gconDMIS.Execute ("Delete from AMIS_AP Where STATUS = 'N' AND VOUCHERNO='" & rsJournalHD!JTYPE + "-" + rsJournalHD!VOUCHERNO & "'")
                gconDMIS.Execute ("Delete from AMIS_AR Where STATUS = 'N' AND SJVOUCHERNO='" & rsJournalHD!JTYPE + "-" + rsJournalHD!VOUCHERNO & "'")
                gconDMIS.Execute ("Delete from AMIS_Journal_Det Where STATUS = 'N' AND Jtype = 'SJ' AND VOUCHERNO='" & rsJournalHD!VOUCHERNO & "'")
                gconDMIS.Execute ("Delete from AMIS_Journal_HD Where STATUS = 'N' AND Jtype = 'SJ' and VOUCHERNO='" & rsJournalHD!VOUCHERNO & "'")
                gconDMIS.Execute ("Delete from amis_detail Where STATUS = 'N' AND Jtype = 'SJ' AND VOUCHERNO='" & rsJournalHD!VOUCHERNO & "'")
                gconDMIS.Execute ("Delete from amis_details Where STATUS = 'N' AND Jtype = 'SJ' and VOUCHERNO='" & rsJournalHD!VOUCHERNO & "'")
            End If
        Next i
        cmdShowTrans.Value = True
        Screen.MousePointer = 0
        MsgBox "Existing Data Successfully deleted.", vbInformation, "Deleted"
    End If
    '    End If
    Call cmdShowImp_Click
    Call cmdShowTrans_Click
    Prg1.Value = 0
    progCPB.Value = 0
End Sub

Private Sub cmdCloseRange_Click()
    picBatchImport.Visible = False
    picBatchImport.ZOrder 1
    cmdBatchImport.Enabled = True
    cmdExit.Enabled = True
    BATCHIMPORT = False
End Sub

Private Sub cmdExit_Click()
    Unload Me
End Sub

Private Sub cmdShowImp_Click()
    Screen.MousePointer = 11
    If cmdCheck.Value = True Then
    Else
        cmdCheck.Value = False
InitGrids:         DoEvents:
        Grid1.Rows = 1: Grid2.Rows = 1: Grid3.Rows = 1
    
    End If
    Dim tmpDate                                             As String
    Dim iCount                                              As Integer
    MonthIndex
    Dim rsCheckSALESData                                    As ADODB.Recordset
    Dim rsCheckSALESData2                                   As ADODB.Recordset


    Set rsCheckSALESData2 = New ADODB.Recordset
    rsCheckSALESData2.Open "SELECT DISTINCT CONVERT(VARCHAR,DATE,101) AS DATE FROM AMIS_VW_IMPORTED_ISSUANCES WHERE MONTH([DATE]) = '" & Indx & "' AND YEAR([DATE])='" & cboYear.Text & "' ", gconDMIS, adOpenForwardOnly
    Do While Not rsCheckSALESData2.EOF
        iCount = 0
        Do While iCount <= lab.Count - 1
            If lab.Item(iCount).Caption = Format(Null2String(Null2String(rsCheckSALESData2!Date)), "d") Then
                lab.Item(iCount).BackColor = &HC0FFC0    'GREEN
            End If
            iCount = iCount + 1
            DoEvents
        Loop
        rsCheckSALESData2.MoveNext
        DoEvents
    Loop

    Set rsCheckSALESData = New ADODB.Recordset
    rsCheckSALESData.Open "SELECT DISTINCT CONVERT(VARCHAR,DATE,101) AS DATE FROM AMIS_VW_UNIMPORTED_ISSUANCES WHERE MONTH([DATE]) = '" & Indx & "' AND YEAR([DATE])='" & cboYear.Text & "' ", gconDMIS, adOpenForwardOnly
    Do While Not rsCheckSALESData.EOF
        iCount = 0
        Do While iCount <= lab.Count - 1
            If lab.Item(iCount).Caption = Format(Null2String(Null2String(rsCheckSALESData!Date)), "d") Then
                lab.Item(iCount).BackColor = &HFFFF&  'YELLOW
            End If
            iCount = iCount + 1
            DoEvents
        Loop
        rsCheckSALESData.MoveNext
        DoEvents
    Loop
    Screen.MousePointer = 0
End Sub
    
Private Sub cmdShowTrans_Click()
    xKIM = 0
    xELLAINE = 0
    
    Screen.MousePointer = 11
    
    InitGrids
    DoEvents
    cmdCheck.Enabled = False
    cmdClearJournals.Enabled = False
    
    Grid1.Rows = 1
    Grid2.Rows = 1
    Grid3.Rows = 1
    
    xELLAINE = 0
    
    If COMPANY_CODE = "CMC" Or COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCC" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HGS" Or COMPANY_CODE = "DMI" Then
        GoTo ShowTrans
    Else
        If CheckImportedSales(dtpTranDate) = True Then
            MsgBox "Previous transactions dated " & TRANSACTIONDATE & " are not yet imported.", vbExclamation, "Message"
            Screen.MousePointer = 0
            Exit Sub
        Else
            GoTo ShowTransactions
        End If

ShowTransactions:
    End If

ShowTrans:
    
    Call ShowPMISTransactions
    
    Call ShowCSMSTransactions
    
    Call ShowSMISTransactions

    If xELLAINE > 0 Then
        cmdCheck.Enabled = True
        cmdClearJournals.Enabled = True
        cmdCheck.SetFocus
    End If

    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HCE" Then
        If BATCHIMPORT = False Then
            Call frmListofUnposted.LOADJOURNAL("SJ")
            If UNPOSTEDSJ = True Then
                Screen.MousePointer = 0
                frmListofUnposted.Show 1
            End If
        End If
    End If
    Screen.MousePointer = 0
End Sub

Sub ShowPMISTransactions()
    If chkPMIS.Value = 1 Then
        xKIM = 0
        Set rsPMIOS_ORD_HD = New ADODB.Recordset
        If COMPANY_CODE = "DJM" Then
            Set rsPMIOS_ORD_HD = gconDMIS.Execute("Select * from PMIS_vw_ISS_HISTORY Where (TranType = 'CSH' OR  TranType = 'CHG') and STATUS = 'P' AND trandate ='" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' order by Tranno ASC")
        ElseIf COMPANY_CODE = "MGS" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HGS" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HSM" Then
            Set rsPMIOS_ORD_HD = gconDMIS.Execute("Select * from PMIS_vw_ISS_HISTORY Where (TranType = 'CSH' OR  TranType = 'CHG' OR  TranType = 'DR') and STATUS = 'P' AND trandate ='" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' order by Tranno ASC")
        ElseIf COMPANY_CODE = "HCA" Then
            Set rsPMIOS_ORD_HD = gconDMIS.Execute("Select * from PMIS_vw_ISS_HISTORY Where ((TranType IN ( 'CSH','CHG','DR') AND STATUS = 'P') OR (TRANTYPE = 'RIV' AND STATUS = 'B')) AND trandate ='" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' order by Tranno ASC")
         ElseIf COMPANY_CODE = "HCE" Then
            Set rsPMIOS_ORD_HD = gconDMIS.Execute("Select * from PMIS_vw_ISS_HISTORY Where ((TranType IN ( 'CSH','CHG','DR') AND STATUS = 'P') OR (TRANTYPE = 'RIV' AND STATUS IN ('B','P'))and TRANDATE > = '12-1-2014') AND trandate ='" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' order by Tranno ASC")
        Else
            Set rsPMIOS_ORD_HD = gconDMIS.Execute("Select * from PMIS_vw_ISS_HISTORY Where (TranType = 'CSH' OR  TranType = 'CHG') and STATUS = 'P' AND trandate ='" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' order by Tranno ASC")
        End If
        If Not rsPMIOS_ORD_HD.EOF And Not rsPMIOS_ORD_HD.BOF Then
            rsPMIOS_ORD_HD.MoveFirst:
            Grid1.AutoRedraw = False
            Do While Not rsPMIOS_ORD_HD.EOF
                xKIM = xKIM + 1
                If Null2String(rsPMIOS_ORD_HD!Type) = "P" Then
                    xInvoiceType = "Parts"
                    xINVOICETYPECODE = "PI"
                    TranType = Null2String(rsPMIOS_ORD_HD!TranType)
                ElseIf Null2String(rsPMIOS_ORD_HD!Type) = "A" Then
                    xInvoiceType = "Accessories"
                    xINVOICETYPECODE = "AI"
                    TranType = Null2String(rsPMIOS_ORD_HD!TranType)
                ElseIf Null2String(rsPMIOS_ORD_HD!Type) = "M" Then
                    xInvoiceType = "Materials"
                    xINVOICETYPECODE = "MI"
                    TranType = Null2String(rsPMIOS_ORD_HD!TranType)
                Else
                    xInvoiceType = "Unknown"
                    xINVOICETYPECODE = ""
                End If
                If CheckSJExisting(xINVOICETYPECODE, Null2String(rsPMIOS_ORD_HD!TRANNO), Null2String(rsPMIOS_ORD_HD!TranType)) = True Then
                    xIS_EXIST = 1
                Else
                    xIS_EXIST = 0
                End If
                If TranType = "DR" Then
                Grid1.AddItem xIS_EXIST & Chr(9) & xInvoiceType & Chr(9) & Null2String(rsPMIOS_ORD_HD!TranType) & "-" & Null2String(rsPMIOS_ORD_HD!TRANNO) & Chr(9) & ToDoubleNumber(N2Str2Zero(rsPMIOS_ORD_HD!NETCOST)) & Chr(9) & Null2String(rsPMIOS_ORD_HD!CUSTNAME)
                Else
                Grid1.AddItem xIS_EXIST & Chr(9) & xInvoiceType & Chr(9) & Null2String(rsPMIOS_ORD_HD!TranType) & "-" & Null2String(rsPMIOS_ORD_HD!TRANNO) & Chr(9) & ToDoubleNumber(N2Str2Zero(rsPMIOS_ORD_HD!NETINVAMT)) & Chr(9) & Null2String(rsPMIOS_ORD_HD!CUSTNAME)
                End If
                rsPMIOS_ORD_HD.MoveNext
            Loop

            If xKIM = 0 Then Grid1.RemoveItem 1
            Grid1.AutoRedraw = True
            Grid1.Refresh
        End If
        xELLAINE = xELLAINE + xKIM
    End If
End Sub

Sub ShowCSMSTransactions()
    If chkCSMS.Value = 1 Then
        Grid2.AutoRedraw = False
        'PURELY INTERNAL
        xKIM = 0
        Set rsCSMIOS_REPOR = New ADODB.Recordset
        If COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCE" Then
            Set rsCSMIOS_REPOR = gconDMIS.Execute("Select CSMS_REPOR.REP_OR,CSMS_REPOR.INVOICE,CSMS_REPOR.RO_AMOUNT from CSMS_REPOR  WHERE INVOICE = 'INT RO' and isnull(amount,0) > 0.00 and DTE_REL = '" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' ORDER BY CSMS_REPOR.REP_OR ASC")
        Else
            Set rsCSMIOS_REPOR = gconDMIS.Execute("Select CSMS_REPOR.REP_OR,CSMS_REPOR.INVOICE,CSMS_REPOR.RO_AMOUNT from CSMS_REPOR  WHERE INVOICE IN ('INT RO') and isnull(amount,0) > 0.00 and DTE_COMP = '" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' ORDER BY CSMS_REPOR.REP_OR ASC")
        End If
        If Not rsCSMIOS_REPOR.EOF And Not rsCSMIOS_REPOR.BOF Then
            rsCSMIOS_REPOR.MoveFirst:
            Do While Not rsCSMIOS_REPOR.EOF
                xKIM = xKIM + 1
                If CheckRefNoExisting("SI", Null2String(rsCSMIOS_REPOR!REP_OR)) = True Then
                    xIS_EXIST = 1
                Else
                    xIS_EXIST = 0
                End If
                Grid2.AddItem xIS_EXIST & Chr(9) & Null2String(rsCSMIOS_REPOR!REP_OR) & Chr(9) & Null2String(rsCSMIOS_REPOR!INVOICE) & Chr(9) & ToDoubleNumber(N2Str2Zero(rsCSMIOS_REPOR!RO_AMOUNT)) & Chr(9) & SetRONiym(Null2String(rsCSMIOS_REPOR!INVOICE))
                rsCSMIOS_REPOR.MoveNext
            Loop
     End If
     
     'PDI
        If COMPANY_CODE = "HSM" Then
            Set rsCSMIOS_REPOR = New ADODB.Recordset
            Set rsCSMIOS_REPOR = gconDMIS.Execute("Select CSMS_REPOR.REP_OR AS REP_OR,CSMS_REPOR.INVOICE,SUM(CSMS_RO_DET.DETPRC) AS AMOUNT from CSMS_REPOR INNER JOIN CSMS_RO_DET ON CSMS_REPOR.REP_OR = CSMS_RO_DET.REP_OR WHERE INVOICE = 'PDI RO'  AND  DTE_COMP = '" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' GROUP BY CSMS_REPOR.REP_OR,INVOICE")
            If Not rsCSMIOS_REPOR.EOF And Not rsCSMIOS_REPOR.BOF Then
                rsCSMIOS_REPOR.MoveFirst:
                Do While Not rsCSMIOS_REPOR.EOF
                    xKIM = xKIM + 1
                    If CheckSJExisting("SI", Null2String(rsCSMIOS_REPOR!INVOICE), Null2String(rsCSMIOS_REPOR!REP_OR)) = True Then
                        xIS_EXIST = 1
                    Else
                        xIS_EXIST = 0
                    End If
                    Grid2.AddItem xIS_EXIST & Chr(9) & Null2String(rsCSMIOS_REPOR!REP_OR) & Chr(9) & Null2String(rsCSMIOS_REPOR!INVOICE) & Chr(9) & ToDoubleNumber(N2Str2Zero(rsCSMIOS_REPOR!amount)) & Chr(9) & SetRONiym(Null2String(rsCSMIOS_REPOR!INVOICE))
                    rsCSMIOS_REPOR.MoveNext
                Loop
            End If
        End If

        'CHARGE TO COMPANY / SALES
        Set rsCSMIOS_REPOR = New ADODB.Recordset
        If COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCE" Then
            Set rsCSMIOS_REPOR = gconDMIS.Execute("Select CSMS_REPOR.REP_OR,CSMS_REPOR.INVOICE,SUM(CSMS_RO_DET.DETPRC) AS AMOUNT from CSMS_REPOR INNER JOIN CSMS_RO_DET ON CSMS_REPOR.REP_OR = CSMS_RO_DET.REP_OR WHERE INVOICE <> 'INT RO' AND RO_AMOUNT = 0 AND DETAMT > 0 AND (WCODE = 'S' OR WCODE = 'C') AND invoice <> 'NO CHG' AND invoice <> 'PDI RO' and DTE_REL = '" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' GROUP BY CSMS_REPOR.REP_OR,INVOICE")
        Else
            Set rsCSMIOS_REPOR = gconDMIS.Execute("Select CSMS_REPOR.REP_OR,CSMS_REPOR.INVOICE,SUM(CSMS_RO_DET.DETPRC) AS AMOUNT from CSMS_REPOR INNER JOIN CSMS_RO_DET ON CSMS_REPOR.REP_OR = CSMS_RO_DET.REP_OR WHERE INVOICE <> 'INT RO' AND RO_AMOUNT = 0 AND DETAMT > 0 AND (WCODE = 'S' OR WCODE = 'C') AND invoice <> 'NO CHG' AND invoice <> 'PDI RO' and DTE_COMP = '" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' GROUP BY CSMS_REPOR.REP_OR,INVOICE")
        End If
        If Not rsCSMIOS_REPOR.EOF And Not rsCSMIOS_REPOR.BOF Then
            rsCSMIOS_REPOR.MoveFirst:
            Do While Not rsCSMIOS_REPOR.EOF
                xKIM = xKIM + 1
                If CheckSJExisting("SI", Null2String(rsCSMIOS_REPOR!INVOICE)) = True Then
                    xIS_EXIST = 1
                Else
                    xIS_EXIST = 0
                End If
                Grid2.AddItem xIS_EXIST & Chr(9) & Null2String(rsCSMIOS_REPOR!REP_OR) & Chr(9) & Null2String(rsCSMIOS_REPOR!INVOICE) & Chr(9) & ToDoubleNumber(N2Str2Zero(rsCSMIOS_REPOR!amount)) & Chr(9) & SetRONiym(Null2String(rsCSMIOS_REPOR!INVOICE))
                rsCSMIOS_REPOR.MoveNext
            Loop
        End If

        Set rsCSMIOS_REPOR = New ADODB.Recordset
        If COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCE" Then
            Set rsCSMIOS_REPOR = gconDMIS.Execute("Select * from CSMS_REPOR where RO_AMOUNT > 0 AND invoice <> 'INT RO' AND invoice <> 'NO CHG' AND invoice <> 'PDI RO' and DTE_REL = '" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' order by invoice ASC")
        Else
            Set rsCSMIOS_REPOR = gconDMIS.Execute("Select * from CSMS_REPOR where RO_AMOUNT > 0 AND invoice <> 'INT RO' AND invoice <> 'NO CHG' AND invoice <> 'PDI RO' and DTE_COMP = '" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' order by invoice ASC")
        End If
        If Not rsCSMIOS_REPOR.EOF And Not rsCSMIOS_REPOR.BOF Then
            rsCSMIOS_REPOR.MoveFirst:
            Grid2.AutoRedraw = False
            Do While Not rsCSMIOS_REPOR.EOF
                xKIM = xKIM + 1
                If CheckSJExisting("SI", Null2String(rsCSMIOS_REPOR!INVOICE)) = True Then
                    xIS_EXIST = 1
                Else
                    xIS_EXIST = 0
                End If
                Grid2.AddItem xIS_EXIST & Chr(9) & Null2String(rsCSMIOS_REPOR!REP_OR) & Chr(9) & Null2String(rsCSMIOS_REPOR!INVOICE) & Chr(9) & ToDoubleNumber(N2Str2Zero(rsCSMIOS_REPOR!amount)) & Chr(9) & Null2String(rsCSMIOS_REPOR!Niym)
                rsCSMIOS_REPOR.MoveNext
            Loop
        End If

        'PURELY WARRANTY
        Set rsCSMIOS_REPOR = New ADODB.Recordset
        If COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCE" Then
            Set rsCSMIOS_REPOR = gconDMIS.Execute("Select CSMS_REPOR.REP_OR,CSMS_REPOR.INVOICE,SUM(CSMS_RO_DET.DET_AMT) AS AMOUNT from CSMS_REPOR INNER JOIN CSMS_RO_DET ON CSMS_REPOR.REP_OR = CSMS_RO_DET.REP_OR WHERE RO_AMOUNT = 0 AND DET_AMT > 0 AND WCODE = 'W' AND invoice <> 'NO CHG' AND invoice <> 'PDI RO' AND invoice <> 'INT RO' and DTE_REL = '" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' GROUP BY CSMS_REPOR.REP_OR,INVOICE")
        Else
            Set rsCSMIOS_REPOR = gconDMIS.Execute("Select CSMS_REPOR.REP_OR,CSMS_REPOR.INVOICE,SUM(CSMS_RO_DET.DETAMT) AS AMOUNT from CSMS_REPOR INNER JOIN CSMS_RO_DET ON CSMS_REPOR.REP_OR = CSMS_RO_DET.REP_OR WHERE RO_AMOUNT = 0 AND DETAMT > 0 AND WCODE = 'W' AND invoice <> 'NO CHG' AND invoice <> 'PDI RO' AND invoice <> 'INT RO' and DTE_COMP = '" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "'AND (SELECT ISNULL(SUM(DETCOST),0) FROM CSMS_Ro_Det CRS WHERE CRS.WCODE IN ('S','C') AND CRS.REP_OR = CSMS_RO_DET.REP_OR) = 0 GROUP BY CSMS_REPOR.REP_OR,INVOICE")
        End If
        If Not rsCSMIOS_REPOR.EOF And Not rsCSMIOS_REPOR.BOF Then
            rsCSMIOS_REPOR.MoveFirst:
            Do While Not rsCSMIOS_REPOR.EOF
                xKIM = xKIM + 1
                If CheckSJExisting("SI", Null2String(rsCSMIOS_REPOR!INVOICE)) = True Then
                    xIS_EXIST = 1
                Else
                    xIS_EXIST = 0
                End If
                Grid2.AddItem xIS_EXIST & Chr(9) & Null2String(rsCSMIOS_REPOR!REP_OR) & Chr(9) & Null2String(rsCSMIOS_REPOR!INVOICE) & Chr(9) & ToDoubleNumber(N2Str2Zero(rsCSMIOS_REPOR!amount)) & Chr(9) & SetRONiym(Null2String(rsCSMIOS_REPOR!INVOICE))
                rsCSMIOS_REPOR.MoveNext
            Loop
        End If
        If xKIM = 0 Then Grid2.RemoveItem 1
        Grid2.AutoRedraw = True
        Grid2.Refresh
        xELLAINE = xELLAINE + xKIM
    End If
End Sub

Sub ShowSMISTransactions()
    xKIM = 0
    Grid3.AutoRedraw = False
    If COMPANY_CODE = "HGC" Then
        Set rsTransferOut = New ADODB.Recordset
        Set rsTransferOut = gconDMIS.Execute("Select * from SMIS_Stocktransfer Where deyt = '" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' order by VINO ASC")
        If Not rsTransferOut.EOF And Not rsTransferOut.BOF Then
            rsTransferOut.MoveFirst:
            Dim Cost                                        As String
            Cost = ReturnAmount(rsTransferOut!DESCRIPTIONS)
            Do While Not rsTransferOut.EOF
                xKIM = xKIM + 1
                If CheckSJExisting("VI", Null2String(rsTransferOut!SDNO)) = True Then
                    xIS_EXIST = 1
                Else
                    xIS_EXIST = 0
                End If
                Grid3.AddItem xIS_EXIST & Chr(9) & Null2String(rsTransferOut!CSNO) & Chr(9) & Null2String(rsTransferOut!SDNO) & Chr(9) & Null2String(NumericVal(Cost)) & Chr(9) & Null2String(rsTransferOut!Entity_to)
                rsTransferOut.MoveNext
            Loop
        End If
    End If

    If chkSMIS.Value = 1 Then
        Set rsSMIS_PURCHAGREE = New ADODB.Recordset
        If COMPANY_CODE = "CMC" Then
            Set rsSMIS_PURCHAGREE = gconDMIS.Execute("Select * from SMIS_PurchAgree Where CONVERT(VarChar, InvoicedDate, 101)  = '" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' order by VI_NO ASC")
        Else
            Set rsSMIS_PURCHAGREE = gconDMIS.Execute("Select * from SMIS_PurchAgree Where STATUS = 'P' AND CONVERT(VarChar, DateReleased, 101)  = '" & Format(CDate(dtpTranDate), "MM/DD/YYYY") & "' order by VI_NO ASC")
        End If
        
        If Not rsSMIS_PURCHAGREE.EOF And Not rsSMIS_PURCHAGREE.BOF Then
            rsSMIS_PURCHAGREE.MoveFirst:
            Do While Not rsSMIS_PURCHAGREE.EOF
                xKIM = xKIM + 1
                If CheckSJExisting("VI", Null2String(rsSMIS_PURCHAGREE!VI_NO)) = True Then
                    xIS_EXIST = 1
                Else
                    xIS_EXIST = 0
                End If
                Grid3.AddItem xIS_EXIST & Chr(9) & Null2String(rsSMIS_PURCHAGREE!IGNKEY_NO) & Chr(9) & Null2String(rsSMIS_PURCHAGREE!VI_NO) & Chr(9) & ToDoubleNumber(N2Str2Zero(rsSMIS_PURCHAGREE!NETSALESPRICE)) & Chr(9) & SetCustomerName(Null2String(rsSMIS_PURCHAGREE!Code))
                rsSMIS_PURCHAGREE.MoveNext
            Loop
        End If
        If xKIM = 0 Then Grid3.RemoveItem 1
        Grid3.AutoRedraw = True
        Grid3.Refresh
        xELLAINE = xELLAINE + xKIM
    End If
End Sub

Private Sub Command1_Click()
    Screen.MousePointer = 11
    Prg1.Max = 6:
    Prg1.Value = 1
    cmdCheck.Enabled = False
    cmdExit.Enabled = False
    Dim i
    For i = 1 To Grid1.Rows - 1

        Select Case UCase(Grid1.Cell(i, 2).Text)
        Case "PARTS"
            gconDMIS.Execute "SP_IMPORT_PMIS_SALES  'P', '" & Left(Grid1.Cell(i, 3).Text, 3) & "','" & Right(Grid1.Cell(i, 3).Text, 6) & "','" & LOGCODE & "'"
        Case "MATERIALS"
            gconDMIS.Execute "SP_IMPORT_PMIS_SALES  'M', '" & Left(Grid1.Cell(i, 3).Text, 3) & "','" & Right(Grid1.Cell(i, 3).Text, 6) & "','" & LOGCODE & "'"
        Case "ACCESSORIES"
        End Select
        Grid1.Cell(i, 1).Text = 1
        Grid1.TopRow = i
        DoEvents
    Next
    Screen.MousePointer = 0
    MsgBox "finished"
End Sub

Private Sub dtpTranDate_Change()
InitGrids:     DoEvents:
    Grid1.Rows = 1
    Grid2.Rows = 1
    Grid3.Rows = 1
    cmdCheck.Enabled = False
    cmdClearJournals.Enabled = False
End Sub

Private Sub dtTo_LostFocus()
    If dtTo.Value < dtFrom.Value Then
        MsgBox "Please check selected date.", vbInformation, "Check Date"
        dtTo.SetFocus
    End If
End Sub

Private Sub Form_Load()
    On Error GoTo ErrorCode
    Screen.MousePointer = 11
    CenterMe frmMain, Me, 1
    Me.Caption = Me.Caption & " [" & App.EXEName & " version " & App.Major & "." & App.Minor & "." & App.Revision & "]"
    dtpTranDate = LOGDATE
    InitGrids
    InitCombo
    InitNoDays
    cmdCheck.Enabled = False
    Screen.MousePointer = 0
    
    If COMPANY_CODE = "DGI1" Then
        cmdClearJournals.Visible = False
    End If
    Exit Sub
    
ErrorCode:
    Screen.MousePointer = 0
    MsgBox err.Number & vbCrLf & err.DESCRIPTION, vbCritical, "Database Connection Error!"
    Unload frmSplash
    cmdCheck.Enabled = False
End Sub

Function CheckImportedSales(xTranDate As String) As Boolean
'Update: ACL 11162009
    Dim xNoDays                                             As Integer
    Dim rsCheckSales                                        As ADODB.Recordset
    Dim rsCheckTrans                                        As ADODB.Recordset
    Set rsCheckSales = New ADODB.Recordset
    rsCheckSales.Open "Select TOP 1 * from AMIS_Journal_HD where JTYPE='SJ' AND JDATE < '" & CDate(xTranDate) & "' ORDER BY JDATE DESC", gconDMIS, adOpenKeyset
    If Not rsCheckSales.EOF And Not rsCheckSales.BOF Then
        Set rsCheckTrans = New ADODB.Recordset
        rsCheckTrans.Open "SELECT * FROM (SELECT TOP 1 TRANDATE AS TRANDATE FROM PMIS_VW_ISS_HISTORY WHERE (TRANTYPE = 'CSH' OR  TRANTYPE = 'CHG') AND STATUS = 'P' AND TRANDATE > '" & Null2Date(rsCheckSales!JDATE) & "' ORDER BY TRANDATE ASC " & _
                          "UNION SELECT TOP 1 DTE_REL AS TRANDATE FROM CSMS_REPOR  WHERE INVOICE = 'INT RO' AND DTE_REL > '" & Null2Date(rsCheckSales!JDATE) & "' ORDER BY DTE_REL ASC " & _
                          "UNION SELECT TOP 1 DTE_REL AS TRANDATE FROM CSMS_REPOR WHERE RO_AMOUNT > 0 AND INVOICE <> 'INT RO' AND INVOICE <> 'NO CHG' AND INVOICE <> 'PDI RO' AND DTE_REL > '" & Null2Date(rsCheckSales!JDATE) & "' ORDER BY DTE_REL ASC " & _
                          "UNION SELECT TOP 1 DTE_REL AS TRANDATE FROM CSMS_REPOR INNER JOIN CSMS_RO_DET ON CSMS_REPOR.REP_OR = CSMS_RO_DET.REP_OR WHERE RO_AMOUNT = 0 AND DETAMT > 0 AND WCODE = 'W' AND INVOICE <> 'NO CHG' AND INVOICE <> 'PDI RO' AND INVOICE <> 'INT RO' AND DTE_REL > '" & Null2Date(rsCheckSales!JDATE) & "' ORDER BY DTE_REL ASC " & _
                          "UNION SELECT TOP 1 CONVERT(VARCHAR, DATERELEASED, 101) AS TRANDATE FROM SMIS_PURCHAGREE WHERE STATUS = 'P' AND (MONTH(CONVERT(VARCHAR, DATERELEASED, 101))> '" & Month(CDate(rsCheckSales!JDATE)) & "' AND DAY(CONVERT(VARCHAR, DATERELEASED, 101)) > '" & Day(CDate(rsCheckSales!JDATE)) & "' AND YEAR(CONVERT(VARCHAR, DATERELEASED, 101)) > '" & Year(CDate(rsCheckSales!JDATE)) & "') ORDER BY DATERELEASED ASC) X ORDER BY TRANDATE ASC", gconDMIS, adOpenKeyset
        If Not rsCheckTrans.EOF And Not rsCheckTrans.BOF Then
            TRANSACTIONDATE = Null2Date(rsCheckTrans!trandate)
            xNoDays = DateDiff("d", TRANSACTIONDATE, dtpTranDate)
            'If Format(CDate(dtpTranDate), "mm/dd/yyyy") > Format(CDate(TRANSACTIONDATE), "mm/dd/yyyy") Then
            If xNoDays > 0 Then
                CheckImportedSales = True
            End If
        End If
    End If
    Set rsCheckSales = Nothing
End Function

Function CheckToClearSales(xTranDate As String) As Boolean
    Dim rsCheckSJ                                           As ADODB.Recordset
    Set rsCheckSJ = New ADODB.Recordset
    rsCheckSJ.Open "Select TOP 1 * from AMIS_Journal_HD Where STATUS <> 'P' AND Jtype = 'SJ' and Jdate > '" & CDate(xTranDate) & "' Order by Jdate ASC", gconDMIS, adOpenKeyset
    If Not rsCheckSJ.EOF And Not rsCheckSJ.BOF Then
        CheckToClearSales = True
    End If
End Function

Private Sub lab_Click(Index As Integer)
InitGrids:     DoEvents:
    Grid1.Rows = 1
    Grid2.Rows = 1
    Grid3.Rows = 1
    cmdCheck.Enabled = False
    cmdClearJournals.Enabled = False
    MonthIndex
    xTranDate = Indx & "/" & lab.Item(Index).Caption & "/" & cboYear.Text
    dtpTranDate.Value = xTranDate
    Call cmdShowTrans_Click
End Sub

Sub MonthIndex()
    Select Case cboMonth.Text
    Case "January": Indx = 1
    Case "February": Indx = 2
    Case "March": Indx = 3
    Case "April": Indx = 4
    Case "May": Indx = 5
    Case "June": Indx = 6
    Case "July": Indx = 7
    Case "August": Indx = 8
    Case "September": Indx = 9
    Case "October": Indx = 10
    Case "November": Indx = 11
    Case "December": Indx = 12
    Case Else: Indx = -1
    End Select
End Sub

Sub InitNoDays()
    Dim iCount                                              As Integer
    For iCount = 1 To 31
        lab.Item(iCount - 1).Caption = iCount
    Next
End Sub

Sub InitCombo()
    Dim NoDays                                              As Integer
    With cboYear
        .AddItem ("2005")
        .AddItem ("2006")
        .AddItem ("2007")
        .AddItem ("2008")
        .AddItem ("2009")
        .AddItem ("2010")
        .AddItem ("2011")
        .AddItem ("2012")
        .AddItem ("2013")
        .AddItem ("2014")
        .AddItem ("2015")
        .AddItem ("2016")
        .AddItem ("2017")
        .AddItem ("2018")
    End With
    cboYear.Text = Format(LOGDATE, "yyyy")

    With cboMonth
        .AddItem ("January")
        .AddItem ("February")
        .AddItem ("March")
        .AddItem ("April")
        .AddItem ("May")
        .AddItem ("June")
        .AddItem ("July")
        .AddItem ("August")
        .AddItem ("September")
        .AddItem ("October")
        .AddItem ("November")
        .AddItem ("December")
    End With
    cboMonth.ListIndex = Month(LOGDATE) - 1
End Sub

Private Sub IMPORT_ACCESSORIES()
    If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HSM" Then
        If CSMIOS_ACCESSORIES > 0 Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER")))
            Else
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED")))
                End If
            End If
            J_GROSS = Round(NumericVal(CSMIOS_ACCESSORIES), 2)
            If CSMIOS_INVOICE = "PDI RO" Then
                J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_ACCESSORIES), 2)
            Else
                If CSMIOS_VAT_EXEMPT = True Then
                    J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_ACCESSORIES), 2)
                Else
                    J_TAX = Round(NumericVal(Round((CSMIOS_ACCESSORIES / 1.12), 2) * 0.12), 2)
                    If COMPANY_CODE = "DGI" Then
                        J_NET = Round(NumericVal(CSMIOS_ACCESSORIES - CSMIOS_ACCESSORIES_DISCOUNT) / 1.12, 2)
                    Else
                        J_NET = Round(NumericVal(CSMIOS_ACCESSORIES) - Round(NumericVal(J_TAX), 2), 2)
                    End If
                End If
            End If
            J_DEBIT = 0
            'arjr
            If COMPANY_CODE = "HCI" And CSMIOS_PARTICIPAT <> "" Then
                J_CREDIT = Round(NumericVal(J_GROSS), 2)
            Else
                J_CREDIT = Round(NumericVal(J_NET), 2)
            End If
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)

            'COST OF SALES
            If COMPANY_CODE = "HCI" And CSMIOS_PARTICIPAT <> "" Then
            Else
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"

                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HMR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("ACCESSORIES", "INSTALLED"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("ACCESSORIES", "INSTALLED")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("ACCESSORIES", "INSTALLED"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("ACCESSORIES", "INSTALLED")))
                    End If
                End If

                J_DEBIT = Round(CSMIOS_ACCESSORIES_COST, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)

                'INVENTORY
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HMR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES", "INVA"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES", "INVA")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES", "INVA"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES", "INVA")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES", "INVA"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES", "INVA")))
                    End If
                End If
                J_DEBIT = 0
                J_CREDIT = Round(CSMIOS_ACCESSORIES_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    End If
End Sub

Function ReturnExpense(XXX As String, Optional YYY As String, Optional zzz As String) As String
    Dim rsChartAccount                                      As ADODB.Recordset
    Set rsChartAccount = New ADODB.Recordset
    If Trim(YYY) = "" Then
        Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'EXPENSE' AND TRANTYPE2 = '" & XXX & "'")
    Else
        If Trim(zzz) = "" Then
            Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'EXPENSE' AND TRANTYPE2 = '" & XXX & "' AND TRANTYPE1 = '" & YYY & "'")
        Else
            Set rsChartAccount = gconDMIS.Execute("Select AcctCode from AMIS_ChartAccount where TRANTYPE3 = 'EXPENSE' AND TRANTYPE2 = '" & XXX & "' AND TRANTYPE1 = '" & YYY & "' AND TRANTYPE4 = '" & zzz & "'")
        End If
    End If

    If Not rsChartAccount.EOF And Not rsChartAccount.BOF Then
        ReturnExpense = Null2String(rsChartAccount!AcctCode)
    End If
    Set rsChartAccount = Nothing
End Function

Function ReturnAccommodation(XXX As String)
    Dim rsAccommodation                                     As ADODB.Recordset
    Set rsAccommodation = New ADODB.Recordset
    Set rsAccommodation = gconDMIS.Execute("SELECT ACCTCODE FROM AMIS_CHARTACCOUNT WHERE TRANTYPE3='ACCOMMODATION' AND TRANTYPE1='" & XXX & "'")
    If Not rsAccommodation.EOF And Not rsAccommodation.BOF Then
        ReturnAccommodation = Null2String(rsAccommodation!AcctCode)
    End If
    Set rsAccommodation = Nothing
End Function

Function CheckInternalRO(XXX As String) As Boolean
    Dim rsCheckInternalRO                                   As ADODB.Recordset
    Set rsCheckInternalRO = New ADODB.Recordset
    rsCheckInternalRO.Open "SELECT INVOICENO FROM CMIS_REPOR WHERE INVOICE = '" & XXX & "'", gconDMIS, adOpenForwardOnly
    If Not rsCheckInternalRO.EOF And Not rsCheckInternalRO.BOF Then
        CheckInternalRO = True
    End If
    Set rsCheckInternalRO = Nothing
End Function

Function CheckIfORIG(XXX As String) As Boolean
    Dim SQL                                                 As String
    Dim RS                                                  As New ADODB.Recordset

    SQL = "SELECT GENUINE From PMIS_stockmas where Stockno='" & XXX & "'"

    Set RS = New ADODB.Recordset
    Set RS = gconDMIS.Execute(SQL)

    If Not RS.EOF And Not RS.BOF Then
        If Null2String(RS!genuine) = "Y" Then
            CheckIfORIG = True
        Else
            CheckIfORIG = False
        End If
    End If
    Set RS = Nothing
End Function

Function ReturnAmount(XXX As String) As Double
    Dim rsReturnAmount                                      As ADODB.Recordset
    Set rsReturnAmount = New ADODB.Recordset
    rsReturnAmount.Open "SELECT DESCRIPT,purchprice FROM SMIS_MrrInv_Table WHERE DESCRIPT = '" & XXX & "' ORDER BY DATERELEASED desc", gconDMIS, adOpenForwardOnly
    If Not rsReturnAmount.EOF And Not rsReturnAmount.BOF Then
        ReturnAmount = rsReturnAmount!PURCHPRICE
    End If
    Set rsReturnAmount = Nothing
End Function

Function ReturnCodeTR(XXX As Variant) As Double
    Dim rsReturnCode                                        As ADODB.Recordset
    Set rsReturnCode = New ADODB.Recordset
    rsReturnCode.Open "SELECT CODE, DESCRIPT FROM ALL_Model WHERE DESCRIPT = '" & XXX & "'", gconDMIS, adOpenForwardOnly
    If Not rsReturnCode.EOF And Not rsReturnCode.BOF Then
        ReturnCodeTR = N2Str2IntZero(rsReturnCode!Code)
    End If
    Set rsReturnCode = Nothing
End Function

Function AmountLessVAT(XXX As String, YYY As String) As Double
    Dim rsAMOUNT                                            As ADODB.Recordset
    Set rsAMOUNT = New ADODB.Recordset
    If COMPANY_CODE = "CMC" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCE" Then
        rsAMOUNT.Open "SELECT SUM(ISNULL(CREDIT,0)) AS CREDIT FROM AMIS_JOURNAL_DET WHERE VOUCHERNO =" & XXX & " AND JTYPE= " & YYY & " AND (LEFT(ACCT_CODE,2)IN ('41','42') OR LEFT(ACCT_CODE,5)='71-61')", gconDMIS, adOpenForwardOnly
    Else
        rsAMOUNT.Open "SELECT SUM(ISNULL(CREDIT,0)) AS CREDIT FROM AMIS_JOURNAL_DET WHERE VOUCHERNO =" & XXX & " AND JTYPE= " & YYY & " AND (LEFT(ACCT_CODE,2) = '41' OR LEFT(ACCT_CODE,5)='71-61')", gconDMIS, adOpenForwardOnly
    End If
    If Not rsAMOUNT.EOF And Not rsAMOUNT.BOF Then
        AmountLessVAT = NumericVal(rsAMOUNT!Credit)
    End If
    Set rsAMOUNT = Nothing
End Function

Function DiscountLessVAT(XXX As String, YYY As String) As Double
    Dim rsAMOUNT                                            As ADODB.Recordset
    Set rsAMOUNT = New ADODB.Recordset
    rsAMOUNT.Open "SELECT SUM(ISNULL(DEBIT,0)) AS DEBIT FROM AMIS_JOURNAL_DET WHERE VOUCHERNO =" & XXX & " AND JTYPE= " & YYY & " AND LEFT(ACCT_CODE,1)='5'", gconDMIS, adOpenForwardOnly
    If Not rsAMOUNT.EOF And Not rsAMOUNT.BOF Then
        DiscountLessVAT = N2Str2Zero(rsAMOUNT!Debit)
    End If
    Set rsAMOUNT = Nothing
End Function

Function SJLASTTRANS() As String
'Update: ACL 05092011
    Dim rsCheckTrans                                        As ADODB.Recordset
    Set rsCheckTrans = New ADODB.Recordset
    rsCheckTrans.Open "SELECT MAX(TRANDATE) AS TRANDATE FROM (SELECT MAX(TRANDATE) AS TRANDATE FROM PMIS_VW_ISS_HISTORY WHERE (TRANTYPE = 'CSH' OR  TRANTYPE = 'CHG') AND STATUS = 'P'" & _
                      "UNION SELECT MAX(DTE_REL) AS TRANDATE FROM CSMS_REPOR  WHERE INVOICE = 'INT RO' " & _
                      "UNION SELECT MAX(DTE_REL) AS TRANDATE FROM CSMS_REPOR WHERE RO_AMOUNT > 0 AND INVOICE <> 'INT RO' AND INVOICE <> 'NO CHG' AND INVOICE <> 'PDI RO'" & _
                      "UNION SELECT MAX(DTE_REL) AS TRANDATE FROM CSMS_REPOR INNER JOIN CSMS_RO_DET ON CSMS_REPOR.REP_OR = CSMS_RO_DET.REP_OR WHERE RO_AMOUNT = 0 AND DETAMT > 0 AND WCODE = 'W' AND INVOICE <> 'NO CHG' AND INVOICE <> 'PDI RO' AND INVOICE <> 'INT RO' " & _
                      "UNION SELECT MAX(CAST(CONVERT(VARCHAR, DATERELEASED, 101) AS SMALLDATETIME)) AS TRANDATE FROM SMIS_PURCHAGREE WHERE STATUS = 'P') X", gconDMIS, adOpenKeyset
    If Not rsCheckTrans.EOF And Not rsCheckTrans.BOF Then
        SJLASTTRANS = Null2Date(rsCheckTrans!trandate)
    End If
    Set rsCheckTrans = Nothing
End Function

Sub DR_IMPORT_TEMPORARY(xJType As String, xVOUCHERNO As String, xJno As String, xInv_no As String, xDate As Date)
    Dim rsDR As New ADODB.Recordset
    Set rsDR = New ADODB.Recordset
    rsDR.Open "Select [type],custcode,ttlinvamt from PMIS_vw_ISS_HISTORY Where TranType = 'DR' and STATUS = 'P' AND trandate ='" & Format(CDate(xDate), "MM/DD/YYYY") & "' order by Tranno ASC", gconDMIS
    If Not rsDR.EOF And Not rsDR.BOF Then
        Call InsertToJournalDet1(xDate, xVOUCHERNO, xJType, xJno, "0001", "11-05011-00", "INVENTORY CLEARING", rsDR!TTLINVAMT, "0.00", "", "", "", "N")
        Call InsertToJournalDet1(xDate, xVOUCHERNO, xJType, xJno, "0001", "11-05002-00", "INVENTORY - PARTS", "0.00", rsDR!TTLINVAMT, "", "", "", "N")

        
    End If
    SQL_STATEMENT = "INSERT INTO AMIS_JOURNAL_HD (JTYPE,VOUCHERNO,JNO,"
End Sub
Sub internal_insurance()

 If COMPANY_DIRECT_EXPENSE_LABOR + COMPANY_DIRECT_EXPENSE_SPAREPARTS + COMPANY_DIRECT_EXPENSE_GOL + SALES_DIRECT_EXPENSE_LABOR + SALES_DIRECT_EXPENSE_SPAREPARTS + SALES_DIRECT_EXPENSE_GOL > 0 And CSMIOS_RO_AMOUNT > 0 Then
        'LABOR

        INTERNAL_LABOR_AMT = 0: INTERNAL_PARTS_AMT = 0: INTERNAL_MATERIALS_AMT = 0
        INTERNAL_LABOR_COST = 0: INTERNAL_PARTS_COST = 0: INTERNAL_MATERIALS_COST = 0
        INTERNAL_ACCESSORIES_AMT = 0: INTERNAL_ACCESSORIES_COST = 0

If COMPANY_CODE = "HCE" Then
        Set rsINTERNAL_RO_DET = New ADODB.Recordset
        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '1' AND DETPRC > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND ISNULL(JOBTYPE,0) IN ('GJ','PMS') AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
            rsINTERNAL_RO_DET.MoveFirst
            Do While Not rsINTERNAL_RO_DET.EOF
                If ((N2Str2Zero(rsINTERNAL_RO_DET!DETPRC) > 0) And COMPANY_CODE <> "HMH" And COMPANY_CODE <> "FMC") Or ((N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) > 0) And COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC") Then
                    INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)
                    INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                    If COMPANY_CODE = "HPI" Then
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                        If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Then
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        Else
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        End If
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0

                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            Set rsUEA = New ADODB.Recordset
                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        Else
                            WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If
                End If
                rsINTERNAL_RO_DET.MoveNext
            Loop
                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Then
                Else
                WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DJM" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                End If
                J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_TAX = 0
                J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)

                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            

            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
            Else
                'COST OF SALES
                WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICECHG", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICECHG", "LABOR", "INTERNAL")))
                End If
                J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            End If
            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
            ElseIf INTERNAL_LABOR_COST = 0 And (COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC") Then
            Else
                'INVENTORY
            
            If INTERNAL_LABOR_COST > 0 Then

                WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HCE" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    End If
                End If
                J_DEBIT = 0
                J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    End If
    
        Set rsINTERNAL_RO_DET = New ADODB.Recordset
        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '1' AND DETPRC > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND ISNULL(JOBTYPE,0) IN ('GJ','PMS') AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
            rsINTERNAL_RO_DET.MoveFirst
            Do While Not rsINTERNAL_RO_DET.EOF
                If ((N2Str2Zero(rsINTERNAL_RO_DET!DETPRC) > 0) And COMPANY_CODE <> "HMH" And COMPANY_CODE <> "FMC") Or ((N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) > 0) And COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC") Then
                    INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)
                    INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                    If COMPANY_CODE = "HPI" Then
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                        If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Then
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        Else
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        End If
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0

                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            Set rsUEA = New ADODB.Recordset
                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        Else
                            WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If
                End If
                rsINTERNAL_RO_DET.MoveNext
            Loop
                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Then
                Else
                
                WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABORBP", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABORBP", "INTERNAL")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICECHG", "LABORBP", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICECHG", "LABORBP", "INTERNAL")))
                End If
                J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_TAX = 0
                J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)

                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            

            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
            Else
                'COST OF SALES
                WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABORBP", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABORBP", "INTERNAL")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICECHG", "LABORBP", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICECHG", "LABORBP", "INTERNAL")))
                End If
                J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            End If
            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
            ElseIf INTERNAL_LABOR_COST = 0 And (COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC") Then
            Else
                'INVENTORY
            
            If INTERNAL_LABOR_COST > 0 Then

                WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HCE" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    End If
                End If
                J_DEBIT = 0
                J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    End If
Else
        Set rsINTERNAL_RO_DET = New ADODB.Recordset
        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '1' AND DETPRC > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
            rsINTERNAL_RO_DET.MoveFirst
            Do While Not rsINTERNAL_RO_DET.EOF
                If ((N2Str2Zero(rsINTERNAL_RO_DET!DETPRC) > 0) And COMPANY_CODE <> "HMH" And COMPANY_CODE <> "FMC") Or ((N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) > 0) And COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC") Then
                    INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)
                    INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                    If COMPANY_CODE = "HPI" Then
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                        If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Then
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        Else
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        End If
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0

                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            Set rsUEA = New ADODB.Recordset
                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        Else
                            WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If
                End If
                rsINTERNAL_RO_DET.MoveNext
            Loop
            If COMPANY_CODE = "HCE" Then
                 ''CHECKING FOR BP
                        Set INTERNAL_BP_LABOR_RS = New ADODB.Recordset
                        Set INTERNAL_BP_LABOR_RS = gconDMIS.Execute("Select SUM(DETPRC) AS DETPRC from CSMS_RO_DET WHERE LIVIL = '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE = 'BP' AND REP_OR = '" & CSMIOS_REP_OR & "'")
                        If Not INTERNAL_BP_LABOR_RS.EOF And Not INTERNAL_BP_LABOR_RS.BOF Then
                        INTERNAL_BP_LABOR = Round(N2Str2Zero(INTERNAL_BP_LABOR_RS!DETPRC), 2)
                        End If
                ''END CHECKING FOR BP
                If INTERNAL_BP_LABOR > 0 Then
                            INTERNAL_LABOR_COST = INTERNAL_LABOR_AMT - INTERNAL_BP_LABOR
                            WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            
                                 If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABORBP", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABORBP", "INTERNAL")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICECHG", "LABORBP", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICECHG", "LABORBP", "INTERNAL")))
                                End If
                            J_DEBIT = 0
                            J_CREDIT = Round(INTERNAL_BP_LABOR, 2)
                            ALL_CREDIT = ALL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Then
                Else
                
                WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DJM" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                End If
                J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_TAX = 0
                J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)

                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            

            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
            Else
                'COST OF SALES
                WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            End If
            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCE" Then
            ElseIf INTERNAL_LABOR_COST = 0 And (COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC") Then
            Else
                'INVENTORY
            
            If INTERNAL_LABOR_COST > 0 Then

                WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HCE" Then
                     If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICECHG", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICECHG", "LABOR", "INTERNAL")))
                    End If
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    End If
                End If
                J_DEBIT = 0
                J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    End If
End If

''SUBLET
If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Then
INTERNAL_LABOR_AMT = 0: INTERNAL_LABOR_COST = 0
  Set rsINTERNAL_RO_DET = New ADODB.Recordset
        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE  DETPRC > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ROTYPE = 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
            rsINTERNAL_RO_DET.MoveFirst
            Do While Not rsINTERNAL_RO_DET.EOF
                If N2Str2Zero(rsINTERNAL_RO_DET!DETPRC) > 0 Then
                    INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)
                    INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                    If COMPANY_CODE = "HPI" Then
                    Else
                        WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                        If COMPANY_CODE = "HMH" Then
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        Else
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        End If
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0

                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If
                rsINTERNAL_RO_DET.MoveNext
            Loop

                If COMPANY_CODE = "HMH" Then
                Else
                WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DJM" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                ElseIf COMPANY_CODE = "HCE" Then
                    If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "INTERNAL")))
                    End If
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                End If
                J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_TAX = 0
                J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)

                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            

            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
            Else
                'COST OF SALES
                WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HCE" Then
                    If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLETCHG", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLETCHG", "INTERNAL")))
                    End If
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                End If
                J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            End If
            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
            Else
                'INVENTORY
                WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                End If
                J_DEBIT = 0
                J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
''SUBLET NOT PURELY INTERNAL
Call SUBLETINTERNALINSURANCEHCA
End If
''END SUBLET

        'PARTS
        Set rsINTERNAL_RO_DET = New ADODB.Recordset
        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '2' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR'AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
            rsINTERNAL_RO_DET.MoveFirst
            Do While Not rsINTERNAL_RO_DET.EOF
                If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                    INTERNAL_PARTS_AMT = INTERNAL_PARTS_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                    INTERNAL_PARTS_COST = INTERNAL_PARTS_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))

    
                    If COMPANY_CODE = "HCC" Then
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                        If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Then
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                        Else
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                        End If
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0

                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            Set rsUEA = New ADODB.Recordset
                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        Else
                            WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If

                End If
                rsINTERNAL_RO_DET.MoveNext
            Loop

            If INTERNAL_PARTS_AMT > 0 Then
                If COMPANY_CODE = "HCC" Or COMPANY_CODE = "HMH" Then
                Else
                    WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HCE" Then
                        If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTSCHG", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTSCHG", "INTERNAL")))
                        End If
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                    End If
                    J_GROSS = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                    If CSMIOS_VAT_EXEMPT = True Then
                        J_TAX = 0
                    Else
                        J_TAX = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                    End If
                    J_NET = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(J_NET), 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If

                If COMPANY_CODE = "HCC" Or COMPANY_CODE = "HMH" Then
                Else
                    'COST OF SALES
                    WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HCE" Then
                        If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTSCHG", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTSCHG", "INTERNAL")))
                        End If
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                    End If
                    J_DEBIT = Round(INTERNAL_PARTS_COST, 2)
                    J_CREDIT = 0
                    TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If


                'INVENTORY
                If COMPANY_CODE = "HCC" Then
                Else
                    WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                        ''INVENTORY HCA
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARST-IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARST-IN-PROCESS")))
                    ElseIf COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                    Else
                        If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                        End If
                    End If
                    J_DEBIT = 0
                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Then
                        J_CREDIT = Round(INTERNAL_PARTS_COST, 2)
                    Else
                        J_CREDIT = Round(INTERNAL_PARTS_COST, 2)
                    End If
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If

        End If

        Set rsINTERNAL_RO_DET = New ADODB.Recordset
        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '3' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
            rsINTERNAL_RO_DET.MoveFirst
            Do While Not rsINTERNAL_RO_DET.EOF
                If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                    INTERNAL_MATERIALS_AMT = INTERNAL_MATERIALS_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                    INTERNAL_MATERIALS_COST = INTERNAL_MATERIALS_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                    If COMPANY_CODE = "HCC" Then
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                        If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Then
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                        Else
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                        End If
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0
                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            Set rsUEA = New ADODB.Recordset
                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        Else
                            WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If
                End If
                rsINTERNAL_RO_DET.MoveNext
            Loop

            If INTERNAL_MATERIALS_AMT > 0 Then
                If COMPANY_CODE = "HCC" Or COMPANY_CODE = "HMH" Then
                Else
                   If COMPANY_CODE = "HMH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "INTERNAL")))
                    ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                    ElseIf COMPANY_CODE = "HCE" Then
                        If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS", "INTERNAL")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALSCHG", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALSCHG", "INTERNAL")))
                        End If
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL")))
                    End If
                    J_GROSS = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                    If CSMIOS_VAT_EXEMPT = True Then
                        J_TAX = 0
                    Else
                        J_TAX = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                    End If
                    J_NET = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(J_NET), 2)
                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET CREDIT = CREDIT + " & J_CREDIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    Else
                        WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If

                If COMPANY_CODE = "HCC" Or COMPANY_CODE = "HMH" Then
                Else
                    'COST OF SALES
                    If COMPANY_CODE = "HMH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "INTERNAL")))
                    ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                     ElseIf COMPANY_CODE = "HCE" Then
                        If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS", "INTERNAL")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALSCHG", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALSCHG", "INTERNAL")))
                        End If
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                    End If
                    J_GROSS = 0
                    J_TAX = 0
                    J_NET = 0
                    J_DEBIT = Round(INTERNAL_MATERIALS_COST, 2)
                    J_CREDIT = 0
                    TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    Else
                        WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If


                'INVENTORY
                If COMPANY_CODE = "HCC" Then
                Else
                    WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HMH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM")))
                    ElseIf COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                    End If
                    J_GROSS = 0: J_TAX = 0: J_NET = 0
                    J_DEBIT = 0
                    J_CREDIT = Round(INTERNAL_MATERIALS_COST, 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If

            End If
        End If

            'ACCESSORIES

            Set rsINTERNAL_RO_DET = New ADODB.Recordset
            Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '4' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') and ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                        INTERNAL_ACCESSORIES_AMT = INTERNAL_ACCESSORIES_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_ACCESSORIES_COST = INTERNAL_ACCESSORIES_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                        If COMPANY_CODE = "HPI" Then
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            If COMPANY_CODE = "HMH" Then
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                            Else
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            End If
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                        End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    Else
                        WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                Else
                    WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If

                If INTERNAL_ACCESSORIES_AMT > 0 Then
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                        ElseIf COMPANY_CODE = "HCE" Then
                            If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "INTERNAL")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "INTERNAL")))
                            End If
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL")))
                        End If
                        J_GROSS = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                        If CSMIOS_VAT_EXEMPT = True Then
                            J_TAX = 0
                        Else
                            J_TAX = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                        End If
                        J_NET = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                        J_DEBIT = 0
                        J_CREDIT = Round(NumericVal(J_NET), 2)
                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        Set rsUEA = New ADODB.Recordset
                        Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                            gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET CREDIT = CREDIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        Else
                            WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If

                    
                        'COST OF SALES
                        ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                        ElseIf COMPANY_CODE = "HCE" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "INTERNAL")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                        End If
                        J_GROSS = 0
                        J_TAX = 0
                        J_NET = 0
                        J_DEBIT = Round(INTERNAL_ACCESSORIES_COST, 2)
                        J_CREDIT = 0
                        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                        Set rsUEA = New ADODB.Recordset
                        Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                            gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        Else
                        WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If

                    'INVENTORY
                    WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("AIN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("AIN-PROCESS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES")))
                    End If
                    J_GROSS = 0: J_TAX = 0: J_NET = 0
                    J_DEBIT = 0
                    J_CREDIT = Round(INTERNAL_ACCESSORIES_COST, 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
        End If
        'END OF NOT PURELY INTERNAL RO
End Sub
Sub SUBLET_CUSTOMERINSURANCE()
If INSURANCE_DIRECT_EXPENSE_SR > 0 Then
                                'SALES
        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        If COMPANY_CODE = "DSSC" Then
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "RETAIL"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "RETAIL")))
        ElseIf COMPANY_CODE = "HCE" Then
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLETCSH", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLETCSH", "CUSTOMER")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "CUSTOMER")))
            End If
        ElseIf COMPANY_CODE = "DGI" Then
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "RETAIL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "RETAIL")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "RETAIL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "RETAIL")))
            End If
        Else
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER")))
        End If
        J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SR), 2)
            If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SR), 2)
            Else
                J_NET = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_SR) / 1.12), 2)
            End If
        J_DEBIT = 0
        J_CREDIT = Round(NumericVal(J_NET), 2)
        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        If COMPANY_CODE = "HSM" Then
        Else
            'COST OF SALES
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If COMPANY_CODE = "HCE" Then
                If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLETCSH", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLETCSH", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLETCHG", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLETCHG", "CUSTOMER")))
                    End If
            Else
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET")))
            End If
            J_DEBIT = Round(CSMIOS_SUBLET_COST, 2)
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)

            'INVENTORY
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
            J_DEBIT = 0
            J_CREDIT = Round(CSMIOS_SUBLET_COST, 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
End If
End Sub
Sub BP_INSURANCE()
                    If INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS > 0 Then
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            If CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER")))
                            End If
                            J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR_BP + DISCOUNT_INS_LABOR_BP), 2)
                            If CSMIOS_INVOICE = "PDI RO" Then
                                J_TAX = 0
                                J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR_BP + DISCOUNT_INS_LABOR_BP), 2)
                            Else
                                    If CSMIOS_VAT_EXEMPT = True Then
                                        J_TAX = 0
                                        J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS + DISCOUNT_INS_LABOR_BP), 2)
                                    Else
                                        J_TAX = Round(NumericVal(Round((INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS + DISCOUNT_INS_LABOR_BP / 1.12), 2) * 0.12), 2)
                                        J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS + DISCOUNT_INS_LABOR_BP) / 1.12, 2)
                                    End If
                            End If
                            J_DEBIT = 0
                            J_CREDIT = Round(NumericVal(J_NET), 2)
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                         
                         
                            'COST OF SALES
                            If CSMIOS_TINSPAINT_COST > 0 Then
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER")))
                                    End If
                                    J_DEBIT = Round(CSMIOS_TINSPAINT_COST + CSMIOS_TINSPAINT_COST_PARTS, 2)
                                    J_CREDIT = 0
                                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                             'INVENTORY
                                    ItemCnt = ItemCnt + 1
                                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                                    End If
                                    J_DEBIT = 0
                                    J_CREDIT = Round(CSMIOS_TINSPAINT_COST + CSMIOS_TINSPAINT_COST_PARTS, 2)
                                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                End If
                            End If
End Sub
Sub BP_PARTS()
If CSMIOS_PARTS_BP > 0 Then
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            If COMPANY_CODE = "HCE" Then
                                If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-BP", "CUSTOMER"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-BP", "CUSTOMER")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-BPCHG", "CUSTOMER"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-BPCHG", "CUSTOMER")))
                                End If
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-BP", "CUSTOMER"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-BP", "CUSTOMER")))
                            End If
                            J_GROSS = Round(NumericVal(CSMIOS_PARTS_BP), 2)
                            If COMPANY_CODE = "DGI" Then
                                J_NET = (Round(NumericVal(CSMIOS_PARTS_BP - CSMIOS_PARTS_DISCOUNT) / 1.12, 2))    '+ Round(CSMIOS_LABOR_DISCOUNT / 1.12, 2)
                            Else
                                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                J_NET = Round(NumericVal(CSMIOS_PARTS_BP), 2)
                                Else
                                J_NET = Round(NumericVal(NumericVal(CSMIOS_PARTS_BP) / 1.12), 2)
                                End If
                            End If
                            J_DEBIT = 0
                            J_CREDIT = Round(NumericVal(J_NET), 2)
                            ALL_CREDIT = ALL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            If COMPANY_CODE <> "HNE" Then
                            If (COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR") And INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP > 0 And CSMIOS_PARTICIPAT <> "" Then
                            Else
                            If CSMIOS_PARTS_COST_BP > 0 Then
                            'COST OF SALES
                            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER")))
                                Else
                                    If CSMIOS_TERM = "CSH" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER")))
                                    Else
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-BPCHG", "CUSTOMER"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-BPCHG", "CUSTOMER")))
                                    End If
                                End If
                                    J_DEBIT = Round(CSMIOS_PARTS_COST_BP, 2)
                                    J_CREDIT = 0
                                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)

                                    'INVENTORY
                                    ItemCnt = ItemCnt + 1
                                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                    If COMPANY_CODE = "HMH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                                    Else
                                        If CSMIOS_TERM = "CSH" Then
                                            If COMPANY_CODE = "DGI" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                                            Else
                                                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                                            End If
                                        Else
                                            If COMPANY_CODE = "HBK" Or COMPANY_CODE = "HPI" Or COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Or COMPANY_CODE = "HOT" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                                            Else
                                                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                                            End If
                                        End If
                                    End If
                                    J_DEBIT = 0
                                    J_CREDIT = Round(CSMIOS_PARTS_COST_BP, 2)
                                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                     End If
                                    End If
                                End If
                            End If
End Sub
Sub BP_MATERIALS()
    If CSMIOS_MATERIALS_BP > 0 Then
        ItemCnt = ItemCnt + 1
        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-BP", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-BP", "CUSTOMER")))
        J_GROSS = Round(NumericVal(CSMIOS_MATERIALS_BP), 2)
        If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
             J_NET = Round(NumericVal(CSMIOS_MATERIALS_BP), 2)
        Else
            J_NET = Round(NumericVal(NumericVal(CSMIOS_MATERIALS_BP) / 1.12), 2)
        End If
        J_DEBIT = 0
        J_CREDIT = (Round(NumericVal(J_NET), 2))
        ALL_CREDIT = ALL_CREDIT + J_CREDIT
        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    
        If (COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI") And INSURANCE_DIRECT_EXPENSE_GOL_BP > 0 And CSMIOS_PARTICIPAT <> "" Then
        Else
             'COST OF SALES
             ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-BP", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-BP", "CUSTOMER")))
             J_GROSS = 0: J_TAX = 0: J_NET = 0
             J_DEBIT = Round(CSMIOS_MATERIALS_COST_BP, 2)
             J_CREDIT = 0
             ALL_DEBIT = ALL_DEBIT + J_DEBIT
             Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        
             'INVENTORY
             ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
             If CSMIOS_TERM = "CSH" Then
                If COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Then
                     J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                     J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                 Else
                     J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                     J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                 End If
             Else
                 If COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Then
                     J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                     J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                 Else
                     J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                     J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                 End If
             End If
             J_GROSS = 0: J_TAX = 0: J_NET = 0
             J_DEBIT = 0
             J_CREDIT = Round(CSMIOS_MATERIALS_COST_BP, 2)
             ALL_CREDIT = ALL_CREDIT + J_CREDIT
             Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If
End Sub

Sub PARTSBPINSURANCE()
    If INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP > 0 Then
    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCA" Then
        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-BP", "CUSTOMER"))
        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-BP", "CUSTOMER")))
    Else
    If CSMIOS_TERM = "CSH" Then
    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-BP", "CUSTOMER"))
    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-BP", "CUSTOMER")))
    Else
    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-BPCHG", "CUSTOMER"))
    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-BPCHG", "CUSTOMER")))
    End If
    End If
    J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + DISCOUNT_INS_PARTS_BP), 2)
    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
    J_TAX = 0
    Else
    J_TAX = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + DISCOUNT_INS_PARTS_BP) / 1.12 * 0.12, 2)
    End If
    J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + DISCOUNT_INS_PARTS_BP) - Round(NumericVal(J_TAX), 2), 2)
    J_DEBIT = 0
    J_CREDIT = Round(NumericVal(J_NET), 2)
    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
    Else
        'COST OF SALES
        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        If COMPANY_CODE = "HMH" Then
            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER")))
        Else
        If CSMIOS_TERM = "CSH" Then
            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER")))
        Else
            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-BPCHG", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-BPCHG", "CUSTOMER")))
        End If
        End If
        J_DEBIT = Round(CSMIOS_PARTS_COST_BP, 2)
        J_CREDIT = 0
        ALL_DEBIT = ALL_DEBIT + J_DEBIT
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        
        'INVENTORY
        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
        J_DEBIT = 0
        J_CREDIT = Round(CSMIOS_PARTS_COST_BP, 2)
        ALL_CREDIT = ALL_CREDIT + J_CREDIT
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If
End Sub
Sub MATERIALSBPINSURANCE()
If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCC" Or COMPANY_CODE = "HCA" Then
Else
                            If INSURANCE_DIRECT_EXPENSE_GOL_BP > 0 Then
                                Dim SHOPSUP                 As Double
                                Dim SHOPSUP_TAX             As Double
                                Dim SHOPSUP_NET             As Double

                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HMR" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-BP", "CUSTOMER"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-BP", "CUSTOMER")))
                            Else
                                If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "RETAIL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "RETAIL")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "RETAIL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "RETAIL")))
                                End If
                            End If
                                J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_GOL_BP), 2)
                                SHOPSUP = Round(ReturnShopSuplies(CSMIOS_REP_OR), 2)
                                SHOPSUP_TAX = Round(NumericVal(Round((SHOPSUP / 1.12), 2) * 0.12), 2)
                                SHOPSUP_NET = Round(NumericVal(SHOPSUP) - Round(NumericVal(SHOPSUP_TAX), 2), 2)
                                If CSMIOS_INVOICE = "PDI RO" Then
                                    J_TAX = 0
                                    J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_GOL_BP), 2) - SHOPSUP_NET
                                Else
                                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                        J_TAX = 0
                                        J_NET = (Round(NumericVal(INSURANCE_DIRECT_EXPENSE_GOL_BP), 2)) - SHOPSUP_NET
                                    Else
                                        J_TAX = Round(NumericVal(Round((INSURANCE_DIRECT_EXPENSE_GOL_BP / 1.12), 2) * 0.12), 2) - SHOPSUP_TAX
                                        If COMPANY_CODE = "DGI" Then
                                            J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_GOL_BP - CSMIOS_MATERIALS_DISCOUNT) / 1.12, 2) - SHOPSUP_NET
                                        Else
                                            J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_GOL_BP) - Round(NumericVal(J_TAX), 2), 2) - SHOPSUP_NET
                                        End If
                                    End If
                                End If
                                J_DEBIT = 0
                                J_CREDIT = (Round(NumericVal(J_NET), 2)) - SHOPSUP_TAX
                                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                               If CSMIOS_MATERIALS_COST_BP > 0 Then

                                    'COST OF SALES
                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HMR" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-BP", "CUSTOMER"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-BP", "CUSTOMER")))
                                    Else
                                        If CSMIOS_TERM = "CSH" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                                        End If
                                    End If
                                    J_GROSS = 0: J_TAX = 0: J_NET = 0
                                    J_DEBIT = Round(CSMIOS_MATERIALS_COST_BP, 2)
                                    J_CREDIT = 0
                                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    'INVENTORY
                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    If CSMIOS_TERM = "CSH" Then
                                       If COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HMR" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                                        End If
                                    Else
                                        If COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                                        End If
                                    End If
                                    J_GROSS = 0: J_TAX = 0: J_NET = 0
                                    J_DEBIT = 0
                                    J_CREDIT = Round(CSMIOS_MATERIALS_COST_BP, 2)
                                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                     Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    End If
                                End If
                            End If
End Sub

Sub LABOR_DISCOUNT()
''GJ DISCOUNT----------------------------------------------------------------------
                        If CSMIOS_LABOR_DISCOUNT + CSMIOS_PMS_DISCOUNT > 0 Then
                                'DISCOUNT
                                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABOR-GJ"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABOR-GJ")))
                                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                         J_NET = Round(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_PMS_DISCOUNT), 2)
                                    Else
                                        J_NET = Round(NumericVal(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_PMS_DISCOUNT) / 1.12), 2)
                                    End If
                                J_DEBIT = Round(NumericVal(J_NET), 2)
                                J_CREDIT = 0
                                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
''END GJ DISCOUNT----------------------------------------------------------------------

''  BP DISCOUNT----------------------------------------------------------------------
                        If CSMIOS_TINSPAINT_DISCOUNT > 0 Then
                                'DISCOUNT
                                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABOR-BP"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABOR-BP")))
                                If CSMIOS_INVOICE = "PDI RO" Then
                                    J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_TINSPAINT_DISCOUNT), 2)
                                Else
                                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                        J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_TINSPAINT_DISCOUNT), 2)
                                    Else
                                        J_TAX = Round(Round(((CSMIOS_TINSPAINT_DISCOUNT) / 1.12), 2) * 0.12, 2)
                                        J_NET = Round(NumericVal((CSMIOS_TINSPAINT_DISCOUNT)) - Round(NumericVal(J_TAX), 2), 2)
                                    End If
                                End If
                                J_DEBIT = Round(NumericVal(J_NET), 2)
                                J_CREDIT = 0
                                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
''END BP DISCOUNT----------------------------------------------------------------------

'' SUBLET DISCOUNT----------------------------------------------------------------------
                                If CSMIOS_SUBLET_DISCOUNT > 0 Then
                                'DISCOUNT
                                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "SUBLET"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "SUBLET")))
                                If CSMIOS_INVOICE = "PDI RO" Then
                                    J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_SUBLET_DISCOUNT), 2)
                                Else
                                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                        J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_SUBLET_DISCOUNT), 2)
                                    Else
                                        J_TAX = Round(Round(((CSMIOS_SUBLET_DISCOUNT) / 1.12), 2) * 0.12, 2)
                                        J_NET = Round(NumericVal((CSMIOS_SUBLET_DISCOUNT)) - Round(NumericVal(J_TAX), 2), 2)
                                    End If
                                End If
                                J_DEBIT = Round(NumericVal(J_NET), 2)
                                J_CREDIT = 0
                                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
'' END SUBLET DISCOUNT----------------------------------------------------------------------



End Sub

Sub DOTAX_SERVICE()
    Dim xVOUCHERNO                                          As String
    Dim xJdate                                              As String
    Dim xDUEDATE                                            As String
    Dim xJType                                              As String
    Dim XCustomerCode                                       As String
    Dim xREFCUSTOMERCODE                                    As String
    Dim xCUST_NAME                                          As String
    Dim xInvoiceNo                                          As String
    Dim xInvoiceType                                        As String
    Dim xInvoicedate                                        As String
    Dim xAMOUNT_TO_PAY                                      As Double
    Dim xAMOUNT_PAID                                        As Double
    Dim xACCT_CODE                                          As String
    Dim xLAST_UPDATED                                       As String
    Dim xENTITYCODE                                         As String
    Dim xID                                                 As String
    Dim xBAL                                                As Double
    
    xBAL = 0
    xAMOUNT_PAID = 0
    xAMOUNT_TO_PAY = 0
    Set DOTAX_SERVICE1 = New ADODB.Recordset
    Set DOTAX_SERVICE1 = gconDMIS.Execute("Select* from amis_chartaccount Where ACCTCODE = " & J_ACCT_CODE & " AND TRANTYPE1 = 'DEFERRED OUTPUT TAX' AND IS_SCHEDULE_ACCNT = 1  ")
    
    If Not DOTAX_SERVICE1.EOF And Not DOTAX_SERVICE1.BOF Then
        xJType = "SJ"
        xID = N2Str2IntZero(gconDMIS.Execute("SELECT ID FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE = " & J_ACCT_CODE & "").Fields(0).Value)
        xENTITYCODE = N2Str2Null("C")
        xREFCUSTOMERCODE = N2Str2Null(Null2String("C" & J_CUSTOMERCODE))
        XCustomerCode = N2Str2Null(J_CUSTOMERCODE)
        xCUST_NAME = N2Str2Null(gconDMIS.Execute("SELECT ACCTNAME FROM ALL_Customer_Table WHERE CUSCDE = " & J_CUSTOMERCODE & "").Fields(0).Value)
        xInvoiceNo = N2Str2Null(J_INVOICENO)
        xInvoiceType = N2Str2Null("SI")
        xInvoicedate = N2Str2Null(J_JDATE)
        xAMOUNT_TO_PAY = N2Str2Zero(J_CREDIT)
        xAMOUNT_PAID = N2Str2Zero(J_CREDIT)
        xBAL = Round((xAMOUNT_TO_PAY - xAMOUNT_PAID), 2)
        xACCT_CODE = N2Str2Null(J_ACCT_CODE)
        xLAST_UPDATED = N2Str2Null(J_JDATE)
        xDUEDATE = N2Str2Null(J_JDATE)
        xJdate = N2Str2Null(J_JDATE)
        xVOUCHERNO = N2Str2Null(Null2String(xJType) & "-" & Null2String(J_VOUCHERNO))
        SQL_STATEMENT = "INSERT INTO AMIS_AP(VOUCHERNO,INVOICETYPE,INVOICENO,VENDOR_CODE,VENDOR_NAME,AMOUNT2PAY,AMOUNTPAID,BALANCE,ACCT_CODE,INVOICEDATE,LASTUPDATED,JDATE,DUEDATE,REFCODE,ENTITYCODE,journal_det_id) " & _
        "VALUES(" & xVOUCHERNO & "," & xInvoiceType & "," & xInvoiceNo & "," & XCustomerCode & "," & xCUST_NAME & "," & xAMOUNT_TO_PAY & "," & xAMOUNT_PAID & "," & xBAL & "," & xACCT_CODE & "," & xInvoicedate & "," & xLAST_UPDATED & "," & xJdate & "," & xDUEDATE & "," & xREFCUSTOMERCODE & "," & xENTITYCODE & "," & xID & ")"
        gconDMIS.Execute SQL_STATEMENT
    End If
End Sub
Sub DOTAX_INS()
    Dim xVOUCHERNO                                          As String
    Dim xJdate                                              As String
    Dim xDUEDATE                                            As String
    Dim xJType                                              As String
    Dim XCustomerCode                                       As String
    Dim xREFCUSTOMERCODE                                    As String
    Dim xCUST_NAME                                          As String
    Dim xInvoiceNo                                          As String
    Dim xInvoiceType                                        As String
    Dim xInvoicedate                                        As String
    Dim xAMOUNT_TO_PAY                                      As Double
    Dim xAMOUNT_PAID                                        As Double
    Dim xACCT_CODE                                          As String
    Dim xLAST_UPDATED                                       As String
    Dim xENTITYCODE                                         As String
    Dim xID                                                 As String
    Dim xBAL                                                As Double
    
    xBAL = 0
    xAMOUNT_PAID = 0
    xAMOUNT_TO_PAY = 0
    Set DOTAX_SERVICE1 = New ADODB.Recordset
    Set DOTAX_SERVICE1 = gconDMIS.Execute("Select* from amis_chartaccount Where ACCTCODE = " & J_ACCT_CODE & " AND TRANTYPE1 = 'DEFERRED OUTPUT TAX' AND IS_SCHEDULE_ACCNT = 1  ")
    
    If Not DOTAX_SERVICE1.EOF And Not DOTAX_SERVICE1.BOF Then
        xJType = "SJ"
        xID = N2Str2IntZero(gconDMIS.Execute("SELECT ID FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE = " & J_ACCT_CODE & "").Fields(0).Value)
        xENTITYCODE = N2Str2Null("C")
        xREFCUSTOMERCODE = N2Str2Null(Null2String("C" & CSMIOS_PARTICIPAT))
        XCustomerCode = N2Str2Null(CSMIOS_PARTICIPAT)
        xCUST_NAME = N2Str2Null(gconDMIS.Execute("SELECT ACCTNAME FROM ALL_Customer_Table WHERE CUSCDE = '" & CSMIOS_PARTICIPAT & "'").Fields(0).Value)
        xInvoiceNo = N2Str2Null(J_INVOICENO)
        xInvoiceType = N2Str2Null("SI")
        xInvoicedate = N2Str2Null(J_JDATE)
        xAMOUNT_TO_PAY = N2Str2Zero(J_CREDIT)
        xAMOUNT_PAID = N2Str2Zero(J_CREDIT)
        xBAL = Round((xAMOUNT_TO_PAY - xAMOUNT_PAID), 2)
        xACCT_CODE = N2Str2Null(J_ACCT_CODE)
        xLAST_UPDATED = N2Str2Null(J_JDATE)
        xDUEDATE = N2Str2Null(J_JDATE)
        xJdate = N2Str2Null(J_JDATE)
        xVOUCHERNO = N2Str2Null(Null2String(xJType) & "-" & Null2String(WARRANTY_VOUCHERNO))
        SQL_STATEMENT = "INSERT INTO AMIS_AP(VOUCHERNO,INVOICETYPE,INVOICENO,VENDOR_CODE,VENDOR_NAME,AMOUNT2PAY,AMOUNTPAID,BALANCE,ACCT_CODE,INVOICEDATE,LASTUPDATED,JDATE,DUEDATE,REFCODE,ENTITYCODE,journal_det_id) " & _
        "VALUES(" & xVOUCHERNO & "," & xInvoiceType & "," & xInvoiceNo & "," & XCustomerCode & "," & xCUST_NAME & "," & xAMOUNT_TO_PAY & "," & xAMOUNT_PAID & "," & xBAL & "," & xACCT_CODE & "," & xInvoicedate & "," & xLAST_UPDATED & "," & xJdate & "," & xDUEDATE & "," & xREFCUSTOMERCODE & "," & xENTITYCODE & "," & xID & ")"
        gconDMIS.Execute SQL_STATEMENT
    End If
End Sub


Sub HCE_DISCOUNT()
'DISCOUNT
If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
    If DISCOUNT_INS_LABOR_GJ + DISCOUNT_INS_LABOR_BP + DISCOUNT_INS_SUBLET > 0 Then
        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        If CSMIOS_TERM = "CSH" Then
            J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABOR"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABOR")))
        Else
            J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABORCHG"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABORCHG")))
        End If
        If CSMIOS_VAT_EXEMPT = True Then
            J_TAX = 0: J_NET = Round(NumericVal(DISCOUNT_INS_LABOR_GJ + DISCOUNT_INS_LABOR_BP + DISCOUNT_INS_SUBLET), 2)
        Else
            J_TAX = Round(NumericVal(Round((NumericVal(DISCOUNT_INS_LABOR_GJ + DISCOUNT_INS_LABOR_BP) / 1.12), 2) * 0.12), 2)
            J_NET = Round(NumericVal(NumericVal(DISCOUNT_INS_LABOR_GJ + DISCOUNT_INS_LABOR_BP + DISCOUNT_INS_SUBLET) / 1.12), 2)
        End If
        J_DEBIT = NumericVal(J_NET)
        J_CREDIT = 0
        ALL_DEBIT = ALL_DEBIT + J_DEBIT
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    End If
    
     If DISCOUNT_INS_PARTS_GJ + DISCOUNT_INS_PARTS_BP + DISCOUNT_INS_MATERIALS + DISCOUNT_INS_ACCESSORIES > 0 Then
        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        If CSMIOS_TERM = "CSH" Then
            J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "PARTS"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "PARTS")))
        Else
            J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTSCHG", "PARTS"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTSCHG", "PARTS")))
        End If
        If CSMIOS_VAT_EXEMPT = True Then
            J_TAX = 0: J_NET = Round(NumericVal(DISCOUNT_INS_PARTS_GJ + DISCOUNT_INS_PARTS_BP), 2)
        Else
            J_TAX = Round(NumericVal(Round((NumericVal(DISCOUNT_INS_PARTS_GJ + DISCOUNT_INS_PARTS_BP) / 1.12), 2) * 0.12), 2)
            J_NET = Round(NumericVal(NumericVal(DISCOUNT_INS_PARTS_GJ + DISCOUNT_INS_PARTS_BP + DISCOUNT_INS_MATERIALS + DISCOUNT_INS_ACCESSORIES) / 1.12), 2)
        End If
        J_DEBIT = NumericVal(J_NET)
        J_CREDIT = 0
        ALL_DEBIT = ALL_DEBIT + J_DEBIT
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    End If
Else
    If DISCOUNT_INS_LABOR_GJ + DISCOUNT_INS_LABOR_BP > 0 Then
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABOR"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABOR")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABORCHG"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABORCHG")))
                                End If
                                If CSMIOS_VAT_EXEMPT = True Then
                                    J_TAX = 0: J_NET = Round(NumericVal(DISCOUNT_INS_LABOR_GJ + DISCOUNT_INS_LABOR_BP), 2)
                                Else
                                    J_TAX = Round(NumericVal(Round((NumericVal(DISCOUNT_INS_LABOR_GJ + DISCOUNT_INS_LABOR_BP) / 1.12), 2) * 0.12), 2)
                                    J_NET = Round(NumericVal(DISCOUNT_INS_LABOR_GJ + DISCOUNT_INS_LABOR_BP) - Round(NumericVal(J_TAX), 2), 2)
                                End If
                                J_DEBIT = NumericVal(J_NET)
                                J_CREDIT = 0
                                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    End If
    
    If DISCOUNT_INS_PARTS_GJ + DISCOUNT_INS_PARTS_BP > 0 Then
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "PARTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "PARTS")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTSCHG", "PARTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTSCHG", "PARTS")))
                                End If
                                If CSMIOS_VAT_EXEMPT = True Then
                                    J_TAX = 0: J_NET = Round(NumericVal(DISCOUNT_INS_PARTS_GJ + DISCOUNT_INS_PARTS_BP), 2)
                                Else
                                    J_TAX = Round(NumericVal(Round((NumericVal(DISCOUNT_INS_PARTS_GJ + DISCOUNT_INS_PARTS_BP) / 1.12), 2) * 0.12), 2)
                                    J_NET = Round(NumericVal(DISCOUNT_INS_PARTS_GJ + DISCOUNT_INS_PARTS_BP) - Round(NumericVal(J_TAX), 2), 2)
                                End If
                                J_DEBIT = NumericVal(J_NET)
                                J_CREDIT = 0
                                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    End If
    
    
    If DISCOUNT_INS_MATERIALS > 0 Then
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "PARTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "PARTS")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "PARTSCHG"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "PARTSCHG")))
                                End If
                                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                    J_TAX = 0: J_NET = Round(NumericVal(DISCOUNT_INS_MATERIALS), 2)
                                Else
                                    J_TAX = Round(NumericVal(Round((NumericVal(DISCOUNT_INS_MATERIALS) / 1.12), 2) * 0.12), 2)
                                    J_NET = Round(NumericVal(DISCOUNT_INS_MATERIALS) - Round(NumericVal(J_TAX), 2), 2)
                                End If
                                J_DEBIT = NumericVal(J_NET)
                                J_CREDIT = 0
                                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    End If
    
    'If DISCOUNT_INS_SUBLET > 0 Then
    '                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
    '                            If CSMIOS_TERM = "CSH" Then
    '                                J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "PARTS"))
    '                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "PARTS")))
    '                            Else
    '                                J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "PARTSCHG"))
    '                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "PARTSCHG")))
    '                            End If
    '                            If CSMIOS_VAT_EXEMPT = True Then
    '                                J_TAX = 0: J_NET = Round(NumericVal(DISCOUNT_INS_SUBLET), 2)
    '                            Else
    '                                J_TAX = Round(NumericVal(Round((NumericVal(DISCOUNT_INS_SUBLET) / 1.12), 2) * 0.12), 2)
    '                                J_NET = Round(NumericVal(DISCOUNT_INS_SUBLET) - Round(NumericVal(J_TAX), 2), 2)
    '                            End If
    '                            J_DEBIT = NumericVal(J_NET)
    '                            J_CREDIT = 0
    '                            ALL_DEBIT = ALL_DEBIT + J_DEBIT
    '                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    'End If
    
    If DISCOUNT_INS_ACCESSORIES > 0 Then
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "PARTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "PARTS")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTSCHG", "PARTSCHG"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTSCHG", "PARTSCHG")))
                                End If
                                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                    J_TAX = 0: J_NET = Round(NumericVal(DISCOUNT_INS_ACCESSORIES), 2)
                                Else
                                    J_TAX = Round(NumericVal(Round((NumericVal(DISCOUNT_INS_ACCESSORIES) / 1.12), 2) * 0.12), 2)
                                    J_NET = Round(NumericVal(DISCOUNT_INS_ACCESSORIES) - Round(NumericVal(J_TAX), 2), 2)
                                End If
                                J_DEBIT = NumericVal(J_NET)
                                J_CREDIT = 0
                                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    End If
End If
End Sub
Sub PartsMaterialAccessories()
If INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_PARTS_HARI + INSURANCE_PARTS_NONHARI > 0 Then
        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS")))
        J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + DISCOUNT_INS_PARTS_GJ), 2)
        If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT = True Then
            J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + DISCOUNT_INS_PARTS_GJ), 2)
        Else
            J_NET = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + DISCOUNT_INS_PARTS_GJ) / 1.12), 2)
    
        End If
        J_DEBIT = 0
        J_CREDIT = Round(NumericVal(J_NET), 2)
        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    
        If CSMIOS_PARTS_COST + CSMIOS_MATERIALS_COST + CSMIOS_ACCESSORIES_COST > 0 Then
            'COST OF SALES
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
            J_DEBIT = Round(CSMIOS_PARTS_COST + CSMIOS_MATERIALS_COST + CSMIOS_ACCESSORIES_COST, 2)
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            'INVENTORY
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
            J_DEBIT = 0
            J_CREDIT = Round(CSMIOS_PARTS_COST + CSMIOS_MATERIALS_COST + CSMIOS_ACCESSORIES_COST, 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If
End Sub
Sub PARTSWARRANTY()
        'PARTS
    If WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL > 0 Then
        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        If COMPANY_CODE = "HGS" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "CUSTOMER")))
        Else
            If Left(CSMIOS_INVOICE, 6) = "INT RO" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "CUSTOMER")))
            End If
        End If
        J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS), 2)
        If (CSMIOS_VAT_EXEMPT = True) Or (CSMIOS_VAT_EXEMPT1 = True) Or (Left(CSMIOS_INVOICE, 6) = "INT RO") Then
            J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL), 2)
        Else
            J_NET = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL) / 1.12), 2)
        End If
        J_DEBIT = 0
        J_CREDIT = Round(NumericVal(J_NET), 2)
        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    If WARRANTY_CSMIOS_PARTS_COST + WARRANTY_CSMIOS_MATERIALS_COST = 0 Then
    Else
        'COST OF SALES
        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        If Left(CSMIOS_INVOICE, 6) = "INT RO" Then
            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
        'SJR 082014
        ElseIf COMPANY_CODE = "HGS" Then
            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
        Else
            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "CUSTOMER")))
        End If
        J_DEBIT = Round(WARRANTY_CSMIOS_PARTS_COST + WARRANTY_CSMIOS_MATERIALS_COST, 2)
        J_CREDIT = 0
        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        
        'INVENTORY
        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        'SJR 082014
        If COMPANY_CODE = "HGS" Then
            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS-IN-PROCESS"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS-IN-PROCESS")))
        Else
            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
        End If
        J_DEBIT = 0
        J_CREDIT = Round(WARRANTY_CSMIOS_PARTS_COST + WARRANTY_CSMIOS_MATERIALS_COST, 2)
        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    End If
End If
End Sub
Sub PartsInternal()
'PARTS
Set rsINTERNAL_RO_DET = New ADODB.Recordset
Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL IN ('2','3','4') AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND REP_OR = '" & CSMIOS_REP_OR & "'")
If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
rsINTERNAL_RO_DET.MoveFirst
Do While Not rsINTERNAL_RO_DET.EOF
   If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
           INTERNAL_PARTS_AMT = INTERNAL_PARTS_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
           INTERNAL_PARTS_COST = INTERNAL_PARTS_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
               WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
               WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
               J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
               J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
               If COMPANY_CODE = "HMH" Then
               J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
               J_TAX = 0
               J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
               Else
               J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
               J_TAX = 0
               J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
               'J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
               End If
               J_DEBIT = Round(NumericVal(J_NET), 2)
               J_CREDIT = 0
               TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
               SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                               "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                               " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                               ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                               ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
               gconDMIS.Execute SQL_STATEMENT
               TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
               NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
       End If
       rsINTERNAL_RO_DET.MoveNext
    Loop
    If INTERNAL_PARTS_AMT > 0 Then
           WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
           WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
          If COMPANY_CODE = "HMH" Then
               J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "INTERNAL"))
               J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "INTERNAL")))
           Else
               J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
               J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
           End If
           J_GROSS = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
           If CSMIOS_VAT_EXEMPT = True Then
               J_TAX = 0
           Else
               J_TAX = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
           End If
           J_NET = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
           J_DEBIT = 0
           J_CREDIT = Round(NumericVal(J_NET), 2)
           TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
           SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                           "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                           " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                           ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                           ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
           gconDMIS.Execute SQL_STATEMENT
           TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
           NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
     End If
    
    If INTERNAL_PARTS_COST > 0 Then
        'COST OF SALES
        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
        J_DEBIT = Round(INTERNAL_PARTS_COST, 2)
        J_CREDIT = 0
        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    
       'INVENTORY
       WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
       WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
       J_DEBIT = 0
       J_CREDIT = Round(INTERNAL_PARTS_COST, 2)
       TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
       Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    End If
End If
End Sub
Sub DOTSERVICEPARTS()
If COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMR" Then
    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"

    J_ACCT_CODE = N2Str2Null(ReturnDeferredOutPutTax())
    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDeferredOutPutTax()))
    
    J_CREDIT = Round(NumericVal(NumericVal(NumericVal(J_INVOICEAMT)) / 1.12 * 0.12), 2)
    ALL_CREDIT = ALL_CREDIT + J_CREDIT
    J_TAX = 0: J_GROSS = 0: J_NET = 0: J_DEBIT = 0
    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    Call DOTAX_SERVICE
Else
    If Round(NumericVal(NumericVal(NumericVal(CSMIOS_TINSPAINT + CSMIOS_SUBLET + CSMIOS_LABOR) - NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT)) / 1.12 * 0.12), 2) > 0 Then
        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
        J_ACCT_CODE = N2Str2Null(ReturnAccountCode("DOTSERVICE"))
        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("DOTSERVICE")))
        J_DEBIT = 0
        J_CREDIT = Round(NumericVal(NumericVal(NumericVal(CSMIOS_TINSPAINT + CSMIOS_SUBLET + CSMIOS_LABOR) - NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT)) / 1.12 * 0.12), 2)
        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        ''INSERT AMIS_AP
        Set rsDOTCIS = New ADODB.Recordset
        Set rsDOTCIS = gconDMIS.Execute("SELECT * FROM AMIS_CHARTACCOUNT WHERE AcctCode = " & J_ACCT_CODE & " AND IS_SCHEDULE_ACCNT =1 AND TRANTYPE1 = 'DOTSERVICE'")
        If Not rsDOTCIS.EOF And Not rsDOTCIS.BOF Then
            xIDDOTAX = (gconDMIS.Execute("SELECT ID FROM AMIS_JOURNAL_DET WHERE JTYPE =" & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE = " & J_ACCT_CODE & "").Fields(0).Value)
            xCNAME = (gconDMIS.Execute("select ACCOUNTNAME from ALL_ENTITY   WHERE ENTITYCODE = 'C' AND CODE = " & J_CUSTOMERCODE & "").Fields(0).Value)
            SQL_STATEMENT = "INSERT INTO AMIS_AP (Voucherno,Vendor_code,VENDOR_NAME,invoicedate,Amount2pay,AmountPaid,Balance,Acct_code,LastUpdated,INVOICENO,INVOICETYPE,JDATE,MODIFIED_DATE,REFCODE,ENTITYCODE,STATUS,JOURNAL_DET_ID) " & _
                            " values ('" & "SJ" + "-" + GetVoucherNo & "', " & J_CUSTOMERCODE & ", '" & xCNAME & "', " & J_INVOICEDATE & "," & J_CREDIT & ",'0'," & J_CREDIT & "," & J_ACCT_CODE & "," & J_JDATE & ", " & J_INVOICENO & ", " & J_INVOICETYPE & "," & J_JDATE & "," & J_JDATE & ",'" & "C" + CSMIOS_ACCT_NO & "','C','N'," & xIDDOTAX & ")"
            gconDMIS.Execute SQL_STATEMENT
        End If
        ''--------------------------------------
        ALL_CREDIT = ALL_CREDIT + J_CREDIT
        J_TAX = 0: J_GROSS = 0: J_NET = 0: J_DEBIT = 0: J_CREDIT = 0: xIDDOTAX = "": xCNAME = ""
    End If
    
    If Round(NumericVal(NumericVal(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES + CSMIOS_TINSPAINT_DISCOUNT_PARTS) - NumericVal(CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT)) / 1.12 * 0.12), 2) > 0 Then
        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
        J_ACCT_CODE = N2Str2Null(ReturnAccountCode("DOTPARTS"))
        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("DOTPARTS")))
        J_DEBIT = 0
        J_CREDIT = Round(NumericVal(NumericVal(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES + CSMIOS_TINSPAINT_COST_PARTS) - NumericVal(CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT + CSMIOS_TINSPAINT_COST_PARTS)) / 1.12 * 0.12), 2)
        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        ''INSERT AMIS_AP
        Set rsDOTCIS = New ADODB.Recordset
        Set rsDOTCIS = gconDMIS.Execute("SELECT * FROM AMIS_CHARTACCOUNT WHERE AcctCode = " & J_ACCT_CODE & " AND IS_SCHEDULE_ACCNT =1 AND TRANTYPE1 = 'DOTPARTS'")
        If Not rsDOTCIS.EOF And Not rsDOTCIS.BOF Then
            xIDDOTAX = (gconDMIS.Execute("SELECT ID FROM AMIS_JOURNAL_DET WHERE JTYPE =" & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE = " & J_ACCT_CODE & "").Fields(0).Value)
            xCNAME = (gconDMIS.Execute("select ACCOUNTNAME from ALL_ENTITY   WHERE ENTITYCODE = 'C' AND CODE = " & J_CUSTOMERCODE & "").Fields(0).Value)
            SQL_STATEMENT = "INSERT INTO AMIS_AP (Voucherno,Vendor_code,VENDOR_NAME,invoicedate,Amount2pay,AmountPaid,Balance,Acct_code,LastUpdated,INVOICENO,INVOICETYPE,JDATE,MODIFIED_DATE,REFCODE,ENTITYCODE,STATUS,JOURNAL_DET_ID) " & _
                            " values ('" & "SJ" + "-" + GetVoucherNo & "', " & J_CUSTOMERCODE & ", '" & xCNAME & "', " & J_INVOICEDATE & "," & J_CREDIT & ",'0'," & J_CREDIT & "," & J_ACCT_CODE & "," & J_JDATE & ", " & J_INVOICENO & ", " & J_INVOICETYPE & "," & J_JDATE & "," & J_JDATE & ",'" & "C" + CSMIOS_ACCT_NO & "','C','N'," & xIDDOTAX & ")"
            gconDMIS.Execute SQL_STATEMENT
        End If
        ''--------------------------------------
        ALL_CREDIT = ALL_CREDIT + J_CREDIT
        J_TAX = 0: J_GROSS = 0: J_NET = 0: J_DEBIT = 0: J_CREDIT = 0: xIDDOTAX = "": xCNAME = ""
    End If
End If
End Sub
Sub ARSERVICEPARTS()
    If Round(NumericVal(NumericVal(CSMIOS_TINSPAINT + CSMIOS_SUBLET + CSMIOS_LABOR) - NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT)), 2) > 0 Then
        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
        J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("SERVICE"))
        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("SERVICE")))
        J_DEBIT = Round(NumericVal(NumericVal(CSMIOS_TINSPAINT + CSMIOS_SUBLET + CSMIOS_LABOR) - NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT)), 2)
        J_CREDIT = 0: J_TAX = 0: J_GROSS = 0: J_NET = 0
        ALL_DEBIT = ALL_DEBIT + J_DEBIT
        ALL_CREDIT = ALL_CREDIT + J_CREDIT
        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        J_TAX = 0: J_GROSS = 0: J_NET = 0: J_DEBIT = 0: J_CREDIT = 0
    End If
    
    If Round(NumericVal(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES) - NumericVal(CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT)), 2) > 0 Then
        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
        J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("PARTS"))
        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("PARTS")))
        J_DEBIT = Round(NumericVal(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES) - NumericVal(CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT)), 2)
        J_CREDIT = 0: J_TAX = 0: J_GROSS = 0: J_NET = 0
        ALL_DEBIT = ALL_DEBIT + J_DEBIT
        ALL_CREDIT = ALL_CREDIT + J_CREDIT
        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        J_TAX = 0: J_GROSS = 0: J_NET = 0: J_DEBIT = 0: J_CREDIT = 0
    End If
End Sub

Sub rod()
If COMPANY_CODE = "HCE" Then
     Dim DES_FB As New ADODB.Recordset
     Dim FB_DES As Double
     Dim ACCT_ADJ As New ADODB.Recordset
     Dim ADJ_ACCT As String
     ADJ_ACCT = ""
     FB_DES = 0
     Set DES_FB = New ADODB.Recordset
     Set DES_FB = gconDMIS.Execute("SELECT SUM(ISNULL(DEBIT,0)) -  SUM(ISNULL(CREDIT,0)) AS DESCREPANCY FROM AMIS_JOURNAL_DET WHERE VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND JTYPE = 'SJ'")
     If Not DES_FB.EOF And Not DES_FB.BOF Then
     FB_DES = Round(N2Str2Zero(DES_FB!DESCREPANCY), 2)
     End If
     Set ACCT_ADJ = New ADODB.Recordset
     Set ACCT_ADJ = gconDMIS.Execute("SELECT TOP 1 ACCT_CODE AS ACCTCODE FROM AMIS_JOURNAL_DET A INNER JOIN AMIS_CHARTACCOUNT B ON A.ACCT_CODE = B.ACCTCODE WHERE A.VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND A.JTYPE = 'SJ' AND B.TRANTYPE3 = 'DISCOUNT'")
     If Not ACCT_ADJ.EOF And Not ACCT_ADJ.BOF Then
     ADJ_ACCT = (ACCT_ADJ!AcctCode)
     End If
     If FB_DES = 0.01 Then
     gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT - 0.01 WHERE VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND JTYPE = 'SJ' AND ACCT_CODE = '" & ADJ_ACCT & "'")
     ElseIf FB_DES = -0.01 Then
     gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + 0.01 WHERE VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND JTYPE = 'SJ' AND ACCT_CODE = '" & ADJ_ACCT & "'")
     Else
     End If

ElseIf COMPANY_CODE = "DAI" Then
     Dim DES_FB2 As New ADODB.Recordset
     Dim FB_DES2 As Double
     Dim ACCT_ADJ2 As New ADODB.Recordset
     Dim ADJ_ACCT2 As String
     ADJ_ACCT2 = ""
     FB_DES2 = 0
     Set DES_FB2 = New ADODB.Recordset
     Set DES_FB2 = gconDMIS.Execute("SELECT SUM(ISNULL(DEBIT,0)) -  SUM(ISNULL(CREDIT,0)) AS DESCREPANCY FROM AMIS_JOURNAL_DET WHERE VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND JTYPE = 'SJ'")
     If Not DES_FB2.EOF And Not DES_FB2.BOF Then
     FB_DES2 = Round(N2Str2Zero(DES_FB2!DESCREPANCY), 2)
     End If
     Set ACCT_ADJ2 = New ADODB.Recordset
     Set ACCT_ADJ2 = gconDMIS.Execute("SELECT TOP 1 ACCT_CODE AS ACCTCODE FROM AMIS_JOURNAL_DET A INNER JOIN AMIS_CHARTACCOUNT B ON A.ACCT_CODE = B.ACCTCODE WHERE A.VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND A.JTYPE = 'SJ' AND B.TRANTYPE1 = 'DEFERRED OUTPUT TAX'")
     If Not ACCT_ADJ2.EOF And Not ACCT_ADJ2.BOF Then
     ADJ_ACCT2 = (ACCT_ADJ2!AcctCode)
     End If
     If FB_DES2 = 0.01 Then
     gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET CREDIT = CREDIT + 0.01 WHERE VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND JTYPE = 'SJ' AND ACCT_CODE = '" & ADJ_ACCT2 & "'")
     ElseIf FB_DES2 = -0.01 Then
     gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET CREDIT = CREDIT - 0.01 WHERE VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND JTYPE = 'SJ' AND ACCT_CODE = '" & ADJ_ACCT2 & "'")
     Else
     End If
     
Else
    Dim rsROD As New ADODB.Recordset
    Dim xROD As Double
    xROD = 0
    Set rsROD = New ADODB.Recordset
    Set rsROD = gconDMIS.Execute("SELECT (SUM(DEBIT) - SUM(CREDIT)) AS DIF FROM AMIS_JOURNAL_DET WHERE JType = " & J_JTYPE & " AND VoucherNo = " & J_VOUCHERNO & "")
    If Not rsROD.EOF And Not rsROD.BOF Then
        xROD = Round(rsROD!DIF, 2)
        If xROD = 0.01 Or xROD = 0.02 Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnAccountCode("ROD"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("ROD")))
            J_DEBIT = 0: J_TAX = 0: J_GROSS = 0: J_NET = 0
            J_CREDIT = xROD
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        ElseIf xROD = -0.01 Or xROD = -0.02 Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnAccountCode("ROD"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("ROD")))
            J_CREDIT = 0: J_TAX = 0: J_GROSS = 0: J_NET = 0
            J_DEBIT = (xROD * -1)
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If
End If
End Sub

Sub PURELYITERNAL()
If COMPANY_CODE <> "DJM" Or COMPANY_CODE <> "HCA" Then
            Set rsINTERNAL_RO_DET = New ADODB.Recordset
            
            If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S')AND ROTYPE = 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            Else
                Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND ISNULL(ROTYPE,0) IN ('GJ','PMS') AND REP_OR = '" & CSMIOS_REP_OR & "'")
            End If
            
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0) Then
                        INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "HMH" Then
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                            Else
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            End If
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "HCA" Then
                                    Set rsUEA = New ADODB.Recordset
                                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        Else
                                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                gconDMIS.Execute SQL_STATEMENT
                                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                        End If
                            Else
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    
                    If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then GoTo SKIPOTHERS
                    
                    If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICECHG", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICECHG", "LABOR", "INTERNAL")))
                    End If
                    J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                    J_TAX = 0
                    J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(J_NET), 2)

                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"

                    gconDMIS.Execute SQL_STATEMENT
                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                    If INTERNAL_LABOR_COST > 0 Then
                    Else
                        'COST OF SALES
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICECHG", "LABOR", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICECHG", "LABOR", "INTERNAL")))
                        End If
                        J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                        J_CREDIT = 0
                        ALL_DEBIT = ALL_DEBIT + J_DEBIT
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    
                        'INVENTORY
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        
                        ''SJR
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("PAYROLL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PAYROLL")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                        End If
                        ''SJR
                        
                        J_DEBIT = 0
                        J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
            End If
            
            Set rsINTERNAL_RO_DET = New ADODB.Recordset
            Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND ISNULL(ROTYPE,0) IN ('BP') AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0) Then
                        INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            If COMPANY_CODE = "HMH" Then
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                            Else
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            End If
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                                    Set rsUEA = New ADODB.Recordset
                                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        Else
                                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                gconDMIS.Execute SQL_STATEMENT
                                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                        End If
                            Else
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABORBP", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABORBP", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICECHG", "LABORBP", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICECHG", "LABORBP", "INTERNAL")))
                    End If
                    J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                    J_TAX = 0
                    J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(J_NET), 2)

                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"

                    gconDMIS.Execute SQL_STATEMENT
                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                    If INTERNAL_LABOR_COST > 0 Then
                    Else
                        'COST OF SALES
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABORBP", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABORBP", "INTERNAL")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICECHG", "LABORBP", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICECHG", "LABORBP", "INTERNAL")))
                        End If
                        J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                        J_CREDIT = 0
                        ALL_DEBIT = ALL_DEBIT + J_DEBIT
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    
                        'INVENTORY
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                        J_DEBIT = 0
                        J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
            End If
Else
            Set rsINTERNAL_RO_DET = New ADODB.Recordset
            Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0) Then
                        INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                                If INTERNAL_LABOR_AMT = "810.00" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnAccountCode("FSV"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("FSV")))
                                'SJR
                                ElseIf INTERNAL_LABOR_AMT = "680.00" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnAccountCode("PDI"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("PDI")))
                                'SJR
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                                End If
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            End If
                            If COMPANY_CODE = "HMH" Then
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                            Else
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            End If
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                                    Set rsUEA = New ADODB.Recordset
                                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        Else
                                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                gconDMIS.Execute SQL_STATEMENT
                                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                        End If
                            Else
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                    J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                    J_TAX = 0
                    J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(J_NET), 2)

                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"

                    gconDMIS.Execute SQL_STATEMENT
                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                    If INTERNAL_LABOR_COST > 0 Then
                    Else
                        'COST OF SALES
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                        J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                        J_CREDIT = 0
                        ALL_DEBIT = ALL_DEBIT + J_DEBIT
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    
                        'INVENTORY
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                        J_DEBIT = 0
                        J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
            End If
End If
            
''SUBLET
If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HCE" Then
INTERNAL_LABOR_AMT = 0: INTERNAL_LABOR_COST = 0
 Set rsINTERNAL_RO_DET = New ADODB.Recordset
            Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S')AND ROTYPE = 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                        INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            If COMPANY_CODE = "HMH" Then
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                            Else
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            'J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            End If
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            Set rsUEA = New ADODB.Recordset
                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                            "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                            " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                            ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                            ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                            gconDMIS.Execute SQL_STATEMENT
                            TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop
                    If COMPANY_CODE = "HMH" Then
                    Else
                    If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL")))
                    ElseIf COMPANY_CODE = "HMH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "INTERNAL")))
                    ElseIf COMPANY_CODE = "HCE" Then
                            If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "INTERNAL")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "INTERNAL")))
                            End If
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                    End If
                    J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                    J_TAX = 0
                    J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                    If COMPANY_CODE = "HPI" Then
                        J_CREDIT = 0
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                    Else
                        J_DEBIT = 0
                        J_CREDIT = Round(NumericVal(J_NET), 2)
                    End If

                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                            gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET CREDIT = CREDIT + " & J_CREDIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        Else
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                            "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                            " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                            ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                            ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
        
                            gconDMIS.Execute SQL_STATEMENT
                            TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                        End If
                    End If
                
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HMH" Then
                Else
                    'COST OF SALES
                If COMPANY_CODE = "HMH" Then
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL")))
                    End If
                ElseIf COMPANY_CODE = "HCE" Then
                        If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "INTERNAL")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLETCHG", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLETCHG", "INTERNAL")))
                        End If
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                    End If
                End If
                    J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                    J_CREDIT = 0
                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    Else
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If
SKIPOTHERS:
                
                If COMPANY_CODE = "HPI" Or COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Or COMPANY_CODE = "DJM" Then
                Else
                    'INVENTORY
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                    Else
                        If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                        End If
                    End If
                    J_DEBIT = 0
                    J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET CREDIT = CREDIT + " & J_CREDIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    Else
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If
            End If
End If
'END SUBLET
            'PARTS
            Set rsINTERNAL_RO_DET = New ADODB.Recordset
            Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '2' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0) Then
                        INTERNAL_PARTS_AMT = INTERNAL_PARTS_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_PARTS_COST = INTERNAL_PARTS_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                        If COMPANY_CODE = "HPI" Then
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "HMH" Then
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                            Else
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            End If
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                                    Set rsUEA = New ADODB.Recordset
                                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        Else
                                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                gconDMIS.Execute SQL_STATEMENT
                                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                        End If
                            Else
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                        End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop
                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "HMH" Then
                Else
                If INTERNAL_PARTS_AMT > 0 Then
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                       If COMPANY_CODE = "HMH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "INTERNAL")))
                        ElseIf COMPANY_CODE = "HCE" Then
                            If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTSCHG", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTSCHG", "INTERNAL")))
                            End If
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                        End If
                        J_GROSS = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                        If CSMIOS_VAT_EXEMPT = True Then
                            J_TAX = 0
                        Else
                            J_TAX = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                        End If
                        J_NET = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                        J_DEBIT = 0
                        J_CREDIT = Round(NumericVal(J_NET), 2)
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                        ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                        gconDMIS.Execute SQL_STATEMENT
                        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                    End If
                    If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "HNE" Then
                    Else
                        'COST OF SALES
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        If COMPANY_CODE = "HMH" Then
                            If CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "INTERNAL")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "INTERNAL")))
                            End If
                        ElseIf COMPANY_CODE = "HCE" Then
                            If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTSCHG", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTSCHG", "INTERNAL")))
                            End If
                        Else
                            If CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                            End If
                        End If
                        J_DEBIT = Round(INTERNAL_PARTS_COST, 2)
                        J_CREDIT = 0
                        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If
                 If COMPANY_CODE <> "HNE" Then
                    'INVENTORY
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                    End If
                    J_DEBIT = 0
                    J_CREDIT = Round(INTERNAL_PARTS_COST, 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                 End If
            End If

            'MATERIALS
            Set rsINTERNAL_RO_DET = New ADODB.Recordset
            Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '3' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0) Then
                        INTERNAL_MATERIALS_AMT = INTERNAL_MATERIALS_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_MATERIALS_COST = INTERNAL_MATERIALS_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                        If COMPANY_CODE = "HPI" Then
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "HMH" Then
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                            Else
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            End If
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                                    Set rsUEA = New ADODB.Recordset
                                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        Else
                                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                gconDMIS.Execute SQL_STATEMENT
                                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                        End If
                            Else
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                        End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop

                If INTERNAL_MATERIALS_AMT > 0 Then
                    If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "HMH" Then
                    Else
                        If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL")))
                        ElseIf COMPANY_CODE = "HMH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "INTERNAL")))
                        ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                        ElseIf COMPANY_CODE = "HCE" Then
                            If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS", "INTERNAL")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALSCHG", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALSCHG", "INTERNAL")))
                            End If
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS")))
                        End If

                        J_GROSS = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                        If CSMIOS_VAT_EXEMPT = True Then
                            J_TAX = 0
                        Else
                            J_TAX = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                        End If
                        J_NET = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                        J_DEBIT = 0
                        J_CREDIT = Round(NumericVal(J_NET), 2)
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                                    Set rsUEA = New ADODB.Recordset
                                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET CREDIT = CREDIT + " & J_CREDIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        Else
                                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                gconDMIS.Execute SQL_STATEMENT
                                        End If
                        Else
                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                         SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                        gconDMIS.Execute SQL_STATEMENT
                        End If
                        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                    

                    If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "HNE" Then
                    Else
                        'COST OF SALES
                        If COMPANY_CODE = "HMH" Then
                             If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "INTERNAL")))
                            Else
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "INTERNAL")))
                                End If
                        ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                        ElseIf COMPANY_CODE = "HCE" Then
                            If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS", "INTERNAL")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALSCHG", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALSCHG", "INTERNAL")))
                            End If
                        Else
                            If CSMIOS_TERM = "CSH" Then
                                If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Or COMPANY_CODE = "HOT" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                                End If
                            Else
                                If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                                End If
                            End If
                        End If
                        J_GROSS = 0
                        J_TAX = 0
                        J_NET = 0
                        J_DEBIT = Round(INTERNAL_MATERIALS_COST, 2)
                        J_CREDIT = 0
                        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                         If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                                    Set rsUEA = New ADODB.Recordset
                                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        Else
                                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        End If
                        Else
                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If
                End If
                    
                    If COMPANY_CODE = "HNE" Then
                    Else
                    'INVENTORY
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HMH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                    ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                    ElseIf COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                    Else
                        If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                        End If
                    End If
                    J_GROSS = 0: J_TAX = 0: J_NET = 0
                    J_DEBIT = 0
                    J_CREDIT = Round(INTERNAL_MATERIALS_COST, 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                 End If
                End If
            End If

            
                'ACCESSORIES

             INTERNAL_ACCESSORIES_COST = 0
                Set rsINTERNAL_RO_DET = New ADODB.Recordset
                Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '4' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
                If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                    rsINTERNAL_RO_DET.MoveFirst
                    Do While Not rsINTERNAL_RO_DET.EOF
                        If (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0) Then
                            INTERNAL_ACCESSORIES_AMT = INTERNAL_ACCESSORIES_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                            INTERNAL_ACCESSORIES_COST = INTERNAL_ACCESSORIES_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                            If COMPANY_CODE = "HPI" Then
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "HMH" Then
                                J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                                J_TAX = 0
                                J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                                Else
                                J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                J_TAX = 0
                                J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                End If
                                J_DEBIT = Round(NumericVal(J_NET), 2)
                                J_CREDIT = 0
                                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                                        Set rsUEA = New ADODB.Recordset
                                        Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                    gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                            Else
                                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                    gconDMIS.Execute SQL_STATEMENT
                                                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                            End If
                                Else
                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                    gconDMIS.Execute SQL_STATEMENT
                                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                End If
                            End If
                        End If
                        rsINTERNAL_RO_DET.MoveNext
                    Loop

                    If INTERNAL_MATERIALS_AMT > 0 Then
                    If COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Then
                    Else
                            If COMPANY_CODE = "HMH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER")))
                            ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                            ElseIf COMPANY_CODE = "HCE" Then
                                If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "INTERNAL")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "INTERNAL")))
                                End If
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS")))
                            End If
                            J_GROSS = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                            If CSMIOS_VAT_EXEMPT = True Then
                                J_TAX = 0
                            Else
                                J_TAX = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                            End If
                            J_NET = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                            J_DEBIT = 0
                            J_CREDIT = Round(NumericVal(J_NET), 2)
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                                    Set rsUEA = New ADODB.Recordset
                                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET CREDIT = CREDIT + " & J_CREDIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                        Else
                                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                gconDMIS.Execute SQL_STATEMENT
                                        End If
                        Else
                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                         SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                        gconDMIS.Execute SQL_STATEMENT
                        End If
                            TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                        

                        If COMPANY_CODE = "DAI" Or COMPANY_CODE = "HNE" Then
                        Else
                            'COST OF SALES
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            If COMPANY_CODE = "HMH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER")))
                            ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                            ElseIf COMPANY_CODE = "HCE" Then
                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "INTERNAL")))
                            Else
                                If CSMIOS_TERM = "CSH" Then
                                    If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                                    End If
                                Else
                                    If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                                    End If
                                End If
                            End If
                            J_GROSS = 0
                            J_TAX = 0
                            J_NET = 0
                            J_DEBIT = Round(INTERNAL_MATERIALS_COST, 2)
                            J_CREDIT = 0
                            TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If
                        
                        'INVENTORY
                        If COMPANY_CODE = "HNE" Then
                        Else
                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVA", "MATERIALS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVA", "MATERIALS")))
                        ElseIf COMPANY_CODE = "HCE" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("AIN-PROCESS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("AIN-PROCESS")))
                        Else
                            If CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES")))
                            End If
                        End If
                        J_GROSS = 0: J_TAX = 0: J_NET = 0
                        J_DEBIT = 0
                        J_CREDIT = Round(INTERNAL_ACCESSORIES_COST, 2)
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                       End If
                    End If
                End If

End Sub
Sub DOTSERVICEPARTSWARRANTY()
    If Left(CSMIOS_INVOICE, 6) = "INT RO" And CSMIOS_VAT_EXEMPT = False And CSMIOS_VAT_EXEMPT1 = False Then
    Else
        If Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_SR) / 1.12 * 0.12), 2) > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnAccountCode("DOTSERVICE"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("DOTSERVICE")))
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_SR) / 1.12 * 0.12), 2)
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            ''INSERT AMIS_AP
            Set rsDOTCIS = New ADODB.Recordset
            Set rsDOTCIS = gconDMIS.Execute("SELECT * FROM AMIS_CHARTACCOUNT WHERE AcctCode = " & J_ACCT_CODE & " AND IS_SCHEDULE_ACCNT =1 AND TRANTYPE1 = 'DOTSERVICE'")
            If Not rsDOTCIS.EOF And Not rsDOTCIS.BOF Then
                xIDDOTAX = (gconDMIS.Execute("SELECT ID FROM AMIS_JOURNAL_DET WHERE JTYPE =" & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE = " & J_ACCT_CODE & "").Fields(0).Value)
                xCNAME = (gconDMIS.Execute("select ACCOUNTNAME from ALL_ENTITY   WHERE ENTITYCODE = 'C' AND CODE = " & J_CUSTOMERCODE & "").Fields(0).Value)
                SQL_STATEMENT = "INSERT INTO AMIS_AP (Voucherno,Vendor_code,VENDOR_NAME,invoicedate,Amount2pay,AmountPaid,Balance,Acct_code,LastUpdated,INVOICENO,INVOICETYPE,JDATE,MODIFIED_DATE,REFCODE,ENTITYCODE,STATUS,JOURNAL_DET_ID) " & _
                                " values ('" & "SJ" + "-" + GetVoucherNo & "', " & J_CUSTOMERCODE & ", '" & xCNAME & "', " & J_INVOICEDATE & "," & J_CREDIT & ",'0'," & J_CREDIT & "," & J_ACCT_CODE & "," & J_JDATE & ", " & J_INVOICENO & ", " & J_INVOICETYPE & "," & J_JDATE & "," & J_JDATE & ",'" & "C" + CSMIOS_ACCT_NO & "','C','N'," & xIDDOTAX & ")"
                gconDMIS.Execute SQL_STATEMENT
            End If
            ''--------------------------------------
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            J_TAX = 0: J_GROSS = 0: J_NET = 0: J_DEBIT = 0: J_CREDIT = 0: xIDDOTAX = 0: xCNAME = ""
        End If
        
        If Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL) / 1.12 * 0.12), 2) > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
             If COMPANY_CODE = "DJM" Then
              J_ACCT_CODE = N2Str2Null(ReturnAccountCode("DOTSERVICE"))
             J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("DOTSERVICE")))
             Else
             J_ACCT_CODE = N2Str2Null(ReturnAccountCode("DOTPARTS"))
             J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("DOTPARTS")))
             End If
             J_DEBIT = 0
             J_CREDIT = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL) / 1.12 * 0.12), 2)
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            ''INSERT AMIS_AP
            Set rsDOTCIS = New ADODB.Recordset
            Set rsDOTCIS = gconDMIS.Execute("SELECT * FROM AMIS_CHARTACCOUNT WHERE AcctCode = " & J_ACCT_CODE & " AND IS_SCHEDULE_ACCNT =1 AND TRANTYPE1 = 'DOTPARTS'")
            If Not rsDOTCIS.EOF And Not rsDOTCIS.BOF Then
                xIDDOTAX = (gconDMIS.Execute("SELECT ID FROM AMIS_JOURNAL_DET WHERE JTYPE =" & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE = " & J_ACCT_CODE & "").Fields(0).Value)
                xCNAME = (gconDMIS.Execute("select ACCOUNTNAME from ALL_ENTITY   WHERE ENTITYCODE = 'C' AND CODE = " & J_CUSTOMERCODE & "").Fields(0).Value)
                SQL_STATEMENT = "INSERT INTO AMIS_AP (Voucherno,Vendor_code,VENDOR_NAME,invoicedate,Amount2pay,AmountPaid,Balance,Acct_code,LastUpdated,INVOICENO,INVOICETYPE,JDATE,MODIFIED_DATE,REFCODE,ENTITYCODE,STATUS,JOURNAL_DET_ID) " & _
                                " values ('" & "SJ" + "-" + GetVoucherNo & "', " & J_CUSTOMERCODE & ", '" & xCNAME & "', " & J_INVOICEDATE & "," & J_CREDIT & ",'0'," & J_CREDIT & "," & J_ACCT_CODE & "," & J_JDATE & ", " & J_INVOICENO & ", " & J_INVOICETYPE & "," & J_JDATE & "," & J_JDATE & ",'" & "C" + CSMIOS_ACCT_NO & "','C','N'," & xIDDOTAX & ")"
                gconDMIS.Execute SQL_STATEMENT
            End If
            ''--------------------------------------
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            J_TAX = 0: J_GROSS = 0: J_NET = 0: J_DEBIT = 0: J_CREDIT = 0: xIDDOTAX = "": xCNAME = ""
        End If
    End If
End Sub
Sub rodwarranty()
Dim rsROD As New ADODB.Recordset
Dim xROD As Double
xROD = 0
Set rsROD = New ADODB.Recordset
Set rsROD = gconDMIS.Execute("SELECT ISNULL((SUM(DEBIT) - SUM(CREDIT)),0) AS DIF FROM AMIS_JOURNAL_DET WHERE JType = " & J_JTYPE & " AND VoucherNo = " & J_VOUCHERNO & "")
If Not rsROD.EOF And Not rsROD.BOF Then
    xROD = Round(rsROD!DIF, 2)
    If xROD = 0.01 Or xROD = 0.02 Then
        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        J_ACCT_CODE = N2Str2Null(ReturnAccountCode("ROD"))
        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("ROD")))
        J_DEBIT = 0: J_TAX = 0: J_GROSS = 0: J_NET = 0
        J_CREDIT = xROD
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    ElseIf xROD = -0.01 Or xROD = -0.02 Then
        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        J_ACCT_CODE = N2Str2Null(ReturnAccountCode("ROD"))
        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("ROD")))
        J_CREDIT = 0: J_TAX = 0: J_GROSS = 0: J_NET = 0
        J_DEBIT = (xROD * -1)
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    End If
End If
End Sub
Sub SNPI()
If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
INTERNAL_LABOR_AMT = 0: INTERNAL_LABOR_COST = 0
 Set rsINTERNAL_RO_DET = New ADODB.Recordset
            Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S')AND ROTYPE = 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                        INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            If COMPANY_CODE = "HMH" Then
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                            Else
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            'J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            End If
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            Set rsUEA = New ADODB.Recordset
                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop
                    If COMPANY_CODE = "HMH" Then
                    Else
                    If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL")))
                    ElseIf COMPANY_CODE = "HMH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                    End If
                    J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                    J_TAX = 0
                    J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                    If COMPANY_CODE = "HPI" Then
                        J_CREDIT = 0
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                    Else
                        J_DEBIT = 0
                        J_CREDIT = Round(NumericVal(J_NET), 2)
                    End If

                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                            gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET CREDIT = CREDIT + " & J_CREDIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        Else
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                        End If
                    End If
                
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HMH" Then
                Else
                    'COST OF SALES
                If COMPANY_CODE = "HMH" Then
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL")))
                    End If
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                    End If
                End If
                    J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                    J_CREDIT = 0
                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    Else
                        ItemCnt = ItemCnt + 1
                        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)

                    End If
                End If
                If COMPANY_CODE = "HPI" Or COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Or COMPANY_CODE = "DJM" Then
                Else
                    'INVENTORY
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    End If
                    J_DEBIT = 0
                    J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET CREDIT = CREDIT + " & J_CREDIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    Else
                        ItemCnt = ItemCnt + 1
                        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If
            End If
End If

End Sub
Sub NPIENTRY()
If COMPANY_CODE = "HCE" Then
        Set rsINTERNAL_RO_DET = New ADODB.Recordset
        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '1' AND DETPRC > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND ISNULL(JOBTYPE,0) IN ('GJ','PMS') AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
            rsINTERNAL_RO_DET.MoveFirst
            Do While Not rsINTERNAL_RO_DET.EOF
                If ((N2Str2Zero(rsINTERNAL_RO_DET!DETPRC) > 0) And COMPANY_CODE <> "HMH" And COMPANY_CODE <> "FMC") Or ((N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) > 0) And COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC") Then
                    INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)
                    INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                    If COMPANY_CODE = "HPI" Then
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                        If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Then
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        Else
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        End If
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0

                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            Set rsUEA = New ADODB.Recordset
                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        Else
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If
                End If
                rsINTERNAL_RO_DET.MoveNext
            Loop
                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Then
                Else
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DJM" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                End If
                J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_TAX = 0
                J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)

                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            

            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
            Else
                'COST OF SALES
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICECHG", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICECHG", "LABOR", "INTERNAL")))
                End If
                J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            End If
            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
            ElseIf INTERNAL_LABOR_COST = 0 And (COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC") Then
            Else
                'INVENTORY
            
            If INTERNAL_LABOR_COST > 0 Then

                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HCE" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    End If
                End If
                J_DEBIT = 0
                J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    End If
    
        Set rsINTERNAL_RO_DET = New ADODB.Recordset
        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '1' AND DETPRC > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND ISNULL(JOBTYPE,0) IN ('BP') AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
            rsINTERNAL_RO_DET.MoveFirst
            Do While Not rsINTERNAL_RO_DET.EOF
                If ((N2Str2Zero(rsINTERNAL_RO_DET!DETPRC) > 0) And COMPANY_CODE <> "HMH" And COMPANY_CODE <> "FMC") Or ((N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) > 0) And COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC") Then
                    INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)
                    INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                    If COMPANY_CODE = "HPI" Then
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                        If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Then
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        Else
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        End If
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0

                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            Set rsUEA = New ADODB.Recordset
                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        Else
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If
                End If
                rsINTERNAL_RO_DET.MoveNext
            Loop
                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Then
                Else
                
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABORBP", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABORBP", "INTERNAL")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICECHG", "LABORBP", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICECHG", "LABORBP", "INTERNAL")))
                End If
                J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_TAX = 0
                J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)

                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            

            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
            Else
                'COST OF SALES
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABORBP", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABORBP", "INTERNAL")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICECHG", "LABORBP", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICECHG", "LABORBP", "INTERNAL")))
                End If
                J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            End If
            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
            ElseIf INTERNAL_LABOR_COST = 0 And (COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC") Then
            Else
                'INVENTORY
            
            If INTERNAL_LABOR_COST > 0 Then

                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HCE" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    End If
                End If
                J_DEBIT = 0
                J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    End If
Else
        Set rsINTERNAL_RO_DET = New ADODB.Recordset
        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '1' AND DETPRC > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
            rsINTERNAL_RO_DET.MoveFirst
            Do While Not rsINTERNAL_RO_DET.EOF
                If ((N2Str2Zero(rsINTERNAL_RO_DET!DETPRC) > 0) And COMPANY_CODE <> "HMH" And COMPANY_CODE <> "FMC") Or ((N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) > 0) And COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC") Then
                    INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)
                    INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                    If COMPANY_CODE = "HPI" Then
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                        If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Then
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        Else
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        End If
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0

                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            Set rsUEA = New ADODB.Recordset
                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        Else
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If
                End If
                rsINTERNAL_RO_DET.MoveNext
            Loop
            If COMPANY_CODE = "HCE" Then
                 ''CHECKING FOR BP
                        Set INTERNAL_BP_LABOR_RS = New ADODB.Recordset
                        Set INTERNAL_BP_LABOR_RS = gconDMIS.Execute("Select SUM(DETPRC) AS DETPRC from CSMS_RO_DET WHERE LIVIL = '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE = 'BP' AND REP_OR = '" & CSMIOS_REP_OR & "'")
                        If Not INTERNAL_BP_LABOR_RS.EOF And Not INTERNAL_BP_LABOR_RS.BOF Then
                        INTERNAL_BP_LABOR = Round(N2Str2Zero(INTERNAL_BP_LABOR_RS!DETPRC), 2)
                        End If
                ''END CHECKING FOR BP
                If INTERNAL_BP_LABOR > 0 Then
                            INTERNAL_LABOR_COST = INTERNAL_LABOR_AMT - INTERNAL_BP_LABOR
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            
                                 If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABORBP", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABORBP", "INTERNAL")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICECHG", "LABORBP", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICECHG", "LABORBP", "INTERNAL")))
                                End If
                            J_DEBIT = 0
                            J_CREDIT = Round(INTERNAL_BP_LABOR, 2)
                            ALL_CREDIT = ALL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Then
                Else
                
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DJM" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                End If
                J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_TAX = 0
                J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)

                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            

            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
            Else
                'COST OF SALES
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            End If
            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCE" Then
            ElseIf INTERNAL_LABOR_COST = 0 And (COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC") Then
            Else
                'INVENTORY
            
            If INTERNAL_LABOR_COST > 0 Then

                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HCE" Then
                     If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICECHG", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICECHG", "LABOR", "INTERNAL")))
                    End If
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    End If
                End If
                J_DEBIT = 0
                J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    End If
End If

''SUBLET
If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Then
INTERNAL_LABOR_AMT = 0: INTERNAL_LABOR_COST = 0
  Set rsINTERNAL_RO_DET = New ADODB.Recordset
        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE  DETPRC > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ROTYPE = 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
            rsINTERNAL_RO_DET.MoveFirst
            Do While Not rsINTERNAL_RO_DET.EOF
                If N2Str2Zero(rsINTERNAL_RO_DET!DETPRC) > 0 Then
                    INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)
                    INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                    If COMPANY_CODE = "HPI" Then
                    Else
                        ItemCnt = ItemCnt + 1
                        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                        If COMPANY_CODE = "HMH" Then
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                        Else
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETPRC)), 2)
                        End If
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0

                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If
                rsINTERNAL_RO_DET.MoveNext
            Loop

                If COMPANY_CODE = "HMH" Then
                Else
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DJM" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                ElseIf COMPANY_CODE = "HCE" Then
                    If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "INTERNAL")))
                    End If
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                End If
                J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_TAX = 0
                J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)

                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            

            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
            Else
                'COST OF SALES
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HCE" Then
                    If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLETCHG", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLETCHG", "INTERNAL")))
                    End If
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                End If
                J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            End If
            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DJM" Then
            Else
                'INVENTORY
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                End If
                J_DEBIT = 0
                J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
''SUBLET NOT PURELY INTERNAL
Call SNPI
End If
''END SUBLET

        'PARTS
        Set rsINTERNAL_RO_DET = New ADODB.Recordset
        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '2' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR'AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
            rsINTERNAL_RO_DET.MoveFirst
            Do While Not rsINTERNAL_RO_DET.EOF
                If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                    INTERNAL_PARTS_AMT = INTERNAL_PARTS_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                    INTERNAL_PARTS_COST = INTERNAL_PARTS_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))

    
                    If COMPANY_CODE = "HCC" Then
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                        If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Then
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                        Else
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                        End If
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0

                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            Set rsUEA = New ADODB.Recordset
                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        Else
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If

                End If
                rsINTERNAL_RO_DET.MoveNext
            Loop

            If INTERNAL_PARTS_AMT > 0 Then
                If COMPANY_CODE = "HCC" Or COMPANY_CODE = "HMH" Then
                Else
                    ItemCnt = ItemCnt + 1
                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HCE" Then
                        If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTSCHG", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTSCHG", "INTERNAL")))
                        End If
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                    End If
                    J_GROSS = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                    If CSMIOS_VAT_EXEMPT = True Then
                        J_TAX = 0
                    Else
                        J_TAX = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                    End If
                    J_NET = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(J_NET), 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If

                If COMPANY_CODE = "HCC" Or COMPANY_CODE = "HMH" Then
                Else
                    'COST OF SALES
                    ItemCnt = ItemCnt + 1
                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HCE" Then
                        If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTSCHG", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTSCHG", "INTERNAL")))
                        End If
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                    End If
                    J_DEBIT = Round(INTERNAL_PARTS_COST, 2)
                    J_CREDIT = 0
                    TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If


                'INVENTORY
                If COMPANY_CODE = "HCC" Then
                Else
                    ItemCnt = ItemCnt + 1
                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                        ''INVENTORY HCA
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARST-IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARST-IN-PROCESS")))
                    ElseIf COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                    Else
                        If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                        End If
                    End If
                    J_DEBIT = 0
                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Then
                        J_CREDIT = Round(INTERNAL_PARTS_COST, 2)
                    Else
                        J_CREDIT = Round(INTERNAL_PARTS_COST, 2)
                    End If
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If

        End If

        Set rsINTERNAL_RO_DET = New ADODB.Recordset
        Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '3' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
            rsINTERNAL_RO_DET.MoveFirst
            Do While Not rsINTERNAL_RO_DET.EOF
                If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                    INTERNAL_MATERIALS_AMT = INTERNAL_MATERIALS_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                    INTERNAL_MATERIALS_COST = INTERNAL_MATERIALS_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                    If COMPANY_CODE = "HCC" Then
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                        If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Then
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                        Else
                        J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                        J_TAX = 0
                        J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                        End If
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0
                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            Set rsUEA = New ADODB.Recordset
                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        Else
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                    End If
                End If
                rsINTERNAL_RO_DET.MoveNext
            Loop

            If INTERNAL_MATERIALS_AMT > 0 Then
                If COMPANY_CODE = "HCC" Or COMPANY_CODE = "HMH" Then
                Else
                   If COMPANY_CODE = "HMH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "INTERNAL")))
                    ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                    ElseIf COMPANY_CODE = "HCE" Then
                        If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS", "INTERNAL")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALSCHG", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALSCHG", "INTERNAL")))
                        End If
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL")))
                    End If
                    J_GROSS = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                    If CSMIOS_VAT_EXEMPT = True Then
                        J_TAX = 0
                    Else
                        J_TAX = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                    End If
                    J_NET = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(J_NET), 2)
                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET CREDIT = CREDIT + " & J_CREDIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    Else
                        ItemCnt = ItemCnt + 1
                        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If

                If COMPANY_CODE = "HCC" Or COMPANY_CODE = "HMH" Then
                Else
                    'COST OF SALES
                    If COMPANY_CODE = "HMH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "INTERNAL")))
                    ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                     ElseIf COMPANY_CODE = "HCE" Then
                        If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS", "INTERNAL")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALSCHG", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALSCHG", "INTERNAL")))
                        End If
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                    End If
                    J_GROSS = 0
                    J_TAX = 0
                    J_NET = 0
                    J_DEBIT = Round(INTERNAL_MATERIALS_COST, 2)
                    J_CREDIT = 0
                    TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    Else
                        ItemCnt = ItemCnt + 1
                        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If


                'INVENTORY
                If COMPANY_CODE = "HCC" Then
                Else
                    ItemCnt = ItemCnt + 1
                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HMH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM")))
                    ElseIf COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                    End If
                    J_GROSS = 0: J_TAX = 0: J_NET = 0
                    J_DEBIT = 0
                    J_CREDIT = Round(INTERNAL_MATERIALS_COST, 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If

            End If
        End If

            'ACCESSORIES

            Set rsINTERNAL_RO_DET = New ADODB.Recordset
            Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '4' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') and ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                        INTERNAL_ACCESSORIES_AMT = INTERNAL_ACCESSORIES_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_ACCESSORIES_COST = INTERNAL_ACCESSORIES_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                        If COMPANY_CODE = "HPI" Then
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            If COMPANY_CODE = "HMH" Then
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)), 2)
                            Else
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            End If
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                        End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    Else
                        ItemCnt = ItemCnt + 1
                        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                Else
                    ItemCnt = ItemCnt + 1
                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If

                If INTERNAL_ACCESSORIES_AMT > 0 Then
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                        ElseIf COMPANY_CODE = "HCE" Then
                            If CSMIOS_TERM = "" Or CSMIOS_TERM = "CSH" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "INTERNAL")))
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "INTERNAL")))
                            End If
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "INTERNAL")))
                        End If
                        J_GROSS = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                        If CSMIOS_VAT_EXEMPT = True Then
                            J_TAX = 0
                        Else
                            J_TAX = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                        End If
                        J_NET = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                        J_DEBIT = 0
                        J_CREDIT = Round(NumericVal(J_NET), 2)
                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                        Set rsUEA = New ADODB.Recordset
                        Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                            gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET CREDIT = CREDIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        Else
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If

                    
                        'COST OF SALES
                        ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                        ElseIf COMPANY_CODE = "HCE" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "INTERNAL")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "INTERNAL")))
                        End If
                        J_GROSS = 0
                        J_TAX = 0
                        J_NET = 0
                        J_DEBIT = Round(INTERNAL_ACCESSORIES_COST, 2)
                        J_CREDIT = 0
                        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                        Set rsUEA = New ADODB.Recordset
                        Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                            gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        Else
                        ItemCnt = ItemCnt + 1
                        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If

                    'INVENTORY
                    ItemCnt = ItemCnt + 1
                    J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("AIN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("AIN-PROCESS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES")))
                    End If
                    J_GROSS = 0: J_TAX = 0: J_NET = 0
                    J_DEBIT = 0
                    J_CREDIT = Round(INTERNAL_ACCESSORIES_COST, 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            
        '---al for HCC combined entry
        If COMPANY_CODE = "HCC" Then
            Set rsINTERNAL_RO_DET = New ADODB.Recordset
            Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL IN ('2','3','4') AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                        INTERNAL_ACCESSORIES_AMT = INTERNAL_ACCESSORIES_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_ACCESSORIES_COST = INTERNAL_ACCESSORIES_COST + (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                        If COMPANY_CODE = "HPI" Then
                        Else
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            J_GROSS = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(INTERNAL_ACCESSORIES_AMT)), 2)
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                        End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                J_GROSS = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                If CSMIOS_VAT_EXEMPT = True Then
                    J_TAX = 0
                Else
                    J_TAX = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                End If
                J_NET = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                'COST OF SALES
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                J_GROSS = 0
                J_TAX = 0
                J_NET = 0
                J_DEBIT = Round(INTERNAL_ACCESSORIES_COST, 2)
                J_CREDIT = 0
                TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                'INVENTORY
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                J_GROSS = 0: J_TAX = 0: J_NET = 0
                J_DEBIT = 0
                J_CREDIT = Round(INTERNAL_ACCESSORIES_COST, 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)

            End If
        End If

        'OUT PUT TAX
        If COMPANY_CODE = "HPI" Then
            If INTERNAL_PARTS_COST + INTERNAL_MATERIALS_COST > 0 Then
                If CSMIOS_VAT_EXEMPT = False Then
                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HBK" Then
                        If CSMIOS_TERM = "CHG" Then
                            J_ACCT_CODE = N2Str2Null(ReturnDeferredOutPutTax())
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDeferredOutPutTax()))
                        End If
                    ElseIf COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Then
                        J_ACCT_CODE = N2Str2Null(ReturnDeferredOutPutTax())
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDeferredOutPutTax()))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnOutputTax())
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnOutputTax()))
                    End If
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(Round(((INTERNAL_PARTS_COST + INTERNAL_MATERIALS_COST) / 1.12), 2) * 0.12), 2)
                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                    J_TAX = 0: J_GROSS = 0: J_NET = 0
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
        End If

        If COMPANY_CODE = "HCC" Then
            Dim rsCheckHD                                   As ADODB.Recordset
            Set rsCheckHD = New ADODB.Recordset
            rsCheckHD.Open "Select VoucherNo, JType from AMIS_JOURNAL_HD WHERE JTYPE=" & J_JTYPE & " AND VOUCHERNO =" & J_VOUCHERNO & " AND STATUS <> 'P'", gconDMIS, adOpenKeyset
            If Not rsCheckHD.EOF And Not rsCheckHD.BOF Then
            Else
                J_REMARKS = " SERVICE INVOICENO:" + " " + CSMIOS_INVOICE
                SQL_STATEMENT = "Insert into AMIS_Journal_HD" & _
                                " (jdate,voucherno,jtype,vendorcode,customercode,invoicedate,invoicetype,invoiceno,invoiceamt,duedate,paytype,refno,refdate,terms,dealer,amounttopay,Balance,AmountPaid,jno,debit,credit,outbalance,status,CheckNo,CheckDate,BankCode,remarks,PaidStatus,ReceiveStatus)" & _
                                " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & ", " & J_VENDORCODE & "," & J_CUSTOMERCODE & ", " & J_INVOICEDATE & "," & J_INVOICETYPE & "," & J_INVOICENO & "," & J_INVOICEAMT & ", " & J_DUEDATE & ", " & J_PAYTYPE & "," & J_REFNO & "," & J_REFDATE & "," & J_TERMS & "," & J_DEALER & ", " & J_AMOUNTTOPAY & "," & J_BALANCE & "," & J_AMOUNTPAID & _
                                ", " & J_JNO & ", " & TOTAL_DEBIT & ", " & TOTAL_CREDIT & ", " & J_OUTBALANCE & ", " & J_STATUS & ", " & J_CHECKNO & ", " & J_CHECKDATE & ", " & J_BANKCODE & ",'" & J_REMARKS & "'," & J_PAIDSTATUS & "," & J_RECEIVESTATUS & ")"
                gconDMIS.Execute SQL_STATEMENT
                'AUDIT
                TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_hd", "X", J_JTYPE, "Jtype"))
                NEW_LogAudit "M", "JOURNAL ENTRY", SQL_STATEMENT, TransactionID, "", J_VOUCHERNO, J_JTYPE, J_JNO
            End If
        End If
        'END OF NOT PURELY INTERNAL RO
        ':-)=================================
End Sub
Sub SUBLETINTERNALINSURANCEHCA()
If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
INTERNAL_LABOR_AMT = 0: INTERNAL_LABOR_COST = 0
 Set rsINTERNAL_RO_DET = New ADODB.Recordset
            Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S')AND ROTYPE = 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
            If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                rsINTERNAL_RO_DET.MoveFirst
                Do While Not rsINTERNAL_RO_DET.EOF
                    If N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 Then
                        INTERNAL_LABOR_AMT = INTERNAL_LABOR_AMT + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                        INTERNAL_LABOR_COST = INTERNAL_LABOR_COST + N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                            If COMPANY_CODE = "HMH" Then
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DETCOST)), 2)
                            Else
                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            J_TAX = 0
                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            'J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                            End If
                            J_DEBIT = Round(NumericVal(J_NET), 2)
                            J_CREDIT = 0
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            Set rsUEA = New ADODB.Recordset
                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                            WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                    End If
                    rsINTERNAL_RO_DET.MoveNext
                Loop
                    If COMPANY_CODE = "HMH" Then
                    Else
                    If COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL")))
                    ElseIf COMPANY_CODE = "HMH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                    End If
                    J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                    J_TAX = 0
                    J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                    If COMPANY_CODE = "HPI" Then
                        J_CREDIT = 0
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                    Else
                        J_DEBIT = 0
                        J_CREDIT = Round(NumericVal(J_NET), 2)
                    End If

                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                            gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET CREDIT = CREDIT + " & J_CREDIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        Else
                            WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                        End If
                    End If
                
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HMH" Then
                Else
                    'COST OF SALES
                If COMPANY_CODE = "HMH" Then
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "INTERNAL")))
                    End If
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                    End If
                End If
                    J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                    J_CREDIT = 0
                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    Else
                        WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)

                    End If
                End If
                If COMPANY_CODE = "HPI" Or COMPANY_CODE = "HLP" Or COMPANY_CODE = "HAM" Or COMPANY_CODE = "HSP" Or COMPANY_CODE = "DJM" Then
                Else
                    'INVENTORY
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                    End If
                    J_DEBIT = 0
                    J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET CREDIT = CREDIT + " & J_CREDIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    Else
                        WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If
            End If
End If
End Sub
Sub PARTSHARINONHARI()
If COMPANY_CODE = "HNE" Then
                        If INSURANCE_PARTS_HARI > 0 Then
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "RETAIL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "RETAIL")))
                            J_GROSS = Round(NumericVal(INSURANCE_PARTS_HARI + DISCOUNT_INS_PARTS_GJ), 2)
                            If CSMIOS_VAT_EXEMPT = True Then
                                J_TAX = 0
                            Else
                                J_TAX = Round(NumericVal(INSURANCE_PARTS_HARI + DISCOUNT_INS_PARTS_GJ) / 1.12 * 0.12, 2)
                            End If
                            J_NET = Round(NumericVal(INSURANCE_PARTS_HARI + DISCOUNT_INS_PARTS_GJ) - Round(NumericVal(J_TAX), 2), 2)
                            J_DEBIT = 0
                            J_CREDIT = Round(NumericVal(J_NET), 2)
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        End If
                        
                        If INSURANCE_PARTS_NONHARI > 0 Then
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("PARTS", "TRADE", "RETAIL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("PARTS", "TRADE", "RETAIL")))
                                J_GROSS = Round(NumericVal(INSURANCE_PARTS_NONHARI), 2)
                            If CSMIOS_INVOICE = "PDI RO" Then
                                J_TAX = 0
                                J_NET = Round(NumericVal(INSURANCE_PARTS_NONHARI), 2)
                            Else
                                If CSMIOS_VAT_EXEMPT = True Then
                                    J_TAX = 0
                                    J_NET = Round(NumericVal(INSURANCE_PARTS_NONHARI), 2)
                                Else
                                    J_TAX = Round(NumericVal(Round((INSURANCE_PARTS_NONHARI / 1.12), 2) * 0.12), 2)
                                    J_NET = Round(NumericVal(INSURANCE_PARTS_NONHARI) - Round(NumericVal(J_TAX), 2), 2)
                            End If
                            J_DEBIT = 0
                            J_CREDIT = Round(NumericVal(J_NET), 2)
                            ALL_CREDIT = ALL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        End If
                    End If
End Sub
Sub DOTSERVICEPARTSINSURANCE()
    If Left(CSMIOS_INVOICE, 6) = "INT RO" Then
    Else
        If Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_BP) / 1.12 * 0.12), 2) > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                J_ACCT_CODE = N2Str2Null(ReturnAccountCode("OTSERVICE"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("OTSERVICE")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnAccountCode("DOTSERVICE"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("DOTSERVICE")))
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_BP) / 1.12 * 0.12), 2)
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            ''INSERT AMIS_AP
            Set rsDOTCIS = New ADODB.Recordset
            Set rsDOTCIS = gconDMIS.Execute("SELECT * FROM AMIS_CHARTACCOUNT WHERE AcctCode = " & J_ACCT_CODE & " AND IS_SCHEDULE_ACCNT =1 AND TRANTYPE1 = 'DOTSERVICE'")
            If Not rsDOTCIS.EOF And Not rsDOTCIS.BOF Then
                xIDDOTAX = (gconDMIS.Execute("SELECT ID FROM AMIS_JOURNAL_DET WHERE JTYPE =" & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE = " & J_ACCT_CODE & "").Fields(0).Value)
                xCNAME = (gconDMIS.Execute("select ACCOUNTNAME from ALL_ENTITY   WHERE ENTITYCODE = 'C' AND CODE = '" & CSMIOS_PARTICIPAT & "'").Fields(0).Value)
                SQL_STATEMENT = "INSERT INTO AMIS_AP (Voucherno,Vendor_code,VENDOR_NAME,invoicedate,Amount2pay,AmountPaid,Balance,Acct_code,LastUpdated,INVOICENO,INVOICETYPE,JDATE,MODIFIED_DATE,REFCODE,ENTITYCODE,STATUS,JOURNAL_DET_ID) " & _
                                " values ('" & "SJ" + "-" + INSURANCE_VOUCHERNO_TAX & "', '" & CSMIOS_PARTICIPAT & "', '" & xCNAME & "', " & J_INVOICEDATE & "," & J_CREDIT & ",'0'," & J_CREDIT & "," & J_ACCT_CODE & "," & J_JDATE & ", " & J_INVOICENO & ", " & J_INVOICETYPE & "," & J_JDATE & "," & J_JDATE & ",'" & "C" + CSMIOS_ACCT_NO & "','C','N'," & xIDDOTAX & ")"
                gconDMIS.Execute SQL_STATEMENT
            End If
            ''--------------------------------------
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            J_TAX = 0: J_GROSS = 0: J_NET = 0: J_DEBIT = 0: J_CREDIT = 0: xIDDOTAX = 0: xCNAME = ""
        End If
        
        If Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS + CSMIOS_INSURANCE_MISC) / 1.12 * 0.12), 2) > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                J_ACCT_CODE = N2Str2Null(ReturnAccountCode("OTPARTS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("OTPARTS")))
            ElseIf COMPANY_CODE = "DJM" Then
                J_ACCT_CODE = N2Str2Null(ReturnAccountCode("DOTSERVICE"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("DOTSERVICE")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnAccountCode("DOTPARTS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("DOTPARTS")))
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS + CSMIOS_INSURANCE_MISC) / 1.12 * 0.12), 2)
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            ''INSERT AMIS_AP
            Set rsDOTCIS = New ADODB.Recordset
            Set rsDOTCIS = gconDMIS.Execute("SELECT * FROM AMIS_CHARTACCOUNT WHERE AcctCode = " & J_ACCT_CODE & " AND IS_SCHEDULE_ACCNT =1 AND TRANTYPE1 = 'DOTPARTS'")
            If Not rsDOTCIS.EOF And Not rsDOTCIS.BOF Then
                xIDDOTAX = (gconDMIS.Execute("SELECT ID FROM AMIS_JOURNAL_DET WHERE JTYPE =" & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE = " & J_ACCT_CODE & "").Fields(0).Value)
                xCNAME = (gconDMIS.Execute("select ACCOUNTNAME from ALL_ENTITY   WHERE ENTITYCODE = 'C' AND CODE = '" & CSMIOS_PARTICIPAT & "'").Fields(0).Value)
                SQL_STATEMENT = "INSERT INTO AMIS_AP (Voucherno,Vendor_code,VENDOR_NAME,invoicedate,Amount2pay,AmountPaid,Balance,Acct_code,LastUpdated,INVOICENO,INVOICETYPE,JDATE,MODIFIED_DATE,REFCODE,ENTITYCODE,STATUS,JOURNAL_DET_ID) " & _
                                " values ('" & "SJ" + "-" + INSURANCE_VOUCHERNO_TAX & "', '" & CSMIOS_PARTICIPAT & "', '" & xCNAME & "', " & J_INVOICEDATE & "," & J_CREDIT & ",'0'," & J_CREDIT & "," & J_ACCT_CODE & "," & J_JDATE & ", " & J_INVOICENO & ", " & J_INVOICETYPE & "," & J_JDATE & "," & J_JDATE & ",'" & "C" + CSMIOS_ACCT_NO & "','C','N'," & xIDDOTAX & ")"
                gconDMIS.Execute SQL_STATEMENT
            End If
            ''--------------------------------------
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            J_TAX = 0: J_GROSS = 0: J_NET = 0: J_DEBIT = 0: J_CREDIT = 0: xIDDOTAX = "": xCNAME = ""
        End If
    End If
End Sub

Function SetInvCode(INV As String)
    If INV = "ACCESSORIES" Then
        SetInvCode = "AI"
    ElseIf INV = "PARTS" Then
        SetInvCode = "PI"
    ElseIf INV = "MATERIALS" Then
        SetInvCode = "MI"
    ElseIf INV = "VEHICLE" Then
        SetInvCode = "VI"
    Else
        SetInvCode = "Null"
    End If
End Function
Function CHKDUPLICATEINV(xInvoiceType As String, xInvoiceNo, xPAYTYPE) As String
    Dim rsCHECKINVOICE As ADODB.Recordset
    Dim xIMPORTINGINVTYPE As String
    xIMPORTINGINVTYPE = SetInvCode(UCase(xInvoiceType))
    Set rsCHECKINVOICE = New ADODB.Recordset
    If xIMPORTINGINVTYPE = "VI" Then
        Set rsCHECKINVOICE = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_HD WHERE INVOICETYPE = '" & xIMPORTINGINVTYPE & "' AND INVOICENO = '" & Right(xInvoiceNo, 6) & "'  AND JTYPE = 'SJ'")
    Else
        Set rsCHECKINVOICE = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_HD WHERE INVOICETYPE = '" & xIMPORTINGINVTYPE & "' AND INVOICENO = '" & Right(xInvoiceNo, Len(xInvoiceNo) - 4) & "' AND PAYTYPE = '" & Left(xPAYTYPE, 3) & "' AND JTYPE = 'SJ'")
    End If
    If Not rsCHECKINVOICE.EOF And Not rsCHECKINVOICE.BOF Then
        CHKDUPLICATEINV = Null2String(rsCHECKINVOICE!INVOICENO)
    Else
        CHKDUPLICATEINV = ""
    End If
End Function

Function ENTRY_FOR_INSURANCE_HCA() As Boolean
    On Error GoTo ErrorCode
    Dim str_MSG As String
    If INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_PARTS_HARI + INSURANCE_PARTS_NONHARI + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS + INSURANCE_DIRECT_EXPENSE_SR_BP + CSMIOS_INSURANCE_MISC > 0 Then
        Set rsJournal_HDDup = New ADODB.Recordset
        Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_journal_hd order by jno desc")
        If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then WARRANTY_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 2, "000000") & "'"
        WARRANTY_VOUCHERNO = N2Str2Null(Format(NumericVal(GetVoucherNo()), "000000"))
        INSURANCE_VOUCHERNO_TAX = Format(NumericVal(GetVoucherNo()), "000000")
        WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        TOTAL_DEBIT = 0: TOTAL_CREDIT = 0
        
''INSERT HEADER HERE
        CSMIOS_REP_OR = Null2String(rsCSMIOS_REPOR!REP_OR)
        CSMIOS_ACCT_NO = Null2String("H00001")
        CSMIOS_PLATE_NO = Null2String(rsCSMIOS_REPOR!PLATE_NO)
        CSMIOS_NIYM = Null2String(SetCustomerName(CSMIOS_PARTICIPAT))
        WARRANTY_J_AMOUNTTOPAY = 0
        WARRANTY_J_INVOICEAMT = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_DIRECT_EXPENSE_SR_BP + INSURANCE_PARTS_HARI + INSURANCE_PARTS_NONHARI + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS + CSMIOS_INSURANCE_MISC), 2)
        WARRANTY_J_BALANCE = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_PARTS_HARI + INSURANCE_PARTS_NONHARI + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS + CSMIOS_INSURANCE_MISC), 2)
        WARRANTY_J_AMOUNTPAID = 0
        
        If COMPANY_CODE = "MGS" Then
            'DESCRIPTION: UPDATE HEADER CUSTOMER PAID + INSURANCE
            SQL_STATEMENT = "UPDATE AMIS_JOURNAL_HD" & _
                            " SET invoiceamt = invoiceamt + " & WARRANTY_J_INVOICEAMT & ", balance = balance + " & WARRANTY_J_BALANCE & ""
                            gconDMIS.Execute SQL_STATEMENT
        Else
            SQL_STATEMENT = "Insert into AMIS_Journal_HD" & _
                            " (jdate,voucherno,jtype,vendorcode,customercode,invoicedate,invoicetype,invoiceno,invoiceamt,duedate,paytype,refno,refdate,terms,dealer,amounttopay,Balance,AmountPaid,jno,debit,credit,outbalance,status,CheckNo,CheckDate,BankCode,remarks,PaidStatus,ReceiveStatus)" & _
                            " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & ", " & J_VENDORCODE & "," & N2Str2Null(CSMIOS_PARTICIPAT) & ", " & J_INVOICEDATE & "," & J_INVOICETYPE & "," & J_INVOICENO & "," & WARRANTY_J_INVOICEAMT & ", " & J_DUEDATE & ", " & J_PAYTYPE & "," & J_REFNO & "," & J_REFDATE & "," & J_TERMS & "," & J_DEALER & ", " & WARRANTY_J_AMOUNTTOPAY & "," & WARRANTY_J_BALANCE & "," & WARRANTY_J_AMOUNTPAID & _
                            ", " & WARRANTY_JNO & ", " & TOTAL_DEBIT & ", " & TOTAL_CREDIT & ", " & J_OUTBALANCE & ", " & J_STATUS & ", " & J_CHECKNO & ", " & J_CHECKDATE & ", " & J_BANKCODE & ",'" & J_REMARKS & "'," & J_PAIDSTATUS & "," & J_RECEIVESTATUS & ")"
                            gconDMIS.Execute SQL_STATEMENT
                            TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_hd", "X", J_JTYPE, "Jtype")): NEW_LogAudit "M", "SALES JOURNAL", SQL_STATEMENT, TransactionID, "", WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO
        End If
        
''INSERT DETAILS HERE

        ''***ENTRY FOR ACCOUNTS RECEIVABLE***''
        If AR_INSURANCE_FUNCTION = False Then
            ENTRY_FOR_INSURANCE_HCA = False
            Exit Function
        End If
        
        ''***ENTRY FOR COST OF SALES***''
        If COST_INSURANCE_FUNCTION = False Then
            ENTRY_FOR_INSURANCE_HCA = False
            Exit Function
        End If
        
        ''***ENTRY FOR DISCOUNT***''
        If (COMPANY_CODE = "HCE" Or COMPANY_CODE = "HCA") And CHECK_INSURANCE = 0 Then
            Call HCE_DISCOUNT
        End If
        
        ''***ENTRY FOR SALES***''
        If SALES_INSURANCE_FUNCTION = False Then
            ENTRY_FOR_INSURANCE_HCA = False
            Exit Function
        End If
        
        ''***ENTRY FOR INVENTORY***''
        If INVENTORY_INSURANCE_FUNCTION = False Then
            ENTRY_FOR_INSURANCE_HCA = False
            Exit Function
        End If
        
        ''***ENTRY FOR TAX***''
        If TAX_INSURANCE_FUNCTION = False Then
            ENTRY_FOR_INSURANCE_HCA = False
            Exit Function
        End If
        
        ''ENTRY FOR INTERNAL AND INSURANCE
        If (COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR") And (CSMIOS_MATERIALS = 0 And CSMIOS_PARTS = 0 And CSMIOS_LABOR = 0 And CSMIOS_ACCESSORIES = 0 And CSMIOS_SUBLET = 0 And CSMIOS_PMS = 0 And CSMIOS_TINSPAINT = 0) Then ''Edited by norman 08-1
            Call internal_insurance
        End If
        
        ''***ENTRY FOR ROUND OF DIFF***''
        If COMPANY_CODE = "DAI" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HCE" Then
            Call rod
        ElseIf COMPANY_CODE = "HMR" Then
            Call rodwarranty
        End If
        
        ''ENTRY FOR WARRANTY AND INSURANCE
        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
            J_VOUCHERNO = WARRANTY_VOUCHERNO
            Call rodwarranty
        End If
    End If
    
    ENTRY_FOR_INSURANCE_HCA = True
    Exit Function
    
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    ENTRY_FOR_INSURANCE_HCA = False
    ShowVBError
End Function

Function AR_INSURANCE_FUNCTION() As Boolean
    On Error GoTo INSURANCE_ERROR
    
    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
        J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("SERVICE"))
        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("SERVICE")))
    ElseIf COMPANY_CODE = "MGS" Then
        J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("TRADE"))
        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("TRADE")))
    Else
        J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("INSURANCE"))
        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("INSURANCE")))
    End If
    
    J_DEBIT = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_SR_BP + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_PARTS_HARI + INSURANCE_PARTS_NONHARI + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS + CSMIOS_INSURANCE_MISC), 2)
    J_CREDIT = 0: J_TAX = 0: J_GROSS = 0: J_NET = 0
    TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
    
    If COMPANY_CODE = "MGS" Then
        Call UpdateJournalDetAmt(J_VOUCHERNO, J_JTYPE, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT)
    Else
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    End If
    
    AR_INSURANCE_FUNCTION = True
    Exit Function
    
INSURANCE_ERROR:
    AR_INSURANCE_FUNCTION = False
End Function

Function COST_INSURANCE_FUNCTION() As Boolean
    On Error GoTo INSURANCE_ERROR
    
''LABOR INSURANCE GJ ONLY
    If COMPANY_CODE = "MGS" Or COMPANY_CODE = "HNE" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
    Else
        If INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS > 0 Then
            If CSMIOS_LABOR_COST + CSMIOS_PMS_COST > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER")))
                ElseIf COMPANY_CODE = "DSSC" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "RETAIL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "RETAIL")))
                ElseIf COMPANY_CODE = "HCE" Then
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJCHG", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJCHG", "CUSTOMER")))
                    End If
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET")))
                    End If
                End If
                
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                    J_DEBIT = Round(CSMIOS_LABOR_COST + CSMIOS_PMS_COST, 2)
                Else
                    J_DEBIT = Round(CSMIOS_LABOR_COST, 2)
                End If
                
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    End If
    
''PARTS + MATERIALS + ACCESSORIES GJ ONLY
    If COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
        If INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_PARTS_HARI + INSURANCE_PARTS_NONHARI > 0 Then
            If CSMIOS_PARTS_COST + CSMIOS_MATERIALS_COST + CSMIOS_ACCESSORIES_COST > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                J_DEBIT = Round(CSMIOS_PARTS_COST + CSMIOS_MATERIALS_COST + CSMIOS_ACCESSORIES_COST, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    ElseIf COMPANY_CODE = "MGS" Then
        GoTo TOTAL_PMA_GJ_BP
    Else
''PARTS INSURANCE GJ ONLY
        If INSURANCE_DIRECT_EXPENSE_SPAREPARTS + CSMIOS_PARTS_INV_GEN + CSMIOS_PARTS_INV_NONGEN > 0 Then
            If CSMIOS_PARTS_COST + CSMIOS_PARTS_INV_GEN + CSMIOS_PARTS_INV_NONGEN > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                ElseIf COMPANY_CODE = "HCE" Then
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJCHG", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJCHG", "CUSTOMER")))
                    End If
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "RETAIL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "RETAIL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "RETAIL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "RETAIL")))
                    End If
                End If
                J_DEBIT = Round(CSMIOS_PARTS_COST + CSMIOS_PARTS_INV_GEN + CSMIOS_PARTS_INV_NONGEN, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                
            ElseIf CSMIOS_PARTS_COST_BP > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER")))
                J_DEBIT = Round(CSMIOS_PARTS_COST_BP, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
''MATERIALS INSURANCE GJ ONLY
        If INSURANCE_DIRECT_EXPENSE_GOL > 0 Then
            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "HCA" Then
            Else
                If CSMIOS_MATERIALS_COST > 0 Then
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                    ElseIf COMPANY_CODE = "HCE" Then
                        If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJCHG", "CUSTOMER"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJCHG", "CUSTOMER")))
                        End If
                    ElseIf COMPANY_CODE = "DAI" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS", "CUSTOMER")))
                    Else
                        If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                        End If
                    End If
                    
                    J_GROSS = 0: J_TAX = 0: J_NET = 0
                    J_DEBIT = Round(CSMIOS_MATERIALS_COST, 2)
                    J_CREDIT = 0
                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
        End If
        
''ACCESSORIES INSURANCE GJ ONLY
        If INSURANCE_DIRECT_EXPENSE_ACCESSORIES > 0 Then
            If CSMIOS_ACCESSORIES_COST > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER")))
                    
                ElseIf COMPANY_CODE = "HSM" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("ACCESSORIES", "INSTALLED", ""))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("ACCESSORIES", "INSTALLED", "")))
                ElseIf COMPANY_CODE = "HCE" Then
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("ACCESSORIES", "INSTALLED"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("ACCESSORIES", "INSTALLED")))
                    End If
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("ACCESSORIES", "INSTALLED"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("ACCESSORIES", "INSTALLED")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("ACCESSORIES", "INSTALLED"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("ACCESSORIES", "INSTALLED")))
                    End If
                End If
                J_DEBIT = Round(CSMIOS_ACCESSORIES_COST, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
''SUBLET INSURANCE GJ ONLY
        If CSMIOS_SUBLET_COST > 0 And INSURANCE_DIRECT_EXPENSE_SR > 0 And (COMPANY_CODE <> "HSB" And COMPANY_CODE <> "HBC" And COMPANY_CODE <> "HLB" And COMPANY_CODE <> "HCR") Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If COMPANY_CODE = "HCE" Then
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLETCSH", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLETCSH", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLETCHG", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLETCHG", "CUSTOMER")))
                End If
            Else
                If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SUBLET", "SERVICE", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SUBLET", "SERVICE", "CUSTOMER")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET")))
                    End If
                End If
            End If
            J_DEBIT = Round(CSMIOS_SUBLET_COST, 2)
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
''LABOR INSURANCE BP ONLY
        If INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS > 0 Then
            If CSMIOS_TINSPAINT_COST > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER")))
                End If
                J_DEBIT = Round(CSMIOS_TINSPAINT_COST + CSMIOS_TINSPAINT_COST_PARTS, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
''PARTS INSURANCE BP ONLY
        If INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DJM" Then
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER")))
            End If
            
            J_DEBIT = Round(CSMIOS_PARTS_COST_BP, 2)
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
''MATERIALS INSURANCE BP ONLY
'NO EXISTING CODE
        
''ACCESSORIES INSURANCE BP ONLY
'NO EXISTING CODE
        
''SUBLET INSURANCE BP ONLY
        If INSURANCE_DIRECT_EXPENSE_SR_BP > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER")))
            J_DEBIT = Round(CSMIOS_SUBLET_COST_BP, 2)
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
TOTAL_PMA_GJ_BP:
''PARTS + MATERIALS + ACCESSORIES GJ + BP ONLY
        If COMPANY_CODE = "MGS" Then
            If INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_ACCESSORIES_BP > 0 Then
                If CSMIOS_PARTS_COST + CSMIOS_PARTS_COST_BP + CSMIOS_MATERIALS_COST + CSMIOS_MATERIALS_COST_BP + CSMIOS_ACCESSORIES_COST + CSMIOS_ACCESSORIES_COST_BP > 0 Then
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                    J_DEBIT = Round(CSMIOS_PARTS_COST + CSMIOS_PARTS_COST_BP + CSMIOS_MATERIALS_COST + CSMIOS_MATERIALS_COST_BP + CSMIOS_ACCESSORIES_COST + CSMIOS_ACCESSORIES_COST_BP, 2)
                    J_CREDIT = 0
                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                    
                    Set rsCheckVoucher = New ADODB.Recordset
                    Set rsCheckVoucher = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & " AND ACCT_NAME = " & J_ACCT_NAME & "")
                    If Not rsCheckVoucher.EOF And Not rsCheckVoucher.BOF Then
                        Call UpdateJournalDetAmt(J_VOUCHERNO, J_JTYPE, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT)
                    Else
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                End If
            End If
        End If
        
    End If
    
    COST_INSURANCE_FUNCTION = True
    Exit Function
    
INSURANCE_ERROR:
    COST_INSURANCE_FUNCTION = False
End Function



Function SALES_INSURANCE_FUNCTION() As Boolean
    On Error GoTo INSURANCE_ERROR
    
    If COMPANY_CODE = "MGS" Then
    ''LABOR INSURANCE GJ + BP ONLY
        If INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_SR_BP > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
            
            J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_SR_BP + DISCOUNT_INS_LABOR_GJ + DISCOUNT_INS_LABOR_BP), 2)
            
            If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_SR_BP + DISCOUNT_INS_LABOR_GJ + DISCOUNT_INS_LABOR_BP), 2)
            Else
                J_NET = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_SR_BP + DISCOUNT_INS_LABOR_GJ + DISCOUNT_INS_LABOR_BP) / 1.12), 2)
            End If
            
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            
            Set rsCheckVoucher = New ADODB.Recordset
            Set rsCheckVoucher = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & " AND ACCT_NAME = " & J_ACCT_NAME & "")
            If Not rsCheckVoucher.EOF And Not rsCheckVoucher.BOF Then
                Call UpdateJournalDetAmt(J_VOUCHERNO, J_JTYPE, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT)
            Else
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
    Else
    ''LABOR INSURANCE GJ ONLY
        If INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            
            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DSSC" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL")))
            ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
            ElseIf COMPANY_CODE = "HCE" Then
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJCHG", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJCHG", "CUSTOMER")))
                End If
            Else
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET")))
            End If
            
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + DISCOUNT_INS_LABOR_GJ), 2)
            Else
                J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + DISCOUNT_INS_LABOR_GJ), 2)
            End If
            
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + DISCOUNT_INS_LABOR_GJ), 2)
                Else
                    J_NET = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + DISCOUNT_INS_LABOR_GJ) / 1.12), 2)
                End If
            Else
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + DISCOUNT_INS_LABOR_GJ), 2)
                Else
                    J_NET = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + DISCOUNT_INS_LABOR_GJ) / 1.12), 2)
                End If
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
    ''LABOR INSURANCE BP ONLY
        If INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER")))
            End If
            
            J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR_BP + DISCOUNT_INS_LABOR_BP), 2)
            
            If CSMIOS_INVOICE = "PDI RO" Then
                J_TAX = 0
                J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR_BP + DISCOUNT_INS_LABOR_BP), 2)
            Else
                If CSMIOS_VAT_EXEMPT = True Then
                    J_TAX = 0
                    J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS + DISCOUNT_INS_LABOR_BP), 2)
                Else
                    J_TAX = Round(NumericVal(Round((INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS + DISCOUNT_INS_LABOR_BP / 1.12), 2) * 0.12), 2)
                    J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS + DISCOUNT_INS_LABOR_BP) / 1.12, 2)
                End If
            End If
            
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If
    
    ''PARTS + MATERIALS + ACCESSORIES INSURANCE GJ ONLY
    If COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
        If INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_PARTS_HARI + INSURANCE_PARTS_NONHARI > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "CUSTOMER")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS")))
            End If
            J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + DISCOUNT_INS_PARTS_GJ), 2)
            If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT = True Then
                J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + DISCOUNT_INS_PARTS_GJ), 2)
            Else
                J_NET = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + DISCOUNT_INS_PARTS_GJ) / 1.12), 2)
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
        If CSMIOS_INSURANCE_MISC > 0 And (COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR") Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("MISC", "SERVICE", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("MISC", "SERVICE", "CUSTOMER")))
            J_GROSS = Round(NumericVal(CSMIOS_INSURANCE_MISC), 2)
            If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT = True Then
                J_NET = Round(NumericVal(CSMIOS_INSURANCE_MISC), 2)
            Else
                J_NET = Round(NumericVal(CSMIOS_INSURANCE_MISC) / 1.12, 2)
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    ElseIf COMPANY_CODE = "MGS" Then
        GoTo TOTAL_PMA_GJ_BP
    Else
    ''PARTS INSURANCE GJ ONLY
        If INSURANCE_DIRECT_EXPENSE_SPAREPARTS > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
            ElseIf COMPANY_CODE = "HCE" Then
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJCHG", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJCHG", "CUSTOMER")))
                End If
            Else
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS")))
            End If
            
            J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + DISCOUNT_INS_PARTS_GJ), 2)
            If CSMIOS_VAT_EXEMPT = True Then
                J_TAX = 0
            Else
                J_TAX = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + DISCOUNT_INS_PARTS_GJ) / 1.12 * 0.12, 2)
            End If
            
            J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + DISCOUNT_INS_PARTS_GJ) - Round(NumericVal(J_TAX), 2), 2)
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
    ''MATERIALS INSURANCE GJ ONLY
        If INSURANCE_DIRECT_EXPENSE_GOL > 0 Then
            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "HCA" Then
            Else
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                ElseIf COMPANY_CODE = "HCE" Then
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJCHG", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJCHG", "CUSTOMER")))
                    End If
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS")))
                End If
                J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_GOL + DISCOUNT_INS_MATERIALS), 2)
                
                If CSMIOS_VAT_EXEMPT = True Then
                    J_TAX = 0
                Else
                    J_TAX = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_GOL + DISCOUNT_INS_MATERIALS) / 1.12 * 0.12, 2)
                End If
                
                J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_GOL + DISCOUNT_INS_MATERIALS) - Round(NumericVal(J_TAX), 2), 2)
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
    ''ACCESSORIES INSURANCE GJ ONLY
        If INSURANCE_DIRECT_EXPENSE_ACCESSORIES > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            
            If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE ", "MATERIALS-GJ", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
            ElseIf COMPANY_CODE = "DAI" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER")))
            ElseIf COMPANY_CODE = "HSM" Then 'SJR 091614
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("ACCESSORIES", "", ""))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED", "")))
            ElseIf COMPANY_CODE = "HCE" Then
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED")))
                End If
            Else
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED")))
                End If
            End If
            J_GROSS = Round(NumericVal(CSMIOS_ACCESSORIES), 2)
            If CSMIOS_INVOICE = "PDI RO" Then
                J_TAX = 0: J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_ACCESSORIES), 2)
            Else
                If CSMIOS_VAT_EXEMPT = True Then
                    J_TAX = 0: J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_ACCESSORIES + DISCOUNT_INS_ACCESSORIES), 2)
                Else
                    J_NET = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_ACCESSORIES + DISCOUNT_INS_ACCESSORIES) / 1.12), 2)
                End If
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If
    
    ''SUBLET INSURANCE GJ ONLY
    If INSURANCE_DIRECT_EXPENSE_SR > 0 Then
        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        If COMPANY_CODE = "DSSC" Then
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "RETAIL"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "RETAIL")))
        ElseIf COMPANY_CODE = "HCE" Then
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLETCSH", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLETCSH", "CUSTOMER")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "CUSTOMER")))
            End If
        Else
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER")))
        End If
        J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SR), 2)
        If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
            J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SR), 2)
        Else
            J_NET = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_SR) / 1.12), 2)
        End If
        J_DEBIT = 0
        J_CREDIT = Round(NumericVal(J_NET), 2)
        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    End If
    
    ''PARTS INSURANCE BP ONLY
    If INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP > 0 Then
        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        
        If COMPANY_CODE = "DJM" Then
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-BP", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-BP", "CUSTOMER")))
        End If
        
        J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP), 2)
        
        If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
            J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP), 2)
        Else
            J_NET = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP) / 1.12), 2)
        End If
        J_DEBIT = 0
        J_CREDIT = Round(NumericVal(J_NET), 2)
        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    End If
    
    ''MATERIALS INSURANCE BP ONLY
        'NO EXISTING CODE
    
    ''ACCESSORIES INSURANCE BP ONLY
        'NO EXISTING CODE
    
    ''SUBLET INSURANCE BP ONLY
    If INSURANCE_DIRECT_EXPENSE_SR_BP > 0 Then
        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        
        If COMPANY_CODE = "DJM" Then
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER")))
        End If
        
        J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SR_BP), 2)
        
        If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
            J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SR_BP), 2)
        Else
            J_NET = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_SR_BP) / 1.12), 2)
        End If
        
        J_DEBIT = 0
        J_CREDIT = Round(NumericVal(J_NET), 2)
        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    End If
    
TOTAL_PMA_GJ_BP:
    If COMPANY_CODE = "MGS" Then
        If INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_ACCESSORIES_BP > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
            
            J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_ACCESSORIES_BP + DISCOUNT_INS_PARTS_GJ + DISCOUNT_INS_PARTS_BP + DISCOUNT_INS_ACCESSORIES + DISCOUNT_INS_MATERIALS), 2)
            If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT = True Then
                J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_ACCESSORIES_BP + DISCOUNT_INS_PARTS_GJ + DISCOUNT_INS_PARTS_BP + DISCOUNT_INS_ACCESSORIES + DISCOUNT_INS_MATERIALS), 2)
            Else
                J_NET = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_ACCESSORIES_BP + DISCOUNT_INS_PARTS_GJ + DISCOUNT_INS_PARTS_BP + DISCOUNT_INS_ACCESSORIES + DISCOUNT_INS_MATERIALS) / 1.12), 2)
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            
            Set rsCheckVoucher = New ADODB.Recordset
            Set rsCheckVoucher = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & " AND ACCT_NAME = " & J_ACCT_NAME & "")
            If Not rsCheckVoucher.EOF And Not rsCheckVoucher.BOF Then
                Call UpdateJournalDetAmt(J_VOUCHERNO, J_JTYPE, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT)
            Else
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    End If
    
    
    SALES_INSURANCE_FUNCTION = True
    Exit Function
    
INSURANCE_ERROR:
    SALES_INSURANCE_FUNCTION = False
End Function




Function INVENTORY_INSURANCE_FUNCTION() As Boolean
    On Error GoTo INSURANCE_ERROR

    ''LABOR INSURANCE GJ ONLY
    If COMPANY_CODE = "HNE" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
        'NO ENTRY FOR INVENTORY LABOR GJ
    ElseIf COMPANY_CODE = "MGS" Then
        GoTo TOTAL_PMA_GJ_BP
    Else
        If INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS > 0 Then
            If CSMIOS_LABOR_COST + CSMIOS_PMS_COST > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                ElseIf COMPANY_CODE = "HCA" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PAYROLL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PAYROLL")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                        End If
                    Else
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                        End If
                    End If
                End If
                J_DEBIT = 0
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                    J_CREDIT = Round(CSMIOS_LABOR_COST + CSMIOS_PMS_COST, 2)
                Else
                    J_CREDIT = Round(CSMIOS_LABOR_COST, 2)
                End If
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    End If
    
    ''LABOR INSURANCE BP ONLY
    If INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS > 0 Then
        If CSMIOS_TINSPAINT_COST > 0 Then
            ItemCnt = ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
            End If
            J_DEBIT = 0
            J_CREDIT = Round(CSMIOS_TINSPAINT_COST + CSMIOS_TINSPAINT_COST_PARTS, 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If

    ''PARTS + MATERIALS + ACCESSORIES INSURANCE GJ ONLY
    If COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
        If INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_PARTS_HARI + INSURANCE_PARTS_NONHARI > 0 Then
            If CSMIOS_PARTS_COST + CSMIOS_MATERIALS_COST + CSMIOS_ACCESSORIES_COST > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS-IN-PROCESS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS-IN-PROCESS")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                End If
                J_DEBIT = 0
                J_CREDIT = Round(CSMIOS_PARTS_COST + CSMIOS_MATERIALS_COST + CSMIOS_ACCESSORIES_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    Else
    ''PARTS INSURANCE GJ ONLY
        If COMPANY_CODE = "HCE" Then
            If CSMIOS_PARTS_INV_GEN > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                J_DEBIT = 0
                J_CREDIT = Round(CSMIOS_PARTS_INV_GEN, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            
            If CSMIOS_PARTS_INV_GEN > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnInventory("NONGEN_PARTS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("NONGEN_PARTS")))
                J_DEBIT = 0
                J_CREDIT = Round(CSMIOS_PARTS_INV_NONGEN, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            
    ''PARTS INSURANCE GJ ONLY
        ElseIf COMPANY_CODE = "DJM" Then
            If INSURANCE_DIRECT_EXPENSE_SPAREPARTS > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                J_DEBIT = 0
                J_CREDIT = Round(CSMIOS_PARTS_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        Else
            If INSURANCE_DIRECT_EXPENSE_SPAREPARTS + CSMIOS_PARTS_INV_GEN + CSMIOS_PARTS_INV_NONGEN > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                End If
                J_DEBIT = 0
                J_CREDIT = Round(CSMIOS_PARTS_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
    ''MATERIALS INSURANCE GJ ONLY
        If INSURANCE_DIRECT_EXPENSE_GOL > 0 Then
            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "HCA" Then
            Else
                If CSMIOS_MATERIALS_COST > 0 Then
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                    Else
                        If CSMIOS_TERM = "CSH" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                        End If
                    End If
                    J_GROSS = 0: J_TAX = 0: J_NET = 0
                    J_DEBIT = 0
                    J_CREDIT = Round(CSMIOS_MATERIALS_COST, 2)
                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
        End If
        
    ''ACCESSORIES INSURANCE GJ ONLY
        If INSURANCE_DIRECT_EXPENSE_ACCESSORIES > 0 Then
            If CSMIOS_ACCESSORIES_COST > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HSM" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES"))
                ElseIf COMPANY_CODE = "HCE" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("AIN-PROCESS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("AIN-PROCESS")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES", "INVA"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES", "INVA")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES", "INVA"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES", "INVA")))
                    End If
                End If
                J_DEBIT = 0
                J_CREDIT = Round(CSMIOS_ACCESSORIES_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
    ''SUBLET INSURANCE GJ ONLY
        If INSURANCE_DIRECT_EXPENSE_SR > 0 Then
            If COMPANY_CODE = "HSM" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
            Else
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                J_DEBIT = 0
                J_CREDIT = Round(CSMIOS_SUBLET_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    End If
    
    ''PARTS INSURANCE BP ONLY
    If INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP > 0 Then
        If COMPANY_CODE = "DJM" Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
            J_DEBIT = 0
            J_CREDIT = Round(CSMIOS_PARTS_COST_BP, 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If
    
    ''SUBLET INSURANCE BP ONLY
    If INSURANCE_DIRECT_EXPENSE_SR_BP > 0 Then
        ItemCnt = ItemCnt + 1
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        If COMPANY_CODE = "DJM" Then
            J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
        End If
        
        J_CREDIT = Round(CSMIOS_SUBLET_COST_BP, 2)
        ALL_CREDIT = ALL_CREDIT + J_CREDIT
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    End If
    
TOTAL_PMA_GJ_BP:
''PARTS + MATERIALS + ACCESSORIES GJ + BP ONLY
    If COMPANY_CODE = "MGS" Then
        If INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_ACCESSORIES_BP > 0 Then
            If CSMIOS_PARTS_COST + CSMIOS_PARTS_COST_BP + CSMIOS_MATERIALS_COST + CSMIOS_MATERIALS_COST_BP + CSMIOS_ACCESSORIES_COST + CSMIOS_ACCESSORIES_COST_BP > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                
                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS-IN-PROCESS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS-IN-PROCESS")))
                
                J_CREDIT = Round(CSMIOS_PARTS_COST + CSMIOS_PARTS_COST_BP + CSMIOS_MATERIALS_COST + CSMIOS_MATERIALS_COST_BP + CSMIOS_ACCESSORIES_COST + CSMIOS_ACCESSORIES_COST_BP, 2)
                J_DEBIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                
                Set rsCheckVoucher = New ADODB.Recordset
                Set rsCheckVoucher = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & " AND ACCT_NAME = " & J_ACCT_NAME & "")
                If Not rsCheckVoucher.EOF And Not rsCheckVoucher.BOF Then
                    Call UpdateJournalDetAmt(J_VOUCHERNO, J_JTYPE, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT)
                Else
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
        End If
    End If
    
    INVENTORY_INSURANCE_FUNCTION = True
    Exit Function
    
INSURANCE_ERROR:
    INVENTORY_INSURANCE_FUNCTION = False
End Function



Function TAX_INSURANCE_FUNCTION() As Boolean
On Error GoTo INSURANCE_ERROR

    If CSMIOS_VAT_EXEMPT = False And CSMIOS_VAT_EXEMPT1 = False Then
        If COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
            Call DOTSERVICEPARTSINSURANCE
        Else
            If NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + CSMIOS_PARTS_DISCOUNT + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_SR_BP + INSURANCE_PARTS_HARI + INSURANCE_PARTS_NONHARI) > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HMR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnDeferredOutPutTax())
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDeferredOutPutTax()))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnOutputTax())
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnOutputTax()))
                End If
    
                J_DEBIT = 0
                
                J_CREDIT = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_DIRECT_EXPENSE_SR_BP + INSURANCE_PARTS_HARI + INSURANCE_PARTS_NONHARI) / 1.12 * 0.12), 2)
                
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                
                If COMPANY_CODE = "HMR" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                Else
                    If Round(Round(TOTAL_CREDIT, 2) - Round(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_DIRECT_EXPENSE_SR_BP, 2), 2) = 0.01 Then J_CREDIT = Round(J_CREDIT, 2) - 0.01
                    If Round(Round(TOTAL_CREDIT, 2) - Round(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_DIRECT_EXPENSE_SR_BP, 2), 2) = -0.01 Then J_CREDIT = Round(J_CREDIT, 2) + 0.01
                    If Round(Round(TOTAL_DEBIT + INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_DIRECT_EXPENSE_SR_BP, 2) - Round(TOTAL_CREDIT, 2), 2) = 0.01 Then J_CREDIT = Round(J_CREDIT, 2) + 0.01
                    If Round(Round(TOTAL_DEBIT + INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_DIRECT_EXPENSE_SR_BP, 2) - Round(TOTAL_CREDIT, 2), 2) = -0.01 Then J_CREDIT = Round(J_CREDIT, 2) - 0.01
                End If
                J_TAX = 0
                J_GROSS = 0
                J_NET = 0
                J_STATUS = "'N'"
                
                If COMPANY_CODE = "MGS" Then
                    Set rsCheckVoucher = New ADODB.Recordset
                    Set rsCheckVoucher = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & " AND ACCT_NAME = " & J_ACCT_NAME & "")
                    If Not rsCheckVoucher.EOF And Not rsCheckVoucher.BOF Then
                        Call UpdateJournalDetAmt(J_VOUCHERNO, J_JTYPE, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT)
                    Else
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                Else
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
                
                Call DOTAX_INS
            End If
        End If
    End If
            
    TAX_INSURANCE_FUNCTION = True
    Exit Function
    
INSURANCE_ERROR:
    TAX_INSURANCE_FUNCTION = False
End Function

Function ENTRY_FOR_INUSURANCE() As Boolean
On Error GoTo ErrorCode
            If INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_PARTS_HARI + INSURANCE_PARTS_NONHARI + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS > 0 Then
                        Set rsJournal_HDDup = New ADODB.Recordset
                        Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_journal_hd order by jno desc")
                        If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then WARRANTY_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 2, "000000") & "'"

                        WARRANTY_VOUCHERNO = N2Str2Null(Format(NumericVal(GetVoucherNo()), "000000"))
                        WARRANTY_ItemCnt = 0: WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        TOTAL_DEBIT = 0: TOTAL_CREDIT = 0
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("SERVICE"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("SERVICE")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("INSURANCE"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("INSURANCE")))
                        End If
                        J_DEBIT = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_PARTS_HARI + INSURANCE_PARTS_NONHARI + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS), 2)
                        J_CREDIT = 0: J_TAX = 0: J_GROSS = 0: J_NET = 0
                        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        If INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS > 0 Then
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "DSSC" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL")))
                            ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
                            ElseIf COMPANY_CODE = "HCE" Then
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJCHG", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJCHG", "CUSTOMER")))
                                    End If
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET")))
                            End If
                            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                                J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + DISCOUNT_INS_LABOR_GJ), 2)
                            Else
                                J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + DISCOUNT_INS_LABOR_GJ), 2)
                            End If
                            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                    J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + DISCOUNT_INS_LABOR_GJ), 2)
                                Else
                                    J_NET = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + DISCOUNT_INS_LABOR_GJ) / 1.12), 2)
                                End If
                            Else
                                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                                    J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + DISCOUNT_INS_LABOR_GJ), 2)
                                Else
                                    J_NET = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + DISCOUNT_INS_LABOR_GJ) / 1.12), 2)
                                End If
                            End If
                            J_DEBIT = 0
                            J_CREDIT = Round(NumericVal(J_NET), 2)
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)

                            If COMPANY_CODE = "HNE" Or COMPANY_CODE = "HSM" Then
                            Else
                                If CSMIOS_LABOR_COST + CSMIOS_PMS_COST > 0 Then
                                    'COST OF SALES
                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER")))
                                    ElseIf COMPANY_CODE = "DSSC" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "RETAIL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "RETAIL")))
                                    ElseIf COMPANY_CODE = "HCE" Then
                                            If CSMIOS_TERM = "CSH" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER")))
                                            Else
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJCHG", "CUSTOMER"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJCHG", "CUSTOMER")))
                                            End If
                                    Else
                                        If CSMIOS_TERM = "CSH" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET")))
                                        End If
                                    End If
                                    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                                        J_DEBIT = Round(CSMIOS_LABOR_COST + CSMIOS_PMS_COST, 2)
                                    Else
                                        J_DEBIT = Round(CSMIOS_LABOR_COST, 2)
                                    End If
                                    J_CREDIT = 0
                                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    'INVENTORY
                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    
                                    
                                        If COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                                        ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                                            ''SJR
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("PAYROLL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PAYROLL")))
                                            ''SJR
                                        Else
                                            If CSMIOS_TERM = "CSH" Then
                                                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                                                Else
                                                J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                                                End If
                                            Else
                                                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                                                Else
                                                J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                                                End If
                                            End If
                                        End If
                                    J_DEBIT = 0
                                     If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                                        J_CREDIT = Round(CSMIOS_LABOR_COST + CSMIOS_PMS_COST, 2)
                                    Else
                                        J_CREDIT = Round(CSMIOS_LABOR_COST, 2)
                                    End If
                                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                End If
                            End If
                        End If
''-------------------------Body and paint insurance
                    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                    Call BP_INSURANCE
                    End If
''-------------------------Body and paint insurance End
                                If COMPANY_CODE = "HNE" Then
                                ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                                Call SUBLET_CUSTOMERINSURANCE
                                Else
                                If CSMIOS_SUBLET_COST > 0 Then
                                    'COST OF SALES
                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET")))
                                    End If
                                    J_DEBIT = Round(CSMIOS_SUBLET_COST, 2)
                                    J_CREDIT = 0
                                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    'INVENTORY
                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                        If CSMIOS_TERM = "CSH" Then
                                            If COMPANY_CODE = "DAI" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                                            Else
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                                            End If
                                        Else
                                            If COMPANY_CODE = "DAI" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                                            Else
                                            J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                                            End If
                                        End If
                                    J_DEBIT = 0
                                    J_CREDIT = Round(CSMIOS_SUBLET_COST, 2)
                                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                  End If
                                End If
If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
    Call PartsMaterialAccessories
Else
                If COMPANY_CODE = "HNE" Then
                    Call PARTSHARINONHARI
                Else
                        If INSURANCE_DIRECT_EXPENSE_SPAREPARTS > 0 Then
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
                             ElseIf COMPANY_CODE = "HCE" Then
                                If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJCHG", "CUSTOMER"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJCHG", "CUSTOMER")))
                                End If
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS")))
                            End If
                            J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + DISCOUNT_INS_PARTS_GJ), 2)
                            If CSMIOS_VAT_EXEMPT = True Then
                                J_TAX = 0
                            Else
                                J_TAX = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + DISCOUNT_INS_PARTS_GJ) / 1.12 * 0.12, 2)
                            End If
                            J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_SPAREPARTS + DISCOUNT_INS_PARTS_GJ) - Round(NumericVal(J_TAX), 2), 2)
                            J_DEBIT = 0
                            J_CREDIT = Round(NumericVal(J_NET), 2)
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)

                           If COMPANY_CODE = "HNE" Then
                           Else
                            If CSMIOS_PARTS_COST > 0 Then
                                'COST OF SALES
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                                 ElseIf COMPANY_CODE = "HCE" Then
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJCHG", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJCHG", "CUSTOMER")))
                                    End If
                                Else
                                
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "RETAIL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "RETAIL")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "RETAIL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "RETAIL")))
                                    End If
                                End If
                                J_DEBIT = Round(CSMIOS_PARTS_COST, 2)
                                J_CREDIT = 0
                                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                'INVENTORY
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                                End If
                                J_DEBIT = 0
                                J_CREDIT = Round(CSMIOS_PARTS_COST, 2)
                                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                End If
                            End If
                        End If
                    End If
                        
''PARTS BP INSURANCE----------------------------------------
             If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
             Call PARTSBPINSURANCE
             End If
''END PARTS BP INSURANCE-------------------------------------
                
                        If INSURANCE_DIRECT_EXPENSE_GOL > 0 Then
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                            ElseIf COMPANY_CODE = "HCE" Then
                                If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJCHG", "CUSTOMER"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJCHG", "CUSTOMER")))
                                End If
                            Else
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS")))
                            End If
                            J_GROSS = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_GOL + DISCOUNT_INS_MATERIALS), 2)
                            If CSMIOS_VAT_EXEMPT = True Then
                                J_TAX = 0
                            Else
                                J_TAX = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_GOL + DISCOUNT_INS_MATERIALS) / 1.12 * 0.12, 2)
                            End If
                            J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_GOL + DISCOUNT_INS_MATERIALS) - Round(NumericVal(J_TAX), 2), 2)
                            J_DEBIT = 0
                            J_CREDIT = Round(NumericVal(J_NET), 2)
                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                          If COMPANY_CODE = "HNE" Then
                          Else
                            If CSMIOS_MATERIALS_COST > 0 Then
                                'COST OF SALES
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                                ElseIf COMPANY_CODE = "HCE" Then
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJCHG", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJCHG", "CUSTOMER")))
                                    End If
                                ElseIf COMPANY_CODE = "DAI" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS", "CUSTOMER"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS", "CUSTOMER")))
                                Else
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                                    End If
                                End If
                                'End If
                                J_GROSS = 0: J_TAX = 0: J_NET = 0
                                J_DEBIT = Round(CSMIOS_MATERIALS_COST, 2)
                                J_CREDIT = 0
                                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                'INVENTORY
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                                Else
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                                    End If
                                End If
                                J_GROSS = 0: J_TAX = 0: J_NET = 0
                                J_DEBIT = 0
                                J_CREDIT = Round(CSMIOS_MATERIALS_COST, 2)
                                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                              End If
                            End If
                        End If
''MATERIALS INSURANCE ----------------------------------
If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
Call MATERIALSBPINSURANCE
End If
''END MATERIALS INSURANCE  -----------------------------

                        
                        If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or (COMPANY_CODE = "HCI" And CSMIOS_PARTICIPAT <> "") Then
                            If INSURANCE_DIRECT_EXPENSE_ACCESSORIES > 0 Then
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                
                                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE ", "MATERIALS-GJ", "CUSTOMER"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                                ElseIf COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER")))
                                ElseIf COMPANY_CODE = "HSM" Then 'SJR 091614
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("ACCESSORIES", "", ""))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED", "")))
                                Else
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED")))
                                    End If
                                End If
                                J_GROSS = Round(NumericVal(CSMIOS_ACCESSORIES), 2)
                                If CSMIOS_INVOICE = "PDI RO" Then
                                    J_TAX = 0: J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_ACCESSORIES), 2)
                                Else
                                    If CSMIOS_VAT_EXEMPT = True Then
                                        J_TAX = 0: J_NET = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_ACCESSORIES + DISCOUNT_INS_ACCESSORIES), 2)
                                    Else
'                                        J_TAX = Round(NumericVal(Round((INSURANCE_DIRECT_EXPENSE_ACCESSORIES + DISCOUNT_INS_ACCESSORIES / 1.12), 2) * 0.12), 2)
                                        J_NET = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_ACCESSORIES + DISCOUNT_INS_ACCESSORIES) / 1.12), 2)
                                    End If
                                End If
                                J_DEBIT = 0
                                J_CREDIT = Round(NumericVal(J_NET), 2)
                                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                             If COMPANY_CODE = "HNE" Then
                              Else
                                'COST OF SALES
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                
                                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER")))
                                
                                ElseIf COMPANY_CODE = "HSM" Then 'SJR 091614
                                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("ACCESSORIES", "INSTALLED", ""))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("ACCESSORIES", "INSTALLED", "")))
                
                                Else
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("ACCESSORIES", "INSTALLED"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("ACCESSORIES", "INSTALLED")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("ACCESSORIES", "INSTALLED"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("ACCESSORIES", "INSTALLED")))
                                    End If
                                End If
                                J_DEBIT = Round(CSMIOS_ACCESSORIES_COST, 2)
                                J_CREDIT = 0
                                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)

                                'INVENTORY
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If COMPANY_CODE = "HSM" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES")))
                                Else
                                    If CSMIOS_TERM = "CSH" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES", "INVA"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES", "INVA")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES", "INVA"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES", "INVA")))
                                    End If
                                End If
                                J_DEBIT = 0
                                J_CREDIT = Round(CSMIOS_ACCESSORIES_COST, 2)
                                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                End If
                            End If
                        End If
End If
                        If (COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HCA") And CHECK_INSURANCE = 0 Then
                            Call HCE_DISCOUNT
                        End If
                        
                        If COMPANY_CODE <> "DMI" And COMPANY_CODE <> "DAI" And COMPANY_CODE <> "DPI" And COMPANY_CODE <> "DGI" And COMPANY_CODE <> "HMH" And COMPANY_CODE <> "DSSC" And COMPANY_CODE <> "HCE" And COMPANY_CODE <> "FMC" And COMPANY_CODE <> "HCA" And COMPANY_CODE <> "HNE" And COMPANY_CODE <> "HSM" And COMPANY_CODE <> "HMR" Then
                            'DISCOUNT
                            If CSMIOS_PARTS_DISCOUNT > 0 Then
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                
                                If CSMIOS_TERM = "CSH" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "PARTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "PARTS")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "PARTS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "PARTS")))
                                End If
                                
                                J_GROSS = NumericVal(CSMIOS_PARTS_DISCOUNT)
                                If CSMIOS_INVOICE = "PDI RO" Then
                                    J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_PARTS_DISCOUNT), 2)
                                Else
                                    If CSMIOS_VAT_EXEMPT = True Then
                                        J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_PARTS_DISCOUNT), 2)
                                    Else
                                        J_TAX = Round(NumericVal(Round((CSMIOS_PARTS_DISCOUNT / 1.12), 2) * 0.12), 2)
                                        J_NET = Round(NumericVal(CSMIOS_PARTS_DISCOUNT) - Round(NumericVal(J_TAX), 2), 2)
                                    End If
                                End If
                                J_DEBIT = NumericVal(J_NET)
                                J_CREDIT = 0
                                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            End If
                        End If

                        'OUTPUT TAX
                        If CSMIOS_VAT_EXEMPT = False And CSMIOS_VAT_EXEMPT1 = False Then
                        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            Call DOTSERVICEPARTSINSURANCE
                        Else
                            If NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + CSMIOS_PARTS_DISCOUNT + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_PARTS_HARI + INSURANCE_PARTS_NONHARI) > 0 Then
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HMR" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnDeferredOutPutTax())
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDeferredOutPutTax()))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnOutputTax())
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnOutputTax()))
                                End If

                                J_DEBIT = 0
                                J_CREDIT = Round(NumericVal(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_PARTS_HARI + INSURANCE_PARTS_NONHARI) / 1.12 * 0.12), 2)
                                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                If COMPANY_CODE = "HMR" Then
                                Else
                                If Round(Round(TOTAL_CREDIT, 2) - Round(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP, 2), 2) = 0.01 Then J_CREDIT = Round(J_CREDIT, 2) - 0.01
                                If Round(Round(TOTAL_CREDIT, 2) - Round(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP, 2), 2) = -0.01 Then J_CREDIT = Round(J_CREDIT, 2) + 0.01
                                If Round(Round(TOTAL_DEBIT + INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP, 2) - Round(TOTAL_CREDIT, 2), 2) = 0.01 Then J_CREDIT = Round(J_CREDIT, 2) + 0.01
                                If Round(Round(TOTAL_DEBIT + INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP, 2) - Round(TOTAL_CREDIT, 2), 2) = -0.01 Then J_CREDIT = Round(J_CREDIT, 2) - 0.01
                                End If
                                J_TAX = 0
                                J_GROSS = 0
                                J_NET = 0
                                J_STATUS = "'N'"
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                Call DOTAX_INS
                            End If
                        End If
    ''ENTRY FOR INTERNAL&INSURANCE===================================================================================
                             If (COMPANY_CODE = "DJM" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR") And (CSMIOS_MATERIALS = 0 And CSMIOS_PARTS = 0 And CSMIOS_LABOR = 0 And CSMIOS_ACCESSORIES = 0 And CSMIOS_SUBLET = 0 And CSMIOS_PMS = 0 And CSMIOS_TINSPAINT = 0) Then ''Edited by norman 08-1
                                Call internal_insurance
                            End If
    ''ENTRY FOR INTERNAL&INSURANCE===================================================================================
                        End If
                        
                ''ROUND OF DIFF
                        If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DPI" Or COMPANY_CODE = "DMI" Or COMPANY_CODE = "HCE" Then
                            Call rod
                        ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                            Call rodwarranty
                        End If
                ''
                
                        'END CREDIT ENTRY
                        CSMIOS_REP_OR = Null2String(rsCSMIOS_REPOR!REP_OR)
                        CSMIOS_ACCT_NO = Null2String("H00001")
                        CSMIOS_PLATE_NO = Null2String(rsCSMIOS_REPOR!PLATE_NO)
                        CSMIOS_NIYM = Null2String(SetCustomerName(CSMIOS_PARTICIPAT))
                        WARRANTY_J_AMOUNTTOPAY = 0
                        WARRANTY_J_INVOICEAMT = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_PARTS_HARI + INSURANCE_PARTS_NONHARI + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS), 2)
                        WARRANTY_J_BALANCE = Round(NumericVal(INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES + INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_LABOR_PMS + INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP + INSURANCE_DIRECT_EXPENSE_GOL_BP + INSURANCE_PARTS_HARI + INSURANCE_PARTS_NONHARI + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS), 2)
                        WARRANTY_J_AMOUNTPAID = 0

                        SQL_STATEMENT = "Insert into AMIS_Journal_HD" & _
                                        " (jdate,voucherno,jtype,vendorcode,customercode,invoicedate,invoicetype,invoiceno,invoiceamt,duedate,paytype,refno,refdate,terms,dealer,amounttopay,Balance,AmountPaid,jno,debit,credit,outbalance,status,CheckNo,CheckDate,BankCode,remarks,PaidStatus,ReceiveStatus)" & _
                                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & ", " & J_VENDORCODE & "," & N2Str2Null(CSMIOS_PARTICIPAT) & ", " & J_INVOICEDATE & "," & J_INVOICETYPE & "," & J_INVOICENO & "," & WARRANTY_J_INVOICEAMT & ", " & J_DUEDATE & ", " & J_PAYTYPE & "," & J_REFNO & "," & J_REFDATE & "," & J_TERMS & "," & J_DEALER & ", " & WARRANTY_J_AMOUNTTOPAY & "," & WARRANTY_J_BALANCE & "," & WARRANTY_J_AMOUNTPAID & _
                                        ", " & WARRANTY_JNO & ", " & TOTAL_DEBIT & ", " & TOTAL_CREDIT & ", " & J_OUTBALANCE & ", " & J_STATUS & ", " & J_CHECKNO & ", " & J_CHECKDATE & ", " & J_BANKCODE & ",'" & J_REMARKS & "'," & J_PAIDSTATUS & "," & J_RECEIVESTATUS & ")"
                        gconDMIS.Execute SQL_STATEMENT
                        'AUDIT
                        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_hd", "X", J_JTYPE, "Jtype"))
                        NEW_LogAudit "M", "SALES JOURNAL", SQL_STATEMENT, TransactionID, "", WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO
                    End If
    ENTRY_FOR_INUSURANCE = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    ENTRY_FOR_INUSURANCE = False
    ShowVBError
End Function

Sub INITIALIZE_VARIABLE_NEW(XXX As String)
''GJ VARIABLES
CSMIOS_LABOR = 0:               CSMIOS_LABOR_COST = 0:              CSMIOS_LABOR_DISCOUNT = 0
CSMIOS_PARTS = 0:               CSMIOS_PARTS_COST = 0:              CSMIOS_PARTS_DISCOUNT = 0
CSMIOS_MATERIALS = 0:           CSMIOS_MATERIALS_COST = 0:          CSMIOS_MATERIALS_DISCOUNT = 0
CSMIOS_ACCESSORIES = 0:         CSMIOS_ACCESSORIES_COST = 0:        CSMIOS_ACCESSORIES_DISCOUNT = 0
CSMIOS_SUBLET = 0:              CSMIOS_SUBLET_COST = 0:             CSMIOS_SUBLET_DISCOUNT = 0

''BP VARIABLES
CSMIOS_TINSPAINT = 0:           CSMIOS_TINSPAINT_COST = 0:          CSMIOS_TINSPAINT_DISCOUNT = 0
CSMIOS_TINSPAINT_PARTS = 0:     CSMIOS_TINSPAINT_COST_PARTS = 0:    CSMIOS_TINSPAINT_DISCOUNT_PARTS = 0
CSMIOS_PARTS_BP = 0:            CSMIOS_PARTS_COST_BP = 0:           CSMIOS_PARTS_DISCOUNT_BP = 0
CSMIOS_MATERIALS_BP = 0:        CSMIOS_MATERIALS_COST_BP = 0:       CSMIOS_MATERIALS_DISCOUNT_BP = 0
CSMIOS_ACCESSORIES_BP = 0:      CSMIOS_ACCESSORIES_COST_BP = 0:     CSMIOS_ACCESSORIES_DISCOUNT_BP = 0
CSMIOS_SUBLET_BP = 0:           CSMIOS_SUBLET_COST_BP = 0:          CSMIOS_SUBLET_DISCOUNT_BP = 0

CSMIOS_MISC = 0:                CSMIOS_INSURANCE_MISC = 0

INSURANCE_DIRECT_EXPENSE_LABOR = 0:         INSURANCE_DIRECT_EXPENSE_LABOR_BP = 0:      INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS = 0
INSURANCE_DIRECT_EXPENSE_SPAREPARTS = 0:    INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP = 0
INSURANCE_DIRECT_EXPENSE_GOL = 0:           INSURANCE_DIRECT_EXPENSE_GOL_BP = 0
INSURANCE_DIRECT_EXPENSE_ACCESSORIES = 0:   INSURANCE_DIRECT_EXPENSE_ACCESSORIES_BP = 0
INSURANCE_DIRECT_EXPENSE_SR = 0:            INSURANCE_DIRECT_EXPENSE_SR_BP = 0

WARRANTY_DIRECT_EXPENSE_LABOR = 0
WARRANTY_DIRECT_EXPENSE_LABOR_COST = 0
WARRANTY_DIRECT_EXPENSE_SPAREPARTS = 0
WARRANTY_CSMIOS_PARTS_COST = 0
WARRANTY_DIRECT_EXPENSE_GOL = 0
WARRANTY_CSMIOS_MATERIALS_COST = 0
WARRANTY_DIRECT_EXPENSE_LABOR_SR = 0
WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR = 0
WARRANTY_DIRECT_EXPENSE_LABOR_BP = 0
WARRANTY_DIRECT_EXPENSE_LABOR_COST_BP = 0
WARRANTY_DIRECT_EXPENSE_ACC = 0
WARRANTY_CSMIOS_MATERIALS_COST_ACC = 0

INTERNAL_LABOR_AMT = 0
INTERNAL_LABOR_COST = 0

INTERNAL_LABOR_AMT_BP = 0
INTERNAL_LABOR_COST_BP = 0

INTERNAL_SR_AMT = 0
INTERNAL_SR_COST = 0

INTERNAL_SR_AMT_BP = 0
INTERNAL_SR_COST_BP = 0

INTERNAL_PARTS_AMT = 0
INTERNAL_PARTS_COST = 0

INTERNAL_PARTS_AMT_BP = 0
INTERNAL_PARTS_COST_BP = 0

INTERNAL_MATERIALS_AMT = 0
INTERNAL_MATERIALS_COST = 0

INTERNAL_MATERIALS_AMT_BP = 0
INTERNAL_MATERIALS_COST_BP = 0

INTERNAL_ACCESSORIES_AMT = 0
INTERNAL_ACCESSORIES_COST = 0

INTERNAL_ACCESSORIES_AMT_BP = 0
INTERNAL_ACCESSORIES_COST_BP = 0

INTERNAL_LABOR_AMT_TAG = 0
INTERNAL_LABOR_AMT_BP_TAG = 0
INTERNAL_PARTS_AMT_TAG = 0
INTERNAL_ACCESSORIES_TAG = 0

INTERNAL_LABOR_CODE_GJ = ""
INTERNAL_SR_CODE_GJ = ""
INTERNAL_PARTS_CODE_GJ = ""
INTERNAL_MATERIALS_CODE_GJ = ""
INTERNAL_ACCESSORIES_CODE_GJ = ""

INTERNAL_LABOR_CODE_BP = ""
INTERNAL_SR_CODE_BP = ""
INTERNAL_PARTS_CODE_BP = ""
INTERNAL_MATERIALS_CODE_BP = ""
INTERNAL_ACCESSORIES_CODE_BP = ""

''***CUSTOMER***''''***CUSTOMER***''''***CUSTOMER***''''***CUSTOMER***''''***CUSTOMER***''''***CUSTOMER***''''***CUSTOMER***''''***CUSTOMER***''

''LABOR CUSTOMER GJ ONLY
       If COMPANY_CODE = "HCA" Then
            ''GJ + PMS + MISC
            Set rsCSMIOS_LABOR = New ADODB.Recordset
            Set rsCSMIOS_LABOR = gconDMIS.Execute("Select DET_AMT AS LABOR,DETCOST AS COST,DISCOUNT_2 AS DISCOUNT FROM CSMS_RO_DET Where ISNULL(ROTYPE,0) <> 'SR' AND WCODE IS NULL AND LIVIL = 1 AND ISNULL(JOBTYPE,0) IN ('GJ','PMS') AND REP_OR = " & N2Str2Null(XXX) & " UNION ALL Select DET_AMT AS LABOR,DETCOST AS COST,DISCOUNT_2 AS DISCOUNT FROM CSMS_RO_DET Where REP_OR = " & N2Str2Null(XXX) & " AND WCODE IS NULL AND DETCDE = 'MISC'")
             If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
                 Do While Not rsCSMIOS_LABOR.EOF
                     CSMIOS_LABOR = CSMIOS_LABOR + N2Str2Zero(rsCSMIOS_LABOR!LABOR)
                     CSMIOS_LABOR_COST = CSMIOS_LABOR_COST + N2Str2Zero(rsCSMIOS_LABOR!Cost)
                     CSMIOS_LABOR_DISCOUNT = CSMIOS_LABOR_DISCOUNT + Round(N2Str2Zero(rsCSMIOS_LABOR!DISCOUNT), 2)
                     rsCSMIOS_LABOR.MoveNext
                 Loop
                     CSMIOS_LABOR = Round(CSMIOS_LABOR, 2)
                     CSMIOS_LABOR_COST = Round(CSMIOS_LABOR_COST, 2)
             End If
        ElseIf COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Then
            ''GJ + PMS
            Set rsCSMIOS_LABOR = New ADODB.Recordset
            Set rsCSMIOS_LABOR = gconDMIS.Execute("Select DET_AMT AS LABOR,DETCOST AS COST,DISCOUNT_2 AS DISCOUNT FROM CSMS_RO_DET Where ISNULL(ROTYPE,0) <> 'SR' AND WCODE IS NULL AND LIVIL = 1 AND ISNULL(JOBTYPE,0) IN ('GJ','PMS') AND REP_OR = " & N2Str2Null(XXX) & "")
            If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
                Do While Not rsCSMIOS_LABOR.EOF
                    CSMIOS_LABOR = CSMIOS_LABOR + N2Str2Zero(rsCSMIOS_LABOR!LABOR)
                    CSMIOS_LABOR_COST = CSMIOS_LABOR_COST + N2Str2Zero(rsCSMIOS_LABOR!Cost)
                    CSMIOS_LABOR_DISCOUNT = CSMIOS_LABOR_DISCOUNT + Round(N2Str2Zero(rsCSMIOS_LABOR!DISCOUNT), 2)
                    rsCSMIOS_LABOR.MoveNext
                Loop
                    CSMIOS_LABOR = Round(CSMIOS_LABOR, 2)
                    CSMIOS_LABOR_COST = Round(CSMIOS_LABOR_COST, 2)
            End If
        Else
            ''GJ + PMS + BP
            Set rsCSMIOS_LABOR = New ADODB.Recordset
            Set rsCSMIOS_LABOR = gconDMIS.Execute("Select DET_AMT AS LABOR,DETCOST AS COST,DISCOUNT_2 AS DISCOUNT FROM CSMS_RO_DET Where ISNULL(ROTYPE,0) <> 'SR' AND WCODE IS NULL AND LIVIL = 1 AND ISNULL(JOBTYPE,0) IN ('GJ','PMS','BP') AND REP_OR = " & N2Str2Null(XXX) & "")
            If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
                Do While Not rsCSMIOS_LABOR.EOF
                    CSMIOS_LABOR = CSMIOS_LABOR + N2Str2Zero(rsCSMIOS_LABOR!LABOR)
                    CSMIOS_LABOR_COST = CSMIOS_LABOR_COST + N2Str2Zero(rsCSMIOS_LABOR!Cost)
                    CSMIOS_LABOR_DISCOUNT = CSMIOS_LABOR_DISCOUNT + Round(N2Str2Zero(rsCSMIOS_LABOR!DISCOUNT), 2)
                    rsCSMIOS_LABOR.MoveNext
                Loop
                    CSMIOS_LABOR = Round(CSMIOS_LABOR, 2)
                    CSMIOS_LABOR_COST = Round(CSMIOS_LABOR_COST, 2)
            End If
        End If
        
''SUBLET CUSTOMER GJ ONLY
        If COMPANY_CODE = "HCA" Then
            ''GJ
            Set rsCSMIOS_SUBLET = New ADODB.Recordset
            Set rsCSMIOS_SUBLET = gconDMIS.Execute("Select SUM(DET_AMT) AS SUBLET,ROUND(SUM(DETCOST),2) AS COST,ROUND(SUM(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where ISNULL(ROTYPE,0) = 'SR' AND JOBTYPE = 'GJ' AND  WCODE IS NULL AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_SUBLET.EOF And Not rsCSMIOS_SUBLET.BOF Then
                CSMIOS_SUBLET = N2Str2Zero(rsCSMIOS_SUBLET!SUBLET)
                CSMIOS_SUBLET_COST = N2Str2Zero(rsCSMIOS_SUBLET!Cost)
                CSMIOS_SUBLET_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_SUBLET!DISCOUNT), 2)
            End If
        ElseIf COMPANY_CODE = "CMC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
            ''GJ + BP
            Set rsCSMIOS_SUBLET = New ADODB.Recordset
            Set rsCSMIOS_SUBLET = gconDMIS.Execute("Select SUM(DET_AMT) AS SUBLET,ROUND(SUM(DETCOST),2) AS COST,ROUND(SUM(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where ISNULL(ROTYPE,0) = 'SR' AND JOBTYPE IN ('GJ','BP') AND  WCODE IS NULL AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_SUBLET.EOF And Not rsCSMIOS_SUBLET.BOF Then
                CSMIOS_SUBLET = N2Str2Zero(rsCSMIOS_SUBLET!SUBLET)
                CSMIOS_SUBLET_COST = N2Str2Zero(rsCSMIOS_SUBLET!Cost)
                CSMIOS_SUBLET_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_SUBLET!DISCOUNT), 2)
            End If
        ElseIf COMPANY_CODE = "DJM" Then
            ''GJ + PMS || COST DEPENDS ON SERVICE
            Set rsCSMIOS_SUBLET = New ADODB.Recordset
            Set rsCSMIOS_SUBLET = gconDMIS.Execute("SELECT SUM(TOTALCOST.SUBLT) AS SUBLET,SUM(TOTALCOST.COSTAMOUNT) AS COST, SUM(TOTALCOST.DISC) AS DISCOUNT FROM( " & _
                                                   "SELECT CS.SUBLT,(CASE WHEN CS.ISNONVAT = 'N' THEN CS.COST / 1.12 ELSE CS.COST  END) COSTAMOUNT,CS.DISC FROM( " & _
                                                   "SELECT ISNULL(DET_AMT,0) AS SUBLT,ISNULL(DETCOST,0) AS COST,ISNULL(DISCOUNT_2,0) AS DISC,TECHCODE,(SELECT V.NONVAT FROM ALL_VENDOR_TABLE V WHERE CODE=DT.TECHCODE) AS ISNONVAT FROM CSMS_RO_DET DT " & _
                                                   "WHERE ISNULL(ROTYPE,0) = 'SR' AND JOBTYPE IN ('GJ','PMS') AND  WCODE IS NULL AND REP_OR = " & N2Str2Null(XXX) & "" & _
                                                   ")CS " & _
                                                   ")TOTALCOST")
            
            If Not rsCSMIOS_SUBLET.EOF And Not rsCSMIOS_SUBLET.BOF Then
                CSMIOS_SUBLET = N2Str2Zero(rsCSMIOS_SUBLET!SUBLET)
                CSMIOS_SUBLET_COST = N2Str2Zero(rsCSMIOS_SUBLET!Cost)
                CSMIOS_SUBLET_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_SUBLET!DISCOUNT), 2)
            End If
        Else
            ''GJ
            Set rsCSMIOS_SUBLET = New ADODB.Recordset
            Set rsCSMIOS_SUBLET = gconDMIS.Execute("Select SUM(DET_AMT) AS SUBLET,ROUND(SUM(DETCOST),2) AS COST,ROUND(SUM(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where ISNULL(ROTYPE,0) = 'SR' AND JOBTYPE = 'GJ' AND  WCODE IS NULL AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_SUBLET.EOF And Not rsCSMIOS_SUBLET.BOF Then
                CSMIOS_SUBLET = N2Str2Zero(rsCSMIOS_SUBLET!SUBLET)
                CSMIOS_SUBLET_COST = N2Str2Zero(rsCSMIOS_SUBLET!Cost)
                CSMIOS_SUBLET_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_SUBLET!DISCOUNT), 2)
            End If
        End If
        
''PARTS CUSTOMER GJ ONLY
        If COMPANY_CODE = "HCA" Then
            ''GJ
            Set rsCSMIOS_PARTS = New ADODB.Recordset
            Set rsCSMIOS_PARTS = gconDMIS.Execute("Select SUM(DET_AMT) AS PARTS,ROUND(SUM(DETCOST * DETVOL),2) AS PARTS_COST,SUM(DISCOUNT_2) AS DISCOUNT from CSMS_RO_DET Where livil = 2 AND ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL) AND ISNULL(JOBTYPE,0) = 'GJ' AND  REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                    CSMIOS_PARTS = N2Str2Zero(rsCSMIOS_PARTS!PARTS)
                    CSMIOS_PARTS_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS_COST), 2)
                    CSMIOS_PARTS_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_PARTS!DISCOUNT), 2)
            End If
        ElseIf COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Then
            ''GJ + PMS
            Set rsCSMIOS_PARTS = New ADODB.Recordset
            Set rsCSMIOS_PARTS = gconDMIS.Execute("Select SUM(DET_AMT) AS PARTS,ROUND(SUM(DETCOST * DETVOL),2) AS PARTS_COST,SUM(DISCOUNT_2) AS DISCOUNT from CSMS_RO_DET Where livil = 2 AND ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL) AND ISNULL(JOBTYPE,0) IN ('GJ','PMS') AND  REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                    CSMIOS_PARTS = N2Str2Zero(rsCSMIOS_PARTS!PARTS)
                    CSMIOS_PARTS_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS_COST), 2)
                    CSMIOS_PARTS_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_PARTS!DISCOUNT), 2)
            End If
        ElseIf COMPANY_CODE = "CMC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
            ''GJ + PMS + BP
            Set rsCSMIOS_PARTS = New ADODB.Recordset
            Set rsCSMIOS_PARTS = gconDMIS.Execute("Select SUM(DET_AMT) AS PARTS,ROUND(SUM(DETCOST * DETVOL),2) AS PARTS_COST,SUM(DISCOUNT_2) AS DISCOUNT from CSMS_RO_DET Where livil = 2 AND ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL) AND ISNULL(JOBTYPE,0) IN ('GJ','PMS','BP') AND  REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                    CSMIOS_PARTS = N2Str2Zero(rsCSMIOS_PARTS!PARTS)
                    CSMIOS_PARTS_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS_COST), 2)
                    CSMIOS_PARTS_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_PARTS!DISCOUNT), 2)
            End If
        Else
            ''GJ + PMS + BP
            Set rsCSMIOS_PARTS = New ADODB.Recordset
            Set rsCSMIOS_PARTS = gconDMIS.Execute("Select SUM(DET_AMT) AS PARTS,ROUND(SUM(DETCOST * DETVOL),2) AS PARTS_COST,SUM(DISCOUNT_2) AS DISCOUNT from CSMS_RO_DET Where livil = 2 AND ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL) AND ISNULL(JOBTYPE,0) IN ('GJ','PMS','BP') AND  REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                    CSMIOS_PARTS = N2Str2Zero(rsCSMIOS_PARTS!PARTS)
                    CSMIOS_PARTS_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_PARTS!DISCOUNT), 2)
                    If COMPANY_CODE <> "HCE" Then
                        CSMIOS_PARTS_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS_COST), 2)
                    Else
                            Set rsCSMIOS_PARTS = New ADODB.Recordset
                            Set rsCSMIOS_PARTS = gconDMIS.Execute("SELECT ROUND(SUM(DETCOST * DETVOL),2) AS COST FROM CSMS_RO_DET  WHERE  LIVIL = 2 AND (WCODE IS NULL) AND ISNULL(JOBTYPE,0) IN ('GJ','PMS','BP') AND (SELECT NON_HARI FROM PMIS_STOCKMAS WHERE STOCKNO = DETCDE) ='N' AND REP_OR = " & N2Str2Null(XXX) & "")
                            If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                                CSMIOS_PARTS_INV_GEN = Round(N2Str2Zero(rsCSMIOS_PARTS!Cost), 2)
                            End If
                    
                            Set rsCSMIOS_PARTS_NON = New ADODB.Recordset
                            Set rsCSMIOS_PARTS = gconDMIS.Execute("SELECT ROUND(SUM(DETCOST * DETVOL),2) AS COST FROM CSMS_RO_DET  WHERE  LIVIL = 2 AND (WCODE IS NULL) AND ISNULL(JOBTYPE,0) IN ('GJ','PMS','BP') AND (SELECT NON_HARI FROM PMIS_STOCKMAS WHERE STOCKNO = DETCDE) IN ('Y','O') AND REP_OR = " & N2Str2Null(XXX) & "")
                            If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                               CSMIOS_PARTS_INV_NONGEN = Round(N2Str2Zero(rsCSMIOS_PARTS!Cost), 2)
                            End If
                    End If
            End If
        End If

''MATERIALS CUSTOMER GJ ONLY
        If COMPANY_CODE = "HCA" Then
            ''GJ + MISC
            Set rsCSMIOS_MATERIALS = New ADODB.Recordset
            Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select SUM(DET_AMT) AS MATERIALS,ROUND(SUM(DETCOST * DETVOL),2) AS MAT_COST,SUM(DISCOUNT_2) AS DISCOUNT from CSMS_RO_DET Where livil = 3 AND ISNULL(ROTYPE,0) <> 'SR' AND JOBTYPE = 'GJ' AND (WCODE IS NULL) AND DETCDE <> 'MISC'  AND  REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
                    CSMIOS_MATERIALS = N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS)
                    CSMIOS_MATERIALS_COST = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MAT_COST), 2)
                    CSMIOS_MATERIALS_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_MATERIALS!DISCOUNT), 2)
            End If
        ElseIf COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Then
            ''GJ
            Set rsCSMIOS_MATERIALS = New ADODB.Recordset
            Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select SUM(DET_AMT) AS MATERIALS,ROUND(SUM(DETCOST * DETVOL),2) AS MAT_COST,SUM(DISCOUNT_2) AS DISCOUNT from CSMS_RO_DET Where livil = 3 AND ISNULL(ROTYPE,0) <> 'SR' AND JOBTYPE ='GJ' AND (WCODE IS NULL) AND  REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
                CSMIOS_MATERIALS = N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS)
                CSMIOS_MATERIALS_COST = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MAT_COST), 2)
                CSMIOS_MATERIALS_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_MATERIALS!DISCOUNT), 2)
            End If
        ElseIf COMPANY_CODE = "CMC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
            ''GJ + BP
            Set rsCSMIOS_MATERIALS = New ADODB.Recordset
            Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select SUM(DET_AMT) AS MATERIALS,ROUND(SUM(DETCOST * DETVOL),2) AS MAT_COST,SUM(DISCOUNT_2) AS DISCOUNT from CSMS_RO_DET Where livil = 3 AND ISNULL(ROTYPE,0) <> 'SR' AND JOBTYPE IN ('GJ','BP') AND (WCODE IS NULL) AND  REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
                CSMIOS_MATERIALS = N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS)
                CSMIOS_MATERIALS_COST = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MAT_COST), 2)
                CSMIOS_MATERIALS_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_MATERIALS!DISCOUNT), 2)
            End If
        Else
            If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                ''GJ + PMS + BP
                Set rsCSMIOS_MATERIALS = New ADODB.Recordset
                Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select SUM(DET_AMT) AS MATERIALS,ROUND(SUM(DETCOST * DETVOL),2) AS MAT_COST,SUM(DISCOUNT_2) AS DISCOUNT from CSMS_RO_DET Where livil = 3 AND ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL) AND DETCDE <> 'MISC'  AND  REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
                    CSMIOS_MATERIALS = N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS)
                    CSMIOS_MATERIALS_COST = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MAT_COST), 2)
                    CSMIOS_MATERIALS_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_MATERIALS!DISCOUNT), 2)
                End If
                
                ''MISC
                Set rsCSMIOS_MATERIALS = New ADODB.Recordset
                Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select SUM(DET_AMT) AS MATERIALS,ROUND(SUM(DETCOST * DETVOL),2) AS MAT_COST,SUM(DISCOUNT_2) AS DISCOUNT from CSMS_RO_DET Where livil = 3 AND ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL) AND DETCDE = 'MISC'  AND  REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
                    CSMIOS_MISC = N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS)
                End If
            Else
                ''GJ + PMS + BP
                Set rsCSMIOS_MATERIALS = New ADODB.Recordset
                Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select SUM(DET_AMT) AS MATERIALS,ROUND(SUM(DETCOST * DETVOL),2) AS MAT_COST,SUM(DISCOUNT_2) AS DISCOUNT from CSMS_RO_DET Where livil = 3 AND ISNULL(ROTYPE,0) <> 'SR' AND ISNULL(JOBTYPE,0) IN ('GJ','PMS','BP') AND (WCODE IS NULL) AND  REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
                    CSMIOS_MATERIALS = N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS)
                    CSMIOS_MATERIALS_COST = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MAT_COST), 2)
                    CSMIOS_MATERIALS_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_MATERIALS!DISCOUNT), 2)
                End If
            End If
        End If
        
''ACCESSORIES CUSTOMER GJ ONLY
        If COMPANY_CODE = "HCA" Then
            ''GJ
            Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
            CSMIOS_ACCESSORIES = 0: CSMIOS_ACCESSORIES_DISCOUNT = 0
            Set rsCSMIOS_ACCESSORIES = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS ACCESSORIES,ROUND(SUM(DETCOST * DETVOL),2) AS ACC_COST,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where LIVIL = 4 and WCODE IS NULL and ISNULL(JOBTYPE,0) = 'GJ' and ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
                CSMIOS_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!Accessories), 2)
                CSMIOS_ACCESSORIES_COST = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!ACC_COST), 2)
                CSMIOS_ACCESSORIES_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!DISCOUNT), 2)
            End If
        ElseIf COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
            ''GJ + PMS
            Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
            CSMIOS_ACCESSORIES = 0: CSMIOS_ACCESSORIES_DISCOUNT = 0
            Set rsCSMIOS_ACCESSORIES = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS ACCESSORIES,ROUND(SUM(DETCOST * DETVOL),2) AS ACC_COST,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where LIVIL = 4 and WCODE IS NULL AND JOBTYPE IN ('GJ','PMS') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
                CSMIOS_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!Accessories), 2)
                CSMIOS_ACCESSORIES_COST = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!ACC_COST), 2)
                CSMIOS_ACCESSORIES_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!DISCOUNT), 2)
            End If
        ElseIf COMPANY_CODE = "CMC" Then
            ''GJ + BP
            Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
            CSMIOS_ACCESSORIES = 0: CSMIOS_ACCESSORIES_DISCOUNT = 0
            Set rsCSMIOS_ACCESSORIES = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS ACCESSORIES,ROUND(SUM(DETCOST * DETVOL),2) AS ACC_COST,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where LIVIL = 4 and WCODE IS NULL AND JOBTYPE IN ('GJ','BP') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
                CSMIOS_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!Accessories), 2)
                CSMIOS_ACCESSORIES_COST = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!ACC_COST), 2)
                CSMIOS_ACCESSORIES_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!DISCOUNT), 2)
            End If
        Else
            ''GJ + PMS + BP
            Set rsCSMIOS_ACCESSORIES = New ADODB.Recordset
            CSMIOS_ACCESSORIES = 0: CSMIOS_ACCESSORIES_DISCOUNT = 0
            Set rsCSMIOS_ACCESSORIES = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS ACCESSORIES,ROUND(SUM(DETCOST * DETVOL),2) AS ACC_COST,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT from CSMS_RO_DET Where LIVIL = 4 and WCODE IS NULL AND ISNULL(JOBTYPE,0) IN ('GJ','PMS','BP') and ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_ACCESSORIES.EOF And Not rsCSMIOS_ACCESSORIES.BOF Then
                CSMIOS_ACCESSORIES = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!Accessories), 2)
                CSMIOS_ACCESSORIES_COST = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!ACC_COST), 2)
                CSMIOS_ACCESSORIES_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES!DISCOUNT), 2)
            End If
        End If
''***END OF GJ ONLY***''


''***START OF BP ONLY***''
''LABOR CUSTOMER BP ONLY
    If COMPANY_CODE = "HCA" Then
        Set rsCSMIOS_TINSMITH = New ADODB.Recordset
        Set rsCSMIOS_TINSMITH = gconDMIS.Execute("Select SUM(DET_AMT) AS TINSPAINT,ROUND(SUM(DETCOST),2) AS COST,SUM(DISCOUNT_2) AS DISCOUNT FROM CSMS_RO_DET Where WCODE IS NULL  AND ISNULL(JOBTYPE,0) = 'BP' AND LIVIL = 1  AND REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_TINSMITH.EOF And Not rsCSMIOS_TINSMITH.BOF Then
            CSMIOS_TINSPAINT = N2Str2Zero(rsCSMIOS_TINSMITH!TINSPAINT)
            CSMIOS_TINSPAINT_COST = N2Str2Zero(rsCSMIOS_TINSMITH!Cost)
            CSMIOS_TINSPAINT_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_TINSMITH!DISCOUNT), 2)
        End If
        
        Set rsCSMIOS_TINSMITH = New ADODB.Recordset
        Set rsCSMIOS_TINSMITH = gconDMIS.Execute("Select SUM(DET_AMT) AS TINSPAINT,ROUND(SUM(DETCOST * DETVOL),2) AS COST,ROUND(SUM(DISCOUNT_2),2) AS DISCOUNT FROM CSMS_RO_DET Where WCODE IS NULL  AND ISNULL(JOBTYPE,0) = 'BP' AND LIVIL <> 1 AND REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_TINSMITH.EOF And Not rsCSMIOS_TINSMITH.BOF Then
            CSMIOS_TINSPAINT_PARTS = N2Str2Zero(rsCSMIOS_TINSMITH!TINSPAINT)
            CSMIOS_TINSPAINT_COST_PARTS = Round(N2Str2Zero(rsCSMIOS_TINSMITH!Cost), 2)
            CSMIOS_TINSPAINT_DISCOUNT_PARTS = Round(N2Str2Zero(rsCSMIOS_TINSMITH!DISCOUNT), 2)
        End If
    ElseIf COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
    ElseIf COMPANY_CODE = "CMC" Then
    Else
        Set rsCSMIOS_TINSMITH = New ADODB.Recordset
        Set rsCSMIOS_TINSMITH = gconDMIS.Execute("Select SUM(DET_AMT) AS LABOR,SUM(DETCOST) AS COST,SUM(DISCOUNT_2) AS DISCOUNT FROM CSMS_RO_DET Where ISNULL(ROTYPE,0) <> 'SR' AND WCODE IS NULL AND LIVIL = 1 AND ISNULL(JOBTYPE,0) = 'BP' AND REP_OR = " & N2Str2Null(XXX) & "")
        If Not rsCSMIOS_TINSMITH.EOF And Not rsCSMIOS_TINSMITH.BOF Then
            CSMIOS_TINSPAINT = Round(N2Str2Zero(rsCSMIOS_TINSMITH!LABOR), 2)
            CSMIOS_TINSPAINT_COST = Round(N2Str2Zero(rsCSMIOS_TINSMITH!Cost), 2)
            CSMIOS_TINSPAINT_DISCOUNT = Round(N2Str2Zero(rsCSMIOS_TINSMITH!DISCOUNT), 2)
        End If
    End If
    
''SUBLET CUSTOMER BP ONLY
    If COMPANY_CODE = "DJM" Then
        Set rsCSMIOS_SUBLET = New ADODB.Recordset
        Set rsCSMIOS_SUBLET = gconDMIS.Execute("SELECT SUM(TOTALCOST.SUBLT) AS SUBLET,SUM(TOTALCOST.COSTAMOUNT) AS COST, SUM(TOTALCOST.DISC) AS DISCOUNT FROM( " & _
                                       "SELECT CS.SUBLT,(CASE WHEN CS.ISNONVAT = 'N' THEN CS.COST / 1.12 ELSE CS.COST  END) COSTAMOUNT,CS.DISC FROM( " & _
                                       "SELECT ISNULL(DET_AMT,0) AS SUBLT,ISNULL(DETCOST,0) AS COST,ISNULL(DISCOUNT_2,0) AS DISC,TECHCODE,(SELECT V.NONVAT FROM ALL_VENDOR_TABLE V WHERE CODE=DT.TECHCODE) AS ISNONVAT FROM CSMS_RO_DET DT " & _
                                       "WHERE ISNULL(ROTYPE,0) = 'SR' AND JOBTYPE = 'BP' AND  WCODE IS NULL AND REP_OR = " & N2Str2Null(XXX) & "" & _
                                       ")CS " & _
                                       ")TOTALCOST")
                                       
        If Not rsCSMIOS_SUBLET.EOF And Not rsCSMIOS_SUBLET.BOF Then
            CSMIOS_SUBLET_BP = N2Str2Zero(rsCSMIOS_SUBLET!SUBLET)
            CSMIOS_SUBLET_COST_BP = N2Str2Zero(rsCSMIOS_SUBLET!Cost)
            CSMIOS_SUBLET_DISCOUNT_BP = Round(N2Str2Zero(rsCSMIOS_SUBLET!DISCOUNT), 2)
        End If
    ElseIf COMPANY_CODE = "CMC" Or COMPANY_CODE = "MGS" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
    End If
    
''PARTS CUSTOMER BP ONLY
    If COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Then
        Set rsCSMIOS_PARTS_BP = New ADODB.Recordset
        Set rsCSMIOS_PARTS_BP = gconDMIS.Execute("Select SUM(DET_AMT) AS PARTS,ROUND(SUM(DETCOST * DETVOL),2) AS PARTS_COST,SUM(DISCOUNT_2) AS DISCOUNT from CSMS_RO_DET Where livil = 2 AND ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL) AND ISNULL(JOBTYPE,0) = 'BP' AND  REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_PARTS_BP.EOF And Not rsCSMIOS_PARTS_BP.BOF Then
            CSMIOS_PARTS_BP = N2Str2Zero(rsCSMIOS_PARTS_BP!PARTS)
            CSMIOS_PARTS_COST_BP = Round(N2Str2Zero(rsCSMIOS_PARTS_BP!PARTS_COST), 2)
            CSMIOS_PARTS_DISCOUNT_BP = Round(N2Str2Zero(rsCSMIOS_PARTS_BP!DISCOUNT), 2)
        End If
    ElseIf COMPANY_CODE = "CMC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
    End If
    
''MATERIALS CUSTOMER BP ONLY
    If COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Then
        Set rsCSMIOS_MATERIALS_BP = New ADODB.Recordset
        Set rsCSMIOS_MATERIALS_BP = gconDMIS.Execute("Select SUM(DET_AMT) AS MATERIALS,ROUND(SUM(DETCOST * DETVOL),2) AS MATERIALS_COST,SUM(DISCOUNT_2) AS DISCOUNT from CSMS_RO_DET Where livil = 3 AND ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL) AND ISNULL(JOBTYPE,0) = 'BP' AND  REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_MATERIALS_BP.EOF And Not rsCSMIOS_MATERIALS_BP.BOF Then
            CSMIOS_MATERIALS_BP = N2Str2Zero(rsCSMIOS_MATERIALS_BP!MATERIALS)
            CSMIOS_MATERIALS_COST_BP = Round(N2Str2Zero(rsCSMIOS_MATERIALS_BP!MATERIALS_COST), 2)
            CSMIOS_MATERIALS_DISCOUNT_BP = Round(N2Str2Zero(rsCSMIOS_MATERIALS_BP!DISCOUNT), 2)
        End If
    ElseIf COMPANY_CODE = "CMC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
    End If
    
''ACCESSORIES CUSTOMER BP ONLY
    If COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Then
        Set rsCSMIOS_ACCESSORIES_BP = New ADODB.Recordset
        Set rsCSMIOS_ACCESSORIES_BP = gconDMIS.Execute("Select SUM(DET_AMT) AS ACCESSORIES,ROUND(SUM(DETCOST * DETVOL),2) AS ACCESSORIES_COST,SUM(DISCOUNT_2) AS DISCOUNT from CSMS_RO_DET Where livil = 4 AND ISNULL(ROTYPE,0) <> 'SR' AND (WCODE IS NULL) AND ISNULL(JOBTYPE,0) = 'BP' AND  REP_OR = " & N2Str2Null(XXX))
        If Not rsCSMIOS_ACCESSORIES_BP.EOF And Not rsCSMIOS_ACCESSORIES_BP.BOF Then
            CSMIOS_ACCESSORIES_BP = N2Str2Zero(rsCSMIOS_ACCESSORIES_BP!Accessories)
            CSMIOS_ACCESSORIES_COST_BP = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES_BP!ACCESSORIES_COST), 2)
            CSMIOS_ACCESSORIES_DISCOUNT_BP = Round(N2Str2Zero(rsCSMIOS_ACCESSORIES_BP!DISCOUNT), 2)
        End If
    ElseIf COMPANY_CODE = "CMC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
    End If
''***CUSTOMER END***''''***CUSTOMER END***''''***CUSTOMER END***''''***CUSTOMER END***''''***CUSTOMER END***''''***CUSTOMER END***''


''***INSURANCE START***''''***INSURANCE START***''''***INSURANCE START***''''***INSURANCE START***''''***INSURANCE START***''''***INSURANCE START***''
    Set rsCSMIOS_MATERIALS = New ADODB.Recordset
    Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select * from CSMIOS_INSURANCE Where REP_OR = " & N2Str2Null(XXX))
    If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
    ''LABOR INSURANCE GJ ONLY
            If COMPANY_CODE = "HCA" Then
                Set rsCSMIOS_GJ = gconDMIS.Execute("SELECT SUM(ISNULL(GJ_INSURANCE,0)) AS GJ_INSURANCE FROM( " & _
                                                    "SELECT SUM(ISNULL(GJ_INSURANCE,0)) AS GJ_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=1  AND JOBTYPE IN ('GJ','PMS') AND ISNULL(ROTYPE,0) <>'SR' AND REP_OR = " & N2Str2Null(XXX) & "" & _
                                                    "UNION ALL " & _
                                                    "SELECT SUM(ISNULL(GJ_INSURANCE,0)) AS GJ_INSURANCE FROM CSMS_RO_DET WHERE  DETCDE = 'MISC' AND  REP_OR = " & N2Str2Null(XXX) & " ) A")
                If Not rsCSMIOS_GJ.EOF And Not rsCSMIOS_GJ.BOF Then
                    INSURANCE_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_GJ!GJ_INSURANCE), 2)
                End If
            ElseIf COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                Set rsCSMIOS_GJ = gconDMIS.Execute("SELECT (SUM(ISNULL(GJ_INSURANCE,0))+ SUM(ISNULL(BP_INSURANCE,0))) AS GJ_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=1  AND JOBTYPE IN ('GJ','PMS','BP') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX) & "")
                If Not rsCSMIOS_GJ.EOF And Not rsCSMIOS_GJ.BOF Then
                    INSURANCE_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_GJ!GJ_INSURANCE), 2)
                End If
            ElseIf COMPANY_CODE = "CMC" Then
            Else
                Set rsCSMIOS_GJ = gconDMIS.Execute("SELECT SUM(ISNULL(GJ_INSURANCE,0)) AS GJ_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=1  AND JOBTYPE IN ('GJ','PMS') AND ISNULL(ROTYPE,0) <>'SR' AND REP_OR = " & N2Str2Null(XXX) & "")
                If Not rsCSMIOS_GJ.EOF And Not rsCSMIOS_GJ.BOF Then
                    INSURANCE_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_GJ!GJ_INSURANCE), 2)
                End If
            End If
            
     ''SUBLET INSURANCE GJ ONLY
            If COMPANY_CODE = "HCA" Then
                Set rsCSMIOS_SR = New ADODB.Recordset
                Set rsCSMIOS_SR = gconDMIS.Execute("SELECT SUM(ISNULL(GJ_INSURANCE,0)) + SUM(ISNULL(BP_INSURANCE,0)) AS GJ_INSURANCE  FROM CSMS_RO_DET WHERE ROTYPE='SR' AND JOBTYPE IN ('GJ','PMS') AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_SR.EOF And Not rsCSMIOS_SR.BOF Then
                    INSURANCE_DIRECT_EXPENSE_SR = Round(N2Str2Zero(rsCSMIOS_SR!GJ_INSURANCE), 2)
                End If
            ElseIf COMPANY_CODE = "DJM" Then
                Set rsCSMIOS_SR = New ADODB.Recordset
                Set rsCSMIOS_SR = gconDMIS.Execute("SELECT SUM(ISNULL(GJ_INSURANCE,0)) AS GJ_INSURANCE  FROM CSMS_RO_DET WHERE ROTYPE='SR' AND JOBTYPE IN ('GJ','PMS') AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_SR.EOF And Not rsCSMIOS_SR.BOF Then
                    INSURANCE_DIRECT_EXPENSE_SR = Round(N2Str2Zero(rsCSMIOS_SR!GJ_INSURANCE), 2)
                End If
            ElseIf COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                Set rsCSMIOS_SR = New ADODB.Recordset
                Set rsCSMIOS_SR = gconDMIS.Execute("SELECT SUM(ISNULL(GJ_INSURANCE,0)) + SUM(ISNULL(BP_INSURANCE,0)) AS GJ_INSURANCE  FROM CSMS_RO_DET WHERE ROTYPE='SR' AND JOBTYPE IN ('GJ','PMS','BP') AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_SR.EOF And Not rsCSMIOS_SR.BOF Then
                    INSURANCE_DIRECT_EXPENSE_SR = Round(N2Str2Zero(rsCSMIOS_SR!GJ_INSURANCE), 2)
                End If
            ElseIf COMPANY_CODE = "CMC" Then
            Else
                Set rsCSMIOS_SR = New ADODB.Recordset
                Set rsCSMIOS_SR = gconDMIS.Execute("SELECT SUM(ISNULL(GJ_INSURANCE,0)) + SUM(ISNULL(BP_INSURANCE,0)) AS GJ_INSURANCE  FROM CSMS_RO_DET WHERE ROTYPE='SR' AND JOBTYPE IN ('GJ','PMS','BP') AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_SR.EOF And Not rsCSMIOS_SR.BOF Then
                    INSURANCE_DIRECT_EXPENSE_SR = Round(N2Str2Zero(rsCSMIOS_SR!GJ_INSURANCE), 2)
                End If
            End If
            
    ''PARTS INSURANCE GJ ONLY
            Dim rsCSMIOS_INSPARTS_GJ As New Recordset
            If COMPANY_CODE = "HCA" Then
                Set rsCSMIOS_INSPARTS_GJ = New ADODB.Recordset
                Set rsCSMIOS_INSPARTS_GJ = gconDMIS.Execute("SELECT SUM(ISNULL(GJ_INSURANCE,0)) AS GJ_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=2  AND JOBTYPE IN ('GJ','PMS')  AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_INSPARTS_GJ.EOF And Not rsCSMIOS_INSPARTS_GJ.BOF Then
                    INSURANCE_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_INSPARTS_GJ!GJ_INSURANCE), 2)
                End If
            ElseIf COMPANY_CODE = "DJM" Then
                Set rsCSMIOS_INSPARTS_GJ = New ADODB.Recordset
                Set rsCSMIOS_INSPARTS_GJ = gconDMIS.Execute("SELECT SUM(ISNULL(GJ_INSURANCE,0)) AS GJ_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=2  AND JOBTYPE IN ('GJ','PMS')  AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_INSPARTS_GJ.EOF And Not rsCSMIOS_INSPARTS_GJ.BOF Then
                    INSURANCE_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_INSPARTS_GJ!GJ_INSURANCE), 2)
                End If
            ElseIf COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                Set rsCSMIOS_INSPARTS_GJ = New ADODB.Recordset
                Set rsCSMIOS_INSPARTS_GJ = gconDMIS.Execute("SELECT (SUM(ISNULL(GJ_INSURANCE,0))+ SUM(ISNULL(BP_INSURANCE,0))) AS GJ_INSURANCE FROM CSMS_RO_DET WHERE LIVIL = 2  AND JOBTYPE IN ('GJ','PMS','BP')  AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_INSPARTS_GJ.EOF And Not rsCSMIOS_INSPARTS_GJ.BOF Then
                    INSURANCE_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_INSPARTS_GJ!GJ_INSURANCE), 2)
                End If
            ElseIf COMPANY_CODE = "CMC" Then
            Else
                Set rsCSMIOS_INSPARTS_GJ = New ADODB.Recordset
                Set rsCSMIOS_INSPARTS_GJ = gconDMIS.Execute("SELECT (SUM(ISNULL(GJ_INSURANCE,0))+ SUM(ISNULL(BP_INSURANCE,0))) AS GJ_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=2  AND JOBTYPE IN ('GJ','PMS','BP')  AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_INSPARTS_GJ.EOF And Not rsCSMIOS_INSPARTS_GJ.BOF Then
                    INSURANCE_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_INSPARTS_GJ!GJ_INSURANCE), 2)
                End If
            End If
                
    ''MATERIALS INSURANCE GJ ONLY
            Dim rsCSMIOS_INSMATERIALS_GJ As New Recordset
            If COMPANY_CODE = "HCA" Then
                Set rsCSMIOS_INSMATERIALS_GJ = New ADODB.Recordset
                Set rsCSMIOS_INSMATERIALS_GJ = gconDMIS.Execute("SELECT SUM(ISNULL(GJ_INSURANCE,0)) AS GJ_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=3  AND JOBTYPE IN ('GJ','PMS') AND DETCDE <> 'MISC' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_INSMATERIALS_GJ.EOF And Not rsCSMIOS_INSMATERIALS_GJ.BOF Then
                    INSURANCE_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_INSMATERIALS_GJ!GJ_INSURANCE), 2)
                End If
            ElseIf COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                Set rsCSMIOS_INSMATERIALS_GJ = New ADODB.Recordset
                Set rsCSMIOS_INSMATERIALS_GJ = gconDMIS.Execute("SELECT (SUM(ISNULL(GJ_INSURANCE,0))+SUM(ISNULL(BP_INSURANCE,0))) AS GJ_INSURANCE FROM CSMS_RO_DET WHERE LIVIL IN (3,4)  AND JOBTYPE IN ('GJ','PMS','BP') AND ISNULL(ROTYPE,0) <> 'SR' AND DETCDE <> 'MISC' AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_INSMATERIALS_GJ.EOF And Not rsCSMIOS_INSMATERIALS_GJ.BOF Then
                    INSURANCE_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_INSMATERIALS_GJ!GJ_INSURANCE), 2)
                End If
                
                Set rsCSMIOS_INSMATERIALS_GJ = New ADODB.Recordset
                Set rsCSMIOS_INSMATERIALS_GJ = gconDMIS.Execute("SELECT (SUM(ISNULL(GJ_INSURANCE,0))+SUM(ISNULL(BP_INSURANCE,0))) AS GJ_INSURANCE FROM CSMS_RO_DET WHERE LIVIL IN (3,4)  AND JOBTYPE IN ('GJ','PMS','BP') AND ISNULL(ROTYPE,0) <> 'SR' AND DETCDE = 'MISC' AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_INSMATERIALS_GJ.EOF And Not rsCSMIOS_INSMATERIALS_GJ.BOF Then
                    CSMIOS_INSURANCE_MISC = Round(N2Str2Zero(rsCSMIOS_INSMATERIALS_GJ!GJ_INSURANCE), 2)
                End If
            ElseIf COMPANY_CODE = "DJM" Then
                Set rsCSMIOS_INSMATERIALS_GJ = New ADODB.Recordset
                Set rsCSMIOS_INSMATERIALS_GJ = gconDMIS.Execute("SELECT ISNULL(GJ_INSURANCE,0) AS GJ_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=3  AND JOBTYPE = 'GJ' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_INSMATERIALS_GJ.EOF And Not rsCSMIOS_INSMATERIALS_GJ.BOF Then
                    INSURANCE_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_INSMATERIALS_GJ!GJ_INSURANCE), 2)
                End If
            ElseIf COMPANY_CODE = "CMC" Then
            Else
                Set rsCSMIOS_INSMATERIALS_GJ = New ADODB.Recordset
                Set rsCSMIOS_INSMATERIALS_GJ = gconDMIS.Execute("SELECT (SUM(ISNULL(GJ_INSURANCE,0))+ SUM(ISNULL(BP_INSURANCE,0))) AS GJ_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=3  AND JOBTYPE IN ('GJ','PMS','BP') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_INSMATERIALS_GJ.EOF And Not rsCSMIOS_INSMATERIALS_GJ.BOF Then
                    INSURANCE_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_INSMATERIALS_GJ!GJ_INSURANCE), 2)
                End If
            End If
            
    ''ACCESSORRIES INSURANCE GJ ONLY
            Dim rsINS_ACCESSORIES As ADODB.Recordset
            If COMPANY_CODE = "HCA" Then
                Set rsINS_ACCESSORIES = New ADODB.Recordset
                Set rsINS_ACCESSORIES = gconDMIS.Execute("Select SUM(GJ_INSURANCE) AS INSURANCE from CSMS_RO_DET Where ISNULL(ROTYPE,0) <> 'SR' AND JOBTYPE IN ('GJ','PMS') AND WCODE IS NULL AND LIVIL = 4 AND REP_OR = " & N2Str2Null(XXX))
                If Not rsINS_ACCESSORIES.EOF And Not rsINS_ACCESSORIES.BOF Then
                    INSURANCE_DIRECT_EXPENSE_ACCESSORIES = Round(N2Str2Zero(rsINS_ACCESSORIES!INSURANCE), 2)
                End If
            ElseIf COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
            ElseIf COMPANY_CODE = "CMC" Then
            Else
                Set rsINS_ACCESSORIES = New ADODB.Recordset
                Set rsINS_ACCESSORIES = gconDMIS.Execute("Select (SUM(ISNULL(GJ_INSURANCE,0)) + SUM(ISNULL(BP_INSURANCE,0))) AS INSURANCE from CSMS_RO_DET Where ISNULL(ROTYPE,0) <> 'SR' AND JOBTYPE IN ('GJ','PMS','BP') AND WCODE IS NULL AND LIVIL = 4 AND REP_OR = " & N2Str2Null(XXX))
                If Not rsINS_ACCESSORIES.EOF And Not rsINS_ACCESSORIES.BOF Then
                    INSURANCE_DIRECT_EXPENSE_ACCESSORIES = Round(N2Str2Zero(rsINS_ACCESSORIES!INSURANCE), 2)
                End If
            End If
    
    ''***INSURANCE BP***''''***INSURANCE BP***''''***INSURANCE BP***''''***INSURANCE BP***''''***INSURANCE BP***''''***INSURANCE BP***''''***INSURANCE BP***''''***INSURANCE BP***''''***INSURANCE BP***''''***INSURANCE BP***''''***INSURANCE BP***''''***INSURANCE BP***''''***INSURANCE BP***''''***INSURANCE BP***''''***INSURANCE BP***''
    ''LABOR INSURANCE BP ONLY
            If COMPANY_CODE = "HCA" Then
                Set rsCSMIOS_BP = New ADODB.Recordset
                Set rsCSMIOS_BP = gconDMIS.Execute("SELECT SUM(ISNULL(BP_INSURANCE,0)) AS BP_INSURANCE FROM CSMS_RO_DET WHERE JOBTYPE IN ('BP') AND LIVIL = 1 AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_BP.EOF And Not rsCSMIOS_BP.BOF Then
                    INSURANCE_DIRECT_EXPENSE_LABOR_BP = Round(N2Str2Zero(rsCSMIOS_BP!BP_INSURANCE), 2)
                End If
                
                Set rsCSMIOS_BP = New ADODB.Recordset
                Set rsCSMIOS_BP = gconDMIS.Execute("SELECT SUM(ISNULL(BP_INSURANCE,0)) AS BP_INSURANCE FROM CSMS_RO_DET WHERE JOBTYPE IN ('BP') AND LIVIL <> 1 AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_BP.EOF And Not rsCSMIOS_BP.BOF Then
                    INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS = Round(N2Str2Zero(rsCSMIOS_BP!BP_INSURANCE), 2)
                End If
            ElseIf COMPANY_CODE = "DJM" Then
                Set rsCSMIOS_BP = New ADODB.Recordset
                Set rsCSMIOS_BP = gconDMIS.Execute("SELECT SUM(ISNULL(BP_INSURANCE,0)) AS BP_INSURANCE FROM CSMS_RO_DET WHERE JOBTYPE IN ('BP') AND ISNULL(ROTYPE,0) <>'SR' AND LIVIL = 1 AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_BP.EOF And Not rsCSMIOS_BP.BOF Then
                    INSURANCE_DIRECT_EXPENSE_LABOR_BP = Round(N2Str2Zero(rsCSMIOS_BP!BP_INSURANCE), 2)
                End If
            ElseIf COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
            ElseIf COMPANY_CODE = "CMC" Then
            Else
                Set rsCSMIOS_BP = New ADODB.Recordset
                Set rsCSMIOS_BP = gconDMIS.Execute("SELECT SUM(ISNULL(BP_INSURANCE,0)) AS BP_INSURANCE FROM CSMS_RO_DET WHERE JOBTYPE IN ('BP') AND LIVIL = 1 AND ROTYPE<>'SR' AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_BP.EOF And Not rsCSMIOS_BP.BOF Then
                    INSURANCE_DIRECT_EXPENSE_LABOR_BP = Round(N2Str2Zero(rsCSMIOS_BP!BP_INSURANCE), 2)
                    If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                        INSURANCE_DIRECT_EXPENSE_LABOR = INSURANCE_DIRECT_EXPENSE_LABOR + INSURANCE_DIRECT_EXPENSE_LABOR_BP
                        INSURANCE_DIRECT_EXPENSE_LABOR_BP = 0
                    End If
                End If
            End If
            
    ''SUBLET INSURANCE BP ONLY
            If COMPANY_CODE = "DJM" Then
                Set rsCSMIOS_SR = New ADODB.Recordset
                Set rsCSMIOS_SR = gconDMIS.Execute("SELECT SUM(ISNULL(BP_INSURANCE,0)) AS BP_INSURANCE  FROM CSMS_RO_DET WHERE ROTYPE='SR' AND JOBTYPE = 'BP' AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_SR.EOF And Not rsCSMIOS_SR.BOF Then
                    INSURANCE_DIRECT_EXPENSE_SR_BP = Round(N2Str2Zero(rsCSMIOS_SR!BP_INSURANCE), 2)
                End If
            ElseIf COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
            ElseIf COMPANY_CODE = "CMC" Then
            End If
            
    ''PARTS INSURANCE BP ONLY
            If COMPANY_CODE = "DJM" Then
                Set rsCSMIOS_INSPARTS_BP = New ADODB.Recordset
                Set rsCSMIOS_INSPARTS_BP = gconDMIS.Execute("SELECT SUM(ISNULL(BP_INSURANCE,0)) AS BP_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=2  AND JOBTYPE ='BP'  AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_INSPARTS_BP.EOF And Not rsCSMIOS_INSPARTS_BP.BOF Then
                    INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP = Round(N2Str2Zero(rsCSMIOS_INSPARTS_BP!BP_INSURANCE), 2)
                End If
                
                If INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP = 0 Then
                    Set rsCSMIOS_INSPARTS_BP = New ADODB.Recordset
                    Set rsCSMIOS_INSPARTS_BP = gconDMIS.Execute("SELECT SUM(ISNULL(BP_INSURANCE,0)) AS BP_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=2  AND JOBTYPE ='BP'  AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
                    If Not rsCSMIOS_INSPARTS_BP.EOF And Not rsCSMIOS_INSPARTS_BP.BOF Then
                        INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP = Round(N2Str2Zero(rsCSMIOS_INSPARTS_BP!BP_INSURANCE), 2)
                    End If
                End If
            ElseIf COMPANY_CODE = "HLB" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
            ElseIf COMPANY_CODE = "CMC" Then
            End If
            
    ''MATERIALS INSURANCE BP ONLY
            If COMPANY_CODE = "DJM" Then
                Set rsCSMIOS_INSMATERIALS_BP = New ADODB.Recordset
                Set rsCSMIOS_INSMATERIALS_BP = gconDMIS.Execute("SELECT ISNULL(BP_INSURANCE,0) AS BP_INSURANCE FROM CSMS_RO_DET WHERE LIVIL=3  AND JOBTYPE = 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = " & N2Str2Null(XXX))
                If Not rsCSMIOS_INSMATERIALS_BP.EOF And Not rsCSMIOS_INSMATERIALS_BP.BOF Then
                    INSURANCE_DIRECT_EXPENSE_GOL_BP = Round(N2Str2Zero(rsCSMIOS_INSMATERIALS_BP!BP_INSURANCE), 2)
                End If
            ElseIf COMPANY_CODE = "CMC" Then
            End If
            
            
    ''ACCESSORIES INSURANCE BP ONLY
            If COMPANY_CODE = "DJM" Then
            ElseIf COMPANY_CODE = "CMC" Then
            End If
    End If
''***INSURANCE END***''''***INSURANCE END***''''***INSURANCE END***''''***INSURANCE END***''''***INSURANCE END***''''***INSURANCE END***''

''%%CUSTOMER AND INSURANCE COMPUTATION%%''

    ''LABOR
        CSMIOS_LABOR = Round(NumericVal(CSMIOS_LABOR - INSURANCE_DIRECT_EXPENSE_LABOR), 2)
        
    ''BRP
        CSMIOS_TINSPAINT = Round(NumericVal(CSMIOS_TINSPAINT - INSURANCE_DIRECT_EXPENSE_LABOR_BP), 2)
        CSMIOS_TINSPAINT_PARTS = CSMIOS_TINSPAINT_PARTS - INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS
        
    ''PARTS
        CSMIOS_PARTS = CSMIOS_PARTS - INSURANCE_DIRECT_EXPENSE_SPAREPARTS
        CSMIOS_PARTS_BP = CSMIOS_PARTS_BP - INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP
        
    ''MATERIALS
        CSMIOS_MATERIALS = CSMIOS_MATERIALS - INSURANCE_DIRECT_EXPENSE_GOL
        
        If COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Then
            CSMIOS_MATERIALS_BP = CSMIOS_MATERIALS_BP - INSURANCE_DIRECT_EXPENSE_GOL_BP
        End If
        
        If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
            CSMIOS_MISC = CSMIOS_MISC - CSMIOS_INSURANCE_MISC
        End If
        
    ''SUBLET
        If COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Then
            CSMIOS_SUBLET = CSMIOS_SUBLET - INSURANCE_DIRECT_EXPENSE_SR
            CSMIOS_SUBLET_BP = CSMIOS_SUBLET_BP - INSURANCE_DIRECT_EXPENSE_SR_BP
        Else
            CSMIOS_SUBLET = CSMIOS_SUBLET - INSURANCE_DIRECT_EXPENSE_SR
        End If
        
    ''ACCESSORIES
        CSMIOS_ACCESSORIES = CSMIOS_ACCESSORIES - INSURANCE_DIRECT_EXPENSE_ACCESSORIES
        
    ''TOTAL CUSTOMER DISCOUNT
        If COMPANY_CODE = "CMC" Or COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Then
            TOTAL_DISCOUNT_AMOUNT = Round(CSMIOS_LABOR_DISCOUNT + CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT_PARTS + CSMIOS_PARTS_DISCOUNT_BP + CSMIOS_MATERIALS_DISCOUNT_BP + CSMIOS_ACCESSORIES_DISCOUNT_BP + CSMIOS_SUBLET_DISCOUNT_BP, 2)
        Else
            TOTAL_DISCOUNT_AMOUNT = Round(CSMIOS_LABOR_DISCOUNT + CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT_PARTS, 2)
        End If
''%%CUSTOMER AND INSURANCE COMPUTATION%%''


''***WARRANTY***''''***WARRANTY***''''***WARRANTY***''''***WARRANTY***''''***WARRANTY***''''***WARRANTY***''''***WARRANTY***''''***WARRANTY***''''***WARRANTY***''''***WARRANTY***''''***WARRANTY***''''***WARRANTY***''''***WARRANTY***''''***WARRANTY***''''***WARRANTY***''
''LABOR WARRANTY GJ ONLY
        Set rsCSMIOS_WARRANTYGJ = New ADODB.Recordset
        If COMPANY_CODE = "HCA" Then
            ''GJ + PMS
            Set rsCSMIOS_LABOR = gconDMIS.Execute("SELECT ROUND(sum(LABOR),2)AS LABOR,ROUND(sum(LABOR_COST),2) AS LABOR_COST FROM( " & _
                                                  "Select ROUND(sum(DET_AMT),2)AS LABOR,ROUND(sum(DETCOST),2) AS LABOR_COST  from CSMS_RO_DET Where  WCODE = 'W' AND LIVIL = 1 AND JOBTYPE IN ('GJ','PMS') AND ISNULL(ROTYPE,0) <> 'SR'  AND REP_OR = " & N2Str2Null(XXX) & "" & _
                                                  "UNION ALL " & _
                                                  "Select ROUND(sum(DET_AMT),2)AS LABOR,ROUND(sum(DETCOST),2) AS LABOR_COST  from CSMS_RO_DET Where  WCODE = 'W' AND DETCDE = 'MISC' AND JOBTYPE IN ('GJ','PMS')  AND REP_OR = " & N2Str2Null(XXX) & ")A")
            If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
                WARRANTY_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
                WARRANTY_DIRECT_EXPENSE_LABOR_COST = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR_COST), 2)
            End If
        Else
            ''GJ + BP
            Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2)AS LABOR,ROUND(sum(DETCOST),2) AS LABOR_COST  from CSMS_RO_DET Where  WCODE = 'W' AND LIVIL = 1 AND JOBTYPE IN ('GJ','PMS','BP') AND ISNULL(ROTYPE,0) <> 'SR'  AND REP_OR = " & N2Str2Null(XXX) & "")
            If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
                WARRANTY_DIRECT_EXPENSE_LABOR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
                WARRANTY_DIRECT_EXPENSE_LABOR_COST = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR_COST), 2)
            End If
        End If
        
''SUBLET WARRANTY GJ ONLY
        Set rsCSMIOS_WARRANTYSR = New ADODB.Recordset
        If COMPANY_CODE = "HCA" Then
            ''GJ + PMS
            Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DETPRC),2)AS LABOR,ROUND(sum(DETCOST),2) AS LABOR_COST  from CSMS_RO_DET Where  WCODE = 'W' AND  JOBTYPE IN ('GJ','PMS')  AND ISNULL(ROTYPE,0) = 'SR'  AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
                WARRANTY_DIRECT_EXPENSE_LABOR_SR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
                WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR_COST), 2)
            End If
        ElseIf COMPANY_CODE = "DJM" Then
            ''GJ + PMS + BP
            Set rsCSMIOS_LABOR = gconDMIS.Execute("SELECT SUM(TOTALCOST.SUBLT) AS LABOR,SUM(TOTALCOST.COSTAMOUNT) AS LABOR_COST, SUM(TOTALCOST.DISC) AS DISCOUNT FROM( " & _
                                                  "SELECT CS.SUBLT,(CASE WHEN CS.ISNONVAT = 'N' THEN CS.COST / 1.12 ELSE CS.COST  END) COSTAMOUNT,CS.DISC FROM( " & _
                                                  "SELECT ISNULL(DETPRC,0) AS SUBLT,ISNULL(DETCOST,0) AS COST,ISNULL(DISCOUNT_2,0) AS DISC,TECHCODE,(SELECT V.NONVAT FROM ALL_VENDOR_TABLE V WHERE CODE=DT.TECHCODE) AS ISNONVAT FROM CSMS_RO_DET DT " & _
                                                  "WHERE WCODE = 'W' AND  JOBTYPE IN ('GJ','PMS','BP')  AND ISNULL(ROTYPE,0) = 'SR' AND REP_OR = " & N2Str2Null(XXX) & "" & _
                                                  ")CS " & _
                                                  ")TOTALCOST")
                                                  
            If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
                WARRANTY_DIRECT_EXPENSE_LABOR_SR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
                WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR_COST), 2)
            End If
        ElseIf COMPANY_CODE = "CMC" Then
            ''GJ + PMS + BP
            Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DETPRC),2)AS LABOR,ROUND(sum(DETCOST),2) AS LABOR_COST  from CSMS_RO_DET Where  WCODE = 'W' AND  JOBTYPE IN ('GJ','PMS','BP')  AND ISNULL(ROTYPE,0) = 'SR'  AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
                WARRANTY_DIRECT_EXPENSE_LABOR_SR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
                WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR_COST), 2)
            End If
        Else
            ''GJ + PMS + BP
            Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DETPRC),2)AS LABOR,ROUND(sum(DETCOST),2) AS LABOR_COST  from CSMS_RO_DET Where  WCODE = 'W' AND  JOBTYPE IN ('GJ','PMS','BP')  AND ISNULL(ROTYPE,0) = 'SR'  AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
                WARRANTY_DIRECT_EXPENSE_LABOR_SR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
                WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR_COST), 2)
            End If
        End If
        
''PARTS WARRANTY GJ ONLY
        Set rsCSMIOS_PARTS = New ADODB.Recordset
        If COMPANY_CODE = "HCA" Then
            ''GJ + PMS
            Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS PARTS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET Where  WCODE = 'W' AND  JOBTYPE IN ('GJ','PMS')  AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 2  AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                WARRANTY_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2)
                WARRANTY_CSMIOS_PARTS_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!DETCOST), 2)
            End If
        ElseIf COMPANY_CODE = "MGS" Then
            ''GJ + PMS + BP ONLY
            Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS PARTS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET Where  WCODE = 'W' AND  JOBTYPE IN ('GJ','PMS','BP')  AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 2  AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                WARRANTY_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2)
                WARRANTY_CSMIOS_PARTS_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!DETCOST), 2)
            End If
        ElseIf COMPANY_CODE = "CMC" Then
            ''GJ + PMS + BP ONLY
            Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS PARTS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET Where  WCODE = 'W' AND  JOBTYPE IN ('GJ','PMS','BP')  AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 2  AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                WARRANTY_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2)
                WARRANTY_CSMIOS_PARTS_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!DETCOST), 2)
            End If
        Else
            Set rsCSMIOS_PARTS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS PARTS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET Where  WCODE = 'W' AND  JOBTYPE IN ('GJ','PMS','BP')  AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 2  AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                WARRANTY_DIRECT_EXPENSE_SPAREPARTS = Round(N2Str2Zero(rsCSMIOS_PARTS!PARTS), 2)
                If COMPANY_CODE <> "HCE" Then
                    WARRANTY_CSMIOS_PARTS_COST = Round(N2Str2Zero(rsCSMIOS_PARTS!DETCOST), 2)
                Else
                    Set rsCSMIOS_PARTS = New ADODB.Recordset
                    Set rsCSMIOS_PARTS = gconDMIS.Execute("SELECT ROUND(sum(DETCOST * DETVOL),2) AS DETCOST FROM CSMS_RO_DET  WHERE WCODE = 'W' AND  JOBTYPE IN ('GJ','PMS','BP')  AND ISNULL(ROTYPE,0) <> 'SR' AND  LIVIL = 2 AND (SELECT NON_HARI FROM PMIS_STOCKMAS WHERE STOCKNO = DETCDE) ='N' AND REP_OR = " & N2Str2Null(XXX) & "")
                    If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                        CSMIOS_WARRANTY_PARTS_INV_GEN = Round(N2Str2Zero(rsCSMIOS_PARTS!DETCOST), 2)
                    End If
            
                    Set rsCSMIOS_PARTS_NON = New ADODB.Recordset
                    Set rsCSMIOS_PARTS = gconDMIS.Execute("SELECT ROUND(sum(DETCOST * DETVOL),2) AS DETCOST FROM CSMS_RO_DET  WHERE WCODE = 'W' AND  JOBTYPE IN ('GJ','PMS','BP')  AND ISNULL(ROTYPE,0) <> 'SR' AND  LIVIL = 2 AND (SELECT NON_HARI FROM PMIS_STOCKMAS WHERE STOCKNO = DETCDE) IN ('Y','O') AND REP_OR = " & N2Str2Null(XXX) & "")
                    If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                        CSMIOS_WARRANTY__PARTS_INV_NONGEN = Round(N2Str2Zero(rsCSMIOS_PARTS!DETCOST), 2)
                    End If
                End If
            End If
        End If
        
''MATERIALS WARRANTY GJ ONLY
        Set rsCSMIOS_MATERIALS = New ADODB.Recordset
        If COMPANY_CODE = "HCA" Then
            Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS MATERIALS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET Where  WCODE = 'W' AND DETCDE <> 'MISC' AND  JOBTYPE IN ('GJ','PMS')  AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 3  AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
                WARRANTY_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS), 2)
                WARRANTY_CSMIOS_MATERIALS_COST = Round(N2Str2Zero(rsCSMIOS_MATERIALS!DETCOST), 2)
            End If
        ElseIf COMPANY_CODE = "CMC" Then
            ''GJ + PMS + BP ONLY
            Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS MATERIALS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET Where  WCODE = 'W'  AND  JOBTYPE IN ('GJ','PMS','BP')  AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 3  AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
                WARRANTY_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS), 2)
                WARRANTY_CSMIOS_MATERIALS_COST = Round(N2Str2Zero(rsCSMIOS_MATERIALS!DETCOST), 2)
            End If
        Else
            ''GJ + PMS + BP ONLY
            Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS MATERIALS,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET Where  WCODE = 'W'  AND  JOBTYPE IN ('GJ','PMS','BP')  AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 3  AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
                WARRANTY_DIRECT_EXPENSE_GOL = Round(N2Str2Zero(rsCSMIOS_MATERIALS!MATERIALS), 2)
                WARRANTY_CSMIOS_MATERIALS_COST = Round(N2Str2Zero(rsCSMIOS_MATERIALS!DETCOST), 2)
            End If
        End If

''ACCESSORIES WARRANTY GJ ONLY
        Set rsCSMIOS_MATERIALS = New ADODB.Recordset
        If COMPANY_CODE = "HCA" Then
            ''GJ + PMS
            Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS ACCESSORIES,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET Where  WCODE = 'W' AND DETCDE <> 'MISC' AND  JOBTYPE IN ('GJ','PMS')  AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 4  AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
                WARRANTY_DIRECT_EXPENSE_ACC = Round(N2Str2Zero(rsCSMIOS_MATERIALS!Accessories), 2)
                WARRANTY_CSMIOS_MATERIALS_COST_ACC = Round(N2Str2Zero(rsCSMIOS_MATERIALS!DETCOST), 2)
            End If
        ElseIf COMPANY_CODE = "CMC" Then
            ''GJ + PMS + BP
            Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS ACCESSORIES,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET Where  WCODE = 'W' AND  JOBTYPE IN ('GJ','PMS','BP')  AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 4  AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
                WARRANTY_DIRECT_EXPENSE_ACC = Round(N2Str2Zero(rsCSMIOS_MATERIALS!Accessories), 2)
                WARRANTY_CSMIOS_MATERIALS_COST_ACC = Round(N2Str2Zero(rsCSMIOS_MATERIALS!DETCOST), 2)
            End If
        Else
            ''GJ + PMS + BP
            Set rsCSMIOS_MATERIALS = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2) AS ACCESSORIES,ROUND(sum(DISCOUNT_2),2) AS DISCOUNT,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET Where  WCODE = 'W' AND  JOBTYPE IN ('GJ','PMS','BP')  AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 4  AND REP_OR = " & N2Str2Null(XXX))
            If Not rsCSMIOS_MATERIALS.EOF And Not rsCSMIOS_MATERIALS.BOF Then
                WARRANTY_DIRECT_EXPENSE_ACC = Round(N2Str2Zero(rsCSMIOS_MATERIALS!Accessories), 2)
                WARRANTY_CSMIOS_MATERIALS_COST_ACC = Round(N2Str2Zero(rsCSMIOS_MATERIALS!DETCOST), 2)
            End If
        End If
        
''LABOR WARRANTY BP ONLY
        Set rsCSMIOS_WARRANTYBP = New ADODB.Recordset
        If COMPANY_CODE = "HCA" Then
            Set rsCSMIOS_LABOR = gconDMIS.Execute("SELECT ROUND(sum(LABOR),2)AS LABOR,ROUND(sum(LABOR_COST),2) AS LABOR_COST FROM( " & _
                                                  "Select ROUND(sum(DET_AMT),2)AS LABOR,ROUND(sum(DETCOST),2) AS LABOR_COST  from CSMS_RO_DET Where  WCODE = 'W' AND  JOBTYPE = 'BP'  AND REP_OR = " & N2Str2Null(XXX) & " " & _
                                                  "UNION ALL " & _
                                                  "Select ROUND(sum(DET_AMT),2)AS LABOR,ROUND(sum(DETCOST),2) AS LABOR_COST  from CSMS_RO_DET Where  WCODE = 'W' AND  JOBTYPE = 'BP' AND DETCDE = 'MISC' AND REP_OR = " & N2Str2Null(XXX) & ")A")
            If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
                WARRANTY_DIRECT_EXPENSE_LABOR_BP = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
                WARRANTY_DIRECT_EXPENSE_LABOR_COST_BP = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR_COST), 2)
            End If
        ElseIf COMPANY_CODE = "CMC" Or COMPANY_CODE = "MGS" Then
        Else
            If (COMPANY_CODE <> "HSB" And COMPANY_CODE <> "HBC" And COMPANY_CODE <> "HLB" And COMPANY_CODE <> "HCR") Then
                Set rsCSMIOS_LABOR = gconDMIS.Execute("Select ROUND(sum(DET_AMT),2)AS LABOR,ROUND(sum(DETCOST),2) AS LABOR_COST  from CSMS_RO_DET Where  WCODE = 'W'  AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 1 AND  JOBTYPE = 'BP'  AND REP_OR = " & N2Str2Null(XXX) & " ")
                If Not rsCSMIOS_LABOR.EOF And Not rsCSMIOS_LABOR.BOF Then
                    WARRANTY_DIRECT_EXPENSE_LABOR_BP = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR), 2)
                    WARRANTY_DIRECT_EXPENSE_LABOR_COST_BP = Round(N2Str2Zero(rsCSMIOS_LABOR!LABOR_COST), 2)
                End If
            End If
        End If
        
''SUBLET WARRANTY BP ONLY
        If COMPANY_CODE = "CMC" Then
        
        End If
        
''PARTS WARRANTY BP ONLY
         If COMPANY_CODE = "CMC" Then
        
        End If
        
''MATERIALS WARRANTY BP ONLY
        If COMPANY_CODE = "CMC" Then
        
        End If
        
''ACCESSORIES WARRANTY BP ONLY
        If COMPANY_CODE = "CMC" Then
        
        End If
        
''***WARRANTY END***''''***WARRANTY END***''''***WARRANTY END***''''***WARRANTY END***''''***WARRANTY END***''''***WARRANTY END***''''***WARRANTY END***''''***WARRANTY END***''''***WARRANTY END***''''***WARRANTY END***''''***WARRANTY END***''


''***INTERNAL**''''***INTERNAL**''''***INTERNAL**''''***INTERNAL**''''***INTERNAL**''''***INTERNAL**''''***INTERNAL**''''***INTERNAL**''''***INTERNAL**''''***INTERNAL**''''***INTERNAL**''''***INTERNAL**''''***INTERNAL**''''***INTERNAL**''''***INTERNAL**''
    Dim rsGJLABORINTERNAL As New ADODB.Recordset
    Set rsGJLABORINTERNAL = New ADODB.Recordset
    
''INTERNAL LABOR GJ ONLY
    If COMPANY_CODE = "HCA" Then
        Set rsGJLABORINTERNAL = gconDMIS.Execute("SELECT SUM(DET_AMT) AS DET_AMT, SUM(DETCOST) AS DETCOST  FROM( " & _
                                                 "Select SUM(DET_AMT) AS DET_AMT,SUM(DETCOST) AS DETCOST from CSMS_RO_DET WHERE LIVIL = '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' " & _
                                                 "UNION ALL " & _
                                                 "Select SUM(DET_AMT) AS DET_AMT,SUM(DETCOST) AS DETCOST from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' AND DETCDE = 'MISC'" & _
                                                 "UNION ALL " & _
                                                 "Select SUM(DET_AMT) AS DET_AMT,SUM(DETCOST) AS DETCOST from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) = 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' AND LIVIL = 1 AND DETCDE <> 'MISC'" & _
                                                 "UNION ALL " & _
                                                 "Select SUM(DET_AMT) AS DET_AMT ,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST  from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) = 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' AND LIVIL <> 1 AND DETCDE <> 'MISC')A")
        
        If Not rsGJLABORINTERNAL.EOF And Not rsGJLABORINTERNAL.BOF Then
             INTERNAL_LABOR_AMT = N2Str2Zero(rsGJLABORINTERNAL!DET_AMT)
             INTERNAL_LABOR_COST = N2Str2Zero(rsGJLABORINTERNAL!DETCOST)
        End If
    ElseIf COMPANY_CODE = "DJM" Then
        Set rsGJLABORINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT,SUM(DETCOST) AS DETCOST from CSMS_RO_DET WHERE LIVIL = 1 AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE IN ('GJ','PMS') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' ")
        If Not rsGJLABORINTERNAL.EOF And Not rsGJLABORINTERNAL.BOF Then
             INTERNAL_LABOR_AMT = N2Str2Zero(rsGJLABORINTERNAL!DET_AMT)
             INTERNAL_LABOR_COST = N2Str2Zero(rsGJLABORINTERNAL!DETCOST)
        End If
    ElseIf COMPANY_CODE = "CMC" Then
        Set rsGJLABORINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT,SUM(DETCOST) AS DETCOST,CODE from CSMS_RO_DET WHERE LIVIL = 1 AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE IN ('GJ','PMS') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' GROUP BY CODE")
        If Not rsGJLABORINTERNAL.EOF And Not rsGJLABORINTERNAL.BOF Then
             INTERNAL_LABOR_AMT = N2Str2Zero(rsGJLABORINTERNAL!DET_AMT)
             INTERNAL_LABOR_COST = N2Str2Zero(rsGJLABORINTERNAL!DETCOST)
             INTERNAL_LABOR_CODE_GJ = N2String(rsGJLABORINTERNAL!Code)
        End If
    Else
        Set rsGJLABORINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT,SUM(DETCOST) AS DETCOST from CSMS_RO_DET WHERE LIVIL = '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE IN ('GJ','PMS') AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' ")
        If Not rsGJLABORINTERNAL.EOF And Not rsGJLABORINTERNAL.BOF Then
             INTERNAL_LABOR_AMT = N2Str2Zero(rsGJLABORINTERNAL!DET_AMT)
             INTERNAL_LABOR_COST = N2Str2Zero(rsGJLABORINTERNAL!DETCOST)
        End If
        
        Set rsGJLABORINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT,SUM(DETCOST) AS DETCOST from CSMS_RO_DET WHERE LIVIL = '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) = 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' ")
        If Not rsGJLABORINTERNAL.EOF And Not rsGJLABORINTERNAL.BOF Then
             INTERNAL_SR_AMT = N2Str2Zero(rsGJLABORINTERNAL!DET_AMT)
             INTERNAL_SR_COST = N2Str2Zero(rsGJLABORINTERNAL!DETCOST)
        End If
    End If
    
''INTERNAL SUBLET GJ ONLY
    If COMPANY_CODE = "DJM" Then
        Set rsGJLABORINTERNAL = gconDMIS.Execute("SELECT SUM(TOTALCOST.SUBLT) AS DET_AMT,SUM(TOTALCOST.COSTAMOUNT) AS DETCOST, SUM(TOTALCOST.DISC) AS DISCOUNT FROM( " & _
                                         "SELECT CS.SUBLT,(CASE WHEN CS.ISNONVAT = 'N' THEN CS.COST / 1.12 ELSE CS.COST  END) COSTAMOUNT,CS.DISC FROM( " & _
                                         "SELECT ISNULL(DET_AMT,0) AS SUBLT,ISNULL(DETCOST,0) AS COST,ISNULL(DISCOUNT_2,0) AS DISC,TECHCODE,(SELECT V.NONVAT FROM ALL_VENDOR_TABLE V WHERE CODE=DT.TECHCODE) AS ISNONVAT FROM CSMS_RO_DET DT " & _
                                         "WHERE LIVIL = '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) = 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'" & _
                                         ")CS " & _
                                         ")TOTALCOST")
                                          
        If Not rsGJLABORINTERNAL.EOF And Not rsGJLABORINTERNAL.BOF Then
             INTERNAL_SR_AMT = N2Str2Zero(rsGJLABORINTERNAL!DET_AMT)
             INTERNAL_SR_COST = N2Str2Zero(rsGJLABORINTERNAL!DETCOST)
        End If
    ElseIf COMPANY_CODE = "CMC" Then
        Set rsGJLABORINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT,SUM(DETCOST) AS DETCOST, CODE from CSMS_RO_DET WHERE LIVIL = 1 AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) = 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' GROUP BY CODE")
        If Not rsGJLABORINTERNAL.EOF And Not rsGJLABORINTERNAL.BOF Then
             INTERNAL_SR_AMT = N2Str2Zero(rsGJLABORINTERNAL!DET_AMT)
             INTERNAL_SR_COST = N2Str2Zero(rsGJLABORINTERNAL!DETCOST)
             INTERNAL_SR_CODE_GJ = N2String(rsGJLABORINTERNAL!Code)
        End If
    End If
    
''INTERNAL PARTS GJ ONLY
    Dim rsPARTSMATERIALSINTERNAL As New ADODB.Recordset
    Set rsPARTSMATERIALSINTERNAL = New ADODB.Recordset
    If COMPANY_CODE = "MGS" Or COMPANY_CODE = "HCA" Then
        'GJ
        Set rsPARTSMATERIALSINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT ,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET WHERE LIVIL = 2 AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' AND DETCDE <> 'MISC'")
        If Not rsPARTSMATERIALSINTERNAL.EOF And Not rsPARTSMATERIALSINTERNAL.BOF Then
             INTERNAL_PARTS_AMT = N2Str2Zero(rsPARTSMATERIALSINTERNAL!DET_AMT)
             INTERNAL_PARTS_COST = N2Str2Zero(rsPARTSMATERIALSINTERNAL!DETCOST)
        End If
    ElseIf COMPANY_CODE = "CMC" Then
        'GJ
        Set rsPARTSMATERIALSINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT ,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST, CODE from CSMS_RO_DET WHERE LIVIL = 2 AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' AND DETCDE <> 'MISC' GROUP BY CODE")
        If Not rsPARTSMATERIALSINTERNAL.EOF And Not rsPARTSMATERIALSINTERNAL.BOF Then
             INTERNAL_PARTS_AMT = N2Str2Zero(rsPARTSMATERIALSINTERNAL!DET_AMT)
             INTERNAL_PARTS_COST = N2Str2Zero(rsPARTSMATERIALSINTERNAL!DETCOST)
             INTERNAL_PARTS_CODE_GJ = N2String(rsPARTSMATERIALSINTERNAL!Code)
        End If
    Else
        Set rsPARTSMATERIALSINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT ,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET WHERE LIVIL = 2 AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsPARTSMATERIALSINTERNAL.EOF And Not rsPARTSMATERIALSINTERNAL.BOF Then
             INTERNAL_PARTS_AMT = N2Str2Zero(rsPARTSMATERIALSINTERNAL!DET_AMT)
             If COMPANY_CODE <> "HCE" Then
                INTERNAL_PARTS_COST = N2Str2Zero(rsPARTSMATERIALSINTERNAL!DETCOST)
             Else
                Set rsCSMIOS_PARTS = New ADODB.Recordset
                Set rsCSMIOS_PARTS = gconDMIS.Execute("SELECT ROUND(SUM(DETCOST * DETVOL),2) AS COST FROM CSMS_RO_DET  WHERE  LIVIL = 2 AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND (SELECT NON_HARI FROM PMIS_STOCKMAS WHERE STOCKNO = DETCDE) ='N' AND REP_OR = " & N2Str2Null(XXX) & "")
                If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                    CSMIOS_INTERNAL_PARTS_INV_GEN = Round(N2Str2Zero(rsCSMIOS_PARTS!Cost), 2)
                End If
        
                Set rsCSMIOS_PARTS_NON = New ADODB.Recordset
                Set rsCSMIOS_PARTS = gconDMIS.Execute("SELECT ROUND(SUM(DETCOST * DETVOL),2) AS COST FROM CSMS_RO_DET  WHERE  LIVIL = 2 AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND (SELECT NON_HARI FROM PMIS_STOCKMAS WHERE STOCKNO = DETCDE) IN ('Y','O') AND REP_OR = " & N2Str2Null(XXX) & "")
                If Not rsCSMIOS_PARTS.EOF And Not rsCSMIOS_PARTS.BOF Then
                   CSMIOS_INTERNAL_PARTS_INV_NONGEN = Round(N2Str2Zero(rsCSMIOS_PARTS!Cost), 2)
                End If
             End If
        End If
        
        Set rsPARTSMATERIALSINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT ,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET WHERE LIVIL = 3 AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsPARTSMATERIALSINTERNAL.EOF And Not rsPARTSMATERIALSINTERNAL.BOF Then
             INTERNAL_MATERIALS_AMT = N2Str2Zero(rsPARTSMATERIALSINTERNAL!DET_AMT)
             INTERNAL_MATERIALS_COST = N2Str2Zero(rsPARTSMATERIALSINTERNAL!DETCOST)
        End If
    End If
    
''INTERNAL MATERIALS GJ ONLY
    If COMPANY_CODE = "MGS" Then
        'PAG NAGDISBLANCE SA INTERNAL PARTS & MATERIALS SI MGS, DAGDAGAN NG CODE DITO, SA AR, COS, SLS, AND INV
        'NIREMOVE KO YUNG LIVIL 3 SA 'INTERNAL PARTS GJ ONLY
        
        Set rsPARTSMATERIALSINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT ,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET WHERE LIVIL = 3 AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' AND DETCDE <> 'MISC'")
        If Not rsPARTSMATERIALSINTERNAL.EOF And Not rsPARTSMATERIALSINTERNAL.BOF Then
             INTERNAL_MATERIALS_AMT = N2Str2Zero(rsPARTSMATERIALSINTERNAL!DET_AMT)
             INTERNAL_MATERIALS_COST = N2Str2Zero(rsPARTSMATERIALSINTERNAL!DETCOST)
        End If
    ElseIf COMPANY_CODE = "CMC" Then
        Set rsPARTSMATERIALSINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT ,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST, CODE from CSMS_RO_DET WHERE LIVIL = 3 AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' AND DETCDE <> 'MISC' GROUP BY CODE")
        If Not rsPARTSMATERIALSINTERNAL.EOF And Not rsPARTSMATERIALSINTERNAL.BOF Then
             INTERNAL_MATERIALS_AMT = N2Str2Zero(rsPARTSMATERIALSINTERNAL!DET_AMT)
             INTERNAL_MATERIALS_COST = N2Str2Zero(rsPARTSMATERIALSINTERNAL!DETCOST)
             INTERNAL_MATERIALS_CODE_GJ = N2String(rsPARTSMATERIALSINTERNAL!Code)
        End If
    End If
    
''INTERNAL ACCESORIES GJ ONLY
    Dim rsACCESSORIESINTERNAL As New ADODB.Recordset
    Set rsACCESSORIESINTERNAL = New ADODB.Recordset
    If COMPANY_CODE = "CMC" Then
        Set rsACCESSORIESINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT ,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST, CODE from CSMS_RO_DET WHERE LIVIL = 4 AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' GROUP BY CODE")
        If Not rsACCESSORIESINTERNAL.EOF And Not rsACCESSORIESINTERNAL.BOF Then
             INTERNAL_ACCESSORIES_AMT = N2Str2Zero(rsACCESSORIESINTERNAL!DET_AMT)
             INTERNAL_ACCESSORIES_COST = N2Str2Zero(rsACCESSORIESINTERNAL!DETCOST)
             INTERNAL_ACCESSORIES_CODE_GJ = N2String(rsACCESSORIESINTERNAL!Code)
        End If
    Else
        Set rsACCESSORIESINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT ,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET WHERE LIVIL = 4 AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsACCESSORIESINTERNAL.EOF And Not rsACCESSORIESINTERNAL.BOF Then
             INTERNAL_ACCESSORIES_AMT = N2Str2Zero(rsACCESSORIESINTERNAL!DET_AMT)
             INTERNAL_ACCESSORIES_COST = N2Str2Zero(rsACCESSORIESINTERNAL!DETCOST)
        End If
    End If
    
''INTERNAL LABOR BP ONLY
    Dim rsBRPLABORINTERNAL As New ADODB.Recordset
    Set rsBRPLABORINTERNAL = New ADODB.Recordset
    If COMPANY_CODE = "HCA" Then
        Set rsBRPLABORINTERNAL = gconDMIS.Execute("SELECT SUM(DET_AMT) AS DET_AMT, SUM(DETCOST) AS DETCOST FROM( " & _
                                                 "Select SUM(DET_AMT) AS DET_AMT, SUM(DETCOST) AS DETCOST from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE = 'BP' AND LIVIL = 1  AND REP_OR = '" & CSMIOS_REP_OR & "'" & _
                                                 "UNION ALL " & _
                                                 "Select SUM(DET_AMT) AS DET_AMT ,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE = 'BP' AND LIVIL <> 1  AND REP_OR = '" & CSMIOS_REP_OR & "')A")
        
        If Not rsBRPLABORINTERNAL.EOF And Not rsBRPLABORINTERNAL.BOF Then
             INTERNAL_LABOR_AMT_BP = N2Str2Zero(rsBRPLABORINTERNAL!DET_AMT)
             INTERNAL_LABOR_COST_BP = N2Str2Zero(rsBRPLABORINTERNAL!DETCOST)
        End If
    ElseIf COMPANY_CODE = "CMC" Then
        Set rsBRPLABORINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT, SUM(DETCOST) AS DETCOST, CODE from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE = 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 1  AND REP_OR = '" & CSMIOS_REP_OR & "' GROUP BY CODE")
        If Not rsBRPLABORINTERNAL.EOF And Not rsBRPLABORINTERNAL.BOF Then
             INTERNAL_LABOR_AMT_BP = N2Str2Zero(rsBRPLABORINTERNAL!DET_AMT)
             INTERNAL_LABOR_COST_BP = N2Str2Zero(rsBRPLABORINTERNAL!DETCOST)
             INTERNAL_LABOR_CODE_BP = N2String(rsBRPLABORINTERNAL!Code)
        End If
    Else
        Set rsBRPLABORINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT, SUM(DETCOST) AS DETCOST from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE = 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 1  AND REP_OR = '" & CSMIOS_REP_OR & "'")
        If Not rsBRPLABORINTERNAL.EOF And Not rsBRPLABORINTERNAL.BOF Then
             INTERNAL_LABOR_AMT_BP = N2Str2Zero(rsBRPLABORINTERNAL!DET_AMT)
             INTERNAL_LABOR_COST_BP = N2Str2Zero(rsBRPLABORINTERNAL!DETCOST)
        End If
    End If
    
''INTERNAL SUBLET BP ONLY
    If COMPANY_CODE = "CMC" Then
        Set rsBRPLABORINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT, SUM(DETCOST) AS DETCOST, CODE from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE = 'BP' AND ISNULL(ROTYPE,0) = 'SR' AND LIVIL = 1  AND REP_OR = '" & CSMIOS_REP_OR & "' GROUP BY CODE")
        If Not rsBRPLABORINTERNAL.EOF And Not rsBRPLABORINTERNAL.BOF Then
             INTERNAL_SR_AMT_BP = N2Str2Zero(rsBRPLABORINTERNAL!DET_AMT)
             INTERNAL_SR_COST_BP = N2Str2Zero(rsBRPLABORINTERNAL!DETCOST)
             INTERNAL_SR_CODE_BP = N2String(rsBRPLABORINTERNAL!Code)
        End If
    End If
    
''INTERNAL PARTS BP ONLY
    If COMPANY_CODE = "CMC" Then
        Set rsBRPLABORINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT, SUM(DETCOST) AS DETCOST, CODE from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE = 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 2  AND REP_OR = '" & CSMIOS_REP_OR & "' GROUP BY CODE")
        If Not rsBRPLABORINTERNAL.EOF And Not rsBRPLABORINTERNAL.BOF Then
             INTERNAL_PARTS_AMT_BP = N2Str2Zero(rsBRPLABORINTERNAL!DET_AMT)
             INTERNAL_PARTS_COST_BP = N2Str2Zero(rsBRPLABORINTERNAL!DETCOST)
             INTERNAL_PARTS_CODE_BP = N2String(rsBRPLABORINTERNAL!Code)
        End If
    End If
    
''INTERNAL MATERIAL BP ONLY
    If COMPANY_CODE = "CMC" Then
        Set rsBRPLABORINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT, SUM(DETCOST) AS DETCOST, CODE from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE = 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 3  AND REP_OR = '" & CSMIOS_REP_OR & "' GROUP BY CODE")
        If Not rsBRPLABORINTERNAL.EOF And Not rsBRPLABORINTERNAL.BOF Then
             INTERNAL_MATERIALS_AMT_BP = N2Str2Zero(rsBRPLABORINTERNAL!DET_AMT)
             INTERNAL_MATERIALS_COST_BP = N2Str2Zero(rsBRPLABORINTERNAL!DETCOST)
             INTERNAL_MATERIALS_CODE_BP = N2Str2Zero(rsBRPLABORINTERNAL!Code)
        End If
    End If
    
''INTERNAL ACCESSORIES BP ONLY
    If COMPANY_CODE = "CMC" Then
        Set rsBRPLABORINTERNAL = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT, SUM(DETCOST) AS DETCOST, CODE from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE = 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND LIVIL = 4  AND REP_OR = '" & CSMIOS_REP_OR & "' GROUP BY CODE")
        If Not rsBRPLABORINTERNAL.EOF And Not rsBRPLABORINTERNAL.BOF Then
             INTERNAL_ACCESSORIES_AMT_BP = N2Str2Zero(rsBRPLABORINTERNAL!DET_AMT)
             INTERNAL_ACCESSORIES_COST_BP = N2Str2Zero(rsBRPLABORINTERNAL!DETCOST)
             INTERNAL_ACCESSORIES_CODE_BP = N2Str2Zero(rsBRPLABORINTERNAL!Code)
        End If
    End If
''***INTERNAL END**''''***INTERNAL END**''''***INTERNAL END**''''***INTERNAL END**''''***INTERNAL END**''''***INTERNAL END**''''***INTERNAL END**''''***INTERNAL END**''''***INTERNAL END**''''***INTERNAL END**''''***INTERNAL END**''
End Sub

Function CUSTOMER_ENTRY_INTERNAL_NEW() As Boolean
''DESIGNED FOR CMC
''NO SLS, COST AND INVENTORY

    On Error GoTo ErrorCode
    
    Dim xCUSTOMERINTERNAL As Boolean
    xCUSTOMERINTERNAL = False
    
    If INTERNAL_LABOR_AMT + INTERNAL_LABOR_COST + INTERNAL_LABOR_AMT_BP + INTERNAL_LABOR_COST_BP + INTERNAL_SR_AMT + INTERNAL_SR_COST + INTERNAL_SR_AMT_BP + INTERNAL_SR_COST_BP + INTERNAL_PARTS_AMT + INTERNAL_PARTS_COST + INTERNAL_PARTS_AMT_BP + INTERNAL_PARTS_COST_BP + INTERNAL_MATERIALS_AMT + INTERNAL_MATERIALS_COST + INTERNAL_MATERIALS_AMT_BP + INTERNAL_MATERIALS_COST_BP + INTERNAL_ACCESSORIES_AMT + INTERNAL_ACCESSORIES_COST + INTERNAL_ACCESSORIES_AMT_BP + INTERNAL_ACCESSORIES_COST_BP > 0 And CSMIOS_RO_AMOUNT > 0 Then
        xCUSTOMERINTERNAL = True
        GoTo CUSTOMER_W_INTERNAL:
    End If
        
    If INTERNAL_LABOR_AMT + INTERNAL_LABOR_COST + INTERNAL_LABOR_AMT_BP + INTERNAL_LABOR_COST_BP + INTERNAL_SR_AMT + INTERNAL_SR_COST + INTERNAL_SR_AMT_BP + INTERNAL_SR_COST_BP + INTERNAL_PARTS_AMT + INTERNAL_PARTS_COST + INTERNAL_PARTS_AMT_BP + INTERNAL_PARTS_COST_BP + INTERNAL_MATERIALS_AMT + INTERNAL_MATERIALS_COST + INTERNAL_MATERIALS_AMT_BP + INTERNAL_MATERIALS_COST_BP + INTERNAL_ACCESSORIES_AMT + INTERNAL_ACCESSORIES_COST + INTERNAL_ACCESSORIES_AMT_BP + INTERNAL_ACCESSORIES_COST_BP > 0 Then
        ALL_DEBIT = 0
        ALL_CREDIT = 0
        
        Set rsCSMIOS_REPOR = New ADODB.Recordset
        Set rsCSMIOS_REPOR = gconDMIS.Execute("SELECT * FROM CSMS_REPOR WHERE (REP_OR = '" & CSMIOS_REP_OR & "' AND LEFT(INVOICE,6) IN ('INT RO','PDI RO') OR (REP_OR = '" & CSMIOS_REP_OR & "'))")
    
        If Not rsCSMIOS_REPOR.EOF And Not rsCSMIOS_REPOR.BOF Then
            ItemCnt = 0
            CSMIOS_REP_OR = Null2String(rsCSMIOS_REPOR!REP_OR)
            CSMIOS_ACCT_NO = Null2String(rsCSMIOS_REPOR!ACCT_NO)
            CSMIOS_PARTICIPAT = Null2String(rsCSMIOS_REPOR!PARTICIPAT)
            CSMIOS_PLATE_NO = Null2String(rsCSMIOS_REPOR!PLATE_NO)
            CSMIOS_NIYM = Null2String(rsCSMIOS_REPOR!Niym)
            CSMIOS_TERM = Null2String(rsCSMIOS_REPOR!TERM)
            CSMIOS_DTE_REL = Null2Date(rsCSMIOS_REPOR!dte_comp)
            CSMIOS_INVOICE = Null2String(rsCSMIOS_REPOR!INVOICE)
            CSMIOS_VAT_EXEMPT = Null2Bool(rsCSMIOS_REPOR!VAT_EXEMPT)
            CSMIOS_RO_AMOUNT = Round(N2Str2Zero(rsCSMIOS_REPOR!RO_AMOUNT), 2)

            Set rsJournal_HDDup = New ADODB.Recordset
            Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_journal_hd order by jno desc")
            If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then
                WARRANTY_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 1, "000000") & "'"
            Else
                WARRANTY_JNO = "000001"
            End If

            If PosibleDoubleInternal(CSMIOS_REP_OR) = True Then Exit Function
            
            If CSMIOS_RO_AMOUNT = 0 Then
                Set rsJournal_HDDup = New ADODB.Recordset
                Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_journal_hd order by jno desc")
                If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then
                    WARRANTY_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 1, "000000") & "'"
                End If
                
                J_JDATE = N2Date2Null(CSMIOS_DTE_REL)
                J_VOUCHERNO = N2Str2Null(GetVoucherNo())
                J_JTYPE = "'SJ'": J_REMARKS = "NULL": J_VENDORCODE = "'999999'"
                J_CUSTOMERCODE = N2Str2Null(CSMIOS_ACCT_NO)

                J_DEBIT = 0: J_CREDIT = 0: J_TAX = 0: J_OUTBALANCE = 0: J_AMOUNTTOPAY = 0
                CSMIOS_RO_AMOUNT = Round((CSMIOS_LABOR + CSMIOS_AIRCON + CSMIOS_TINSPAINT + CSMIOS_SUBLET + CSMIOS_PMS + CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES) - TOTAL_DISCOUNT_AMOUNT, 2)

                J_INVOICEAMT = Round(NumericVal(CSMIOS_RO_AMOUNT), 2)
                J_BALANCE = Round(NumericVal(CSMIOS_RO_AMOUNT), 2)
                J_AMOUNTPAID = 0
                J_STATUS = "'N'"

                J_INVOICEDATE = N2Date2Null(CSMIOS_DTE_REL)
                J_INVOICENO = N2Str2Null(CSMIOS_INVOICE)

                J_CHECKNO = "NULL": J_DUEDATE = N2Date2Null(CSMIOS_DTE_REL): J_PAYTYPE = "NULL": J_INVOICETYPE = "'SI'"
                J_CHECKDATE = "NULL": J_BANKCODE = "NULL": J_REFNO = N2Str2Null(CSMIOS_REP_OR): J_REFDATE = N2Date2Null(CSMIOS_DTE_REL)
                J_TERMS = N2Str2Null(CSMIOS_TERM): J_DEALER = "NULL": J_PAIDSTATUS = "'N'": J_RECEIVESTATUS = "'N'"

                WARRANTY_VOUCHERNO = N2Str2Null(Format(NumericVal(GetVoucherNo()), "000000"))
                WARRANTY_ItemCnt = 0
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                TOTAL_DEBIT = 0: TOTAL_CREDIT = 0

                CSMIOS_REP_OR = Null2String(rsCSMIOS_REPOR!REP_OR)
                CSMIOS_ACCT_NO = Null2String(rsCSMIOS_REPOR!ACCT_NO)
                CSMIOS_PARTICIPAT = Null2String(rsCSMIOS_REPOR!PARTICIPAT)
                CSMIOS_PLATE_NO = Null2String(rsCSMIOS_REPOR!PLATE_NO)
                CSMIOS_NIYM = Null2String(rsCSMIOS_REPOR!Niym)

                CSMIOS_TERM = Null2String(rsCSMIOS_REPOR!TERM)
                CSMIOS_DTE_REL = Null2Date(rsCSMIOS_REPOR!DTE_REL)
                CSMIOS_INVOICE = Null2String(rsCSMIOS_REPOR!INVOICE)

                J_CUSTOMERCODE = N2Str2Null(CSMIOS_ACCT_NO)
                J_REMARKS = " SERVICE INVOICENO:" + " " + CSMIOS_INVOICE

                WARRANTY_J_AMOUNTTOPAY = 0
                WARRANTY_J_AMOUNTPAID = 0
                
                If CSMIOS_RO_AMOUNT = 0 Then
                    WARRANTY_J_INVOICEAMT = CSMIOS_RO_AMOUNT
                Else
                    WARRANTY_J_INVOICEAMT = Round(NumericVal(INTERNAL_LABOR_AMT + INTERNAL_LABOR_AMT_BP + INTERNAL_SR_AMT + INTERNAL_SR_AMT_BP + INTERNAL_PARTS_AMT + INTERNAL_PARTS_AMT_BP + INTERNAL_MATERIALS_AMT + INTERNAL_MATERIALS_AMT_BP + INTERNAL_ACCESSORIES_AMT + INTERNAL_ACCESSORIES_AMT_BP), 2)
                End If
                
                WARRANTY_J_BALANCE = Round(NumericVal(WARRANTY_J_INVOICEAMT), 2)

                SQL_STATEMENT = "Insert into AMIS_Journal_HD" & _
                " (jdate,voucherno,jtype,vendorcode,customercode,invoicedate,invoicetype,invoiceno,invoiceamt,duedate,paytype,refno,refdate,terms,dealer,amounttopay,Balance,AmountPaid,jno,debit,credit,outbalance,status,CheckNo,CheckDate,BankCode,remarks,PaidStatus,ReceiveStatus)" & _
                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & ", " & J_VENDORCODE & "," & J_CUSTOMERCODE & ", " & J_INVOICEDATE & "," & J_INVOICETYPE & "," & J_INVOICENO & "," & WARRANTY_J_INVOICEAMT & ", " & J_DUEDATE & ", " & J_PAYTYPE & "," & J_REFNO & "," & J_REFDATE & "," & J_TERMS & "," & J_DEALER & ", " & WARRANTY_J_AMOUNTTOPAY & "," & WARRANTY_J_BALANCE & "," & WARRANTY_J_AMOUNTPAID & _
                ", " & WARRANTY_JNO & ", " & TOTAL_DEBIT & ", " & TOTAL_CREDIT & ", " & J_OUTBALANCE & ", " & J_STATUS & ", " & J_CHECKNO & ", " & J_CHECKDATE & ", " & J_BANKCODE & ",'" & J_REMARKS & "'," & J_PAIDSTATUS & "," & J_RECEIVESTATUS & ")"
                gconDMIS.Execute SQL_STATEMENT

                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_HD", "X", J_JTYPE, "Jtype"))
                NEW_LogAudit "M", "JOURNAL ENTRY", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                
                ''DEBIT SIDE
                Set rsCSMIOS_REPOR = New ADODB.Recordset
                Set rsCSMIOS_REPOR = gconDMIS.Execute("Select * from CSMS_REPOR where REP_OR = '" & CSMIOS_REP_OR & "' AND LEFT(INVOICE,6) IN ('PDI RO')")
                If Not rsCSMIOS_REPOR.EOF And Not rsCSMIOS_REPOR.BOF Then
                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                    J_ACCT_CODE = N2Str2Null(ReturnAccountCode("PDI"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("PDI")))
                    J_CREDIT = 0
                    J_DEBIT = Round(INTERNAL_LABOR_AMT + INTERNAL_LABOR_AMT_BP + INTERNAL_PARTS_AMT + INTERNAL_ACCESSORIES_COST, 2)
                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                Else
CUSTOMER_W_INTERNAL:
                    ''LABOR INTERNAL GJ ONLY
                    If INTERNAL_LABOR_AMT + INTERNAL_LABOR_AMT_BP > 0 Then
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(INTERNAL_LABOR_CODE_GJ))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(INTERNAL_LABOR_CODE_GJ)))
                                                
                        J_GROSS = Round(NumericVal(N2Str2Zero(INTERNAL_LABOR_AMT + INTERNAL_LABOR_AMT_BP)), 2)
                        J_NET = Round(NumericVal(N2Str2Zero(INTERNAL_LABOR_AMT + INTERNAL_LABOR_AMT_BP)), 2)
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0
                        J_TAX = 0
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                        
                        Set rsUEA = New ADODB.Recordset
                        Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                            If xCUSTOMERINTERNAL = True Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            End If
                        Else
                            If xCUSTOMERINTERNAL = True Then
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            Else
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                SQL_STATEMENT = "insert into AMIS_Journal_Det (jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status) values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                        End If
                        
                    End If
                    
                    ''SUBLET INTERNAL GJ ONLY
                    If INTERNAL_SR_AMT + INTERNAL_SR_AMT_BP > 0 Then
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(INTERNAL_SR_CODE_GJ))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(INTERNAL_SR_CODE_GJ)))
                                                
                        J_GROSS = Round(NumericVal(N2Str2Zero(INTERNAL_SR_AMT + INTERNAL_SR_AMT_BP)), 2)
                        J_NET = Round(NumericVal(N2Str2Zero(INTERNAL_SR_AMT + INTERNAL_SR_AMT_BP)), 2)
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0
                        J_TAX = 0
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT

                        Set rsUEA = New ADODB.Recordset
                        Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                            If xCUSTOMERINTERNAL = True Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            End If
                        Else
                            If xCUSTOMERINTERNAL = True Then
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            Else
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                SQL_STATEMENT = "insert into AMIS_Journal_Det (jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status) values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                        End If
                        
                    End If
                    
                    ''PARTS INTERNAL GJ ONLY
                    If INTERNAL_PARTS_AMT + INTERNAL_PARTS_AMT_BP + INTERNAL_ACCESSORIES_AMT + INTERNAL_ACCESSORIES_AMT_BP > 0 Then
                        
                        If INTERNAL_PARTS_CODE_GJ <> "" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(INTERNAL_PARTS_CODE_GJ))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(INTERNAL_PARTS_CODE_GJ)))
                        ElseIf INTERNAL_PARTS_CODE_BP <> "" Then
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(INTERNAL_PARTS_CODE_BP))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(INTERNAL_PARTS_CODE_BP)))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(INTERNAL_ACCESSORIES_CODE_GJ))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(INTERNAL_ACCESSORIES_CODE_GJ)))
                        End If
                                            
                        J_GROSS = Round(NumericVal(N2Str2Zero(INTERNAL_PARTS_AMT + INTERNAL_PARTS_AMT_BP + INTERNAL_ACCESSORIES_AMT + INTERNAL_ACCESSORIES_AMT_BP)), 2)
                        J_NET = Round(NumericVal(N2Str2Zero(INTERNAL_PARTS_AMT + INTERNAL_PARTS_AMT_BP + INTERNAL_ACCESSORIES_AMT + INTERNAL_ACCESSORIES_AMT_BP)), 2)
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0
                        J_TAX = 0
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT

                        Set rsUEA = New ADODB.Recordset
                        Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                            If xCUSTOMERINTERNAL = True Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            End If
                        Else
                            If xCUSTOMERINTERNAL = True Then
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            Else
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                SQL_STATEMENT = "insert into AMIS_Journal_Det (jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status) values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                        End If
                        
                    End If
                    
                    ''MATERIALS INTERNAL GJ ONLY
                    If INTERNAL_MATERIALS_AMT + INTERNAL_MATERIALS_AMT_BP > 0 Then
                        J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(INTERNAL_MATERIALS_CODE_GJ))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(INTERNAL_MATERIALS_CODE_GJ)))
                                                
                        J_GROSS = Round(NumericVal(N2Str2Zero(INTERNAL_MATERIALS_AMT + INTERNAL_MATERIALS_AMT_BP)), 2)
                        J_NET = Round(NumericVal(N2Str2Zero(INTERNAL_MATERIALS_AMT + INTERNAL_MATERIALS_AMT_BP)), 2)
                        J_DEBIT = Round(NumericVal(J_NET), 2)
                        J_CREDIT = 0
                        J_TAX = 0
                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT

                        Set rsUEA = New ADODB.Recordset
                        Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        If Not rsUEA.EOF And Not rsUEA.BOF Then
                            If xCUSTOMERINTERNAL = True Then
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            Else
                                gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                            End If
                        Else
                            If xCUSTOMERINTERNAL = True Then
                                ItemCnt = ItemCnt + 1
                                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            Else
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                SQL_STATEMENT = "insert into AMIS_Journal_Det (jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status) values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                        End If
                        
                    End If
                    
                    ''ACCESSORIES INTERNAL GJ ONLY
                    If INTERNAL_ACCESSORIES_AMT > 0 Then
                        'IF CMC ADDED TO PARTS
                    End If
                    
                    ''LABOR INTERNAL BP ONLY
                    If INTERNAL_LABOR_AMT_BP > 0 Then
                        'IF CMC ADDED TO GJ
                    End If
                    
                    ''SUBLET INTERNAL BP ONLY
                    If INTERNAL_SR_AMT_BP > 0 Then
                        'IF CMC ADDED TO GJ
                    End If
                    
                    ''PARTS INTERNAL BP ONLY
                    If INTERNAL_PARTS_AMT_BP > 0 Then
                        'IF CMC ADDED TO GJ
                    End If
                    
                    ''MATERIALS INTERNAL BP ONLY
                    If INTERNAL_MATERIALS_AMT_BP > 0 Then
                        'IF CMC ADDED TO GJ
                    End If
                    
                    ''ACCESSORIES INTERNAL BP ONLY
                    If INTERNAL_ACCESSORIES_AMT_BP > 0 Then
                        'IF CMC ADDED TO GJ
                    End If
                End If
                
                ''CREDIT SIDE
                ''NOTE DIRECT EXPENSE | CONTRA INCOME FOR CMC
                
                ''LABOR + SUBLET GJ + BP ONLY
                If INTERNAL_LABOR_AMT + INTERNAL_LABOR_AMT_BP + INTERNAL_SR_AMT + INTERNAL_SR_AMT_BP > 0 Then
                    J_ACCT_CODE = N2Str2Null(ReturnAccountCode("DIRECT-LABOR"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("DIRECT-LABOR")))
                                
                    J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT + INTERNAL_LABOR_AMT_BP + INTERNAL_SR_AMT + INTERNAL_SR_AMT_BP), 2)
                    J_TAX = 0
                    J_NET = Round(NumericVal(INTERNAL_LABOR_AMT + INTERNAL_LABOR_AMT_BP + INTERNAL_SR_AMT + INTERNAL_SR_AMT_BP), 2)
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(J_NET), 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                        If xCUSTOMERINTERNAL = True Then
                            gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        Else
                            gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        End If
                    Else
                        If xCUSTOMERINTERNAL = True Then
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        Else
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            SQL_STATEMENT = "insert into AMIS_Journal_Det (jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status) values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                            gconDMIS.Execute SQL_STATEMENT
                            TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                        End If
                    End If
                    
                End If
                
                ''PARTS + ACCESSORIES GJ + BP ONLY
                If INTERNAL_PARTS_AMT + INTERNAL_PARTS_AMT_BP + INTERNAL_ACCESSORIES_AMT + INTERNAL_ACCESSORIES_AMT_BP > 0 Then
                    J_ACCT_CODE = N2Str2Null(ReturnAccountCode("DIRECT-PARTS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("DIRECT-PARTS")))
                                
                    J_GROSS = Round(NumericVal(INTERNAL_PARTS_AMT + INTERNAL_PARTS_AMT_BP + INTERNAL_ACCESSORIES_AMT + INTERNAL_ACCESSORIES_AMT_BP), 2)
                    J_TAX = 0
                    J_NET = Round(NumericVal(INTERNAL_PARTS_AMT + INTERNAL_PARTS_AMT_BP + INTERNAL_ACCESSORIES_AMT + INTERNAL_ACCESSORIES_AMT_BP), 2)
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(J_NET), 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                        If xCUSTOMERINTERNAL = True Then
                            gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        Else
                            gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        End If
                    Else
                        If xCUSTOMERINTERNAL = True Then
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        Else
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            SQL_STATEMENT = "insert into AMIS_Journal_Det (jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status) values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                            gconDMIS.Execute SQL_STATEMENT
                            TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                        End If
                    End If
                    
                End If
                                
                ''MATERIALS GJ + BP ONLY
                If INTERNAL_MATERIALS_AMT + INTERNAL_MATERIALS_AMT_BP > 0 Then
                    J_ACCT_CODE = N2Str2Null(ReturnAccountCode("DIRECT-MATERIALS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("DIRECT-MATERIALS")))
                                
                    J_GROSS = Round(NumericVal(INTERNAL_MATERIALS_AMT + INTERNAL_MATERIALS_AMT_BP), 2)
                    J_TAX = 0
                    J_NET = Round(NumericVal(INTERNAL_MATERIALS_AMT + INTERNAL_MATERIALS_AMT_BP), 2)
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(J_NET), 2)
                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                    
                    Set rsUEA = New ADODB.Recordset
                    Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                    If Not rsUEA.EOF And Not rsUEA.BOF Then
                        If xCUSTOMERINTERNAL = True Then
                            gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        Else
                            gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                        End If
                    Else
                        If xCUSTOMERINTERNAL = True Then
                            ItemCnt = ItemCnt + 1
                            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        Else
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            SQL_STATEMENT = "insert into AMIS_Journal_Det (jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status) values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                            gconDMIS.Execute SQL_STATEMENT
                            TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                        End If
                    End If
                    
                End If
            End If
        End If
    End If
    
    CUSTOMER_ENTRY_INTERNAL_NEW = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    CUSTOMER_ENTRY_INTERNAL_NEW = False
    ShowVBError
End Function


Function CUSTOMER_ENTRY_INTERNAL() As Boolean
    On Error GoTo ErrorCode
    Dim xCUSTOMERINTERNAL As Boolean
    xCUSTOMERINTERNAL = False

    If INTERNAL_LABOR_AMT + INTERNAL_LABOR_COST + INTERNAL_LABOR_AMT_BP + INTERNAL_LABOR_COST_BP + INTERNAL_SR_AMT + INTERNAL_SR_COST + INTERNAL_SR_AMT_BP + INTERNAL_SR_COST_BP + INTERNAL_PARTS_AMT + INTERNAL_PARTS_COST + INTERNAL_PARTS_AMT_BP + INTERNAL_PARTS_COST_BP + INTERNAL_MATERIALS_AMT + INTERNAL_MATERIALS_COST + INTERNAL_MATERIALS_AMT_BP + INTERNAL_MATERIALS_COST_BP + INTERNAL_ACCESSORIES_AMT + INTERNAL_ACCESSORIES_COST + INTERNAL_ACCESSORIES_AMT_BP + INTERNAL_ACCESSORIES_COST_BP > 0 And CSMIOS_RO_AMOUNT > 0 Then
        xCUSTOMERINTERNAL = True
        GoTo CUSTOMER_W_INTERNAL:
    End If

    If INTERNAL_LABOR_AMT + INTERNAL_LABOR_COST + INTERNAL_LABOR_AMT_BP + INTERNAL_LABOR_COST_BP + INTERNAL_SR_AMT + INTERNAL_SR_COST + INTERNAL_SR_AMT_BP + INTERNAL_SR_COST_BP + INTERNAL_PARTS_AMT + INTERNAL_PARTS_COST + INTERNAL_PARTS_AMT_BP + INTERNAL_PARTS_COST_BP + INTERNAL_MATERIALS_AMT + INTERNAL_MATERIALS_COST + INTERNAL_MATERIALS_AMT_BP + INTERNAL_MATERIALS_COST_BP + INTERNAL_ACCESSORIES_AMT + INTERNAL_ACCESSORIES_COST + INTERNAL_ACCESSORIES_AMT_BP + INTERNAL_ACCESSORIES_COST_BP > 0 Then
        ALL_DEBIT = 0: ALL_CREDIT = 0

        Set rsCSMIOS_REPOR = New ADODB.Recordset
        If COMPANY_CODE = "CMC" Or COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Then
            Set rsCSMIOS_REPOR = gconDMIS.Execute("SELECT * FROM CSMS_REPOR WHERE (REP_OR = '" & CSMIOS_REP_OR & "' AND LEFT(INVOICE,6) IN ('INT RO','PDI RO') OR (REP_OR = '" & CSMIOS_REP_OR & "'))")
        Else
            Set rsCSMIOS_REPOR = gconDMIS.Execute("Select * from CSMS_REPOR where REP_OR = '" & CSMIOS_REP_OR & "' AND LEFT(INVOICE,6) IN ('INT RO','PDI RO')")
        End If

        If Not rsCSMIOS_REPOR.EOF And Not rsCSMIOS_REPOR.BOF Then
            ItemCnt = 0
            CSMIOS_REP_OR = Null2String(rsCSMIOS_REPOR!REP_OR)
            CSMIOS_ACCT_NO = Null2String(rsCSMIOS_REPOR!ACCT_NO)
            CSMIOS_PARTICIPAT = Null2String(rsCSMIOS_REPOR!PARTICIPAT)
            CSMIOS_PLATE_NO = Null2String(rsCSMIOS_REPOR!PLATE_NO)
            CSMIOS_NIYM = Null2String(rsCSMIOS_REPOR!Niym)
            CSMIOS_TERM = Null2String(rsCSMIOS_REPOR!TERM)
            CSMIOS_DTE_REL = Null2Date(rsCSMIOS_REPOR!dte_comp)
            CSMIOS_INVOICE = Null2String(rsCSMIOS_REPOR!INVOICE)
            CSMIOS_VAT_EXEMPT = Null2Bool(rsCSMIOS_REPOR!VAT_EXEMPT)
            CSMIOS_RO_AMOUNT = Round(N2Str2Zero(rsCSMIOS_REPOR!RO_AMOUNT), 2)

            Set rsJournal_HDDup = New ADODB.Recordset
            Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_journal_hd order by jno desc")
            If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then
                WARRANTY_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 1, "000000") & "'"
            Else
                WARRANTY_JNO = "000001"
            End If

            If PosibleDoubleInternal(CSMIOS_REP_OR) = True Then Exit Function

                If CSMIOS_RO_AMOUNT = 0 Then
                    Set rsJournal_HDDup = New ADODB.Recordset
                    Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_journal_hd order by jno desc")
                    If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then WARRANTY_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 1, "000000") & "'"
                        J_JDATE = N2Date2Null(CSMIOS_DTE_REL)
                        J_VOUCHERNO = N2Str2Null(GetVoucherNo())
                        J_JTYPE = "'SJ'": J_REMARKS = "NULL": J_VENDORCODE = "'999999'"
                        J_CUSTOMERCODE = N2Str2Null(CSMIOS_ACCT_NO)

                        J_DEBIT = 0: J_CREDIT = 0: J_TAX = 0: J_OUTBALANCE = 0: J_AMOUNTTOPAY = 0
                        CSMIOS_RO_AMOUNT = Round((CSMIOS_LABOR + CSMIOS_AIRCON + CSMIOS_TINSPAINT + CSMIOS_SUBLET + CSMIOS_PMS + CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES) - TOTAL_DISCOUNT_AMOUNT, 2)

                        J_INVOICEAMT = Round(NumericVal(CSMIOS_RO_AMOUNT), 2)
                        J_BALANCE = Round(NumericVal(CSMIOS_RO_AMOUNT), 2)
                        J_AMOUNTPAID = 0
                        J_STATUS = "'N'"

                        J_INVOICEDATE = N2Date2Null(CSMIOS_DTE_REL)
                        J_INVOICENO = N2Str2Null(CSMIOS_INVOICE)

                        J_CHECKNO = "NULL": J_DUEDATE = N2Date2Null(CSMIOS_DTE_REL): J_PAYTYPE = "NULL": J_INVOICETYPE = "'SI'"
                        J_CHECKDATE = "NULL": J_BANKCODE = "NULL": J_REFNO = N2Str2Null(CSMIOS_REP_OR): J_REFDATE = N2Date2Null(CSMIOS_DTE_REL)
                        J_TERMS = N2Str2Null(CSMIOS_TERM): J_DEALER = "NULL": J_PAIDSTATUS = "'N'": J_RECEIVESTATUS = "'N'"

                        WARRANTY_VOUCHERNO = N2Str2Null(Format(NumericVal(GetVoucherNo()), "000000"))
                        WARRANTY_ItemCnt = 0
                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                        TOTAL_DEBIT = 0: TOTAL_CREDIT = 0

                        CSMIOS_REP_OR = Null2String(rsCSMIOS_REPOR!REP_OR)
                        CSMIOS_ACCT_NO = Null2String(rsCSMIOS_REPOR!ACCT_NO)
                        CSMIOS_PARTICIPAT = Null2String(rsCSMIOS_REPOR!PARTICIPAT)
                        CSMIOS_PLATE_NO = Null2String(rsCSMIOS_REPOR!PLATE_NO)
                        CSMIOS_NIYM = Null2String(rsCSMIOS_REPOR!Niym)

                        CSMIOS_TERM = Null2String(rsCSMIOS_REPOR!TERM)
                        CSMIOS_DTE_REL = Null2Date(rsCSMIOS_REPOR!DTE_REL)
                        CSMIOS_INVOICE = Null2String(rsCSMIOS_REPOR!INVOICE)

                        J_CUSTOMERCODE = N2Str2Null(CSMIOS_ACCT_NO)

                        If COMPANY_CODE = "DJM" Then
                            J_REMARKS = " SERVICE BILLING:" + " " + CSMIOS_INVOICE
                        Else
                            J_REMARKS = " SERVICE INVOICENO:" + " " + CSMIOS_INVOICE
                        End If

                        WARRANTY_J_AMOUNTTOPAY = 0
                        WARRANTY_J_AMOUNTPAID = 0
                        WARRANTY_J_INVOICEAMT = Round(NumericVal(INTERNAL_LABOR_AMT + INTERNAL_LABOR_AMT_BP + INTERNAL_SR_AMT + INTERNAL_SR_AMT_BP + INTERNAL_PARTS_AMT + INTERNAL_PARTS_AMT_BP + INTERNAL_MATERIALS_AMT + INTERNAL_MATERIALS_AMT_BP + INTERNAL_ACCESSORIES_AMT + INTERNAL_ACCESSORIES_AMT_BP), 2)
                        WARRANTY_J_BALANCE = Round(NumericVal(WARRANTY_J_INVOICEAMT), 2)

                        SQL_STATEMENT = "Insert into AMIS_Journal_HD" & _
                        " (jdate,voucherno,jtype,vendorcode,customercode,invoicedate,invoicetype,invoiceno,invoiceamt,duedate,paytype,refno,refdate,terms,dealer,amounttopay,Balance,AmountPaid,jno,debit,credit,outbalance,status,CheckNo,CheckDate,BankCode,remarks,PaidStatus,ReceiveStatus)" & _
                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & ", " & J_VENDORCODE & "," & J_CUSTOMERCODE & ", " & J_INVOICEDATE & "," & J_INVOICETYPE & "," & J_INVOICENO & "," & WARRANTY_J_INVOICEAMT & ", " & J_DUEDATE & ", " & J_PAYTYPE & "," & J_REFNO & "," & J_REFDATE & "," & J_TERMS & "," & J_DEALER & ", " & WARRANTY_J_AMOUNTTOPAY & "," & WARRANTY_J_BALANCE & "," & WARRANTY_J_AMOUNTPAID & _
                        ", " & WARRANTY_JNO & ", " & TOTAL_DEBIT & ", " & TOTAL_CREDIT & ", " & J_OUTBALANCE & ", " & J_STATUS & ", " & J_CHECKNO & ", " & J_CHECKDATE & ", " & J_BANKCODE & ",'" & J_REMARKS & "'," & J_PAIDSTATUS & "," & J_RECEIVESTATUS & ")"
                        gconDMIS.Execute SQL_STATEMENT

                        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_HD", "X", J_JTYPE, "Jtype"))
                        NEW_LogAudit "M", "JOURNAL ENTRY", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO

                        ''ENTRY FOR INTERNAL ========================================================================
                        If INTERNAL_LABOR_AMT + INTERNAL_LABOR_AMT_BP + INTERNAL_PARTS_AMT + INTERNAL_ACCESSORIES_AMT = "810.00" And COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                            J_ACCT_CODE = N2Str2Null(ReturnAccountCode("FSV"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("FSV")))
                            J_CREDIT = 0
                            J_DEBIT = Round(INTERNAL_LABOR_AMT + INTERNAL_LABOR_AMT_BP + INTERNAL_PARTS_AMT + INTERNAL_ACCESSORIES_AMT, 2)
                            ALL_DEBIT = ALL_DEBIT + J_DEBIT
                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)

                            ''SALES GJ LABOR INTERNAL
                            If INTERNAL_LABOR_AMT > 0 Then
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                                J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                                J_TAX = 0
                                J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                                J_DEBIT = 0
                                J_CREDIT = Round(NumericVal(J_NET), 2)
                                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If

                            ''SALES BP LABOR INTERNAL
                            If INTERNAL_LABOR_AMT_BP > 0 Then
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "BRP", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "BRP", "INTERNAL")))
                                J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                                J_TAX = 0
                                J_NET = Round(NumericVal(INTERNAL_LABOR_AMT_BP), 2)
                                J_DEBIT = 0
                                J_CREDIT = Round(NumericVal(J_NET), 2)

                                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"

                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If

                            ''SALES PARTS AND MATERIALS INTERNAL========================================================
                            If INTERNAL_PARTS_AMT > 0 Then
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                                J_GROSS = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                                If CSMIOS_VAT_EXEMPT = True Then
                                    J_TAX = 0
                                Else
                                    J_TAX = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                                End If
                                J_NET = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                                J_DEBIT = 0
                                J_CREDIT = Round(NumericVal(J_NET), 2)
                                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If

                            ''SALES ACCESSORIES INTERNAL========================================================
                            If INTERNAL_ACCESSORIES_COST > 0 Then
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "INTERNAL"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "INTERNAL")))
                                J_GROSS = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                                J_TAX = Round(NumericVal(INTERNAL_ACCESSORIES_COST), 2)
                                J_NET = Round(NumericVal(INTERNAL_ACCESSORIES_COST), 2)
                                J_DEBIT = 0
                                J_CREDIT = Round(NumericVal(J_NET), 2)
                                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                gconDMIS.Execute SQL_STATEMENT
                                TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                            End If
                        Else
                            Set rsCSMIOS_REPOR = New ADODB.Recordset
                            Set rsCSMIOS_REPOR = gconDMIS.Execute("Select * from CSMS_REPOR where REP_OR = '" & CSMIOS_REP_OR & "' AND LEFT(INVOICE,6) IN ('PDI RO')")
                            If Not rsCSMIOS_REPOR.EOF And Not rsCSMIOS_REPOR.BOF Then
                                ''DEBIT SIDE ===================================================================================
                                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                J_ACCT_CODE = N2Str2Null(ReturnAccountCode("PDI"))
                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("PDI")))
                                J_CREDIT = 0
                                J_DEBIT = Round(INTERNAL_LABOR_AMT + INTERNAL_LABOR_AMT_BP + INTERNAL_PARTS_AMT + INTERNAL_ACCESSORIES_COST, 2)
                                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                            Else
CUSTOMER_W_INTERNAL:
                                ''TAG FROM CSMS ENTRY =======================================================================
                                ''LABOR GJ INTERNAL ONLY
                                Set rsINTERNAL_RO_DET = New ADODB.Recordset
                                If COMPANY_CODE = "HCA" Then
                                    Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select SUM(ISNULL(DET_AMT,0)) AS DET_AMT, SUM(ISNULL(DETCOST,0)) AS DETCOST,CODE from CSMS_RO_DET WHERE LIVIL = '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' GROUP BY CODE,DET_AMT,DETCOST " & _
                                    "UNION ALL " & _
                                    "Select SUM(ISNULL(DET_AMT,0)) AS DET_AMT, SUM(ISNULL(DETCOST,0)) AS DETCOST,CODE from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' AND DETCDE = 'MISC' GROUP BY CODE,DET_AMT,DETCOST " & _
                                    "UNION ALL " & _
                                    "Select SUM(ISNULL(DET_AMT,0)) AS DET_AMT, SUM(ISNULL(DETCOST,0)) AS DETCOST,CODE from CSMS_RO_DET WHERE LIVIL = '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) = 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' AND DETCDE <> 'MISC' GROUP BY CODE,DET_AMT,DETCOST " & _
                                    "UNION ALL " & _
                                    "Select SUM(ISNULL(DET_AMT,0)) AS DET_AMT ,SUM(ROUND(ISNULL(DETCOST,0) * ISNULL(DETVOL,0),2)) AS DETCOST,CODE from CSMS_RO_DET WHERE LIVIL <> '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) = 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' AND DETCDE <> 'MISC' GROUP BY CODE,DET_AMT,DETCOST,DETVOL,ID")
                                ElseIf COMPANY_CODE = "CMC" Then
                                    Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select SUM(ISNULL(DET_AMT,0)) AS DET_AMT, SUM(ISNULL(DETCOST,0)) AS DETCOST,CODE from CSMS_RO_DET WHERE LIVIL = '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE = 'GJ' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' GROUP BY CODE,DET_AMT,DETCOST ")
                                Else
                                    Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select SUM(ISNULL(DET_AMT,0)) AS DET_AMT, SUM(ISNULL(DETCOST,0)) AS DETCOST,CODE from CSMS_RO_DET WHERE LIVIL = '1' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' GROUP BY CODE,DET_AMT,DETCOST ")
                                End If
                                
                                If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                                    rsINTERNAL_RO_DET.MoveFirst
                                    Do While Not rsINTERNAL_RO_DET.EOF
                                        If (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0) Then
                                                                                    
                                            INTERNAL_LABOR_AMT_TAG = INTERNAL_LABOR_AMT_TAG + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))

                                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                            J_TAX = 0
                                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                            J_DEBIT = Round(NumericVal(J_NET), 2)
                                            J_CREDIT = 0
                                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT

                                            Set rsUEA = New ADODB.Recordset
                                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                If xCUSTOMERINTERNAL = True Then
                                                    gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                Else
                                                    gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                End If
                                            Else
                                                If xCUSTOMERINTERNAL = True Then
                                                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                                Else
                                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                    gconDMIS.Execute SQL_STATEMENT
                                                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                                End If
                                            End If
                                        End If
                                        rsINTERNAL_RO_DET.MoveNext
                                    Loop
                                End If

                                ''LABOR BP INTERNAL ONLY
                                Set rsINTERNAL_RO_DET = New ADODB.Recordset
                                If COMPANY_CODE = "HCA" Then
                                    Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT, SUM(DETCOST) AS DETCOST,CODE,ID from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE = 'BP' AND LIVIL = 1  AND REP_OR = '" & CSMIOS_REP_OR & "' GROUP BY CODE,DET_AMT,DETCOST,ID " & _
                                    "UNION ALL " & _
                                    "Select SUM(DET_AMT) AS DET_AMT ,ROUND(sum(DETCOST * DETVOL),2) AS DETCOST,CODE,ID from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE = 'BP' AND LIVIL <> 1  AND REP_OR = '" & CSMIOS_REP_OR & "' GROUP BY CODE,DET_AMT,DETCOST,DETVOL,ID")
                                Else
                                    Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT, SUM(DETCOST) AS DETCOST,CODE,ID from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND JOBTYPE = 'BP' AND LIVIL = 1 AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "' GROUP BY CODE,DET_AMT,DETCOST,ID ")
                                End If
                                If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                                    rsINTERNAL_RO_DET.MoveFirst
                                    Do While Not rsINTERNAL_RO_DET.EOF
                                        If (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0) Then
                                            INTERNAL_LABOR_AMT_BP_TAG = INTERNAL_LABOR_AMT_BP_TAG + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                                            J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                            J_TAX = 0
                                            J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                            J_DEBIT = Round(NumericVal(J_NET), 2)
                                            J_CREDIT = 0
                                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                            Set rsUEA = New ADODB.Recordset
                                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                If xCUSTOMERINTERNAL = True Then
                                                    gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                Else
                                                    gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                End If
                                            Else
                                                If xCUSTOMERINTERNAL = True Then
                                                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                                Else
                                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                    gconDMIS.Execute SQL_STATEMENT
                                                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                                End If
                                            End If
                                        End If
                                        rsINTERNAL_RO_DET.MoveNext
                                    Loop
                                End If

                                ''SUBLET INTERNAL
                                If COMPANY_CODE <> "HCA" Then
                                    Set rsINTERNAL_RO_DET = New ADODB.Recordset
                                    Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select SUM(DET_AMT) AS DET_AMT, SUM(DETCOST) AS DETCOST,CODE,ID from CSMS_RO_DET WHERE DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) = 'SR' AND LIVIL = 1  AND REP_OR = '" & CSMIOS_REP_OR & "' GROUP BY CODE,DET_AMT,DETCOST,ID ")
                                    If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                                        rsINTERNAL_RO_DET.MoveFirst
                                        Do While Not rsINTERNAL_RO_DET.EOF
                                            If (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0) Then
                                                INTERNAL_SR_TAG = INTERNAL_LABOR_AMT_BP_TAG + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                                                J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                                                J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                                J_TAX = 0
                                                J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                                J_DEBIT = Round(NumericVal(J_NET), 2)
                                                J_CREDIT = 0
                                                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                                Set rsUEA = New ADODB.Recordset
                                                Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                    If xCUSTOMERINTERNAL = True Then
                                                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                    Else
                                                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                    End If
                                                Else
                                                    If xCUSTOMERINTERNAL = True Then
                                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                                    Else
                                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                        ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                        gconDMIS.Execute SQL_STATEMENT
                                                        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                                    End If
                                                End If
                                            End If
                                            rsINTERNAL_RO_DET.MoveNext
                                        Loop
                                    End If
                                End If

                                If COMPANY_CODE = "HCA" Then
                                    ''PARTS AND MATERIALS INTERNAL ===========================================================================
                                    Set rsINTERNAL_RO_DET = New ADODB.Recordset
                                    Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL IN ('2','3') AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND DETCDE <> 'MISC' AND REP_OR = '" & CSMIOS_REP_OR & "'")
                                    If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                                        rsINTERNAL_RO_DET.MoveFirst
                                        Do While Not rsINTERNAL_RO_DET.EOF
                                            If (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0) Then
                                                INTERNAL_PARTS_AMT_TAG = INTERNAL_PARTS_AMT_TAG + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                                                J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                                                J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                                J_TAX = 0
                                                J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                                J_DEBIT = Round(NumericVal(J_NET), 2)
                                                J_CREDIT = 0
                                                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                                Set rsUEA = New ADODB.Recordset
                                                Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                    If xCUSTOMERINTERNAL = True Then
                                                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                    Else
                                                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                    End If
                                                Else
                                                    If xCUSTOMERINTERNAL = True Then
                                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                                    Else
                                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                        ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                        gconDMIS.Execute SQL_STATEMENT
                                                        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                                    End If
                                                End If
                                            End If
                                            rsINTERNAL_RO_DET.MoveNext
                                        Loop
                                    End If
                                Else
                                    Set rsINTERNAL_RO_DET = New ADODB.Recordset
                                    Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = 2 AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
                                    If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                                        rsINTERNAL_RO_DET.MoveFirst
                                        Do While Not rsINTERNAL_RO_DET.EOF
                                            If (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0) Then
                                                INTERNAL_PARTS_AMT_TAG = INTERNAL_PARTS_AMT_TAG + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                                                J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                                                J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                                J_TAX = 0
                                                J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                                J_DEBIT = Round(NumericVal(J_NET), 2)
                                                J_CREDIT = 0
                                                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                                Set rsUEA = New ADODB.Recordset
                                                Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                    If xCUSTOMERINTERNAL = True Then
                                                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                    Else
                                                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                    End If
                                                Else
                                                    If xCUSTOMERINTERNAL = True Then
                                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                                    Else
                                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                        ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                        gconDMIS.Execute SQL_STATEMENT
                                                        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                                    End If
                                                End If
                                            End If
                                            rsINTERNAL_RO_DET.MoveNext
                                        Loop
                                    End If

                                    Set rsINTERNAL_RO_DET = New ADODB.Recordset
                                    Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = 3 AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S' ) AND JOBTYPE <> 'BP' AND ISNULL(ROTYPE,0) <> 'SR' AND REP_OR = '" & CSMIOS_REP_OR & "'")
                                    If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                                        rsINTERNAL_RO_DET.MoveFirst
                                        Do While Not rsINTERNAL_RO_DET.EOF
                                            If (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0) Then
                                                INTERNAL_MATERIALS_TAG = INTERNAL_PARTS_AMT_TAG + N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                                                J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                                                J_GROSS = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                                J_TAX = 0
                                                J_NET = Round(NumericVal(N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)), 2)
                                                J_DEBIT = Round(NumericVal(J_NET), 2)
                                                J_CREDIT = 0
                                                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                                Set rsUEA = New ADODB.Recordset
                                                Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                    If xCUSTOMERINTERNAL = True Then
                                                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                    Else
                                                        gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                    End If
                                                Else
                                                    If xCUSTOMERINTERNAL = True Then
                                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                                    Else
                                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                        ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                        gconDMIS.Execute SQL_STATEMENT
                                                        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                                    End If
                                                End If
                                            End If
                                            rsINTERNAL_RO_DET.MoveNext
                                        Loop
                                    End If
                                End If

                                ''ACCESSORIES INTERNAL ===========================================================================
                                Set rsINTERNAL_RO_DET = New ADODB.Recordset
                                Set rsINTERNAL_RO_DET = gconDMIS.Execute("Select * from CSMS_RO_DET WHERE LIVIL = '4' AND DET_AMT > 0 AND (WCODE = 'C' OR WCODE = 'S') AND ISNULL(ROTYPE,0) <> 'SR' AND JOBTYPE <> 'BP' AND REP_OR = '" & CSMIOS_REP_OR & "'")
                                If Not rsINTERNAL_RO_DET.EOF And Not rsINTERNAL_RO_DET.BOF Then
                                    rsINTERNAL_RO_DET.MoveFirst
                                    Do While Not rsINTERNAL_RO_DET.EOF
                                        If (((N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL)) > 0) And COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA") Or (N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT) > 0 And COMPANY_CODE <> "DJM" Or COMPANY_CODE <> "HCA") Then
                                            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                                                INTERNAL_ACCESSORIES_TAG = (N2Str2Zero(rsINTERNAL_RO_DET!DETCOST) * N2Str2Zero(rsINTERNAL_RO_DET!DETVOL))
                                            Else
                                                INTERNAL_ACCESSORIES_TAG = N2Str2Zero(rsINTERNAL_RO_DET!DET_AMT)
                                            End If
                                            J_ACCT_CODE = N2Str2Null(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code)))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInternalAccountCode(Null2String(rsINTERNAL_RO_DET!Code))))
                                            J_GROSS = INTERNAL_ACCESSORIES_TAG
                                            J_TAX = 0
                                            J_NET = INTERNAL_ACCESSORIES_TAG
                                            J_DEBIT = Round(NumericVal(J_NET), 2)
                                            J_CREDIT = 0
                                            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                            Set rsUEA = New ADODB.Recordset
                                            Set rsUEA = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                            If Not rsUEA.EOF And Not rsUEA.BOF Then
                                                If xCUSTOMERINTERNAL = True Then
                                                    gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                Else
                                                    gconDMIS.Execute ("UPDATE AMIS_JOURNAL_DET SET DEBIT = DEBIT + " & J_DEBIT & " WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & WARRANTY_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & "")
                                                End If
                                            Else
                                                If xCUSTOMERINTERNAL = True Then
                                                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                                Else
                                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                                                    WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                                    gconDMIS.Execute SQL_STATEMENT
                                                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                                End If
                                            End If
                                        End If
                                        rsINTERNAL_RO_DET.MoveNext
                                    Loop
                                End If
                            End If

                            ''COST INTERNAL ==============================================================================
                            If COMPANY_CODE <> "MGS" And COMPANY_CODE <> "HSB" And COMPANY_CODE <> "HLB" And COMPANY_CODE <> "HBC" And COMPANY_CODE <> "HCR" Then
                                ''GJ LABOR COST INTERNAL =====================================================================
                                'If COMPANY_CODE <> "DJM" Then
                                If INTERNAL_LABOR_COST > 0 Then
                                    If CSMIOS_TERM = "CSH" Or CSMIOS_TERM = "" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                                    Else
                                        If COMPANY_CODE = "HCE" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICECHG", "LABOR", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICECHG", "LABOR", "INTERNAL")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
                                        End If
                                    End If
                                    J_DEBIT = Round(INTERNAL_LABOR_COST, 2)
                                    J_CREDIT = 0
                                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                    If xCUSTOMERINTERNAL = True Then
                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    Else
                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    End If
                                End If
                                'End If

                                ''BRP LABOR COST INTERNAL =====================================================================
                                If INTERNAL_LABOR_COST_BP > 0 Then
                                    If COMPANY_CODE = "HCE" Then
                                        If CSMIOS_TERM = "CSH" Or CSMIOS_TERM = "" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABORBP", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABORBP", "INTERNAL")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICECHG", "LABORBP", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICECHG", "LABORBP", "INTERNAL")))
                                        End If
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "BRP", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "BRP", "INTERNAL")))
                                    End If
                                    J_DEBIT = Round(INTERNAL_LABOR_COST_BP, 2)
                                    J_CREDIT = 0
                                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                    If xCUSTOMERINTERNAL = True Then
                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    Else
                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    End If
                                End If

                                ''SUBLET COST INTERNAL =====================================================================
                                If COMPANY_CODE <> "HCA" Then
                                    If INTERNAL_SR_COST > 0 Then
                                        If CSMIOS_TERM = "CSH" Or CSMIOS_TERM = "" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "INTERNAL")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLETCHG", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLETCHG", "INTERNAL")))
                                        End If
                                        J_DEBIT = Round(INTERNAL_SR_COST, 2)
                                        J_CREDIT = 0
                                        ALL_DEBIT = ALL_DEBIT + J_DEBIT
                                        If xCUSTOMERINTERNAL = True Then
                                            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        Else
                                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        End If
                                    End If
                                End If

                                If COMPANY_CODE = "HCA" Then
                                    ''PARTS AND MATERIALS COST INTERNAL ==============================================================
                                    If INTERNAL_PARTS_COST > 0 Then
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                                        J_DEBIT = Round(INTERNAL_PARTS_COST, 2)
                                        J_CREDIT = 0
                                        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                                        If xCUSTOMERINTERNAL = True Then
                                            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        Else
                                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        End If
                                    End If
                                Else
                                    If INTERNAL_PARTS_COST + CSMIOS_INTERNAL_PARTS_INV_GEN + CSMIOS_INTERNAL_PARTS_INV_NONGEN > 0 Then
                                        If CSMIOS_TERM = "CSH" Or CSMIOS_TERM = "" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                                        Else
                                            If COMPANY_CODE = "HCE" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTSCHG", "INTERNAL"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTSCHG", "INTERNAL")))
                                            Else
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
                                            End If
                                        End If
                                        J_DEBIT = Round(INTERNAL_PARTS_COST + CSMIOS_INTERNAL_PARTS_INV_GEN + CSMIOS_INTERNAL_PARTS_INV_NONGEN, 2)
                                        J_CREDIT = 0
                                        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                                        If xCUSTOMERINTERNAL = True Then
                                            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        Else
                                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        End If
                                    End If

                                    If INTERNAL_MATERIALS_COST > 0 Then
                                        If CSMIOS_TERM = "CSH" Or CSMIOS_TERM = "" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS", "INTERNAL")))
                                        Else
                                            If COMPANY_CODE = "HCE" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALSCHG", "INTERNAL"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALSCHG", "INTERNAL")))
                                            Else
                                                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS", "INTERNAL"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS", "INTERNAL")))
                                            End If
                                        End If
                                        J_DEBIT = Round(INTERNAL_MATERIALS_COST, 2)
                                        J_CREDIT = 0
                                        TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                                        If xCUSTOMERINTERNAL = True Then
                                            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        Else
                                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        End If
                                    End If
                                End If
                                ''ACCESSORIES COST INTERNAL =====================================================================
                                If INTERNAL_ACCESSORIES_COST > 0 Then
                                    If COMPANY_CODE = "HCE" Then
                                        If CSMIOS_TERM = "CSH" Or CSMIOS_TERM = "" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "INTERNAL")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIESCHG", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIESCHG", "INTERNAL")))
                                        End If
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "INTERNAL")))
                                    End If
                                    J_GROSS = 0
                                    J_TAX = 0
                                    J_NET = 0
                                    J_DEBIT = Round(INTERNAL_ACCESSORIES_COST, 2)
                                    J_CREDIT = 0
                                    TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                                    If xCUSTOMERINTERNAL = True Then
                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    Else
                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    End If
                                End If
                            End If

                            ''SALES GJ LABOR INTERNAL ================================================================================
                            If INTERNAL_LABOR_AMT > 0 Then
                                If COMPANY_CODE = "MGS" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
                                Else
                                    If CSMIOS_TERM = "CSH" Or CSMIOS_TERM = "" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                                    Else
                                        If COMPANY_CODE = "HCE" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICECHG", "LABOR", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICECHG", "LABOR", "INTERNAL")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                                        End If
                                    End If
                                End If
                                J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                                J_TAX = 0
                                J_NET = Round(NumericVal(INTERNAL_LABOR_AMT), 2)
                                J_DEBIT = 0
                                J_CREDIT = Round(NumericVal(J_NET), 2)
                                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                If xCUSTOMERINTERNAL = True Then
                                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                Else
                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                    gconDMIS.Execute SQL_STATEMENT
                                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                End If
                            End If

                            ''SALES BRP INTERNAL ===============================================================================
                            If INTERNAL_LABOR_AMT_BP > 0 Then
                                If COMPANY_CODE = "HCE" Then
                                    If CSMIOS_TERM = "CSH" Or CSMIOS_TERM = "" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABORBP", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABORBP", "INTERNAL")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICECHG", "LABORBP", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICECHG", "LABORBP", "INTERNAL")))
                                    End If
                                ElseIf COMPANY_CODE = "HCR" Then
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                                Else
                                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "BRP", "INTERNAL"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "BRP", "INTERNAL")))
                                End If
                                J_GROSS = Round(NumericVal(INTERNAL_LABOR_AMT_BP), 2)
                                J_TAX = 0
                                J_NET = Round(NumericVal(INTERNAL_LABOR_AMT_BP), 2)
                                J_DEBIT = 0
                                J_CREDIT = Round(NumericVal(J_NET), 2)

                                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                If xCUSTOMERINTERNAL = True Then
                                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                Else
                                    WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                    SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                    "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                    " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                    ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                    ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                    gconDMIS.Execute SQL_STATEMENT
                                    TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                    NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                End If
                            End If

                            ''SALES SUBLET INTERNAL ===============================================================================
                            If COMPANY_CODE <> "HCA" Then
                                If INTERNAL_SR_AMT > 0 Then
                                    If CSMIOS_TERM = "CSH" Or CSMIOS_TERM = "" Then
                                        If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "INTERNAL")))
                                        End If
                                    Else
                                        If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER")))
                                        Else
                                            If COMPANY_CODE = "HCE" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "INTERNAL"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "INTERNAL")))
                                            Else
                                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "INTERNAL"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "INTERNAL")))
                                            End If
                                        End If
                                    End If
                                    J_GROSS = Round(NumericVal(INTERNAL_SR_AMT), 2)
                                    J_TAX = 0
                                    J_NET = Round(NumericVal(INTERNAL_SR_AMT), 2)
                                    J_DEBIT = 0
                                    J_CREDIT = Round(NumericVal(J_NET), 2)
                                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                    If xCUSTOMERINTERNAL = True Then
                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    Else
                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                        ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                        gconDMIS.Execute SQL_STATEMENT
                                        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                    End If
                                End If
                            End If

                            ''SALES PARTS AND MATERIALS INTERNAL========================================================
                            If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                                If INTERNAL_PARTS_AMT + INTERNAL_MATERIALS_AMT + INTERNAL_ACCESSORIES_AMT > 0 Then
                                    If CSMIOS_TERM = "CSH" Or CSMIOS_TERM = "" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                                    Else
                                        If COMPANY_CODE = "HCE" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTSCHG", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTSCHG", "INTERNAL")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                                        End If
                                    End If
                                    J_GROSS = Round(NumericVal(INTERNAL_PARTS_AMT + INTERNAL_MATERIALS_AMT + INTERNAL_ACCESSORIES_COST), 2)
                                    If CSMIOS_VAT_EXEMPT = True Then
                                        J_TAX = 0
                                    Else
                                        J_TAX = Round(NumericVal(INTERNAL_PARTS_AMT + INTERNAL_MATERIALS_AMT + INTERNAL_ACCESSORIES_COST), 2)
                                    End If
                                    J_NET = Round(NumericVal(INTERNAL_PARTS_AMT + INTERNAL_MATERIALS_AMT + INTERNAL_ACCESSORIES_COST), 2)
                                    J_DEBIT = 0
                                    J_CREDIT = Round(NumericVal(J_NET), 2)
                                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                    If xCUSTOMERINTERNAL = True Then
                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    Else
                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                        ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                        gconDMIS.Execute SQL_STATEMENT
                                        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                    End If
                                End If
                            Else
                                If INTERNAL_PARTS_AMT > 0 Then
                                    If CSMIOS_TERM = "CSH" Or CSMIOS_TERM = "" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                                    Else
                                        If COMPANY_CODE = "HCE" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTSCHG", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTSCHG", "INTERNAL")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
                                        End If
                                    End If
                                    J_GROSS = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                                    If CSMIOS_VAT_EXEMPT = True Then
                                        J_TAX = 0
                                    Else
                                        J_TAX = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                                    End If
                                    J_NET = Round(NumericVal(INTERNAL_PARTS_AMT), 2)
                                    J_DEBIT = 0
                                    J_CREDIT = Round(NumericVal(J_NET), 2)
                                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                    If xCUSTOMERINTERNAL = True Then
                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    Else
                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                        ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                        gconDMIS.Execute SQL_STATEMENT
                                        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                    End If
                                End If

                                If COMPANY_CODE <> "HCA" Then
                                    If INTERNAL_MATERIALS_AMT > 0 Then
                                        If CSMIOS_TERM = "CSH" Or CSMIOS_TERM = "" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS", "INTERNAL")))
                                        Else
                                            If COMPANY_CODE = "HCE" Then
                                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICECHG", "MATERIALS", "INTERNAL"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICECHG", "MATERIALS", "INTERNAL")))
                                            Else
                                                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS", "INTERNAL"))
                                                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS", "INTERNAL")))
                                            End If
                                        End If
                                        J_GROSS = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                                        If CSMIOS_VAT_EXEMPT = True Then
                                            J_TAX = 0
                                        Else
                                            J_TAX = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                                        End If
                                        J_NET = Round(NumericVal(INTERNAL_MATERIALS_AMT), 2)
                                        J_DEBIT = 0
                                        J_CREDIT = Round(NumericVal(J_NET), 2)
                                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                        If xCUSTOMERINTERNAL = True Then
                                            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        Else
                                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                            SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                            "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                            " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                            ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                            ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                            gconDMIS.Execute SQL_STATEMENT
                                            TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                            NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                        End If
                                    End If
                                End If
                                ''SALES ACCESSORIES INTERNAL========================================================
                                If INTERNAL_ACCESSORIES_COST > 0 Then
                                    If CSMIOS_TERM = "CSH" Or CSMIOS_TERM = "" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESORRIES", "INTERNAL"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESORRIES", "INTERNAL")))
                                    Else
                                        If COMPANY_CODE = "HCE" Then
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESORRIES", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESORRIES", "INTERNAL")))
                                        Else
                                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESORRIES", "INTERNAL"))
                                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESORRIES", "INTERNAL")))
                                        End If
                                    End If
                                    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                                        J_GROSS = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                                        J_TAX = Round(NumericVal(INTERNAL_ACCESSORIES_COST), 2)
                                        J_NET = Round(NumericVal(INTERNAL_ACCESSORIES_COST), 2)
                                    Else
                                        J_GROSS = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                                        J_TAX = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                                        J_NET = Round(NumericVal(INTERNAL_ACCESSORIES_AMT), 2)
                                    End If
                                    J_DEBIT = 0
                                    J_CREDIT = Round(NumericVal(J_NET), 2)
                                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                    If xCUSTOMERINTERNAL = True Then
                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    Else
                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                        SQL_STATEMENT = "insert into AMIS_Journal_Det " & _
                                        "(jdate,voucherno,jtype,jno,jitemno,acct_code,acct_name,debit,credit,tax,grossamt,netamt,status)" & _
                                        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & _
                                        ", " & WARRANTY_JNO & ", " & WARRANTY_J_JITEMNO & ", " & J_ACCT_CODE & ", " & J_ACCT_NAME & ", " & J_DEBIT & _
                                        ", " & J_CREDIT & ", " & J_TAX & "," & J_GROSS & "," & J_NET & ", " & J_STATUS & ")"
                                        gconDMIS.Execute SQL_STATEMENT
                                        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_det", "X", J_JTYPE, "Jtype"))
                                        NEW_LogAudit "MM", "JOURNAL IMPORT DETAIL", SQL_STATEMENT, N2Str2Zero(TransactionID), "", N2Str2Null(WARRANTY_VOUCHERNO), J_JTYPE, WARRANTY_JNO
                                    End If
                                End If
                            End If

                            ''INVENTORY INTERNAL ===============================================================
                            If COMPANY_CODE <> "MGS" And COMPANY_CODE <> "HSB" And COMPANY_CODE <> "HLB" And COMPANY_CODE <> "HBC" And COMPANY_CODE <> "HCR" Then
                                ''INVENTORY GJ LABOR INTERNAL
                                If INTERNAL_LABOR_COST > 0 Then
                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                                    J_DEBIT = 0
                                    J_CREDIT = Round(INTERNAL_LABOR_COST, 2)
                                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                    If xCUSTOMERINTERNAL = True Then
                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    Else
                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    End If
                                End If

                                ''INVENTORY BRP INTERNAL
                                If INTERNAL_LABOR_COST_BP > 0 Then
                                    J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                                    J_DEBIT = 0
                                    J_CREDIT = Round(INTERNAL_LABOR_COST_BP, 2)
                                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                    If xCUSTOMERINTERNAL = True Then
                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    Else
                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    End If
                                End If

                                If COMPANY_CODE <> "DJM" Or COMPANY_CODE <> "HCA" Then
                                    If INTERNAL_SR_COST > 0 Then
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
                                        J_DEBIT = 0
                                        J_CREDIT = Round(INTERNAL_SR_COST, 2)
                                        ALL_CREDIT = ALL_CREDIT + J_CREDIT
                                        If xCUSTOMERINTERNAL = True Then
                                            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        Else
                                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        End If
                                    End If
                                End If

                                ''INVENTORY PARTS AND MATERIALS INTERNAL
                                If COMPANY_CODE <> "HCE" Then
                                    If INTERNAL_PARTS_COST > 0 Then
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                                        J_DEBIT = 0
                                        J_CREDIT = Round(INTERNAL_PARTS_COST, 2)
                                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                        If xCUSTOMERINTERNAL = True Then
                                            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        Else
                                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        End If
                                    End If
                                Else
                                    If CSMIOS_INTERNAL_PARTS_INV_GEN > 0 Then
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                                        J_DEBIT = 0
                                        J_CREDIT = Round(CSMIOS_INTERNAL_PARTS_INV_GEN, 2)
                                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                        If xCUSTOMERINTERNAL = True Then
                                            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        Else
                                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        End If
                                    End If

                                    If CSMIOS_INTERNAL_PARTS_INV_NONGEN > 0 Then
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                                        J_DEBIT = 0
                                        J_CREDIT = Round(CSMIOS_INTERNAL_PARTS_INV_NONGEN, 2)
                                        TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                        If xCUSTOMERINTERNAL = True Then
                                            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        Else
                                            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                        End If
                                    End If
                                End If

                                If INTERNAL_MATERIALS_COST > 0 Then
                                    If COMPANY_CODE = "DJM" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "", ""))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "", "")))
                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                                    End If
                                    J_DEBIT = 0
                                    J_CREDIT = Round(INTERNAL_MATERIALS_COST, 2)
                                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                    If xCUSTOMERINTERNAL = True Then
                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    Else
                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    End If
                                End If

                                ''INVENTORY ACCESSORIES INTERNAL
                                If INTERNAL_ACCESSORIES_COST > 0 Then
                                    If COMPANY_CODE = "HCE" Then
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("AIN-PROCESS"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("AIN-PROCESS")))

                                    Else
                                        J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES"))
                                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES")))
                                    End If
                                    J_GROSS = 0: J_TAX = 0: J_NET = 0
                                    J_DEBIT = 0
                                    J_CREDIT = Round(INTERNAL_ACCESSORIES_COST, 2)
                                    TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                                    If xCUSTOMERINTERNAL = True Then
                                        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    Else
                                        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                                    End If
                                End If
                                ''END CREDIT SIDE ================================================================================
                            End If
                        End If

                    End If
                End If
            End If

            CUSTOMER_ENTRY_INTERNAL = True
            Exit Function
ErrorCode:
            Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
            CUSTOMER_ENTRY_INTERNAL = False
            ShowVBError
            
'~*~WARNING: Missing 2 END | NEXT | LOOP statements (If not missing then not on their own line.)
'CUSTOMER_ENTRY_INTERNAL GENERATED FROM http://warp.senecac.on.ca/timothy.mckenna/CodeFormatter.asp
End Function

Function ENTRY_WARRANTY_AR() As Boolean
    If COMPANY_CODE = "MGS" Then
        ''LABOR GJ + BP ONLY
        If WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            
            If J_INVOICENO = "'INT RO'" Or J_INVOICENO = "INT RO" Then
                J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("WARRANTY"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("WARRANTY")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("TRADE"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("TRADE")))
            End If
            
            J_DEBIT = NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR)
            J_CREDIT = 0: J_TAX = 0: J_GROSS = 0: J_NET = 0
            TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
            
            Set rsCheckVoucher = New ADODB.Recordset
            Set rsCheckVoucher = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & " AND ACCT_NAME = " & J_ACCT_NAME & "")
            If Not rsCheckVoucher.EOF And Not rsCheckVoucher.BOF Then
                Call UpdateJournalDetAmt(J_VOUCHERNO, J_JTYPE, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT)
            Else
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
        ''PARTS + MATERIAL + ACCESSORIES GJ + BP ONLY
        If WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_GOL_BP + WARRANTY_DIRECT_EXPENSE_ACC Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            
            If COMPANY_CODE = "CMC" Then
                J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("WARRANTY"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("WARRANTY")))
            Else
                If J_INVOICENO = "'INT RO'" Or J_INVOICENO = "INT RO" Then
                    J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("WARRANTY")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("TRADE"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("TRADE")))
                End If
            End If
            
            J_DEBIT = NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_GOL_BP + WARRANTY_DIRECT_EXPENSE_ACC)
            J_CREDIT = 0: J_TAX = 0: J_GROSS = 0: J_NET = 0
            TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
            
            Set rsCheckVoucher = New ADODB.Recordset
            Set rsCheckVoucher = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & " AND ACCT_NAME = " & J_ACCT_NAME & "")
            If Not rsCheckVoucher.EOF And Not rsCheckVoucher.BOF Then
                Call UpdateJournalDetAmt(J_VOUCHERNO, J_JTYPE, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT)
            Else
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
    Else
        If WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_ACC + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"

            J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("WARRANTY"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("WARRANTY")))
            
            J_DEBIT = NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_ACC + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR)
            J_CREDIT = 0: J_TAX = 0: J_GROSS = 0: J_NET = 0
            TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
            
            If COMPANY_CODE = "CMC" Then
                Set rsCheckVoucher = New ADODB.Recordset
                Set rsCheckVoucher = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & " AND ACCT_NAME = " & J_ACCT_NAME & "")
                If Not rsCheckVoucher.EOF And Not rsCheckVoucher.BOF Then
                    Call UpdateJournalDetAmt(J_VOUCHERNO, J_JTYPE, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT)
                Else
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            Else
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            
        End If
    End If
    
    ENTRY_WARRANTY_AR = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    ENTRY_WARRANTY_AR = False
    ShowVBError
End Function

Function ENTRY_WARRANTY_DIRECT_EXPENSE() As Boolean
'DIRECT EXPENSE DESIGNED FOR CMC
''NOTE: DIRECT EXPENSE | CONTRA INCOME FOR CMC

    On Error GoTo ErrorCode
    
    If COMPANY_CODE = "CMC" Then
        ''LABOR + SUBLET GJ + BP ONLY
        If WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR > 0 Then
            J_ACCT_CODE = N2Str2Null(ReturnAccountCode("DIRECT-LABOR"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("DIRECT-LABOR")))
                        
            J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR), 2)
            J_TAX = 0
            J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR), 2)
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            'Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
        ''PARTS + ACCESSORIES GJ + BP ONLY
        If WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_ACC > 0 Then
            J_ACCT_CODE = N2Str2Null(ReturnAccountCode("DIRECT-PARTS"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("DIRECT-PARTS")))
                        
            J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_ACC), 2)
            J_TAX = 0
            J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_ACC), 2)
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            'Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
                        
        ''MATERIALS GJ + BP ONLY
        If WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_GOL_BP > 0 Then
            J_ACCT_CODE = N2Str2Null(ReturnAccountCode("DIRECT-MATERIALS"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("DIRECT-MATERIALS")))
                        
            J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_GOL_BP), 2)
            J_TAX = 0
            J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_GOL_BP), 2)
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            'Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    Else
    End If

    ENTRY_WARRANTY_DIRECT_EXPENSE = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    ENTRY_WARRANTY_DIRECT_EXPENSE = False
    ShowVBError
End Function

Function ENTRY_WARRANTY_COST() As Boolean
If COMPANY_CODE = "CMC" Then GoTo EXIT_WARRANTY_COST

''LABOR + SUBLET GJ ONLY
    If COMPANY_CODE = "HCA" Then
        If WARRANTY_DIRECT_EXPENSE_LABOR_COST + WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If Left(CSMIOS_INVOICE, 6) = "INT RO" Then
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER")))
            End If
            J_DEBIT = Round(WARRANTY_DIRECT_EXPENSE_LABOR_COST + WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR, 2)
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    ElseIf COMPANY_CODE = "MGS" Then
        GoTo TOTAL_PMA_GJ_BP
    Else
        If WARRANTY_DIRECT_EXPENSE_LABOR_COST > 0 And (COMPANY_CODE <> "MGS" And COMPANY_CODE <> "HSB" And COMPANY_CODE <> "HBC" And COMPANY_CODE <> "HLB" And COMPANY_CODE <> "HCR") Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If Left(CSMIOS_INVOICE, 6) = "INT RO" Then
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "INTERNAL")))
            Else
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "WARRANTY")))
                Else
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABORCHG", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABORCHG", "WARRANTY")))
                    ElseIf COMPANY_CODE = "DJM" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "WARRANTY")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABORCHG", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABORCHG", "WARRANTY")))
                    End If
                End If
            End If
            J_DEBIT = Round(WARRANTY_DIRECT_EXPENSE_LABOR_COST, 2)
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
        If WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If Left(CSMIOS_INVOICE, 6) = "INT RO" Then
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "INTERNAL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "INTERNAL")))
            Else
                If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HCR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "WARRANTY")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "WARRANTY")))
                    Else
                        If COMPANY_CODE = "HCE" Then
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLETCHG", "WARRANTY"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLETCHG", "WARRANTY")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "WARRANTY"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "WARRANTY")))
                        End If
                    End If
                End If
            End If
            J_DEBIT = Round(WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR, 2)
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If

''LABOR BP ONLY
    If WARRANTY_DIRECT_EXPENSE_LABOR_BP > 0 Then
        WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        If Left(CSMIOS_INVOICE, 6) = "INT RO" Then
            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "BRP", "INTERNAL"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "BRP", "INTERNAL")))
        Else
            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER")))
        End If
        J_DEBIT = Round(WARRANTY_DIRECT_EXPENSE_LABOR_COST_BP, 2)
        J_CREDIT = 0
        ALL_DEBIT = ALL_DEBIT + J_DEBIT
        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    End If
    
''PARTS + MATERIALS + ACCESSORIES GJ ONLY
    If COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
        If WARRANTY_CSMIOS_PARTS_COST + WARRANTY_CSMIOS_MATERIALS_COST + WARRANTY_CSMIOS_MATERIALS_COST_ACC > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If Left(CSMIOS_INVOICE, 6) = "INT RO" Then
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "INTERNAL")))
            Else
                If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "WARRANTY")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                End If
            End If
            J_DEBIT = Round(WARRANTY_CSMIOS_PARTS_COST + WARRANTY_CSMIOS_MATERIALS_COST + WARRANTY_CSMIOS_MATERIALS_COST_ACC, 2)
            J_CREDIT = 0
            TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    Else
    ''PARTS GJ ONLY
        If WARRANTY_CSMIOS_PARTS_COST + CSMIOS_WARRANTY_PARTS_INV_GEN + CSMIOS_WARRANTY__PARTS_INV_NONGEN > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "WARRANTY"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "WARRANTY")))
            Else
                If COMPANY_CODE = "HCE" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJCHG", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJCHG", "WARRANTY")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "WARRANTY")))
                End If
            End If
            J_DEBIT = Round(WARRANTY_CSMIOS_PARTS_COST + CSMIOS_WARRANTY_PARTS_INV_GEN + CSMIOS_WARRANTY__PARTS_INV_NONGEN, 2)
            J_CREDIT = 0
            TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
    ''MATERIALS GJ ONLY
        If WARRANTY_CSMIOS_MATERIALS_COST > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DJM" Then
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "WARRANTY"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "WARRANTY")))
            Else
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS", "WARRANTY")))
                Else
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS", "WARRANTY")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS", "WARRANTY")))
                    End If
                End If
            End If
            J_DEBIT = Round(WARRANTY_CSMIOS_MATERIALS_COST, 2)
            J_CREDIT = 0
            TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
    ''ACCESSORIES GJ ONLY
        If WARRANTY_CSMIOS_MATERIALS_COST_ACC > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "WARRANTY"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "WARRANTY")))
            Else
                If COMPANY_CODE = "HCE" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIESCHG", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIESCHG", "WARRANTY")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "WARRANTY")))
                End If
            End If
            J_DEBIT = Round(WARRANTY_CSMIOS_MATERIALS_COST_ACC, 2)
            J_CREDIT = 0
            TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If
    
            
TOTAL_PMA_GJ_BP:

''PARTS + MATERIALS + ACCESSORIES GJ + BP ONLY
    If COMPANY_CODE = "MGS" Then
        If J_INVOICENO = "'INT RO'" Or J_INVOICENO = "INT RO" Then
        Else
            If WARRANTY_CSMIOS_PARTS_COST + WARRANTY_CSMIOS_PARTS_COST_BP + WARRANTY_CSMIOS_MATERIALS_COST + WARRANTY_CSMIOS_MATERIALS_COST_BP + WARRANTY_CSMIOS_MATERIALS_COST_ACC + WARRANTY_CSMIOS_MATERIALS_COST_BP + WARRANTY_CSMIOS_ACCESSORIES_COST > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                J_DEBIT = Round(WARRANTY_CSMIOS_PARTS_COST + WARRANTY_CSMIOS_PARTS_COST_BP + WARRANTY_CSMIOS_MATERIALS_COST + WARRANTY_CSMIOS_MATERIALS_COST_BP + WARRANTY_CSMIOS_MATERIALS_COST_ACC + WARRANTY_CSMIOS_MATERIALS_COST_BP + WARRANTY_CSMIOS_ACCESSORIES_COST, 2)
                J_CREDIT = 0
                TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                
                Set rsCheckVoucher = New ADODB.Recordset
                Set rsCheckVoucher = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & " AND ACCT_NAME = " & J_ACCT_NAME & "")
                If Not rsCheckVoucher.EOF And Not rsCheckVoucher.BOF Then
                    Call UpdateJournalDetAmt(J_VOUCHERNO, J_JTYPE, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT)
                Else
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
        End If
    End If

EXIT_WARRANTY_COST:
    ENTRY_WARRANTY_COST = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    ENTRY_WARRANTY_COST = False
    ShowVBError
End Function

Function ENTRY_WARRANTY_SALES() As Boolean
If COMPANY_CODE = "CMC" Then GoTo EXIT_WARRANTY_SALES
    
    ''LABOR + SUBLET GJ ONLY
    If COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
        If WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_SR > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "WARRANTY"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "WARRANTY")))
            Else
                If Left(CSMIOS_INVOICE, 6) = "INT RO" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "INTERNAL")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
                End If
            End If
            J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_SR), 2)
            If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Or Left(CSMIOS_INVOICE, 6) = "INT RO" And COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCA" Then
                J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_SR), 2)
            Else
                If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                    J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_SR + WARRANTY_DIRECT_EXPENSE_LABOR_BP), 2)
                Else
                    J_NET = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_SR) / 1.12), 2)
                End If
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    ElseIf COMPANY_CODE = "MGS" Then
    ''LABOR + SUBLET GJ + BP ONLY
        If WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
            
            J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR), 2)
            J_NET = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR) / 1.12), 2)
            
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            
            Set rsCheckVoucher = New ADODB.Recordset
            Set rsCheckVoucher = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & " AND ACCT_NAME = " & J_ACCT_NAME & "")
            If Not rsCheckVoucher.EOF And Not rsCheckVoucher.BOF Then
                Call UpdateJournalDetAmt(J_VOUCHERNO, J_JTYPE, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT)
            Else
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    Else
    ''LABOR GJ ONLY
        If WARRANTY_DIRECT_EXPENSE_LABOR > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "WARRANTY"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "WARRANTY")))
            Else
                If COMPANY_CODE = "HCE" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABORCHG", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABORCHG", "WARRANTY")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "WARRANTY")))
                End If
            End If
            J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR), 2)
            If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Or Left(CSMIOS_INVOICE, 6) = "INT RO" Then
                J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR), 2)
            Else
                J_NET = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR) / 1.12), 2)
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
    ''LABOR BP ONLY
        If COMPANY_CODE <> "HSB" And COMPANY_CODE <> "HBC" And COMPANY_CODE <> "HLB" And COMPANY_CODE <> "HCR" Then
            If WARRANTY_DIRECT_EXPENSE_LABOR_BP > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If Left(CSMIOS_INVOICE, 6) = "INT RO" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "BRP", "INTERNAL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "BRP", "INTERNAL")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER")))
                    Else
                        If COMPANY_CODE = "HCE" Then
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-BPCHG", "CUSTOMER"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-BPCHG", "CUSTOMER")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER")))
                        End If
                    End If
                End If
                J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR_BP), 2)
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Or Left(CSMIOS_INVOICE, 6) = "INT RO" Then
                    J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR_BP), 2)
                Else
                    J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR_BP / 1.12), 2)
                End If
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
    ''SUBLET GJ ONLY
        If WARRANTY_DIRECT_EXPENSE_LABOR_SR > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "WARRANTY"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "WARRANTY")))
            Else
                If COMPANY_CODE = "HCE" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "WARRANTY")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "WARRANTY")))
                End If
            End If
            J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_LABOR_SR), 2)
            If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Or Left(CSMIOS_INVOICE, 6) = "INT RO" Then
                J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR_SR), 2)
            Else
                J_NET = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR_SR) / 1.12), 2)
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If

    ''PARTS + MATERIALS + ACCESSORIES GJ ONLY
    If COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
        If WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_ACC > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If Left(CSMIOS_INVOICE, 6) = "INT RO" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "INTERNAL")))
            Else
                If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "WARRANTY")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "CUSTOMER")))
                End If
            End If
            J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS), 2)
            If (CSMIOS_VAT_EXEMPT = True) Or (CSMIOS_VAT_EXEMPT1 = True) Or (Left(CSMIOS_INVOICE, 6) = "INT RO") Then
                J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_ACC), 2)
            Else
                If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                    J_NET = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_ACC)), 2)
                Else
                    J_NET = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_ACC) / 1.12), 2)
                End If
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    ElseIf COMPANY_CODE = "MGS" Then
        GoTo TOTAL_PMA_GJ_BP
    Else
    ''PARTS GJ ONLY
        If WARRANTY_DIRECT_EXPENSE_SPAREPARTS > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DJM" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "WARRANTY"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "WARRANTY")))
            Else
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "WARRANTY")))
                Else
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJCHG", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJCHG", "WARRANTY")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "WARRANTY")))
                    End If
                End If
            End If
            J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS), 2)
            If (CSMIOS_VAT_EXEMPT = True) Or (CSMIOS_VAT_EXEMPT1 = True) Or (Left(CSMIOS_INVOICE, 6) = "INT RO") Then
                J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS), 2)
            Else
                J_NET = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS) / 1.12), 2)
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
    ''MATERIALS GJ ONLY
        If WARRANTY_DIRECT_EXPENSE_GOL > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DJM" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "WARRANTY"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "WARRANTY")))
            Else
                If CSMIOS_TERM = "CSH" Then
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJCHG", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJCHG", "CUSTOMER")))
                    End If
                Else
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALSCHG", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALSCHG", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS", "WARRANTY"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS", "WARRANTY")))
                    End If
                End If
            End If
            J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS), 2)
            If (CSMIOS_VAT_EXEMPT = True) Or (CSMIOS_VAT_EXEMPT1 = True) Or (Left(CSMIOS_INVOICE, 6) = "INT RO") Then
                J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_GOL), 2)
            Else
                J_NET = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_GOL) / 1.12), 2)
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
    ''ACCESSORIES GJ ONLY
        If WARRANTY_DIRECT_EXPENSE_ACC > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "WARRANTY"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "WARRANTY")))
            Else
                If COMPANY_CODE = "HCE" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIESCHG", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIESCHG", "WARRANTY")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "WARRANTY")))
                End If
            End If
            J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS), 2)
            If (CSMIOS_VAT_EXEMPT = True) Or (CSMIOS_VAT_EXEMPT1 = True) Or (Left(CSMIOS_INVOICE, 6) = "INT RO") Then
                J_NET = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_ACC), 2)
            Else
                J_NET = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_ACC) / 1.12), 2)
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If
    
    

TOTAL_PMA_GJ_BP:
    ''PARTS + MATERIALS + ACCESSORIES GJ + BP ONLY
    If COMPANY_CODE = "MGS" Then
        If WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_GOL_BP + WARRANTY_DIRECT_EXPENSE_ACC > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
            
            J_GROSS = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_GOL_BP + WARRANTY_DIRECT_EXPENSE_ACC), 2)
            J_NET = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_GOL_BP + WARRANTY_DIRECT_EXPENSE_ACC) / 1.12), 2)
            
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            
            Set rsCheckVoucher = New ADODB.Recordset
            Set rsCheckVoucher = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & " AND ACCT_NAME = " & J_ACCT_NAME & "")
            If Not rsCheckVoucher.EOF And Not rsCheckVoucher.BOF Then
                Call UpdateJournalDetAmt(J_VOUCHERNO, J_JTYPE, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT)
            Else
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    End If

EXIT_WARRANTY_SALES:
    ENTRY_WARRANTY_SALES = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    ENTRY_WARRANTY_SALES = False
    ShowVBError
End Function

Function ENTRY_WARRANTY_INVENTORY() As Boolean
If COMPANY_CODE = "CMC" Then GoTo EXIT_WARRANTY_INVENTORY

''LABOR
    If COMPANY_CODE = "MGS" Then
    Else
        ''LABOR GJ ONLY
        If WARRANTY_DIRECT_EXPENSE_LABOR_COST > 0 And (COMPANY_CODE <> "HSB" And COMPANY_CODE <> "HBC" And COMPANY_CODE <> "HLB" And COMPANY_CODE <> "HCR") Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "HCE" Then
                J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnInventory("PAYROLL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PAYROLL")))
            End If
            
            J_DEBIT = 0
            
            If COMPANY_CODE = "DJM" Then
                J_CREDIT = Round(WARRANTY_DIRECT_EXPENSE_LABOR_COST, 2)
            Else
        ''LABOR + SUBLET GJ ONLY
                J_CREDIT = Round(WARRANTY_DIRECT_EXPENSE_LABOR_COST + WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR, 2)
            End If
            
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
        ''SUBLET GJ ONLY
        If WARRANTY_DIRECT_EXPENSE_LABOR_SR > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET", "", ""))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET", "", "")))
            J_DEBIT = 0
            J_CREDIT = Round(WARRANTY_DIRECT_EXPENSE_LABOR_COST_SR, 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
        ''LABOR BP ONLY
        If WARRANTY_DIRECT_EXPENSE_LABOR_BP > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1: WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
            J_DEBIT = 0
            J_CREDIT = Round(WARRANTY_DIRECT_EXPENSE_LABOR_COST_BP, 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
        ''SUBLET BP ONLY
    End If
    
    ''PARTS + MATERIALS + ACCESSORIES GJ ONLY
    If COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
        If WARRANTY_CSMIOS_PARTS_COST + WARRANTY_CSMIOS_MATERIALS_COST + WARRANTY_CSMIOS_MATERIALS_COST_ACC > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
            J_DEBIT = 0
            J_CREDIT = Round(WARRANTY_CSMIOS_PARTS_COST + WARRANTY_CSMIOS_MATERIALS_COST, 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    ElseIf COMPANY_CODE = "MGS" Then
        GoTo TOTAL_PMA_GJ_BP
    Else
        If COMPANY_CODE = "HCE" Then
            If CSMIOS_WARRANTY_PARTS_INV_GEN > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                J_DEBIT = 0
                J_CREDIT = Round(CSMIOS_WARRANTY_PARTS_INV_GEN, 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            
            If CSMIOS_WARRANTY__PARTS_INV_NONGEN > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnInventory("NONGEN_PARTS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("NONGEN_PARTS")))
                J_DEBIT = 0
                J_CREDIT = Round(CSMIOS_WARRANTY__PARTS_INV_NONGEN, 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        Else
    ''PARTS GJ ONLY
            If WARRANTY_CSMIOS_PARTS_COST > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HCE" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                End If
                J_DEBIT = 0
                J_CREDIT = Round(WARRANTY_CSMIOS_PARTS_COST, 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
     ''MATERIALS GJ ONLY
        If WARRANTY_CSMIOS_MATERIALS_COST > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
            End If
            J_DEBIT = 0
            J_CREDIT = Round(WARRANTY_CSMIOS_MATERIALS_COST, 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
     ''ACCESORIES GJ ONLY
        If WARRANTY_CSMIOS_MATERIALS_COST_ACC > 0 Then
            WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
            WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnInventory("AIN-PROCESS"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("AIN-PROCESS")))
            J_DEBIT = 0
            J_CREDIT = Round(WARRANTY_CSMIOS_MATERIALS_COST_ACC, 2)
            TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If
    
    
TOTAL_PMA_GJ_BP:
    If COMPANY_CODE = "MGS" Then
        If J_INVOICENO = "'INT RO'" Or J_INVOICENO = "INT RO" Then
        Else
            If WARRANTY_CSMIOS_PARTS_COST + WARRANTY_CSMIOS_PARTS_COST_BP + WARRANTY_CSMIOS_MATERIALS_COST + WARRANTY_CSMIOS_MATERIALS_COST_BP + WARRANTY_CSMIOS_MATERIALS_COST_ACC + WARRANTY_CSMIOS_MATERIALS_COST_BP + WARRANTY_CSMIOS_ACCESSORIES_COST > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                
                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS-IN-PROCESS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS-IN-PROCESS")))
                
                J_CREDIT = Round(WARRANTY_CSMIOS_PARTS_COST + WARRANTY_CSMIOS_PARTS_COST_BP + WARRANTY_CSMIOS_MATERIALS_COST + WARRANTY_CSMIOS_MATERIALS_COST_BP + WARRANTY_CSMIOS_MATERIALS_COST_ACC + WARRANTY_CSMIOS_MATERIALS_COST_BP + WARRANTY_CSMIOS_ACCESSORIES_COST, 2)
                J_DEBIT = 0
                TOTAL_DEBIT = TOTAL_DEBIT + J_DEBIT
                
                Set rsCheckVoucher = New ADODB.Recordset
                Set rsCheckVoucher = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & " AND ACCT_NAME = " & J_ACCT_NAME & "")
                If Not rsCheckVoucher.EOF And Not rsCheckVoucher.BOF Then
                    Call UpdateJournalDetAmt(J_VOUCHERNO, J_JTYPE, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT)
                Else
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
        End If
    End If
    
EXIT_WARRANTY_INVENTORY:
    ENTRY_WARRANTY_INVENTORY = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    ENTRY_WARRANTY_INVENTORY = False
    ShowVBError
End Function

Function ENTRY_WARRANTY_VAT() As Boolean
If COMPANY_CODE = "CMC" Then GoTo EXIT_WARRANTY_VAT

    If (COMPANY_CODE <> "HSB" And COMPANY_CODE <> "HBC" And COMPANY_CODE <> "HLB" And COMPANY_CODE <> "HCR") Then
        If COMPANY_CODE = "HCA" Then
            Call DOTSERVICEPARTSWARRANTY
        Else
            If NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_GOL_BP + WARRANTY_CSMIOS_MATERIALS_COST_ACC) > 0 Then
                WARRANTY_ItemCnt = WARRANTY_ItemCnt + 1
                WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DAI" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HMR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnDeferredOutPutTax())
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDeferredOutPutTax()))
                ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HNE" Then
                    J_ACCT_CODE = N2Str2Null(ReturnOutputTax2("WARRANTY"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnOutputTax2("WARRANTY")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnOutputTax())
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnOutputTax()))
                End If
                
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_ACC + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR) / 1.12 * 0.12), 2)
                TOTAL_CREDIT = TOTAL_CREDIT + J_CREDIT
                
                If COMPANY_CODE = "HMR" Then
                Else
                    If Round(Round(TOTAL_CREDIT, 2) - Round(TOTAL_DEBIT + WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_GOL_BP, 2), 2) = 0.01 Then J_CREDIT = Round(J_CREDIT, 2) - 0.01
                    If Round(Round(TOTAL_DEBIT + WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS_BP + WARRANTY_DIRECT_EXPENSE_GOL_BP, 2) - Round(TOTAL_CREDIT, 2), 2) = 0.01 Then J_CREDIT = Round(J_CREDIT, 2) + 0.01
                End If
                
                J_TAX = 0: J_GROSS = 0: J_NET = 0
                
                If COMPANY_CODE = "MGS" Then
                    Set rsCheckVoucher = New ADODB.Recordset
                    Set rsCheckVoucher = gconDMIS.Execute("SELECT * FROM AMIS_JOURNAL_DET WHERE JTYPE = " & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE  = " & J_ACCT_CODE & " AND ACCT_NAME = " & J_ACCT_NAME & "")
                    If Not rsCheckVoucher.EOF And Not rsCheckVoucher.BOF Then
                        Call UpdateJournalDetAmt(J_VOUCHERNO, J_JTYPE, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT)
                    Else
                        Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    End If
                Else
                    Call InsertToJournalDet(J_JDATE, WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO, WARRANTY_J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
        End If
        
        ''ENTRY ROUND OF DIFF
        If COMPANY_CODE <> "HCE" And COMPANY_CODE <> "DJM" Then: Call rodwarranty
    End If

EXIT_WARRANTY_VAT:
    ENTRY_WARRANTY_VAT = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    ENTRY_WARRANTY_VAT = False
    ShowVBError
End Function

Function IMPORT_WARRANTY_NEW() As Boolean
    On Error GoTo ErrorCode
    
    If WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_ACC + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR + WARRANTY_DIRECT_EXPENSE_LABOR_COST + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_CSMIOS_PARTS_COST + WARRANTY_CSMIOS_MATERIALS_COST + WARRANTY_CSMIOS_MATERIALS_COST_ACC > 0 Then
        Set rsJournal_HDDup = New ADODB.Recordset
        Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_journal_hd order by jno desc")
        
        If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then
            WARRANTY_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 1, "000000") & "'"
        Else
            WARRANTY_JNO = "000001"
        End If

        WARRANTY_VOUCHERNO = N2Str2Null(Format(NumericVal(GetVoucherNo()), "000000"))
        WARRANTY_ItemCnt = 0
        WARRANTY_J_JITEMNO = "'" & Format(WARRANTY_ItemCnt, "0000") & "'"
        TOTAL_DEBIT = 0: TOTAL_CREDIT = 0
        
        If COMPANY_CODE = "HCE" Then
            CSMIOS_ACCT_NO = Null2String("H00011")
            CSMIOS_NIYM = Null2String(SetCustomerName("H00011"))
            J_CUSTOMERCODE = N2Str2Null("H00011")
        ElseIf COMPANY_CODE = "HSB" Then
            CSMIOS_ACCT_NO = Null2String("H00287")
            CSMIOS_NIYM = Null2String(SetCustomerName("H00287"))
            J_CUSTOMERCODE = N2Str2Null("H00287")
        ElseIf COMPANY_CODE = "CMC" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
            CSMIOS_ACCT_NO = Null2String(CSMIOS_ACCT_NO)
            CSMIOS_NIYM = Null2String(SetCustomerName(CSMIOS_ACCT_NO))
            J_CUSTOMERCODE = N2Str2Null(CSMIOS_ACCT_NO)
        ElseIf COMPANY_CODE = "MGS" Then
            CSMIOS_ACCT_NO = Null2String("M00001")
            CSMIOS_NIYM = Null2String(SetCustomerName("M00001"))
            J_CUSTOMERCODE = N2Str2Null("M00001")
        Else
            CSMIOS_ACCT_NO = Null2String("H00001")
            CSMIOS_NIYM = Null2String(SetCustomerName("H00001"))
            J_CUSTOMERCODE = N2Str2Null("H00001")
        End If
        
        ''***ENTRY FOR ACCOUNTS RECEIVABLE***''
        If ENTRY_WARRANTY_AR = False Then
            IMPORT_WARRANTY_NEW = False
            Exit Function
        End If
        
        ''***ENTRY FOR DIRECT EXPENSE***''
        If ENTRY_WARRANTY_DIRECT_EXPENSE = False Then
            IMPORT_WARRANTY_NEW = False
            Exit Function
        End If

        ''***ENTRY FOR COST OF SALES***''
        If ENTRY_WARRANTY_COST = False Then
            IMPORT_WARRANTY_NEW = False
            Exit Function
        End If
        
        ''***ENTRY FOR SALES***''
        If ENTRY_WARRANTY_SALES = False Then
            IMPORT_WARRANTY_NEW = False
            Exit Function
        End If
        
        ''***ENTRY FOR INVENTORY***''
        If ENTRY_WARRANTY_INVENTORY = False Then
            IMPORT_WARRANTY_NEW = False
            Exit Function
        End If
        
        ''***ENTRY FOR VAT***''
        If ENTRY_WARRANTY_VAT = False Then
            IMPORT_WARRANTY_NEW = False
            Exit Function
        End If

        '1 VOUCHER FOR CUSTOMER AND WARRANTY
        If (COMPANY_CODE = "CMC" Or COMPANY_CODE = "MGS") And (J_INVOICENO <> "'INT RO'" And J_INVOICENO <> "INT RO" And J_INVOICEAMT <> 0) Then GoTo Skip_Header_Warranty
        
        WARRANTY_J_AMOUNTTOPAY = 0
        If COMPANY_CODE = "CMC" Then
            If J_INVOICEAMT = 0 Then
                WARRANTY_J_INVOICEAMT = 0
            Else
                WARRANTY_J_INVOICEAMT = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_ACC + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR), 2)
            End If
        Else
            WARRANTY_J_INVOICEAMT = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_ACC + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR), 2)
        End If
        
        WARRANTY_J_BALANCE = Round(NumericVal(WARRANTY_DIRECT_EXPENSE_LABOR + WARRANTY_DIRECT_EXPENSE_SPAREPARTS + WARRANTY_DIRECT_EXPENSE_GOL + WARRANTY_DIRECT_EXPENSE_ACC + WARRANTY_DIRECT_EXPENSE_LABOR_BP + WARRANTY_DIRECT_EXPENSE_LABOR_SR), 2)
        WARRANTY_J_AMOUNTPAID = 0
        
        If COMPANY_CODE = "DJM" Then
            J_REMARKS = " SERVICE BILLING:" + " " + CSMIOS_INVOICE + " / " + CSMIOS_NIYM_PRINT
        Else
            J_REMARKS = " SERVICE INVOICENO:" + " " + CSMIOS_INVOICE + " / " + CSMIOS_NIYM_PRINT
        End If
        
        SQL_STATEMENT = "Insert into AMIS_Journal_HD" & _
        " (jdate,voucherno,jtype,vendorcode,customercode,invoicedate,invoicetype,invoiceno,invoiceamt,duedate,paytype,refno,refdate,terms,dealer,amounttopay,Balance,AmountPaid,jno,debit,credit,outbalance,status,CheckNo,CheckDate,BankCode,remarks,PaidStatus,ReceiveStatus)" & _
        " values (" & J_JDATE & ", " & WARRANTY_VOUCHERNO & ", " & J_JTYPE & ", " & J_VENDORCODE & "," & J_CUSTOMERCODE & ", " & J_INVOICEDATE & "," & J_INVOICETYPE & "," & J_INVOICENO & "," & WARRANTY_J_INVOICEAMT & ", " & J_DUEDATE & ", " & J_PAYTYPE & "," & J_REFNO & "," & J_REFDATE & "," & J_TERMS & "," & J_DEALER & ", " & WARRANTY_J_AMOUNTTOPAY & "," & WARRANTY_J_BALANCE & "," & WARRANTY_J_AMOUNTPAID & _
        ", " & WARRANTY_JNO & ", " & TOTAL_DEBIT & ", " & TOTAL_CREDIT & ", " & J_OUTBALANCE & ", " & J_STATUS & ", " & J_CHECKNO & ", " & J_CHECKDATE & ", " & J_BANKCODE & ",'" & J_REMARKS & "'," & J_PAIDSTATUS & "," & J_RECEIVESTATUS & ")"
        gconDMIS.Execute SQL_STATEMENT
        TransactionID = (FindTransactionID(N2Str2Null(WARRANTY_VOUCHERNO), "voucherno", "AMIS_journal_hd", "X", J_JTYPE, "Jtype"))
        NEW_LogAudit "M", "JOURNAL ENTRY", SQL_STATEMENT, TransactionID, "", WARRANTY_VOUCHERNO, J_JTYPE, WARRANTY_JNO
    End If
    
Skip_Header_Warranty:
    IMPORT_WARRANTY_NEW = True
    Exit Function
    
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    IMPORT_WARRANTY_NEW = False
    ShowVBError
End Function

Function CUSTOMER_ENTRY_AR() As Boolean
    On Error GoTo ErrorCode
    
    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
    If COMPANY_CODE = "MGS" Then
        J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("TRADE"))
        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("TRADE")))
    Else
        J_ACCT_CODE = N2Str2Null(ReturnAR_AccountCode("SERVICE"))
        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAR_AccountCode("SERVICE")))
    End If
    
    J_DEBIT = Round(J_INVOICEAMT, 2)
    J_CREDIT = 0: J_TAX = 0: J_GROSS = 0: J_NET = 0
    ALL_DEBIT = ALL_DEBIT + J_DEBIT
    ALL_CREDIT = ALL_CREDIT + J_CREDIT
    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                        
    CUSTOMER_ENTRY_AR = True
    Exit Function
    
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    CUSTOMER_ENTRY_AR = False
    ShowVBError
End Function

Function CUSTOMER_ENTRY_COST() As Boolean
    On Error GoTo ErrorCode
    
    If COMPANY_CODE = "CMC" Then GoTo EXIT_COST
    
''LABOR CUSTOMER GJ ONLY
    If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
        GoTo Skip_Costofsales_labor_GJ
    ElseIf COMPANY_CODE = "MGS" Then
        GoTo Skip_ALL_Costofsales_labor
    Else
        If CSMIOS_LABOR_COST + CSMIOS_PMS_COST > 0 And INSURANCE_DIRECT_EXPENSE_LABOR = 0 Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER")))
            ElseIf COMPANY_CODE = "HCE" Then
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJ", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-GJCHG", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-GJCHG", "CUSTOMER")))
                End If
            Else
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR", "RETAIL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR", "RETAIL")))
            End If
            
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Then
                J_DEBIT = Round(CSMIOS_LABOR_COST + CSMIOS_PMS_COST, 2)
            Else
                J_DEBIT = Round(CSMIOS_LABOR_COST, 2)
            End If
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If

Skip_Costofsales_labor_GJ:
''LABOR CUSTOMER BP ONLY
    If CSMIOS_TINSPAINT_COST + CSMIOS_TINSPAINT_COST_PARTS > 0 And INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS = 0 Then
        ItemCnt = ItemCnt + 1
        J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
        If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER")))
            Else
                If COMPANY_CODE = "HCE" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-BPCHG", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-BPCHG", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LABOR-BP", "CUSTOMER")))
                End If
            End If
        Else
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "BODY", "RETAIL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "BODY", "RETAIL")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "BODY", "RETAIL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "BODY", "RETAIL")))
            End If
        End If
        J_DEBIT = Round(CSMIOS_TINSPAINT_COST + CSMIOS_TINSPAINT_COST_PARTS, 2)
        J_CREDIT = 0
        ALL_DEBIT = ALL_DEBIT + J_DEBIT
        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    End If
    
'SUBLET CUSTOMER GJ ONLY
    If COMPANY_CODE = "DJM" Then
        ''SUBLET GJ + BP CUSTOMER
        If (CSMIOS_SUBLET_COST + CSMIOS_SUBLET_COST_BP) > 0 And (INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_SR_BP) = 0 Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER")))
            J_DEBIT = Round(CSMIOS_SUBLET_COST + CSMIOS_SUBLET_COST_BP, 2)
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    ElseIf COMPANY_CODE = "MGS" Then
    Else
        If CSMIOS_SUBLET_COST > 0 And INSURANCE_DIRECT_EXPENSE_SR = 0 And (COMPANY_CODE <> "HSB" And COMPANY_CODE <> "HBC" And COMPANY_CODE <> "HLB" And COMPANY_CODE <> "HCR") Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HGS" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER")))
                End If
            ElseIf COMPANY_CODE = "HCE" Then
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLETCSH", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLETCSH", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLETCHG", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLETCHG", "CUSTOMER")))
                End If
            Else
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "RETAIL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "RETAIL")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "RETAIL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "RETAIL")))
                End If
            End If
            J_DEBIT = Round(CSMIOS_SUBLET_COST, 2)
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If
    
    ''SUBLET CUSTOMER BP ONLY
'        If CSMIOS_SUBLET_COST_BP > 0 And INSURANCE_DIRECT_EXPENSE_SR_BP = 0 And (COMPANY_CODE = "DJM") Then
'            ItemCnt = ItemCnt + 1
'            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
'
'            If CSMIOS_TERM = "CSH" Then
'                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER"))
'                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER")))
'            Else
'                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER"))
'                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "SUBLET", "CUSTOMER")))
'            End If
'
'            J_DEBIT = Round(CSMIOS_SUBLET_COST, 2)
'            J_CREDIT = 0
'            ALL_DEBIT = ALL_DEBIT + J_DEBIT
'            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
'        End If

Skip_ALL_Costofsales_labor:
''PARTS + MATERIALS + ACCESSORIES CUSTOMER GJ ONLY
    If COMPANY_CODE = "HGS" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Or COMPANY_CODE = "HCA" Then
        If CSMIOS_PARTS_COST + CSMIOS_MATERIALS_COST + CSMIOS_ACCESSORIES_COST > 0 And INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES = 0 Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
            J_DEBIT = Round(CSMIOS_PARTS_COST + CSMIOS_MATERIALS_COST + CSMIOS_ACCESSORIES_COST, 2)
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    ElseIf COMPANY_CODE = "MGS" Then
        GoTo TOTAL_PMA_GJ_BP
    Else
''PARTS CUSTOMER GJ ONLY
        If CSMIOS_PARTS_COST + CSMIOS_PARTS_INV_GEN + CSMIOS_PARTS_INV_NONGEN > 0 And INSURANCE_DIRECT_EXPENSE_SPAREPARTS = 0 Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                Else
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJCHG", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJCHG", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                    End If
                End If
            Else
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "RETAIL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "RETAIL")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS", "RETAIL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS", "RETAIL")))
                End If
            End If
            J_DEBIT = Round(CSMIOS_PARTS_COST + CSMIOS_PARTS_INV_GEN + CSMIOS_PARTS_INV_NONGEN, 2)
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
''PARTS CUSTOMER BP ONLY
        If COMPANY_CODE <> "DJM" Then
            If CSMIOS_PARTS_COST_BP > 0 And INSURANCE_DIRECT_EXPENSE_SPAREPARTS = 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-BPCHG", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-BPCHG", "CUSTOMER")))
                    End If
                End If
                J_DEBIT = Round(CSMIOS_PARTS_COST_BP, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        ElseIf COMPANY_CODE = "DJM" Then
            If CSMIOS_PARTS_COST_BP > 0 And INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP = 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER")))
                
                J_DEBIT = Round(CSMIOS_PARTS_COST_BP, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        Else
            If CSMIOS_PARTS_COST_BP > 0 And INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP = 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-BP", "CUSTOMER")))
                
                J_DEBIT = Round(CSMIOS_PARTS_COST_BP, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
''MATERIALS CUSTOMER GJ ONLY
        If CSMIOS_MATERIALS_COST > 0 And INSURANCE_DIRECT_EXPENSE_ACCESSORIES = 0 Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                Else
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJCHG", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJCHG", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                    End If
                End If
            ElseIf COMPANY_CODE = "DAI" Then
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("MATERIALS", "SERVICE", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("MATERIALS", "SERVICE", "CUSTOMER")))
            Else
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "LUBRICANTS", "RETAIL")))
                End If
            End If
            J_GROSS = 0: J_TAX = 0: J_NET = 0
            J_DEBIT = Round(CSMIOS_MATERIALS_COST, 2)
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
''MATERIALS CUSTOMER BP ONLY
        If CSMIOS_MATERIALS_COST_BP > 0 Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "MATERIALS-BP", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "MATERIALS-BP", "CUSTOMER")))
            J_GROSS = 0: J_TAX = 0: J_NET = 0
            J_DEBIT = Round(CSMIOS_MATERIALS_COST_BP, 2)
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
''ACCESSORIES CUSTOMER GJ ONLY
        If CSMIOS_ACCESSORIES_COST > 0 And INSURANCE_DIRECT_EXPENSE_ACCESSORIES = 0 Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HMR" Then
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER")))
            Else
                If CSMIOS_TERM = "CSH" Then
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("ACCESSORIES", "INSTALLED"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("ACCESSORIES", "INSTALLED")))
                    End If
                Else
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "ACCESSORIES", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnCostofSales("ACCESSORIES", "INSTALLED"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("ACCESSORIES", "INSTALLED")))
                    End If
                End If
            End If
            J_DEBIT = Round(CSMIOS_ACCESSORIES_COST, 2)
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
TOTAL_PMA_GJ_BP:
''PARTS + MATERIALS + ACCESSORIES CUSTOMER GJ + BP ONLY
        If COMPANY_CODE = "MGS" Then
            If CSMIOS_PARTS_COST + CSMIOS_PARTS_COST_BP + CSMIOS_MATERIALS_COST + CSMIOS_MATERIALS_COST_BP + CSMIOS_ACCESSORIES_COST + CSMIOS_ACCESSORIES_COST_BP > 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnCostofSales("SERVICE", "PARTS-GJ", "CUSTOMER")))
                J_DEBIT = Round(CSMIOS_PARTS_COST + CSMIOS_PARTS_COST_BP + CSMIOS_MATERIALS_COST + CSMIOS_MATERIALS_COST_BP + CSMIOS_ACCESSORIES_COST + CSMIOS_ACCESSORIES_COST_BP, 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
    End If
        
EXIT_COST:
    CUSTOMER_ENTRY_COST = True
    Exit Function
    
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    CUSTOMER_ENTRY_COST = False
    ShowVBError
End Function

Function CUSTOMER_ENTRY_DISCOUNT() As Boolean
    On Error GoTo ErrorCode
    
    'LABOR
    If COMPANY_CODE <> "CMC" And COMPANY_CODE <> "MGS" And COMPANY_CODE <> "DJM" And COMPANY_CODE <> "DGI" And COMPANY_CODE <> "DSSC" And COMPANY_CODE <> "HGS" Then
        If COMPANY_CODE = "HCA" Then
            ''LABOR + SUBLET
            If CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_PMS_DISCOUNT > 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABOR"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABOR")))
                
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT), 2)
                Else
                    J_TAX = Round(Round(((CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_PMS_DISCOUNT) / 1.12), 2) * 0.12, 2)
                    J_NET = Round(NumericVal(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_PMS_DISCOUNT) / 1.12), 2)
                End If
                
                J_DEBIT = Round(NumericVal(J_NET), 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            
            ''BRP
            If CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT_PARTS > 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "BRP"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "BRP")))
                
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT_PARTS), 2)
                Else
                    J_TAX = Round(Round(((CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT_PARTS) / 1.12), 2) * 0.12, 2)
                    J_NET = Round(NumericVal(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT) / 1.12), 2)
                End If
                
                J_DEBIT = Round(NumericVal(J_NET), 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        ElseIf COMPANY_CODE = "DJM" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
            If CSMIOS_LABOR_DISCOUNT + CSMIOS_PMS_DISCOUNT > 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABOR-GJ"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABOR-GJ")))
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_NET = Round(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_PMS_DISCOUNT), 2)
                Else
                    J_NET = Round(NumericVal(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_PMS_DISCOUNT) / 1.12), 2)
                End If
                J_DEBIT = Round(NumericVal(J_NET), 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            
            If CSMIOS_TINSPAINT_DISCOUNT > 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABOR-BP"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABOR-BP")))
                If CSMIOS_INVOICE = "PDI RO" Then
                    J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_TINSPAINT_DISCOUNT), 2)
                Else
                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                        J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_TINSPAINT_DISCOUNT), 2)
                    Else
                        J_TAX = Round(Round(((CSMIOS_TINSPAINT_DISCOUNT) / 1.12), 2) * 0.12, 2)
                        J_NET = Round(NumericVal((CSMIOS_TINSPAINT_DISCOUNT)) - Round(NumericVal(J_TAX), 2), 2)
                    End If
                End If
                J_DEBIT = Round(NumericVal(J_NET), 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            
            If CSMIOS_SUBLET_DISCOUNT > 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "SUBLET"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "SUBLET")))
                
                If CSMIOS_INVOICE = "PDI RO" Then
                    J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_SUBLET_DISCOUNT), 2)
                Else
                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                        J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_SUBLET_DISCOUNT), 2)
                    Else
                        J_TAX = Round(Round(((CSMIOS_SUBLET_DISCOUNT) / 1.12), 2) * 0.12, 2)
                        J_NET = Round(NumericVal((CSMIOS_SUBLET_DISCOUNT)) - Round(NumericVal(J_TAX), 2), 2)
                    End If
                End If
                
                J_DEBIT = Round(NumericVal(J_NET), 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        Else
            If CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT > 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABOR"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABOR")))
                Else
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABORCHG"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABORCHG")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABOR"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABOR")))
                    End If
                End If
                
                If CSMIOS_VAT_EXEMPT = True And CSMIOS_VAT_EXEMPT1 = True Then
                    J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT), 2)
                Else
                    J_TAX = Round(Round(((CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT) / 1.12), 2) * 0.12, 2)
                    J_NET = Round(NumericVal(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT) / 1.12), 2)
                End If
                J_DEBIT = Round(NumericVal(J_NET), 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
    End If
    
    If COMPANY_CODE = "DAI" Or COMPANY_CODE = "HCC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
        If CSMIOS_PARTS_DISCOUNT > 0 Or CSMIOS_MATERIALS_DISCOUNT > 0 Or CSMIOS_ACCESSORIES_DISCOUNT > 0 Or CSMIOS_TINSPAINT_DISCOUNT_PARTS > 0 Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "PARTS"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "PARTS")))
            J_GROSS = NumericVal(CSMIOS_PARTS_DISCOUNT)
            If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT_PARTS), 2)
            Else
                J_TAX = Round(NumericVal(Round(((CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT_PARTS) / 1.12), 2) * 0.12), 2)
                J_NET = Round(NumericVal(NumericVal(CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT_PARTS) / 1.12), 2)
            End If
            J_DEBIT = NumericVal(J_NET)
            J_CREDIT = 0
            ALL_DEBIT = ALL_DEBIT + J_DEBIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    ElseIf COMPANY_CODE = "CMC" Then
            ''LABOR GJ ONLY
            If CSMIOS_LABOR_DISCOUNT + CSMIOS_PMS_DISCOUNT > 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABOR-GJ-CSH"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABOR-GJ-CSH")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "LABOR-GJ-CHG"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "LABOR-GJ-CHG")))
                End If
                
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_TAX = 0
                    J_NET = Round(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT), 2)
                Else
                    J_TAX = Round(Round(((CSMIOS_LABOR_DISCOUNT + CSMIOS_PMS_DISCOUNT) / 1.12), 2) * 0.12, 2)
                    J_NET = Round(NumericVal(NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_PMS_DISCOUNT) / 1.12), 2)
                End If
                
                J_DEBIT = Round(NumericVal(J_NET), 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            
            ''LABOR BP ONLY
            If CSMIOS_TINSPAINT_DISCOUNT > 0 Then

            End If
            
            ''SUBLET GJ + BP ONLY
            If CSMIOS_SUBLET_DISCOUNT + CSMIOS_SUBLET_DISCOUNT_BP > 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "SUBLET-GJ-CSH"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "SUBLET-GJ-CSH")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "SUBLET-GJ-CHG"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "SUBLET-GJ-CHG")))
                End If
                
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_TAX = 0
                    J_NET = Round(NumericVal(CSMIOS_SUBLET_DISCOUNT + CSMIOS_SUBLET_DISCOUNT_BP), 2)
                Else
                    J_TAX = Round(Round(((CSMIOS_SUBLET_DISCOUNT + CSMIOS_SUBLET_DISCOUNT_BP) / 1.12), 2) * 0.12, 2)
                    J_NET = Round(NumericVal(NumericVal(CSMIOS_SUBLET_DISCOUNT + CSMIOS_SUBLET_DISCOUNT_BP) / 1.12), 2)
                End If
                
                J_DEBIT = Round(NumericVal(J_NET), 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            
            
            ''PARTS GJ + PARTS BP + ACCESSORIES GJ + ACCESSORIES BP ONLY
            If CSMIOS_PARTS_DISCOUNT + CSMIOS_PARTS_DISCOUNT_BP + CSMIOS_ACCESSORIES_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT_BP > 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "PARTS-GJ-CSH"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "PARTS-GJ-CSH")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "PARTS-GJ-CHG"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "PARTS-GJ-CHG")))
                End If
                
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_TAX = 0
                    J_NET = Round(NumericVal(CSMIOS_PARTS_DISCOUNT + CSMIOS_PARTS_DISCOUNT_BP + CSMIOS_ACCESSORIES_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT_BP), 2)
                Else
                    J_TAX = Round(Round(((CSMIOS_PARTS_DISCOUNT + CSMIOS_PARTS_DISCOUNT_BP + CSMIOS_ACCESSORIES_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT_BP) / 1.12), 2) * 0.12, 2)
                    J_NET = Round(NumericVal(NumericVal(CSMIOS_PARTS_DISCOUNT + CSMIOS_PARTS_DISCOUNT_BP + CSMIOS_ACCESSORIES_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT_BP) / 1.12), 2)
                End If
                
                J_DEBIT = Round(NumericVal(J_NET), 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            
            
            ''MATERIALS GJ ONLY
            ''MATERIALS BP ONLY
            ''MATERIALS GJ + BP ONLY
            If CSMIOS_MATERIALS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT_BP > 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "MATERIALS-GJ-CSH"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "MATERIALS-GJ-CSH")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "MATERIALS-GJ-CHG"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "MATERIALS-GJ-CHG")))
                End If
                
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_TAX = 0
                    J_NET = Round(NumericVal(CSMIOS_MATERIALS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT_BP), 2)
                Else
                    J_TAX = Round(Round(((CSMIOS_MATERIALS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT_BP) / 1.12), 2) * 0.12, 2)
                    J_NET = Round(NumericVal(NumericVal(CSMIOS_MATERIALS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT_BP) / 1.12), 2)
                End If
                
                J_DEBIT = Round(NumericVal(J_NET), 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            
            ''ACCESSORIES GJ ONLY
            ''ACCESSORIES BP ONLY
            ''ACCESSORIES GJ + BP ONLY
            
            ''PARTS + MATERIALS + ACCESSORIES GJ ONLY
            ''PARTS + MATERIALS + ACCESSORIES BP ONLY
            ''PARTS + MATERIALS + ACCESSORIES GJ + BP ONLY
            
            CUSTOMER_ENTRY_DISCOUNT = True
            Exit Function
    Else
        If COMPANY_CODE <> "MGS" And COMPANY_CODE <> "DJM" And COMPANY_CODE <> "DGI" And COMPANY_CODE <> "DSSC" And COMPANY_CODE <> "HGS" Then
            If CSMIOS_PARTS_DISCOUNT > 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "PARTS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "PARTS")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "PARTS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "PARTS")))
                    Else
                        If COMPANY_CODE = "HCE" Then
                            J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTSCHG", "PARTS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTSCHG", "PARTS")))
                        Else
                            J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "PARTS"))
                            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "PARTS")))
                        End If
                    End If
                End If
                J_GROSS = NumericVal(CSMIOS_PARTS_DISCOUNT)
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_NET = Round(NumericVal(CSMIOS_PARTS_DISCOUNT), 2)
                Else
                    J_NET = Round(NumericVal(NumericVal(CSMIOS_PARTS_DISCOUNT) / 1.12), 2)
                End If
                J_DEBIT = NumericVal(J_NET)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                
            End If
            
            'PARTS NON-GENUINE DISCOUNT FOR HNE
            If COMPANY_CODE = "HNE" Then
                If CSMIOS_PARTS_NON_DISCOUNT > 0 Then
                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "SERVICE"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "SERVICE")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "SERVICE"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "SERVICE")))
                    End If
                    J_GROSS = NumericVal(CSMIOS_PARTS_DISCOUNT)
                    If CSMIOS_INVOICE = "PDI RO" Then
                        J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_PARTS_NON_DISCOUNT), 2)
                    Else
                        If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                            J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_PARTS_NON_DISCOUNT), 2)
                        Else
                            J_TAX = Round(NumericVal(Round((CSMIOS_PARTS_NON_DISCOUNT / 1.12), 2) * 0.12), 2)
                            J_NET = Round(NumericVal(CSMIOS_PARTS_NON_DISCOUNT) - Round(NumericVal(J_TAX), 2), 2)
                        End If
                    End If
                    J_DEBIT = NumericVal(J_NET)
                    J_CREDIT = 0
                    ALL_DEBIT = ALL_DEBIT + J_DEBIT
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                End If
            End If
            
            If CSMIOS_MATERIALS_DISCOUNT > 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "HNE" Then
                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "MATERIALS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "MATERIALS")))
                ElseIf COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Then
                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "MATERIALS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "MATERIALS")))
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "PARTS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "PARTS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "PARTS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "PARTS")))
                    End If
                End If
                J_GROSS = Round(NumericVal(CSMIOS_MATERIALS_DISCOUNT), 2)
                If CSMIOS_INVOICE = "PDI RO" Then
                    J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_MATERIALS_DISCOUNT), 2)
                Else
                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                        J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_MATERIALS_DISCOUNT), 2)
                    Else
                        J_TAX = Round(NumericVal(Round((CSMIOS_MATERIALS_DISCOUNT / 1.12), 2) * 0.12), 2)
                        J_NET = Round(NumericVal(CSMIOS_MATERIALS_DISCOUNT) - Round(NumericVal(J_TAX), 2), 2)
                    End If
                End If
                J_DEBIT = Round(NumericVal(J_NET), 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                
            End If
            
            If CSMIOS_ACCESSORIES_DISCOUNT > 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                
                If COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Then
                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("SERVICE", "ACCESSORIES"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("SERVICE", "ACCESSORIES")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnDiscount_AccountCode("PARTS", "PARTS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDiscount_AccountCode("PARTS", "PARTS")))
                End If
                
                
                J_GROSS = Round(NumericVal(CSMIOS_ACCESSORIES_DISCOUNT), 2)
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_ACCESSORIES_DISCOUNT), 2)
                Else
                    J_TAX = Round(NumericVal(Round((CSMIOS_ACCESSORIES_DISCOUNT / 1.12), 2) * 0.12), 2)
                    J_NET = Round(NumericVal(CSMIOS_ACCESSORIES_DISCOUNT) - Round(NumericVal(J_TAX), 2), 2)
                End If
                J_DEBIT = Round(NumericVal(J_NET), 2)
                J_CREDIT = 0
                ALL_DEBIT = ALL_DEBIT + J_DEBIT
                
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                
            End If
        End If
    End If
    
    CUSTOMER_ENTRY_DISCOUNT = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    CUSTOMER_ENTRY_DISCOUNT = False
    ShowVBError
End Function



Function CUSTOMER_ENTRY_SALES() As Boolean
On Error GoTo ErrorCode

''LABOR CUSTOMER GJ + BP + PMS ONLY
    If (COMPANY_CODE = "MGS" Or COMPANY_CODE = "HNE") And (CSMIOS_PMS <> 0 Or CSMIOS_SUBLET <> 0 Or CSMIOS_LABOR <> 0) Then
        ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
        
        If COMPANY_CODE = "MGS" Then
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
        Else
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL")))
        End If
        
        J_GROSS = NumericVal(CSMIOS_LABOR + CSMIOS_SUBLET + CSMIOS_PMS)
        
        If CSMIOS_INVOICE = "PDI RO" Then
            J_TAX = 0
            J_NET = Round(NumericVal(CSMIOS_LABOR + CSMIOS_SUBLET + CSMIOS_PMS), 2)
        Else
            If CSMIOS_VAT_EXEMPT = True Then
                J_TAX = 0
                J_NET = Round(NumericVal(CSMIOS_LABOR + CSMIOS_SUBLET + CSMIOS_PMS), 2)
            Else
                J_TAX = Round(NumericVal(Round(((CSMIOS_LABOR + CSMIOS_SUBLET + CSMIOS_PMS) / 1.12), 2) * 0.12), 2)
                J_NET = Round(NumericVal(CSMIOS_LABOR + CSMIOS_SUBLET + CSMIOS_PMS) - Round(NumericVal(J_TAX), 2), 2)
            End If
        End If
        
        J_DEBIT = 0
        J_CREDIT = Round(NumericVal(J_NET), 2)
        ALL_CREDIT = ALL_CREDIT + J_CREDIT
        Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
    Else
''LABOR CUSTOMER GJ + PMS ONLY
        If CSMIOS_LABOR + CSMIOS_PMS > 0 Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HGS" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
            ElseIf COMPANY_CODE = "HCE" Then
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJCHG", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJCHG", "CUSTOMER")))
                End If
            ElseIf COMPANY_CODE = "CMC" Then
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ-CSH", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ-CSH", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ-CHG", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ-CHG", "CUSTOMER")))
                End If
            Else
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL")))
            End If
            
            If COMPANY_CODE = "CMC" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                J_GROSS = NumericVal(CSMIOS_LABOR + CSMIOS_PMS)
            Else
                J_GROSS = NumericVal(CSMIOS_LABOR)
            End If
            
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HGS" Then
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_NET = (Round(NumericVal((CSMIOS_LABOR + CSMIOS_PMS) - (CSMIOS_LABOR_DISCOUNT + CSMIOS_PMS_DISCOUNT)), 2))
                Else
                    J_NET = (Round(NumericVal((CSMIOS_LABOR + CSMIOS_PMS) - (CSMIOS_LABOR_DISCOUNT + CSMIOS_PMS_DISCOUNT)) / 1.12, 2))
                End If
            ElseIf COMPANY_CODE = "CMC" Then
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_NET = (Round(NumericVal(CSMIOS_LABOR + CSMIOS_PMS), 2))
                Else
                    J_NET = (Round(NumericVal(CSMIOS_LABOR + CSMIOS_PMS) / 1.12, 2))
                End If
            Else
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_NET = Round(NumericVal(CSMIOS_LABOR + CSMIOS_PMS), 2)
                Else
                    J_NET = Round(NumericVal(NumericVal(CSMIOS_LABOR + CSMIOS_PMS) / 1.12), 2)
                End If
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
''PARTS CUSTOMER PMS ONLY
        If CSMIOS_TINSPAINT + CSMIOS_TINSPAINT_PARTS > 0 Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER")))
                Else
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-BPCHG", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-BPCHG", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-BP", "CUSTOMER")))
                    End If
                End If
            ElseIf COMPANY_CODE = "CMC" Then
            ElseIf COMPANY_CODE = "MGS" Then
                GoTo TOTAL_PMA_GJ_BP:
            Else
                If CSMIOS_TERM = "CSH" Then
                    If COMPANY_CODE = "HNE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR", "RETAIL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "BODY", "RETAIL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "BODY", "RETAIL")))
                    End If
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "BODY", "RETAIL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "BODY", "RETAIL")))
                End If
            End If
            
            J_GROSS = Round(NumericVal(CSMIOS_TINSPAINT + CSMIOS_TINSPAINT_PARTS), 2)
            
            If CSMIOS_INVOICE = "PDI RO" Then
                J_TAX = 0
                J_NET = Round(NumericVal(CSMIOS_TINSPAINT + CSMIOS_TINSPAINT_PARTS), 2)
            Else
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_TAX = 0
                    J_NET = Round(NumericVal(CSMIOS_TINSPAINT + CSMIOS_TINSPAINT_PARTS), 2)
                Else
                    J_TAX = Round(NumericVal(Round((CSMIOS_TINSPAINT + CSMIOS_TINSPAINT_PARTS / 1.12), 2) * 0.12), 2)
                    If COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Then
                        J_NET = Round(NumericVal(CSMIOS_TINSPAINT - CSMIOS_TINSPAINT_DISCOUNT) / 1.12, 2)
                    Else
                        J_NET = Round(NumericVal(NumericVal(CSMIOS_TINSPAINT + CSMIOS_TINSPAINT_PARTS) / 1.12), 2)
                    End If
                End If
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    
''SUBLET CUSTOMER GJ ONLY
        If COMPANY_CODE = "CMC" Then
        Else
            If CSMIOS_SUBLET > 0 Then
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER")))
                ElseIf COMPANY_CODE = "HGS" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LABOR-GJ", "CUSTOMER")))
                ElseIf COMPANY_CODE = "HCE" Then
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLETCSH", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLETCSH", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLETCHG", "CUSTOMER")))
                    End If
                Else
                    If CSMIOS_TERM = "CSH" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "RETAIL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "RETAIL")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "RETAIL"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "RETAIL")))
                    End If
                End If
                
                J_GROSS = NumericVal(CSMIOS_SUBLET)
                If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Then
                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                        J_NET = Round(NumericVal(CSMIOS_SUBLET - CSMIOS_SUBLET_DISCOUNT), 2)
                    Else
                        J_NET = Round(NumericVal(CSMIOS_SUBLET - CSMIOS_SUBLET_DISCOUNT) / 1.12, 2)
                    End If
                Else
                    If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                        J_NET = Round(NumericVal(NumericVal(CSMIOS_SUBLET)), 2)
                    Else
                        J_NET = Round(NumericVal(NumericVal(CSMIOS_SUBLET) / 1.12), 2)
                    End If
                End If
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
''SUBLET CUSTOMER BP ONLY
        If COMPANY_CODE = "CMC" Then
        Else
            If CSMIOS_SUBLET_BP > 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If COMPANY_CODE = "DJM" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET", "CUSTOMER")))
                End If
                
                J_GROSS = Round(NumericVal(CSMIOS_SUBLET_BP), 2)
                J_NET = Round(NumericVal(NumericVal(CSMIOS_SUBLET_BP - CSMIOS_SUBLET_DISCOUNT_BP) / 1.12), 2)
                J_DEBIT = 0
                J_CREDIT = (Round(NumericVal(J_NET), 2))
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
'SUBLET CUSTOMER GJ + BP ONLY
        If COMPANY_CODE = "CMC" Then
            If CSMIOS_SUBLET + CSMIOS_SUBLET_BP > 0 Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET-GJ-CSH", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET-GJ-CSH", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "SUBLET-GJ-CHG", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "SUBLET-GJ-CHG", "CUSTOMER")))
                End If
                
                J_GROSS = Round(NumericVal(CSMIOS_SUBLET + CSMIOS_SUBLET_BP), 2)
                J_NET = Round(NumericVal(NumericVal(CSMIOS_SUBLET + CSMIOS_SUBLET_BP) / 1.12), 2)
                J_DEBIT = 0
                J_CREDIT = (Round(NumericVal(J_NET), 2))
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
    End If
        
''PARTS + MATERIALS + ACCESSORIES CUSTOMER GJ ONLY
    If COMPANY_CODE = "HCA" Or COMPANY_CODE = "HGS" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
        If CSMIOS_PARTS > 0 Or CSMIOS_MATERIALS > 0 Or CSMIOS_ACCESSORIES > 0 Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
            J_GROSS = Round(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES), 2)
            If CSMIOS_INVOICE = "PDI RO" Then
                J_TAX = 0
                J_NET = Round(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES), 2)
            Else
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_TAX = 0
                    J_NET = Round(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES), 2)
                Else
                    J_TAX = Round(NumericVal(Round(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES) / 1.12 * 0.12), 2)
                    If COMPANY_CODE = "HGS" Then
                        J_NET = Round(NumericVal(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES - NumericVal(CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT)) / 1.12), 2)
                    Else
                        J_NET = Round(NumericVal(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES) / 1.12), 2)
                    End If
                End If
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
''MISCELLANEOUS CUSTOMER GJ ONLY
        If (COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR") And CSMIOS_MISC > 0 Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("MISC", "SERVICE", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("MISC", "SERVICE", "CUSTOMER")))
            J_GROSS = Round(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES), 2)
            If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                J_TAX = 0
                J_NET = Round(NumericVal(CSMIOS_MISC), 2)
            Else
                J_TAX = Round(NumericVal(Round(CSMIOS_MISC) / 1.12 * 0.12), 2)
                J_NET = Round(NumericVal(NumericVal(CSMIOS_MISC) / 1.12), 2)
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    ElseIf COMPANY_CODE = "MGS" Then
        GoTo TOTAL_PMA_GJ_BP
    ElseIf COMPANY_CODE = "CMC" Then
''PARTS + ACCESSORIES GJ + BP ONLY
        If CSMIOS_PARTS + CSMIOS_PARTS_BP + CSMIOS_ACCESSORIES + CSMIOS_ACCESSORIES_BP > 0 Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ-CSH", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ-CSH", "CUSTOMER")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ-CHG", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ-CHG", "CUSTOMER")))
            End If
            
            J_GROSS = Round(NumericVal(CSMIOS_PARTS + CSMIOS_PARTS_BP + CSMIOS_ACCESSORIES + CSMIOS_ACCESSORIES_BP), 2)

            If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                J_NET = (Round(NumericVal(CSMIOS_PARTS + CSMIOS_PARTS_BP + CSMIOS_ACCESSORIES + CSMIOS_ACCESSORIES_BP), 2))
            Else
                J_NET = (Round(NumericVal(CSMIOS_PARTS + CSMIOS_PARTS_BP + CSMIOS_ACCESSORIES + CSMIOS_ACCESSORIES_BP) / 1.12, 2))
            End If

            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
''MATERIALS GJ + BP ONLY
        If CSMIOS_MATERIALS + CSMIOS_MATERIALS_BP > 0 Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ-CSH", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ-CSH", "CUSTOMER")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ-CHG", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ-CHG", "CUSTOMER")))
            End If
            
            J_GROSS = Round(NumericVal(CSMIOS_MATERIALS + CSMIOS_MATERIALS_BP), 2)

            If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                J_NET = (Round(NumericVal(CSMIOS_MATERIALS + CSMIOS_MATERIALS_BP), 2))
            Else
                J_NET = (Round(NumericVal(CSMIOS_MATERIALS + CSMIOS_MATERIALS_BP) / 1.12, 2))
            End If

            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
        CUSTOMER_ENTRY_SALES = True
        Exit Function
    Else
''PARTS CUSTOMER GJ ONLY
        If CSMIOS_PARTS > 0 Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
                Else
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJCHG", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJCHG", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
                    End If
                End If
            Else
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "RETAIL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "RETAIL")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS", "RETAIL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS", "RETAIL")))
                End If
            End If
            
            J_GROSS = Round(NumericVal(CSMIOS_PARTS), 2)
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Then
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_NET = (Round(NumericVal(CSMIOS_PARTS - CSMIOS_PARTS_DISCOUNT), 2))    '+ Round(CSMIOS_LABOR_DISCOUNT / 1.12, 2)
                Else
                    J_NET = (Round(NumericVal(CSMIOS_PARTS - CSMIOS_PARTS_DISCOUNT) / 1.12, 2))
                End If
            Else
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_NET = Round(NumericVal(CSMIOS_PARTS), 2)
                Else
                    J_NET = Round(NumericVal(NumericVal(CSMIOS_PARTS) / 1.12), 2)
                End If
            End If
                J_DEBIT = 0
                J_CREDIT = Round(NumericVal(J_NET), 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
''MATERIALS CUSTOMER GJ ONLY
        If CSMIOS_MATERIALS > 0 Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HSM" Or COMPANY_CODE = "HMR" Then
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                Else
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJCHG", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJCHG", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-GJ", "CUSTOMER")))
                    End If
                End If
            Else
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "RETAIL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "RETAIL")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "RETAIL"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "LUBRICANTS", "RETAIL")))
                End If
            End If
            
            J_GROSS = Round(NumericVal(CSMIOS_MATERIALS), 2)
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Then
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_NET = Round(NumericVal(CSMIOS_MATERIALS - CSMIOS_MATERIALS_DISCOUNT), 2)
                Else
                    J_NET = Round(NumericVal(NumericVal(CSMIOS_MATERIALS - CSMIOS_MATERIALS_DISCOUNT) / 1.12), 2)
                End If
            Else
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_NET = Round(NumericVal(CSMIOS_MATERIALS), 2)
                Else
                     J_NET = Round(NumericVal(NumericVal(CSMIOS_MATERIALS) / 1.12), 2)
                End If
            End If
            J_DEBIT = 0
            J_CREDIT = NumericVal(J_NET)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    
''ACCESSORIES CUSTOMER BP ONLY
    'NO EXISTING CODE
    
''PARTS CUSTOMER BP ONLY
        If CSMIOS_PARTS_BP > 0 Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If COMPANY_CODE = "HCE" Then
                If CSMIOS_TERM = "CSH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-BP", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-BP", "CUSTOMER")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-BPCHG", "CUSTOMER"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-BPCHG", "CUSTOMER")))
                End If
            Else
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-BP", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-BP", "CUSTOMER")))
            End If
            J_GROSS = Round(NumericVal(CSMIOS_PARTS_BP), 2)
            
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DGI" Then
                J_NET = (Round(NumericVal(CSMIOS_PARTS_BP - CSMIOS_PARTS_DISCOUNT_BP) / 1.12, 2))    '+ Round(CSMIOS_LABOR_DISCOUNT / 1.12, 2)
            Else
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                J_NET = Round(NumericVal(CSMIOS_PARTS_BP), 2)
                Else
                J_NET = Round(NumericVal(NumericVal(CSMIOS_PARTS_BP) / 1.12), 2)
                End If
            End If
            
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
''MATERIALS CUSTOMER BP ONLY
        If CSMIOS_MATERIALS_BP > 0 Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "MATERIALS-BP", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "MATERIALS-BP", "CUSTOMER")))
            J_GROSS = Round(NumericVal(CSMIOS_MATERIALS_BP), 2)
                        
            If COMPANY_CODE = "DJM" Then
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_NET = Round(NumericVal(CSMIOS_MATERIALS_BP - CSMIOS_MATERIALS_DISCOUNT_BP), 2)
                Else
                    J_NET = Round(NumericVal(NumericVal(CSMIOS_MATERIALS_BP - CSMIOS_MATERIALS_DISCOUNT_BP) / 1.12), 2)
                End If
            Else
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                     J_NET = Round(NumericVal(CSMIOS_MATERIALS_BP), 2)
                Else
                    J_NET = Round(NumericVal(NumericVal(CSMIOS_MATERIALS_BP) / 1.12), 2)
                End If
            End If
            
            J_DEBIT = 0
            J_CREDIT = (Round(NumericVal(J_NET), 2))
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
''ACCESSORIES CUSTOMER GJ ONLY
        If CSMIOS_ACCESSORIES > 0 Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER")))
            Else
                If CSMIOS_TERM = "CSH" Then
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIES", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED")))
                    End If
                Else
                    If COMPANY_CODE = "HCE" Then
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "ACCESSORIESCHG", "CUSTOMER"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "ACCESSORIESCHG", "CUSTOMER")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("ACCESSORIES", "INSTALLED")))
                    End If
                End If
            End If
            J_GROSS = Round(NumericVal(CSMIOS_ACCESSORIES), 2)
            If CSMIOS_INVOICE = "PDI RO" Then
                J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_ACCESSORIES), 2)
            Else
                If CSMIOS_VAT_EXEMPT = True Then
                    J_TAX = 0: J_NET = Round(NumericVal(CSMIOS_ACCESSORIES), 2)
                Else
                    J_TAX = Round(NumericVal(Round((CSMIOS_ACCESSORIES / 1.12), 2) * 0.12), 2)
                    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DGI" Then
                        J_NET = Round(NumericVal(CSMIOS_ACCESSORIES - CSMIOS_ACCESSORIES_DISCOUNT) / 1.12, 2)
                    Else
                        J_NET = Round(NumericVal(CSMIOS_ACCESSORIES) - Round(NumericVal(J_TAX), 2), 2)
                    End If
                End If
            End If
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If

TOTAL_PMA_GJ_BP:
''PARTS + MATERIALS + ACCESSORIES CUSTOMER GJ + BP ONLY
    If COMPANY_CODE = "MGS" Then
        If CSMIOS_TINSPAINT > 0 Or CSMIOS_TINSPAINT_PARTS > 0 Or CSMIOS_PARTS > 0 Or CSMIOS_PARTS_BP > 0 Or CSMIOS_MATERIALS > 0 Or CSMIOS_MATERIALS_BP > 0 Or CSMIOS_ACCESSORIES > 0 Or CSMIOS_ACCESSORIES_BP > 0 Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnSales_AccountCode("SERVICE", "PARTS-GJ", "CUSTOMER")))
            J_GROSS = Round(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES), 2)
            
            If CSMIOS_INVOICE = "PDI RO" Then
                J_TAX = 0
                J_NET = Round(NumericVal(CSMIOS_TINSPAINT + CSMIOS_TINSPAINT_PARTS + CSMIOS_PARTS + CSMIOS_PARTS_BP + CSMIOS_MATERIALS + CSMIOS_MATERIALS_BP + CSMIOS_ACCESSORIES + CSMIOS_ACCESSORIES_BP), 2)
            Else
                If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                    J_TAX = 0
                    J_NET = Round(NumericVal(CSMIOS_TINSPAINT + CSMIOS_TINSPAINT_PARTS + CSMIOS_PARTS + CSMIOS_PARTS_BP + CSMIOS_MATERIALS + CSMIOS_MATERIALS_BP + CSMIOS_ACCESSORIES + CSMIOS_ACCESSORIES_BP), 2)
                Else
                    J_TAX = Round(NumericVal(Round(CSMIOS_TINSPAINT + CSMIOS_TINSPAINT_PARTS + CSMIOS_PARTS + CSMIOS_PARTS_BP + CSMIOS_MATERIALS + CSMIOS_MATERIALS_BP + CSMIOS_ACCESSORIES + CSMIOS_ACCESSORIES_BP) / 1.12 * 0.12), 2)
                    J_NET = Round(NumericVal(NumericVal(CSMIOS_TINSPAINT + CSMIOS_TINSPAINT_PARTS + CSMIOS_PARTS + CSMIOS_PARTS_BP + CSMIOS_MATERIALS + CSMIOS_MATERIALS_BP + CSMIOS_ACCESSORIES + CSMIOS_ACCESSORIES_BP - NumericVal(CSMIOS_PARTS_DISCOUNT + CSMIOS_PARTS_DISCOUNT_BP + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT_BP + CSMIOS_ACCESSORIES_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT_BP)) / 1.12), 2)
                End If
            End If
            
            J_DEBIT = 0
            J_CREDIT = Round(NumericVal(J_NET), 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If
    
    CUSTOMER_ENTRY_SALES = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    CUSTOMER_ENTRY_SALES = False
    ShowVBError
End Function

Function CUSTOMER_ENTRY_INVENTORY() As Boolean
    On Error GoTo ErrorCode
    
    If COMPANY_CODE = "CMC" Then GoTo EXIT_INVENTORY
    
''LABOR GJ ONLY
    If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
        GoTo Skip_Service_Inventory_GJ
    ElseIf COMPANY_CODE = "MGS" Then
        GoTo Skip_Service_Inventory_GJ_BP
    Else
        If CSMIOS_LABOR_COST + CSMIOS_PMS_COST > 0 And INSURANCE_DIRECT_EXPENSE_LABOR = 0 Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            
            If COMPANY_CODE = "HCA" Then
                J_ACCT_CODE = N2Str2Null(ReturnInventory("PAYROLL"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PAYROLL")))
                J_DEBIT = 0
            Else
                J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
                J_DEBIT = 0
            End If
            
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                J_CREDIT = Round(CSMIOS_LABOR_COST + CSMIOS_PMS_COST, 2)
            Else
                J_CREDIT = Round(CSMIOS_LABOR_COST, 2)
            End If
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If
    
Skip_Service_Inventory_GJ:
''LABOR BP ONLY
    If COMPANY_CODE = "MGS" Then
    Else
        If CSMIOS_TINSPAINT_COST + CSMIOS_TINSPAINT_COST_PARTS > 0 And INSURANCE_DIRECT_EXPENSE_LABOR_BP + INSURANCE_DIRECT_EXPENSE_LABOR_BP_PARTS = 0 Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnInventory("IN-PROCESS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("IN-PROCESS")))
            End If
            J_DEBIT = 0
            J_CREDIT = Round(CSMIOS_TINSPAINT_COST + CSMIOS_TINSPAINT_COST_PARTS, 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If
    
''SUBLET INVENTORY GJ + BP ONLY
    If COMPANY_CODE = "DJM" Then
        If (CSMIOS_SUBLET_COST + CSMIOS_SUBLET_COST_BP) > 0 And (INSURANCE_DIRECT_EXPENSE_SR + INSURANCE_DIRECT_EXPENSE_SR_BP) = 0 And (COMPANY_CODE <> "HSB" And COMPANY_CODE <> "HBC" And COMPANY_CODE <> "HLB" And COMPANY_CODE <> "HCR") Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
            End If
            J_DEBIT = 0
            J_CREDIT = Round(CSMIOS_SUBLET_COST + CSMIOS_SUBLET_COST_BP, 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    ElseIf COMPANY_CODE = "MGS" Then
    Else
''SUBLET INVENTORY GJ ONLY
        If CSMIOS_SUBLET_COST > 0 And INSURANCE_DIRECT_EXPENSE_SR = 0 And (COMPANY_CODE <> "HSB" And COMPANY_CODE <> "HBC" And COMPANY_CODE <> "HLB" And COMPANY_CODE <> "HCR") Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If CSMIOS_TERM = "CSH" Then
                J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnInventory("SUBLET"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("SUBLET")))
            End If
            J_DEBIT = 0
            J_CREDIT = Round(CSMIOS_SUBLET_COST, 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    End If
    
Skip_Service_Inventory_GJ_BP:

''PARTS + MATERIALS + ACCESSORIES GJ ONLY
    If COMPANY_CODE = "HCA" Or COMPANY_CODE = "HGS" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
        If CSMIOS_PARTS_COST + CSMIOS_MATERIALS_COST + CSMIOS_ACCESSORIES_COST > 0 And INSURANCE_DIRECT_EXPENSE_SPAREPARTS + INSURANCE_DIRECT_EXPENSE_GOL + INSURANCE_DIRECT_EXPENSE_ACCESSORIES = 0 Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DAI" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS-IN-PROCESS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS-IN-PROCESS")))
            End If
            J_DEBIT = 0
            J_CREDIT = Round(CSMIOS_PARTS_COST + CSMIOS_MATERIALS_COST + CSMIOS_ACCESSORIES_COST, 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
''PARTS + MATERIALS + ACCESSORIES GJ + BP ONLY
    ElseIf COMPANY_CODE = "MGS" Then
        If CSMIOS_PARTS_COST + CSMIOS_PARTS_COST_BP + CSMIOS_MATERIALS_COST + CSMIOS_MATERIALS_COST_BP + CSMIOS_ACCESSORIES_COST + CSMIOS_ACCESSORIES_COST_BP > 0 Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS-IN-PROCESS"))
            J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS-IN-PROCESS")))
            J_DEBIT = 0
            J_CREDIT = Round(CSMIOS_PARTS_COST + CSMIOS_PARTS_COST_BP + CSMIOS_MATERIALS_COST + CSMIOS_MATERIALS_COST_BP + CSMIOS_ACCESSORIES_COST + CSMIOS_ACCESSORIES_COST_BP, 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
    Else
''PARTS GJ ONLY
        If COMPANY_CODE = "HCE" Then
            If CSMIOS_PARTS_INV_GEN > 0 And INSURANCE_DIRECT_EXPENSE_SPAREPARTS = 0 Then    ''PARTS INVENTORY GEN
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                J_DEBIT = 0
                J_CREDIT = Round(CSMIOS_PARTS_INV_GEN, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
            
            If CSMIOS_PARTS_INV_NONGEN > 0 And INSURANCE_DIRECT_EXPENSE_SPAREPARTS = 0 Then ''PARTS INVENTORY NON GEN
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnInventory("NONGEN_PARTS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("NONGEN_PARTS")))
                J_DEBIT = 0
                J_CREDIT = Round(CSMIOS_PARTS_INV_NONGEN, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        Else
            If CSMIOS_PARTS_COST > 0 And INSURANCE_DIRECT_EXPENSE_SPAREPARTS = 0 Then
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                If CSMIOS_TERM = "CSH" Then
                    If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HMR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                    End If
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                End If
                J_DEBIT = 0
                J_CREDIT = Round(CSMIOS_PARTS_COST, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
''MATERIALS GJ ONLY
        If CSMIOS_MATERIALS_COST > 0 And INSURANCE_DIRECT_EXPENSE_GOL = 0 Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If CSMIOS_TERM = "CSH" Then
                If COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HMR" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                End If
                
            Else
                If COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                End If
            End If
            J_GROSS = 0: J_TAX = 0: J_NET = 0
            J_DEBIT = 0
            J_CREDIT = Round(CSMIOS_MATERIALS_COST, 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
''ACCESSORIES GJ ONLY
        If CSMIOS_ACCESSORIES_COST > 0 And INSURANCE_DIRECT_EXPENSE_ACCESSORIES = 0 Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DAI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HMR" Then
                J_ACCT_CODE = N2Str2Null(ReturnInventory("ACCESSORIES", "INVA"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("ACCESSORIES", "INVA")))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnInventory("AIN-PROCESS"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("AIN-PROCESS")))
            End If
            J_DEBIT = 0
            J_CREDIT = Round(CSMIOS_ACCESSORIES_COST, 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
''PARTS BP ONLY
        If CSMIOS_PARTS_COST_BP > 0 And CSMIOS_PARTICIPAT = "" Then
            ItemCnt = ItemCnt + 1
            J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If COMPANY_CODE = "HMH" Then
                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
            Else
                If CSMIOS_TERM = "CSH" Then
                    If COMPANY_CODE = "DGI" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS")))
                    End If
                Else
                    If COMPANY_CODE = "DJM" Then
                        J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                    End If
                End If
            End If
            J_DEBIT = 0
            J_CREDIT = Round(CSMIOS_PARTS_COST_BP, 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
        If CSMIOS_PARTS_COST_BP > 0 And CSMIOS_PARTICIPAT <> "" And INSURANCE_DIRECT_EXPENSE_SPAREPARTS_BP = 0 Then
            If COMPANY_CODE = "DJM" Then
                ItemCnt = ItemCnt + 1
                J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnInventory("PARTS", "INVP"))
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("PARTS", "INVP")))
                
                J_DEBIT = 0
                J_CREDIT = Round(CSMIOS_PARTS_COST_BP, 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
            End If
        End If
        
''MATERIALS BP ONLY
        If CSMIOS_MATERIALS_COST_BP > 0 Then
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If CSMIOS_TERM = "CSH" Then
                If COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                End If
            Else
                If COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Then
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS", "INVM", "MATERIALS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS", "INVM", "MATERIALS")))
                Else
                    J_ACCT_CODE = N2Str2Null(ReturnInventory("MATERIALS"))
                    J_ACCT_NAME = N2Str2Null(Setacctname(ReturnInventory("MATERIALS")))
                End If
            End If
            J_GROSS = 0: J_TAX = 0: J_NET = 0
            J_DEBIT = 0
            J_CREDIT = Round(CSMIOS_MATERIALS_COST_BP, 2)
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
        End If
        
''ACCESSORIES BP ONLY
        'NO EXISTING CODE
    End If
    
EXIT_INVENTORY:
    CUSTOMER_ENTRY_INVENTORY = True
    Exit Function
    
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    CUSTOMER_ENTRY_INVENTORY = False
    ShowVBError
End Function

Function CUSTOMER_ENTRY_TAX() As Boolean
On Error GoTo ErrorCode
'OUTPUT TAX
If J_INVOICEAMT > 0 Then
    If CSMIOS_VAT_EXEMPT = False And CSMIOS_VAT_EXEMPT1 = False Then
        If COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Or COMPANY_CODE = "HCE" Or COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
            If COMPANY_CODE = "HMR" Or COMPANY_CODE = "HCE" Then
                ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                J_ACCT_CODE = N2Str2Null(ReturnDeferredOutPutTax())
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDeferredOutPutTax()))
                
                J_CREDIT = Round(NumericVal(NumericVal(NumericVal(J_INVOICEAMT)) / 1.12 * 0.12), 2)
                ALL_CREDIT = ALL_CREDIT + J_CREDIT
                J_TAX = 0: J_GROSS = 0: J_NET = 0: J_DEBIT = 0
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                Call DOTAX_SERVICE
            Else
                If Round(NumericVal(NumericVal(NumericVal(CSMIOS_TINSPAINT + CSMIOS_SUBLET + CSMIOS_LABOR) - NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT)) / 1.12 * 0.12), 2) > 0 Then
                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnAccountCode("OTSERVICE"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("OTSERVICE")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnAccountCode("DOTSERVICE"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("DOTSERVICE")))
                    End If
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(NumericVal(NumericVal(CSMIOS_TINSPAINT + CSMIOS_SUBLET + CSMIOS_LABOR) - NumericVal(CSMIOS_LABOR_DISCOUNT + CSMIOS_SUBLET_DISCOUNT + CSMIOS_TINSPAINT_DISCOUNT + CSMIOS_PMS_DISCOUNT)) / 1.12 * 0.12), 2)
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    ''INSERT AMIS_AP
                    Set rsDOTCIS = New ADODB.Recordset
                    Set rsDOTCIS = gconDMIS.Execute("SELECT * FROM AMIS_CHARTACCOUNT WHERE AcctCode = " & J_ACCT_CODE & " AND IS_SCHEDULE_ACCNT =1 AND TRANTYPE1 = 'DOTSERVICE'")
                    If Not rsDOTCIS.EOF And Not rsDOTCIS.BOF Then
                        xIDDOTAX = (gconDMIS.Execute("SELECT ID FROM AMIS_JOURNAL_DET WHERE JTYPE =" & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE = " & J_ACCT_CODE & "").Fields(0).Value)
                        xCNAME = (gconDMIS.Execute("select ACCOUNTNAME from ALL_ENTITY   WHERE ENTITYCODE = 'C' AND CODE = " & J_CUSTOMERCODE & "").Fields(0).Value)
                        SQL_STATEMENT = "INSERT INTO AMIS_AP (Voucherno,Vendor_code,VENDOR_NAME,invoicedate,Amount2pay,AmountPaid,Balance,Acct_code,LastUpdated,INVOICENO,INVOICETYPE,JDATE,MODIFIED_DATE,REFCODE,ENTITYCODE,STATUS,JOURNAL_DET_ID) " & _
                        " values ('" & "SJ" + "-" + CUSTOMER_VOUCHERNO_TAX & "', " & J_CUSTOMERCODE & ", '" & xCNAME & "', " & J_INVOICEDATE & "," & J_CREDIT & ",'0'," & J_CREDIT & "," & J_ACCT_CODE & "," & J_JDATE & ", " & J_INVOICENO & ", " & J_INVOICETYPE & "," & J_JDATE & "," & J_JDATE & ",'" & "C" + CSMIOS_ACCT_NO & "','C','N'," & xIDDOTAX & ")"
                        gconDMIS.Execute SQL_STATEMENT
                    End If
                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                    J_TAX = 0: J_GROSS = 0: J_NET = 0: J_DEBIT = 0: J_CREDIT = 0: xIDDOTAX = "": xCNAME = ""
                End If
                
                If Round(NumericVal(NumericVal(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES + CSMIOS_TINSPAINT_DISCOUNT_PARTS + CSMIOS_MISC) - NumericVal(CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT)) / 1.12 * 0.12), 2) > 0 Then
                    ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
                    If COMPANY_CODE = "HSB" Or COMPANY_CODE = "HBC" Or COMPANY_CODE = "HLB" Or COMPANY_CODE = "HCR" Then
                        J_ACCT_CODE = N2Str2Null(ReturnAccountCode("OTPARTS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("OTPARTS")))
                    Else
                        J_ACCT_CODE = N2Str2Null(ReturnAccountCode("DOTPARTS"))
                        J_ACCT_NAME = N2Str2Null(Setacctname(ReturnAccountCode("DOTPARTS")))
                    End If
                    J_DEBIT = 0
                    J_CREDIT = Round(NumericVal(NumericVal(NumericVal(CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES + CSMIOS_TINSPAINT_COST_PARTS + CSMIOS_MISC) - NumericVal(CSMIOS_PARTS_DISCOUNT + CSMIOS_MATERIALS_DISCOUNT + CSMIOS_ACCESSORIES_DISCOUNT + CSMIOS_TINSPAINT_COST_PARTS)) / 1.12 * 0.12), 2)
                    Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                    ''INSERT AMIS_AP
                    Set rsDOTCIS = New ADODB.Recordset
                    Set rsDOTCIS = gconDMIS.Execute("SELECT * FROM AMIS_CHARTACCOUNT WHERE AcctCode = " & J_ACCT_CODE & " AND IS_SCHEDULE_ACCNT =1 AND TRANTYPE1 = 'DOTPARTS'")
                    If Not rsDOTCIS.EOF And Not rsDOTCIS.BOF Then
                        xIDDOTAX = (gconDMIS.Execute("SELECT ID FROM AMIS_JOURNAL_DET WHERE JTYPE =" & J_JTYPE & " AND VOUCHERNO = " & J_VOUCHERNO & " AND ACCT_CODE = " & J_ACCT_CODE & "").Fields(0).Value)
                        xCNAME = (gconDMIS.Execute("select ACCOUNTNAME from ALL_ENTITY   WHERE ENTITYCODE = 'C' AND CODE = " & J_CUSTOMERCODE & "").Fields(0).Value)
                        SQL_STATEMENT = "INSERT INTO AMIS_AP (Voucherno,Vendor_code,VENDOR_NAME,invoicedate,Amount2pay,AmountPaid,Balance,Acct_code,LastUpdated,INVOICENO,INVOICETYPE,JDATE,MODIFIED_DATE,REFCODE,ENTITYCODE,STATUS,JOURNAL_DET_ID) " & _
                        " values ('" & "SJ" + "-" + CUSTOMER_VOUCHERNO_TAX & "', " & J_CUSTOMERCODE & ", '" & xCNAME & "', " & J_INVOICEDATE & "," & J_CREDIT & ",'0'," & J_CREDIT & "," & J_ACCT_CODE & "," & J_JDATE & ", " & J_INVOICENO & ", " & J_INVOICETYPE & "," & J_JDATE & "," & J_JDATE & ",'" & "C" + CSMIOS_ACCT_NO & "','C','N'," & xIDDOTAX & ")"
                        gconDMIS.Execute SQL_STATEMENT
                    End If
                    ''--------------------------------------
                    ALL_CREDIT = ALL_CREDIT + J_CREDIT
                    J_TAX = 0: J_GROSS = 0: J_NET = 0: J_DEBIT = 0: J_CREDIT = 0: xIDDOTAX = "": xCNAME = ""
                End If
            End If
        Else
            ItemCnt = ItemCnt + 1: J_JITEMNO = "'" & Format(ItemCnt, "0000") & "'"
            If COMPANY_CODE = "DJM" Or COMPANY_CODE = "DAI" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "HCE" Then
                J_ACCT_CODE = N2Str2Null(ReturnDeferredOutPutTax())
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnDeferredOutPutTax()))
            Else
                J_ACCT_CODE = N2Str2Null(ReturnOutputTax())
                J_ACCT_NAME = N2Str2Null(Setacctname(ReturnOutputTax()))
            End If
            
            J_DEBIT = 0
            
            If COMPANY_CODE = "MGS" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "DSSC" Then
                J_CREDIT = Round(NumericVal(J_INVOICEAMT - (AmountLessVAT(J_VOUCHERNO, J_JTYPE))), 2)
            Else
                J_CREDIT = Round(NumericVal(J_INVOICEAMT - (AmountLessVAT(J_VOUCHERNO, J_JTYPE) - DiscountLessVAT(J_VOUCHERNO, J_JTYPE))), 2)
            End If
            ALL_CREDIT = ALL_CREDIT + J_CREDIT
            J_TAX = 0: J_GROSS = 0: J_NET = 0
            
            If COMPANY_CODE = "HCI" And CSMIOS_PARTICIPAT <> "" Then
            Else
                Call InsertToJournalDet(J_JDATE, J_VOUCHERNO, J_JTYPE, J_JNO, J_JITEMNO, J_ACCT_CODE, J_ACCT_NAME, J_DEBIT, J_CREDIT, J_TAX, J_GROSS, J_NET, J_STATUS)
                Call DOTAX_SERVICE
            End If
        End If
    End If
End If

  CUSTOMER_ENTRY_TAX = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    CUSTOMER_ENTRY_TAX = False
    ShowVBError
End Function

Function IMPORT_SALES_COMPOUND() As Boolean
    On Error GoTo ErrorCode
    
    Dim i                                                   As Integer
    Dim GridImport                                          As Integer
    Dim rsSublet                                            As ADODB.Recordset
    
    i = 0
    
    For GridImport = 1 To Grid2.Rows - 1
        If N2Str2Zero(Grid2.Cell(GridImport, 1).Text) = 0 Then
            ALL_DEBIT = 0: ALL_CREDIT = 0
            Set rsCSMIOS_REPOR = New ADODB.Recordset
            
            If COMPANY_CODE = "MGS" Or COMPANY_CODE = "DJM" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "DSSC" Or COMPANY_CODE = "FMC" Or COMPANY_CODE = "HCE" Then
                SQL_STATEMENT = "Select * from CSMS_REPOR where REP_OR = '" & Grid2.Cell(GridImport, 2).Text & "' and DTE_REL = '" & CDate(dtpTranDate) & "' order by invoice ASC"
            Else
                SQL_STATEMENT = "Select * from CSMS_REPOR where REP_OR = '" & Grid2.Cell(GridImport, 2).Text & "' and DTE_COMP = '" & CDate(dtpTranDate) & "' order by invoice ASC"
            End If
            
            Set rsCSMIOS_REPOR = gconDMIS.Execute(SQL_STATEMENT)
            If Not rsCSMIOS_REPOR.EOF And Not rsCSMIOS_REPOR.BOF Then
                If CheckSJExisting("SI", Null2String(rsCSMIOS_REPOR!INVOICE)) = True Then
                    If Null2String(rsCSMIOS_REPOR!INVOICE) = "INT RO" Or Null2String(rsCSMIOS_REPOR!INVOICE) = "PDI RO" Then
                        GoTo ImportINTRO
                    Else
                        GoTo DuplicateInvoiceNo
                    End If
                Else
ImportINTRO:
                    ItemCnt = 0
                    J_JNO = "'" & Format(GetJNo(), "000000") & "'"
                                        
                    CSMIOS_REP_OR = Null2String(rsCSMIOS_REPOR!REP_OR)
                    
'                    If CSMIOS_REP_OR = "R-00031328" Then Stop
                    
                    CSMIOS_INVOICE = Null2String(rsCSMIOS_REPOR!INVOICE)
                    CSMIOS_ACCT_NO = Null2String(rsCSMIOS_REPOR!ACCT_NO)
                    CSMIOS_PARTICIPAT = Null2String(rsCSMIOS_REPOR!PARTICIPAT)
                    CSMIOS_PLATE_NO = Null2String(rsCSMIOS_REPOR!PLATE_NO)
                    CSMIOS_NIYM = Null2String(rsCSMIOS_REPOR!Niym)
                    CSMIOS_NIYM_PRINT = Null2String(rsCSMIOS_REPOR!Niym)
                    CSMIOS_TERM = Null2String(rsCSMIOS_REPOR!TERM)
                    CSMIOS_VAT_EXEMPT = Null2Bool(rsCSMIOS_REPOR!VAT_EXEMPT)
                    CSMIOS_VAT_EXEMPT1 = Null2Bool(rsCSMIOS_REPOR!VAT_EXEMPT1)
                    CSMIOS_RO_AMOUNT = Round(N2Str2Zero(rsCSMIOS_REPOR!RO_AMOUNT), 2)
                    
                    If COMPANY_CODE = "MGS" Or COMPANY_CODE = "DGI" Or COMPANY_CODE = "HMH" Or COMPANY_CODE = "HCE" Then
                        CSMIOS_DTE_REL = Null2Date(rsCSMIOS_REPOR!DTE_REL)
                    Else
                        CSMIOS_DTE_REL = Null2Date(rsCSMIOS_REPOR!dte_comp)
                    End If
                    
                    TOTAL_DISCOUNT_AMOUNT = 0: TOTAL_DEBIT = 0: TOTAL_CREDIT = 0
                    
                    INITIALIZE_VARIABLE_NEW CSMIOS_REP_OR
                    
                    Set rsJournal_HDDup = New ADODB.Recordset
                    Set rsJournal_HDDup = gconDMIS.Execute("select jno from AMIS_Journal_HD order by jno desc")
                    If Not rsJournal_HDDup.EOF And Not rsJournal_HDDup.BOF Then J_JNO = "'" & Format(N2Str2Zero(rsJournal_HDDup!JNo) + 1, "000000") & "'"
                
                    J_JDATE = N2Date2Null(CSMIOS_DTE_REL)
                    
                    J_VOUCHERNO = N2Str2Null(GetVoucherNo())
                    CUSTOMER_VOUCHERNO_TAX = (GetVoucherNo())
                    J_JTYPE = "'SJ'"
                    J_REMARKS = "NULL"
                    J_VENDORCODE = "'999999'"
                    J_CUSTOMERCODE = N2Str2Null(CSMIOS_ACCT_NO)
                    J_DEBIT = 0
                    J_CREDIT = 0
                    J_TAX = 0
                    J_OUTBALANCE = 0
                    J_AMOUNTTOPAY = 0
                    
                    If COMPANY_CODE = "HNE" Then
                        CSMIOS_RO_AMOUNT = Round((CSMIOS_LABOR + CSMIOS_AIRCON + CSMIOS_TINSPAINT + CSMIOS_SUBLET + CSMIOS_PMS + CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES + CSMIOS_PARTS_NON) - TOTAL_DISCOUNT_AMOUNT, 2)
                    Else
                        If CSMIOS_VAT_EXEMPT = True Or CSMIOS_VAT_EXEMPT1 = True Then
                            CSMIOS_RO_AMOUNT = Round((CSMIOS_LABOR + CSMIOS_AIRCON + CSMIOS_TINSPAINT + CSMIOS_SUBLET + CSMIOS_PMS + CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES + CSMIOS_PARTS_BP + CSMIOS_MATERIALS_BP + CSMIOS_MISC) - TOTAL_DISCOUNT_AMOUNT, 2)
                        Else
                            CSMIOS_RO_AMOUNT = Round((CSMIOS_LABOR + CSMIOS_AIRCON + CSMIOS_TINSPAINT + CSMIOS_PMS + CSMIOS_PARTS + CSMIOS_MATERIALS + CSMIOS_ACCESSORIES + CSMIOS_SUBLET + CSMIOS_PARTS_BP + CSMIOS_MATERIALS_BP + CSMIOS_ACCESSORIES_BP + CSMIOS_SUBLET_BP + CSMIOS_MISC) - TOTAL_DISCOUNT_AMOUNT, 2)
                        End If
                    End If
                    
                    J_INVOICEAMT = Round(NumericVal(CSMIOS_RO_AMOUNT), 2)
                    J_BALANCE = Round(NumericVal(CSMIOS_RO_AMOUNT), 2)
                    J_AMOUNTPAID = 0
                    J_STATUS = "'N'"
                    J_INVOICEDATE = N2Date2Null(CSMIOS_DTE_REL)
                    J_INVOICENO = N2Str2Null(CSMIOS_INVOICE)
                    J_CHECKNO = "NULL": J_DUEDATE = N2Date2Null(CSMIOS_DTE_REL): J_PAYTYPE = "NULL": J_INVOICETYPE = "'SI'"
                    J_CHECKDATE = "NULL": J_BANKCODE = "NULL": J_REFNO = N2Str2Null(CSMIOS_REP_OR): J_REFDATE = N2Date2Null(CSMIOS_DTE_REL)
                    J_TERMS = N2Str2Null(CSMIOS_TERM): J_DEALER = "NULL": J_PAIDSTATUS = "'N'": J_RECEIVESTATUS = "'N'"
                    
                    ''***START OF CUSTOMER PAID ENTRIES***''
                    If J_INVOICEAMT > 0 Then
                        
                        If COMPANY_CODE = "DJM" Then
                            J_REMARKS = " SERVICE BILLING:" + " " + "SB" + CSMIOS_INVOICE
                        Else
                            J_REMARKS = " SERVICE INVOICENO:" + " " + "SI" + CSMIOS_INVOICE
                        End If
                        
                        SQL_STATEMENT = "Insert into AMIS_Journal_HD" & _
                                        " (jdate,voucherno,jtype,vendorcode,customercode,invoicedate,invoicetype,invoiceno,invoiceamt,duedate,paytype,refno,refdate,terms,dealer,amounttopay,Balance,AmountPaid,jno,debit,credit,outbalance,status,CheckNo,CheckDate,BankCode,remarks,PaidStatus,ReceiveStatus)" & _
                                        " values (" & J_JDATE & ", " & J_VOUCHERNO & ", " & J_JTYPE & ", " & J_VENDORCODE & "," & J_CUSTOMERCODE & ", " & J_INVOICEDATE & "," & J_INVOICETYPE & "," & J_INVOICENO & "," & J_INVOICEAMT & ", " & J_DUEDATE & ", " & J_PAYTYPE & "," & J_REFNO & "," & J_REFDATE & "," & J_TERMS & "," & J_DEALER & ", " & J_AMOUNTTOPAY & "," & J_BALANCE & "," & J_AMOUNTPAID & _
                                        ", " & J_JNO & ", " & ALL_DEBIT & ", " & ALL_CREDIT & ", " & J_OUTBALANCE & ", " & J_STATUS & ", " & J_CHECKNO & ", " & J_CHECKDATE & ", " & J_BANKCODE & ",'" & J_REMARKS & "'," & J_PAIDSTATUS & "," & J_RECEIVESTATUS & ")"
                        gconDMIS.Execute SQL_STATEMENT
                        TransactionID = (FindTransactionID(N2Str2Null(J_VOUCHERNO), "voucherno", "AMIS_journal_hd", "X", J_JTYPE, "Jtype"))
                        NEW_LogAudit "M", "JOURNAL ENTRY", SQL_STATEMENT, TransactionID, "", J_VOUCHERNO, J_JTYPE, J_JNO
                                                
                                                
                        'ENTRY FOR ACCOUNTS RECEIVABLE
                        If CUSTOMER_ENTRY_AR = False Then
                            IMPORT_SALES_COMPOUND = False
                            Exit Function
                        End If
                        
                        'ENTRY FOR COST OF SALES
                        If CUSTOMER_ENTRY_COST = False Then
                            IMPORT_SALES_COMPOUND = False
                            Exit Function
                        End If
                        
                        'ENTRY FOR DISCOUNT
                        If CUSTOMER_ENTRY_DISCOUNT = False Then
                            IMPORT_SALES_COMPOUND = False
                            Exit Function
                        End If
                        
                        'ENTRY FOR SALES
                        If CUSTOMER_ENTRY_SALES = False Then
                            IMPORT_SALES_COMPOUND = False
                            Exit Function
                        End If
                        
                        'ENTRY FOR INVENTORY
                        If CUSTOMER_ENTRY_INVENTORY = False Then
                            IMPORT_SALES_COMPOUND = False
                            Exit Function
                        End If

                        'ENTRY FOR TAX
                        If CUSTOMER_ENTRY_TAX = False Then
                            IMPORT_SALES_COMPOUND = False
                            Exit Function
                        End If
                        
                        'ENTRY FOR ROUND OF DIFFERENCE
                        If COMPANY_CODE = "HCA" Or COMPANY_CODE = "HMR" Then
                            Call rod
                        End If
                    End If
                    ''***END OF CUSTOMER PAID ENTRIES***''
                    
                    
                    ''***ENTRY FOR INTERNAL***''
                    If COMPANY_CODE = "CMC" Then
                        If CUSTOMER_ENTRY_INTERNAL_NEW = False Then
                            IMPORT_SALES_COMPOUND = False
                            Exit Function
                        End If
                    Else
                        If CUSTOMER_ENTRY_INTERNAL = False Then
                            IMPORT_SALES_COMPOUND = False
                            Exit Function
                        End If
                    End If
                    
                    ''***ENTRY FOR WARRANTY***''
                    If IMPORT_WARRANTY_NEW = False Then
                        IMPORT_SALES_COMPOUND = False
                        Exit Function
                    End If
                    
                    ''***ENTRY FOR INSURANCE***''
                    If ENTRY_FOR_INSURANCE_HCA = False Then
                        IMPORT_SALES_COMPOUND = False
                        Exit Function
                    End If
                    
                    Grid2.Cell(GridImport, 1).Text = 1
                End If
            End If
        End If
xx:
        i = i + 1
        progCPB.Value = (i / (Grid2.Rows - 1)) * 100
        labCPB.Caption = Int(progCPB.Value) & "% Completed - [" & CSMIOS_INVOICE & "]"
        DoEvents
DuplicateInvoiceNo:
    Next
    
    IMPORT_SALES_COMPOUND = True
    Exit Function
ErrorCode:
    Err_handler = "Error Number : " & err.Number & vbCrLf & "Error Description :" & err.DESCRIPTION
    IMPORT_SALES_COMPOUND = False
End Function

Private Sub Grid1_DblClick()
    If Grid1.Rows = 0 Then Exit Sub
    If Grid1.ActiveCell.Col <> 3 Then Exit Sub
    
    Dim HDInvNo As String
    HDInvNo = Right(Grid1.ActiveCell.Text, 6)
    
    JOURNALTYPE = ""
    Unload frmAMISJournalEntry_SJ
    JOURNALTYPE = "SJ"
    Call frmAMISJournalEntry_SJ.LOADJOURNAL("SJ")
    frmAMISJournalEntry_SJ.Show
    Call frmAMISJournalEntry_SJ.StoreSearch3(HDInvNo, "")
End Sub

Private Sub Grid2_DblClick()
    If Grid2.Rows = 0 Then Exit Sub
    If Grid2.ActiveCell.Col <> 2 Then Exit Sub
    
    Dim HDRefNo As String
    HDRefNo = Grid2.ActiveCell.Text

    JOURNALTYPE = ""
    Unload frmAMISJournalEntry_SJ
    JOURNALTYPE = "SJ"
    Call frmAMISJournalEntry_SJ.LOADJOURNAL("SJ")
    frmAMISJournalEntry_SJ.Show
    Call frmAMISJournalEntry_SJ.StoreSearch2(HDRefNo)
End Sub

Private Sub Grid3_DblClick()
    If Grid3.Rows = 0 Then Exit Sub
    If Grid3.ActiveCell.Col <> 3 Then Exit Sub
    
    Dim HDInvNo As String
    HDInvNo = Grid3.ActiveCell.Text
    
    JOURNALTYPE = ""
    Unload frmAMISJournalEntry_SJ
    JOURNALTYPE = "SJ"
    Call frmAMISJournalEntry_SJ.LOADJOURNAL("SJ")
    frmAMISJournalEntry_SJ.Show
    Call frmAMISJournalEntry_SJ.StoreSearch3(HDInvNo, "")
End Sub

Function ReturnInvoiceType(InvType) As String
    If InvType = "PARTS" Then ReturnInvoiceType = "PI"
    If InvType = "MATERIALS" Then ReturnInvoiceType = "MI"
    If InvType = "ACCESSORIES" Then ReturnInvoiceType = "AI"
End Function
